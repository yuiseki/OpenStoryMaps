(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))g(_);new MutationObserver(_=>{for(const b of _)if(b.type==="childList")for(const M of b.addedNodes)M.tagName==="LINK"&&M.rel==="modulepreload"&&g(M)}).observe(document,{childList:!0,subtree:!0});function u(_){const b={};return _.integrity&&(b.integrity=_.integrity),_.referrerPolicy&&(b.referrerPolicy=_.referrerPolicy),_.crossOrigin==="use-credentials"?b.credentials="include":_.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function g(_){if(_.ep)return;_.ep=!0;const b=u(_);fetch(_.href,b)}})();var Gh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var bv={exports:{}},Md={},Sv={exports:{}},zt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bc=Symbol.for("react.element"),zw=Symbol.for("react.portal"),Aw=Symbol.for("react.fragment"),Lw=Symbol.for("react.strict_mode"),Dw=Symbol.for("react.profiler"),Rw=Symbol.for("react.provider"),Bw=Symbol.for("react.context"),Fw=Symbol.for("react.forward_ref"),Ow=Symbol.for("react.suspense"),Nw=Symbol.for("react.memo"),Uw=Symbol.for("react.lazy"),e_=Symbol.iterator;function Vw(i){return i===null||typeof i!="object"?null:(i=e_&&i[e_]||i["@@iterator"],typeof i=="function"?i:null)}var Ev={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Tv=Object.assign,Cv={};function Dl(i,o,u){this.props=i,this.context=o,this.refs=Cv,this.updater=u||Ev}Dl.prototype.isReactComponent={};Dl.prototype.setState=function(i,o){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,o,"setState")};Dl.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function kv(){}kv.prototype=Dl.prototype;function km(i,o,u){this.props=i,this.context=o,this.refs=Cv,this.updater=u||Ev}var Im=km.prototype=new kv;Im.constructor=km;Tv(Im,Dl.prototype);Im.isPureReactComponent=!0;var t_=Array.isArray,Iv=Object.prototype.hasOwnProperty,Pm={current:null},Pv={key:!0,ref:!0,__self:!0,__source:!0};function Mv(i,o,u){var g,_={},b=null,M=null;if(o!=null)for(g in o.ref!==void 0&&(M=o.ref),o.key!==void 0&&(b=""+o.key),o)Iv.call(o,g)&&!Pv.hasOwnProperty(g)&&(_[g]=o[g]);var l=arguments.length-2;if(l===1)_.children=u;else if(1<l){for(var N=Array(l),D=0;D<l;D++)N[D]=arguments[D+2];_.children=N}if(i&&i.defaultProps)for(g in l=i.defaultProps,l)_[g]===void 0&&(_[g]=l[g]);return{$$typeof:bc,type:i,key:b,ref:M,props:_,_owner:Pm.current}}function jw(i,o){return{$$typeof:bc,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}}function Mm(i){return typeof i=="object"&&i!==null&&i.$$typeof===bc}function $w(i){var o={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(u){return o[u]})}var i_=/\/+/g;function tf(i,o){return typeof i=="object"&&i!==null&&i.key!=null?$w(""+i.key):o.toString(36)}function Hh(i,o,u,g,_){var b=typeof i;(b==="undefined"||b==="boolean")&&(i=null);var M=!1;if(i===null)M=!0;else switch(b){case"string":case"number":M=!0;break;case"object":switch(i.$$typeof){case bc:case zw:M=!0}}if(M)return M=i,_=_(M),i=g===""?"."+tf(M,0):g,t_(_)?(u="",i!=null&&(u=i.replace(i_,"$&/")+"/"),Hh(_,o,u,"",function(D){return D})):_!=null&&(Mm(_)&&(_=jw(_,u+(!_.key||M&&M.key===_.key?"":(""+_.key).replace(i_,"$&/")+"/")+i)),o.push(_)),1;if(M=0,g=g===""?".":g+":",t_(i))for(var l=0;l<i.length;l++){b=i[l];var N=g+tf(b,l);M+=Hh(b,o,u,N,_)}else if(N=Vw(i),typeof N=="function")for(i=N.call(i),l=0;!(b=i.next()).done;)b=b.value,N=g+tf(b,l++),M+=Hh(b,o,u,N,_);else if(b==="object")throw o=String(i),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return M}function Ph(i,o,u){if(i==null)return i;var g=[],_=0;return Hh(i,g,"","",function(b){return o.call(u,b,_++)}),g}function qw(i){if(i._status===-1){var o=i._result;o=o(),o.then(function(u){(i._status===0||i._status===-1)&&(i._status=1,i._result=u)},function(u){(i._status===0||i._status===-1)&&(i._status=2,i._result=u)}),i._status===-1&&(i._status=0,i._result=o)}if(i._status===1)return i._result.default;throw i._result}var Mn={current:null},Wh={transition:null},Zw={ReactCurrentDispatcher:Mn,ReactCurrentBatchConfig:Wh,ReactCurrentOwner:Pm};zt.Children={map:Ph,forEach:function(i,o,u){Ph(i,function(){o.apply(this,arguments)},u)},count:function(i){var o=0;return Ph(i,function(){o++}),o},toArray:function(i){return Ph(i,function(o){return o})||[]},only:function(i){if(!Mm(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};zt.Component=Dl;zt.Fragment=Aw;zt.Profiler=Dw;zt.PureComponent=km;zt.StrictMode=Lw;zt.Suspense=Ow;zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Zw;zt.cloneElement=function(i,o,u){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var g=Tv({},i.props),_=i.key,b=i.ref,M=i._owner;if(o!=null){if(o.ref!==void 0&&(b=o.ref,M=Pm.current),o.key!==void 0&&(_=""+o.key),i.type&&i.type.defaultProps)var l=i.type.defaultProps;for(N in o)Iv.call(o,N)&&!Pv.hasOwnProperty(N)&&(g[N]=o[N]===void 0&&l!==void 0?l[N]:o[N])}var N=arguments.length-2;if(N===1)g.children=u;else if(1<N){l=Array(N);for(var D=0;D<N;D++)l[D]=arguments[D+2];g.children=l}return{$$typeof:bc,type:i.type,key:_,ref:b,props:g,_owner:M}};zt.createContext=function(i){return i={$$typeof:Bw,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:Rw,_context:i},i.Consumer=i};zt.createElement=Mv;zt.createFactory=function(i){var o=Mv.bind(null,i);return o.type=i,o};zt.createRef=function(){return{current:null}};zt.forwardRef=function(i){return{$$typeof:Fw,render:i}};zt.isValidElement=Mm;zt.lazy=function(i){return{$$typeof:Uw,_payload:{_status:-1,_result:i},_init:qw}};zt.memo=function(i,o){return{$$typeof:Nw,type:i,compare:o===void 0?null:o}};zt.startTransition=function(i){var o=Wh.transition;Wh.transition={};try{i()}finally{Wh.transition=o}};zt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};zt.useCallback=function(i,o){return Mn.current.useCallback(i,o)};zt.useContext=function(i){return Mn.current.useContext(i)};zt.useDebugValue=function(){};zt.useDeferredValue=function(i){return Mn.current.useDeferredValue(i)};zt.useEffect=function(i,o){return Mn.current.useEffect(i,o)};zt.useId=function(){return Mn.current.useId()};zt.useImperativeHandle=function(i,o,u){return Mn.current.useImperativeHandle(i,o,u)};zt.useInsertionEffect=function(i,o){return Mn.current.useInsertionEffect(i,o)};zt.useLayoutEffect=function(i,o){return Mn.current.useLayoutEffect(i,o)};zt.useMemo=function(i,o){return Mn.current.useMemo(i,o)};zt.useReducer=function(i,o,u){return Mn.current.useReducer(i,o,u)};zt.useRef=function(i){return Mn.current.useRef(i)};zt.useState=function(i){return Mn.current.useState(i)};zt.useSyncExternalStore=function(i,o,u){return Mn.current.useSyncExternalStore(i,o,u)};zt.useTransition=function(){return Mn.current.useTransition()};zt.version="18.2.0";Sv.exports=zt;var mt=Sv.exports;const Gw=Pd(mt);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hw=mt,Ww=Symbol.for("react.element"),Xw=Symbol.for("react.fragment"),Kw=Object.prototype.hasOwnProperty,Yw=Hw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Jw={key:!0,ref:!0,__self:!0,__source:!0};function zv(i,o,u){var g,_={},b=null,M=null;u!==void 0&&(b=""+u),o.key!==void 0&&(b=""+o.key),o.ref!==void 0&&(M=o.ref);for(g in o)Kw.call(o,g)&&!Jw.hasOwnProperty(g)&&(_[g]=o[g]);if(i&&i.defaultProps)for(g in o=i.defaultProps,o)_[g]===void 0&&(_[g]=o[g]);return{$$typeof:Ww,type:i,key:b,ref:M,props:_,_owner:Yw.current}}Md.Fragment=Xw;Md.jsx=zv;Md.jsxs=zv;bv.exports=Md;var st=bv.exports,Av={exports:{}},rr={},Lv={exports:{}},Dv={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function o(We,dt){var xt=We.length;We.push(dt);e:for(;0<xt;){var Ut=xt-1>>>1,Vt=We[Ut];if(0<_(Vt,dt))We[Ut]=dt,We[xt]=Vt,xt=Ut;else break e}}function u(We){return We.length===0?null:We[0]}function g(We){if(We.length===0)return null;var dt=We[0],xt=We.pop();if(xt!==dt){We[0]=xt;e:for(var Ut=0,Vt=We.length,Oi=Vt>>>1;Ut<Oi;){var Bt=2*(Ut+1)-1,Hn=We[Bt],yn=Bt+1,An=We[yn];if(0>_(Hn,xt))yn<Vt&&0>_(An,Hn)?(We[Ut]=An,We[yn]=xt,Ut=yn):(We[Ut]=Hn,We[Bt]=xt,Ut=Bt);else if(yn<Vt&&0>_(An,xt))We[Ut]=An,We[yn]=xt,Ut=yn;else break e}}return dt}function _(We,dt){var xt=We.sortIndex-dt.sortIndex;return xt!==0?xt:We.id-dt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var b=performance;i.unstable_now=function(){return b.now()}}else{var M=Date,l=M.now();i.unstable_now=function(){return M.now()-l}}var N=[],D=[],oe=1,te=null,he=3,Ie=!1,Ce=!1,Pe=!1,ft=typeof setTimeout=="function"?setTimeout:null,J=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function re(We){for(var dt=u(D);dt!==null;){if(dt.callback===null)g(D);else if(dt.startTime<=We)g(D),dt.sortIndex=dt.expirationTime,o(N,dt);else break;dt=u(D)}}function ve(We){if(Pe=!1,re(We),!Ce)if(u(N)!==null)Ce=!0,on(Ae);else{var dt=u(D);dt!==null&&ar(ve,dt.startTime-We)}}function Ae(We,dt){Ce=!1,Pe&&(Pe=!1,J(Ve),Ve=-1),Ie=!0;var xt=he;try{for(re(dt),te=u(N);te!==null&&(!(te.expirationTime>dt)||We&&!qt());){var Ut=te.callback;if(typeof Ut=="function"){te.callback=null,he=te.priorityLevel;var Vt=Ut(te.expirationTime<=dt);dt=i.unstable_now(),typeof Vt=="function"?te.callback=Vt:te===u(N)&&g(N),re(dt)}else g(N);te=u(N)}if(te!==null)var Oi=!0;else{var Bt=u(D);Bt!==null&&ar(ve,Bt.startTime-dt),Oi=!1}return Oi}finally{te=null,he=xt,Ie=!1}}var Ue=!1,Ge=null,Ve=-1,gt=5,Je=-1;function qt(){return!(i.unstable_now()-Je<gt)}function ni(){if(Ge!==null){var We=i.unstable_now();Je=We;var dt=!0;try{dt=Ge(!0,We)}finally{dt?Fi():(Ue=!1,Ge=null)}}else Ue=!1}var Fi;if(typeof K=="function")Fi=function(){K(ni)};else if(typeof MessageChannel<"u"){var Cr=new MessageChannel,sr=Cr.port2;Cr.port1.onmessage=ni,Fi=function(){sr.postMessage(null)}}else Fi=function(){ft(ni,0)};function on(We){Ge=We,Ue||(Ue=!0,Fi())}function ar(We,dt){Ve=ft(function(){We(i.unstable_now())},dt)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(We){We.callback=null},i.unstable_continueExecution=function(){Ce||Ie||(Ce=!0,on(Ae))},i.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):gt=0<We?Math.floor(1e3/We):5},i.unstable_getCurrentPriorityLevel=function(){return he},i.unstable_getFirstCallbackNode=function(){return u(N)},i.unstable_next=function(We){switch(he){case 1:case 2:case 3:var dt=3;break;default:dt=he}var xt=he;he=dt;try{return We()}finally{he=xt}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(We,dt){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var xt=he;he=We;try{return dt()}finally{he=xt}},i.unstable_scheduleCallback=function(We,dt,xt){var Ut=i.unstable_now();switch(typeof xt=="object"&&xt!==null?(xt=xt.delay,xt=typeof xt=="number"&&0<xt?Ut+xt:Ut):xt=Ut,We){case 1:var Vt=-1;break;case 2:Vt=250;break;case 5:Vt=1073741823;break;case 4:Vt=1e4;break;default:Vt=5e3}return Vt=xt+Vt,We={id:oe++,callback:dt,priorityLevel:We,startTime:xt,expirationTime:Vt,sortIndex:-1},xt>Ut?(We.sortIndex=xt,o(D,We),u(N)===null&&We===u(D)&&(Pe?(J(Ve),Ve=-1):Pe=!0,ar(ve,xt-Ut))):(We.sortIndex=Vt,o(N,We),Ce||Ie||(Ce=!0,on(Ae))),We},i.unstable_shouldYield=qt,i.unstable_wrapCallback=function(We){var dt=he;return function(){var xt=he;he=dt;try{return We.apply(this,arguments)}finally{he=xt}}}})(Dv);Lv.exports=Dv;var Qw=Lv.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rv=mt,nr=Qw;function ze(i){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+i,u=1;u<arguments.length;u++)o+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+i+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Bv=new Set,oc={};function sa(i,o){Cl(i,o),Cl(i+"Capture",o)}function Cl(i,o){for(oc[i]=o,i=0;i<o.length;i++)Bv.add(o[i])}var Co=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Rf=Object.prototype.hasOwnProperty,eb=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,n_={},r_={};function tb(i){return Rf.call(r_,i)?!0:Rf.call(n_,i)?!1:eb.test(i)?r_[i]=!0:(n_[i]=!0,!1)}function ib(i,o,u,g){if(u!==null&&u.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return g?!1:u!==null?!u.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function nb(i,o,u,g){if(o===null||typeof o>"u"||ib(i,o,u,g))return!0;if(g)return!1;if(u!==null)switch(u.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function zn(i,o,u,g,_,b,M){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=g,this.attributeNamespace=_,this.mustUseProperty=u,this.propertyName=i,this.type=o,this.sanitizeURL=b,this.removeEmptyString=M}var rn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){rn[i]=new zn(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var o=i[0];rn[o]=new zn(o,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){rn[i]=new zn(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){rn[i]=new zn(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){rn[i]=new zn(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){rn[i]=new zn(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){rn[i]=new zn(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){rn[i]=new zn(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){rn[i]=new zn(i,5,!1,i.toLowerCase(),null,!1,!1)});var zm=/[\-:]([a-z])/g;function Am(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var o=i.replace(zm,Am);rn[o]=new zn(o,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var o=i.replace(zm,Am);rn[o]=new zn(o,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var o=i.replace(zm,Am);rn[o]=new zn(o,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){rn[i]=new zn(i,1,!1,i.toLowerCase(),null,!1,!1)});rn.xlinkHref=new zn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){rn[i]=new zn(i,1,!1,i.toLowerCase(),null,!0,!0)});function Lm(i,o,u,g){var _=rn.hasOwnProperty(o)?rn[o]:null;(_!==null?_.type!==0:g||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(nb(o,u,_,g)&&(u=null),g||_===null?tb(o)&&(u===null?i.removeAttribute(o):i.setAttribute(o,""+u)):_.mustUseProperty?i[_.propertyName]=u===null?_.type===3?!1:"":u:(o=_.attributeName,g=_.attributeNamespace,u===null?i.removeAttribute(o):(_=_.type,u=_===3||_===4&&u===!0?"":""+u,g?i.setAttributeNS(g,o,u):i.setAttribute(o,u))))}var Mo=Rv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Mh=Symbol.for("react.element"),ll=Symbol.for("react.portal"),ul=Symbol.for("react.fragment"),Dm=Symbol.for("react.strict_mode"),Bf=Symbol.for("react.profiler"),Fv=Symbol.for("react.provider"),Ov=Symbol.for("react.context"),Rm=Symbol.for("react.forward_ref"),Ff=Symbol.for("react.suspense"),Of=Symbol.for("react.suspense_list"),Bm=Symbol.for("react.memo"),rs=Symbol.for("react.lazy"),Nv=Symbol.for("react.offscreen"),o_=Symbol.iterator;function Ou(i){return i===null||typeof i!="object"?null:(i=o_&&i[o_]||i["@@iterator"],typeof i=="function"?i:null)}var _i=Object.assign,nf;function Gu(i){if(nf===void 0)try{throw Error()}catch(u){var o=u.stack.trim().match(/\n( *(at )?)/);nf=o&&o[1]||""}return`
`+nf+i}var rf=!1;function of(i,o){if(!i||rf)return"";rf=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(D){var g=D}Reflect.construct(i,[],o)}else{try{o.call()}catch(D){g=D}i.call(o.prototype)}else{try{throw Error()}catch(D){g=D}i()}}catch(D){if(D&&g&&typeof D.stack=="string"){for(var _=D.stack.split(`
`),b=g.stack.split(`
`),M=_.length-1,l=b.length-1;1<=M&&0<=l&&_[M]!==b[l];)l--;for(;1<=M&&0<=l;M--,l--)if(_[M]!==b[l]){if(M!==1||l!==1)do if(M--,l--,0>l||_[M]!==b[l]){var N=`
`+_[M].replace(" at new "," at ");return i.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",i.displayName)),N}while(1<=M&&0<=l);break}}}finally{rf=!1,Error.prepareStackTrace=u}return(i=i?i.displayName||i.name:"")?Gu(i):""}function rb(i){switch(i.tag){case 5:return Gu(i.type);case 16:return Gu("Lazy");case 13:return Gu("Suspense");case 19:return Gu("SuspenseList");case 0:case 2:case 15:return i=of(i.type,!1),i;case 11:return i=of(i.type.render,!1),i;case 1:return i=of(i.type,!0),i;default:return""}}function Nf(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case ul:return"Fragment";case ll:return"Portal";case Bf:return"Profiler";case Dm:return"StrictMode";case Ff:return"Suspense";case Of:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Ov:return(i.displayName||"Context")+".Consumer";case Fv:return(i._context.displayName||"Context")+".Provider";case Rm:var o=i.render;return i=i.displayName,i||(i=o.displayName||o.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Bm:return o=i.displayName||null,o!==null?o:Nf(i.type)||"Memo";case rs:o=i._payload,i=i._init;try{return Nf(i(o))}catch{}}return null}function ob(i){var o=i.type;switch(i.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=o.render,i=i.displayName||i.name||"",o.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Nf(o);case 8:return o===Dm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function vs(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function Uv(i){var o=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function sb(i){var o=Uv(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,o),g=""+i[o];if(!i.hasOwnProperty(o)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var _=u.get,b=u.set;return Object.defineProperty(i,o,{configurable:!0,get:function(){return _.call(this)},set:function(M){g=""+M,b.call(this,M)}}),Object.defineProperty(i,o,{enumerable:u.enumerable}),{getValue:function(){return g},setValue:function(M){g=""+M},stopTracking:function(){i._valueTracker=null,delete i[o]}}}}function zh(i){i._valueTracker||(i._valueTracker=sb(i))}function Vv(i){if(!i)return!1;var o=i._valueTracker;if(!o)return!0;var u=o.getValue(),g="";return i&&(g=Uv(i)?i.checked?"true":"false":i.value),i=g,i!==u?(o.setValue(i),!0):!1}function od(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Uf(i,o){var u=o.checked;return _i({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??i._wrapperState.initialChecked})}function s_(i,o){var u=o.defaultValue==null?"":o.defaultValue,g=o.checked!=null?o.checked:o.defaultChecked;u=vs(o.value!=null?o.value:u),i._wrapperState={initialChecked:g,initialValue:u,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function jv(i,o){o=o.checked,o!=null&&Lm(i,"checked",o,!1)}function Vf(i,o){jv(i,o);var u=vs(o.value),g=o.type;if(u!=null)g==="number"?(u===0&&i.value===""||i.value!=u)&&(i.value=""+u):i.value!==""+u&&(i.value=""+u);else if(g==="submit"||g==="reset"){i.removeAttribute("value");return}o.hasOwnProperty("value")?jf(i,o.type,u):o.hasOwnProperty("defaultValue")&&jf(i,o.type,vs(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(i.defaultChecked=!!o.defaultChecked)}function a_(i,o,u){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var g=o.type;if(!(g!=="submit"&&g!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+i._wrapperState.initialValue,u||o===i.value||(i.value=o),i.defaultValue=o}u=i.name,u!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,u!==""&&(i.name=u)}function jf(i,o,u){(o!=="number"||od(i.ownerDocument)!==i)&&(u==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+u&&(i.defaultValue=""+u))}var Hu=Array.isArray;function xl(i,o,u,g){if(i=i.options,o){o={};for(var _=0;_<u.length;_++)o["$"+u[_]]=!0;for(u=0;u<i.length;u++)_=o.hasOwnProperty("$"+i[u].value),i[u].selected!==_&&(i[u].selected=_),_&&g&&(i[u].defaultSelected=!0)}else{for(u=""+vs(u),o=null,_=0;_<i.length;_++){if(i[_].value===u){i[_].selected=!0,g&&(i[_].defaultSelected=!0);return}o!==null||i[_].disabled||(o=i[_])}o!==null&&(o.selected=!0)}}function $f(i,o){if(o.dangerouslySetInnerHTML!=null)throw Error(ze(91));return _i({},o,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function l_(i,o){var u=o.value;if(u==null){if(u=o.children,o=o.defaultValue,u!=null){if(o!=null)throw Error(ze(92));if(Hu(u)){if(1<u.length)throw Error(ze(93));u=u[0]}o=u}o==null&&(o=""),u=o}i._wrapperState={initialValue:vs(u)}}function $v(i,o){var u=vs(o.value),g=vs(o.defaultValue);u!=null&&(u=""+u,u!==i.value&&(i.value=u),o.defaultValue==null&&i.defaultValue!==u&&(i.defaultValue=u)),g!=null&&(i.defaultValue=""+g)}function u_(i){var o=i.textContent;o===i._wrapperState.initialValue&&o!==""&&o!==null&&(i.value=o)}function qv(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function qf(i,o){return i==null||i==="http://www.w3.org/1999/xhtml"?qv(o):i==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ah,Zv=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,u,g,_){MSApp.execUnsafeLocalFunction(function(){return i(o,u,g,_)})}:i}(function(i,o){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=o;else{for(Ah=Ah||document.createElement("div"),Ah.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=Ah.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;o.firstChild;)i.appendChild(o.firstChild)}});function sc(i,o){if(o){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=o;return}}i.textContent=o}var Ku={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ab=["Webkit","ms","Moz","O"];Object.keys(Ku).forEach(function(i){ab.forEach(function(o){o=o+i.charAt(0).toUpperCase()+i.substring(1),Ku[o]=Ku[i]})});function Gv(i,o,u){return o==null||typeof o=="boolean"||o===""?"":u||typeof o!="number"||o===0||Ku.hasOwnProperty(i)&&Ku[i]?(""+o).trim():o+"px"}function Hv(i,o){i=i.style;for(var u in o)if(o.hasOwnProperty(u)){var g=u.indexOf("--")===0,_=Gv(u,o[u],g);u==="float"&&(u="cssFloat"),g?i.setProperty(u,_):i[u]=_}}var lb=_i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Zf(i,o){if(o){if(lb[i]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(ze(137,i));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(ze(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(ze(61))}if(o.style!=null&&typeof o.style!="object")throw Error(ze(62))}}function Gf(i,o){if(i.indexOf("-")===-1)return typeof o.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hf=null;function Fm(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Wf=null,wl=null,bl=null;function c_(i){if(i=Tc(i)){if(typeof Wf!="function")throw Error(ze(280));var o=i.stateNode;o&&(o=Rd(o),Wf(i.stateNode,i.type,o))}}function Wv(i){wl?bl?bl.push(i):bl=[i]:wl=i}function Xv(){if(wl){var i=wl,o=bl;if(bl=wl=null,c_(i),o)for(i=0;i<o.length;i++)c_(o[i])}}function Kv(i,o){return i(o)}function Yv(){}var sf=!1;function Jv(i,o,u){if(sf)return i(o,u);sf=!0;try{return Kv(i,o,u)}finally{sf=!1,(wl!==null||bl!==null)&&(Yv(),Xv())}}function ac(i,o){var u=i.stateNode;if(u===null)return null;var g=Rd(u);if(g===null)return null;u=g[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(i=i.type,g=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!g;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(ze(231,o,typeof u));return u}var Xf=!1;if(Co)try{var Nu={};Object.defineProperty(Nu,"passive",{get:function(){Xf=!0}}),window.addEventListener("test",Nu,Nu),window.removeEventListener("test",Nu,Nu)}catch{Xf=!1}function ub(i,o,u,g,_,b,M,l,N){var D=Array.prototype.slice.call(arguments,3);try{o.apply(u,D)}catch(oe){this.onError(oe)}}var Yu=!1,sd=null,ad=!1,Kf=null,cb={onError:function(i){Yu=!0,sd=i}};function hb(i,o,u,g,_,b,M,l,N){Yu=!1,sd=null,ub.apply(cb,arguments)}function db(i,o,u,g,_,b,M,l,N){if(hb.apply(this,arguments),Yu){if(Yu){var D=sd;Yu=!1,sd=null}else throw Error(ze(198));ad||(ad=!0,Kf=D)}}function aa(i){var o=i,u=i;if(i.alternate)for(;o.return;)o=o.return;else{i=o;do o=i,o.flags&4098&&(u=o.return),i=o.return;while(i)}return o.tag===3?u:null}function Qv(i){if(i.tag===13){var o=i.memoizedState;if(o===null&&(i=i.alternate,i!==null&&(o=i.memoizedState)),o!==null)return o.dehydrated}return null}function h_(i){if(aa(i)!==i)throw Error(ze(188))}function pb(i){var o=i.alternate;if(!o){if(o=aa(i),o===null)throw Error(ze(188));return o!==i?null:i}for(var u=i,g=o;;){var _=u.return;if(_===null)break;var b=_.alternate;if(b===null){if(g=_.return,g!==null){u=g;continue}break}if(_.child===b.child){for(b=_.child;b;){if(b===u)return h_(_),i;if(b===g)return h_(_),o;b=b.sibling}throw Error(ze(188))}if(u.return!==g.return)u=_,g=b;else{for(var M=!1,l=_.child;l;){if(l===u){M=!0,u=_,g=b;break}if(l===g){M=!0,g=_,u=b;break}l=l.sibling}if(!M){for(l=b.child;l;){if(l===u){M=!0,u=b,g=_;break}if(l===g){M=!0,g=b,u=_;break}l=l.sibling}if(!M)throw Error(ze(189))}}if(u.alternate!==g)throw Error(ze(190))}if(u.tag!==3)throw Error(ze(188));return u.stateNode.current===u?i:o}function e0(i){return i=pb(i),i!==null?t0(i):null}function t0(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var o=t0(i);if(o!==null)return o;i=i.sibling}return null}var i0=nr.unstable_scheduleCallback,d_=nr.unstable_cancelCallback,fb=nr.unstable_shouldYield,mb=nr.unstable_requestPaint,Pi=nr.unstable_now,gb=nr.unstable_getCurrentPriorityLevel,Om=nr.unstable_ImmediatePriority,n0=nr.unstable_UserBlockingPriority,ld=nr.unstable_NormalPriority,yb=nr.unstable_LowPriority,r0=nr.unstable_IdlePriority,zd=null,oo=null;function _b(i){if(oo&&typeof oo.onCommitFiberRoot=="function")try{oo.onCommitFiberRoot(zd,i,void 0,(i.current.flags&128)===128)}catch{}}var jr=Math.clz32?Math.clz32:wb,vb=Math.log,xb=Math.LN2;function wb(i){return i>>>=0,i===0?32:31-(vb(i)/xb|0)|0}var Lh=64,Dh=4194304;function Wu(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function ud(i,o){var u=i.pendingLanes;if(u===0)return 0;var g=0,_=i.suspendedLanes,b=i.pingedLanes,M=u&268435455;if(M!==0){var l=M&~_;l!==0?g=Wu(l):(b&=M,b!==0&&(g=Wu(b)))}else M=u&~_,M!==0?g=Wu(M):b!==0&&(g=Wu(b));if(g===0)return 0;if(o!==0&&o!==g&&!(o&_)&&(_=g&-g,b=o&-o,_>=b||_===16&&(b&4194240)!==0))return o;if(g&4&&(g|=u&16),o=i.entangledLanes,o!==0)for(i=i.entanglements,o&=g;0<o;)u=31-jr(o),_=1<<u,g|=i[u],o&=~_;return g}function bb(i,o){switch(i){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Sb(i,o){for(var u=i.suspendedLanes,g=i.pingedLanes,_=i.expirationTimes,b=i.pendingLanes;0<b;){var M=31-jr(b),l=1<<M,N=_[M];N===-1?(!(l&u)||l&g)&&(_[M]=bb(l,o)):N<=o&&(i.expiredLanes|=l),b&=~l}}function Yf(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function o0(){var i=Lh;return Lh<<=1,!(Lh&4194240)&&(Lh=64),i}function af(i){for(var o=[],u=0;31>u;u++)o.push(i);return o}function Sc(i,o,u){i.pendingLanes|=o,o!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,o=31-jr(o),i[o]=u}function Eb(i,o){var u=i.pendingLanes&~o;i.pendingLanes=o,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=o,i.mutableReadLanes&=o,i.entangledLanes&=o,o=i.entanglements;var g=i.eventTimes;for(i=i.expirationTimes;0<u;){var _=31-jr(u),b=1<<_;o[_]=0,g[_]=-1,i[_]=-1,u&=~b}}function Nm(i,o){var u=i.entangledLanes|=o;for(i=i.entanglements;u;){var g=31-jr(u),_=1<<g;_&o|i[g]&o&&(i[g]|=o),u&=~_}}var Xt=0;function s0(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var a0,Um,l0,u0,c0,Jf=!1,Rh=[],hs=null,ds=null,ps=null,lc=new Map,uc=new Map,ss=[],Tb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function p_(i,o){switch(i){case"focusin":case"focusout":hs=null;break;case"dragenter":case"dragleave":ds=null;break;case"mouseover":case"mouseout":ps=null;break;case"pointerover":case"pointerout":lc.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":uc.delete(o.pointerId)}}function Uu(i,o,u,g,_,b){return i===null||i.nativeEvent!==b?(i={blockedOn:o,domEventName:u,eventSystemFlags:g,nativeEvent:b,targetContainers:[_]},o!==null&&(o=Tc(o),o!==null&&Um(o)),i):(i.eventSystemFlags|=g,o=i.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),i)}function Cb(i,o,u,g,_){switch(o){case"focusin":return hs=Uu(hs,i,o,u,g,_),!0;case"dragenter":return ds=Uu(ds,i,o,u,g,_),!0;case"mouseover":return ps=Uu(ps,i,o,u,g,_),!0;case"pointerover":var b=_.pointerId;return lc.set(b,Uu(lc.get(b)||null,i,o,u,g,_)),!0;case"gotpointercapture":return b=_.pointerId,uc.set(b,Uu(uc.get(b)||null,i,o,u,g,_)),!0}return!1}function h0(i){var o=Ks(i.target);if(o!==null){var u=aa(o);if(u!==null){if(o=u.tag,o===13){if(o=Qv(u),o!==null){i.blockedOn=o,c0(i.priority,function(){l0(u)});return}}else if(o===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Xh(i){if(i.blockedOn!==null)return!1;for(var o=i.targetContainers;0<o.length;){var u=Qf(i.domEventName,i.eventSystemFlags,o[0],i.nativeEvent);if(u===null){u=i.nativeEvent;var g=new u.constructor(u.type,u);Hf=g,u.target.dispatchEvent(g),Hf=null}else return o=Tc(u),o!==null&&Um(o),i.blockedOn=u,!1;o.shift()}return!0}function f_(i,o,u){Xh(i)&&u.delete(o)}function kb(){Jf=!1,hs!==null&&Xh(hs)&&(hs=null),ds!==null&&Xh(ds)&&(ds=null),ps!==null&&Xh(ps)&&(ps=null),lc.forEach(f_),uc.forEach(f_)}function Vu(i,o){i.blockedOn===o&&(i.blockedOn=null,Jf||(Jf=!0,nr.unstable_scheduleCallback(nr.unstable_NormalPriority,kb)))}function cc(i){function o(_){return Vu(_,i)}if(0<Rh.length){Vu(Rh[0],i);for(var u=1;u<Rh.length;u++){var g=Rh[u];g.blockedOn===i&&(g.blockedOn=null)}}for(hs!==null&&Vu(hs,i),ds!==null&&Vu(ds,i),ps!==null&&Vu(ps,i),lc.forEach(o),uc.forEach(o),u=0;u<ss.length;u++)g=ss[u],g.blockedOn===i&&(g.blockedOn=null);for(;0<ss.length&&(u=ss[0],u.blockedOn===null);)h0(u),u.blockedOn===null&&ss.shift()}var Sl=Mo.ReactCurrentBatchConfig,cd=!0;function Ib(i,o,u,g){var _=Xt,b=Sl.transition;Sl.transition=null;try{Xt=1,Vm(i,o,u,g)}finally{Xt=_,Sl.transition=b}}function Pb(i,o,u,g){var _=Xt,b=Sl.transition;Sl.transition=null;try{Xt=4,Vm(i,o,u,g)}finally{Xt=_,Sl.transition=b}}function Vm(i,o,u,g){if(cd){var _=Qf(i,o,u,g);if(_===null)yf(i,o,g,hd,u),p_(i,g);else if(Cb(_,i,o,u,g))g.stopPropagation();else if(p_(i,g),o&4&&-1<Tb.indexOf(i)){for(;_!==null;){var b=Tc(_);if(b!==null&&a0(b),b=Qf(i,o,u,g),b===null&&yf(i,o,g,hd,u),b===_)break;_=b}_!==null&&g.stopPropagation()}else yf(i,o,g,null,u)}}var hd=null;function Qf(i,o,u,g){if(hd=null,i=Fm(g),i=Ks(i),i!==null)if(o=aa(i),o===null)i=null;else if(u=o.tag,u===13){if(i=Qv(o),i!==null)return i;i=null}else if(u===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;i=null}else o!==i&&(i=null);return hd=i,null}function d0(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(gb()){case Om:return 1;case n0:return 4;case ld:case yb:return 16;case r0:return 536870912;default:return 16}default:return 16}}var us=null,jm=null,Kh=null;function p0(){if(Kh)return Kh;var i,o=jm,u=o.length,g,_="value"in us?us.value:us.textContent,b=_.length;for(i=0;i<u&&o[i]===_[i];i++);var M=u-i;for(g=1;g<=M&&o[u-g]===_[b-g];g++);return Kh=_.slice(i,1<g?1-g:void 0)}function Yh(i){var o=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&o===13&&(i=13)):i=o,i===10&&(i=13),32<=i||i===13?i:0}function Bh(){return!0}function m_(){return!1}function or(i){function o(u,g,_,b,M){this._reactName=u,this._targetInst=_,this.type=g,this.nativeEvent=b,this.target=M,this.currentTarget=null;for(var l in i)i.hasOwnProperty(l)&&(u=i[l],this[l]=u?u(b):b[l]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Bh:m_,this.isPropagationStopped=m_,this}return _i(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Bh)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Bh)},persist:function(){},isPersistent:Bh}),o}var Rl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$m=or(Rl),Ec=_i({},Rl,{view:0,detail:0}),Mb=or(Ec),lf,uf,ju,Ad=_i({},Ec,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:qm,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ju&&(ju&&i.type==="mousemove"?(lf=i.screenX-ju.screenX,uf=i.screenY-ju.screenY):uf=lf=0,ju=i),lf)},movementY:function(i){return"movementY"in i?i.movementY:uf}}),g_=or(Ad),zb=_i({},Ad,{dataTransfer:0}),Ab=or(zb),Lb=_i({},Ec,{relatedTarget:0}),cf=or(Lb),Db=_i({},Rl,{animationName:0,elapsedTime:0,pseudoElement:0}),Rb=or(Db),Bb=_i({},Rl,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),Fb=or(Bb),Ob=_i({},Rl,{data:0}),y_=or(Ob),Nb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ub={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Vb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jb(i){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(i):(i=Vb[i])?!!o[i]:!1}function qm(){return jb}var $b=_i({},Ec,{key:function(i){if(i.key){var o=Nb[i.key]||i.key;if(o!=="Unidentified")return o}return i.type==="keypress"?(i=Yh(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?Ub[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:qm,charCode:function(i){return i.type==="keypress"?Yh(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Yh(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),qb=or($b),Zb=_i({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),__=or(Zb),Gb=_i({},Ec,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:qm}),Hb=or(Gb),Wb=_i({},Rl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xb=or(Wb),Kb=_i({},Ad,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Yb=or(Kb),Jb=[9,13,27,32],Zm=Co&&"CompositionEvent"in window,Ju=null;Co&&"documentMode"in document&&(Ju=document.documentMode);var Qb=Co&&"TextEvent"in window&&!Ju,f0=Co&&(!Zm||Ju&&8<Ju&&11>=Ju),v_=String.fromCharCode(32),x_=!1;function m0(i,o){switch(i){case"keyup":return Jb.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function g0(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var cl=!1;function e2(i,o){switch(i){case"compositionend":return g0(o);case"keypress":return o.which!==32?null:(x_=!0,v_);case"textInput":return i=o.data,i===v_&&x_?null:i;default:return null}}function t2(i,o){if(cl)return i==="compositionend"||!Zm&&m0(i,o)?(i=p0(),Kh=jm=us=null,cl=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return f0&&o.locale!=="ko"?null:o.data;default:return null}}var i2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function w_(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o==="input"?!!i2[i.type]:o==="textarea"}function y0(i,o,u,g){Wv(g),o=dd(o,"onChange"),0<o.length&&(u=new $m("onChange","change",null,u,g),i.push({event:u,listeners:o}))}var Qu=null,hc=null;function n2(i){I0(i,0)}function Ld(i){var o=pl(i);if(Vv(o))return i}function r2(i,o){if(i==="change")return o}var _0=!1;if(Co){var hf;if(Co){var df="oninput"in document;if(!df){var b_=document.createElement("div");b_.setAttribute("oninput","return;"),df=typeof b_.oninput=="function"}hf=df}else hf=!1;_0=hf&&(!document.documentMode||9<document.documentMode)}function S_(){Qu&&(Qu.detachEvent("onpropertychange",v0),hc=Qu=null)}function v0(i){if(i.propertyName==="value"&&Ld(hc)){var o=[];y0(o,hc,i,Fm(i)),Jv(n2,o)}}function o2(i,o,u){i==="focusin"?(S_(),Qu=o,hc=u,Qu.attachEvent("onpropertychange",v0)):i==="focusout"&&S_()}function s2(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Ld(hc)}function a2(i,o){if(i==="click")return Ld(o)}function l2(i,o){if(i==="input"||i==="change")return Ld(o)}function u2(i,o){return i===o&&(i!==0||1/i===1/o)||i!==i&&o!==o}var qr=typeof Object.is=="function"?Object.is:u2;function dc(i,o){if(qr(i,o))return!0;if(typeof i!="object"||i===null||typeof o!="object"||o===null)return!1;var u=Object.keys(i),g=Object.keys(o);if(u.length!==g.length)return!1;for(g=0;g<u.length;g++){var _=u[g];if(!Rf.call(o,_)||!qr(i[_],o[_]))return!1}return!0}function E_(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function T_(i,o){var u=E_(i);i=0;for(var g;u;){if(u.nodeType===3){if(g=i+u.textContent.length,i<=o&&g>=o)return{node:u,offset:o-i};i=g}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=E_(u)}}function x0(i,o){return i&&o?i===o?!0:i&&i.nodeType===3?!1:o&&o.nodeType===3?x0(i,o.parentNode):"contains"in i?i.contains(o):i.compareDocumentPosition?!!(i.compareDocumentPosition(o)&16):!1:!1}function w0(){for(var i=window,o=od();o instanceof i.HTMLIFrameElement;){try{var u=typeof o.contentWindow.location.href=="string"}catch{u=!1}if(u)i=o.contentWindow;else break;o=od(i.document)}return o}function Gm(i){var o=i&&i.nodeName&&i.nodeName.toLowerCase();return o&&(o==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||o==="textarea"||i.contentEditable==="true")}function c2(i){var o=w0(),u=i.focusedElem,g=i.selectionRange;if(o!==u&&u&&u.ownerDocument&&x0(u.ownerDocument.documentElement,u)){if(g!==null&&Gm(u)){if(o=g.start,i=g.end,i===void 0&&(i=o),"selectionStart"in u)u.selectionStart=o,u.selectionEnd=Math.min(i,u.value.length);else if(i=(o=u.ownerDocument||document)&&o.defaultView||window,i.getSelection){i=i.getSelection();var _=u.textContent.length,b=Math.min(g.start,_);g=g.end===void 0?b:Math.min(g.end,_),!i.extend&&b>g&&(_=g,g=b,b=_),_=T_(u,b);var M=T_(u,g);_&&M&&(i.rangeCount!==1||i.anchorNode!==_.node||i.anchorOffset!==_.offset||i.focusNode!==M.node||i.focusOffset!==M.offset)&&(o=o.createRange(),o.setStart(_.node,_.offset),i.removeAllRanges(),b>g?(i.addRange(o),i.extend(M.node,M.offset)):(o.setEnd(M.node,M.offset),i.addRange(o)))}}for(o=[],i=u;i=i.parentNode;)i.nodeType===1&&o.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<o.length;u++)i=o[u],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var h2=Co&&"documentMode"in document&&11>=document.documentMode,hl=null,em=null,ec=null,tm=!1;function C_(i,o,u){var g=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;tm||hl==null||hl!==od(g)||(g=hl,"selectionStart"in g&&Gm(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),ec&&dc(ec,g)||(ec=g,g=dd(em,"onSelect"),0<g.length&&(o=new $m("onSelect","select",null,o,u),i.push({event:o,listeners:g}),o.target=hl)))}function Fh(i,o){var u={};return u[i.toLowerCase()]=o.toLowerCase(),u["Webkit"+i]="webkit"+o,u["Moz"+i]="moz"+o,u}var dl={animationend:Fh("Animation","AnimationEnd"),animationiteration:Fh("Animation","AnimationIteration"),animationstart:Fh("Animation","AnimationStart"),transitionend:Fh("Transition","TransitionEnd")},pf={},b0={};Co&&(b0=document.createElement("div").style,"AnimationEvent"in window||(delete dl.animationend.animation,delete dl.animationiteration.animation,delete dl.animationstart.animation),"TransitionEvent"in window||delete dl.transitionend.transition);function Dd(i){if(pf[i])return pf[i];if(!dl[i])return i;var o=dl[i],u;for(u in o)if(o.hasOwnProperty(u)&&u in b0)return pf[i]=o[u];return i}var S0=Dd("animationend"),E0=Dd("animationiteration"),T0=Dd("animationstart"),C0=Dd("transitionend"),k0=new Map,k_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ws(i,o){k0.set(i,o),sa(o,[i])}for(var ff=0;ff<k_.length;ff++){var mf=k_[ff],d2=mf.toLowerCase(),p2=mf[0].toUpperCase()+mf.slice(1);ws(d2,"on"+p2)}ws(S0,"onAnimationEnd");ws(E0,"onAnimationIteration");ws(T0,"onAnimationStart");ws("dblclick","onDoubleClick");ws("focusin","onFocus");ws("focusout","onBlur");ws(C0,"onTransitionEnd");Cl("onMouseEnter",["mouseout","mouseover"]);Cl("onMouseLeave",["mouseout","mouseover"]);Cl("onPointerEnter",["pointerout","pointerover"]);Cl("onPointerLeave",["pointerout","pointerover"]);sa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));sa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));sa("onBeforeInput",["compositionend","keypress","textInput","paste"]);sa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));sa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));sa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Xu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),f2=new Set("cancel close invalid load scroll toggle".split(" ").concat(Xu));function I_(i,o,u){var g=i.type||"unknown-event";i.currentTarget=u,db(g,o,void 0,i),i.currentTarget=null}function I0(i,o){o=(o&4)!==0;for(var u=0;u<i.length;u++){var g=i[u],_=g.event;g=g.listeners;e:{var b=void 0;if(o)for(var M=g.length-1;0<=M;M--){var l=g[M],N=l.instance,D=l.currentTarget;if(l=l.listener,N!==b&&_.isPropagationStopped())break e;I_(_,l,D),b=N}else for(M=0;M<g.length;M++){if(l=g[M],N=l.instance,D=l.currentTarget,l=l.listener,N!==b&&_.isPropagationStopped())break e;I_(_,l,D),b=N}}}if(ad)throw i=Kf,ad=!1,Kf=null,i}function ai(i,o){var u=o[sm];u===void 0&&(u=o[sm]=new Set);var g=i+"__bubble";u.has(g)||(P0(o,i,2,!1),u.add(g))}function gf(i,o,u){var g=0;o&&(g|=4),P0(u,i,g,o)}var Oh="_reactListening"+Math.random().toString(36).slice(2);function pc(i){if(!i[Oh]){i[Oh]=!0,Bv.forEach(function(u){u!=="selectionchange"&&(f2.has(u)||gf(u,!1,i),gf(u,!0,i))});var o=i.nodeType===9?i:i.ownerDocument;o===null||o[Oh]||(o[Oh]=!0,gf("selectionchange",!1,o))}}function P0(i,o,u,g){switch(d0(o)){case 1:var _=Ib;break;case 4:_=Pb;break;default:_=Vm}u=_.bind(null,o,u,i),_=void 0,!Xf||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),g?_!==void 0?i.addEventListener(o,u,{capture:!0,passive:_}):i.addEventListener(o,u,!0):_!==void 0?i.addEventListener(o,u,{passive:_}):i.addEventListener(o,u,!1)}function yf(i,o,u,g,_){var b=g;if(!(o&1)&&!(o&2)&&g!==null)e:for(;;){if(g===null)return;var M=g.tag;if(M===3||M===4){var l=g.stateNode.containerInfo;if(l===_||l.nodeType===8&&l.parentNode===_)break;if(M===4)for(M=g.return;M!==null;){var N=M.tag;if((N===3||N===4)&&(N=M.stateNode.containerInfo,N===_||N.nodeType===8&&N.parentNode===_))return;M=M.return}for(;l!==null;){if(M=Ks(l),M===null)return;if(N=M.tag,N===5||N===6){g=b=M;continue e}l=l.parentNode}}g=g.return}Jv(function(){var D=b,oe=Fm(u),te=[];e:{var he=k0.get(i);if(he!==void 0){var Ie=$m,Ce=i;switch(i){case"keypress":if(Yh(u)===0)break e;case"keydown":case"keyup":Ie=qb;break;case"focusin":Ce="focus",Ie=cf;break;case"focusout":Ce="blur",Ie=cf;break;case"beforeblur":case"afterblur":Ie=cf;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ie=g_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ie=Ab;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ie=Hb;break;case S0:case E0:case T0:Ie=Rb;break;case C0:Ie=Xb;break;case"scroll":Ie=Mb;break;case"wheel":Ie=Yb;break;case"copy":case"cut":case"paste":Ie=Fb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ie=__}var Pe=(o&4)!==0,ft=!Pe&&i==="scroll",J=Pe?he!==null?he+"Capture":null:he;Pe=[];for(var K=D,re;K!==null;){re=K;var ve=re.stateNode;if(re.tag===5&&ve!==null&&(re=ve,J!==null&&(ve=ac(K,J),ve!=null&&Pe.push(fc(K,ve,re)))),ft)break;K=K.return}0<Pe.length&&(he=new Ie(he,Ce,null,u,oe),te.push({event:he,listeners:Pe}))}}if(!(o&7)){e:{if(he=i==="mouseover"||i==="pointerover",Ie=i==="mouseout"||i==="pointerout",he&&u!==Hf&&(Ce=u.relatedTarget||u.fromElement)&&(Ks(Ce)||Ce[ko]))break e;if((Ie||he)&&(he=oe.window===oe?oe:(he=oe.ownerDocument)?he.defaultView||he.parentWindow:window,Ie?(Ce=u.relatedTarget||u.toElement,Ie=D,Ce=Ce?Ks(Ce):null,Ce!==null&&(ft=aa(Ce),Ce!==ft||Ce.tag!==5&&Ce.tag!==6)&&(Ce=null)):(Ie=null,Ce=D),Ie!==Ce)){if(Pe=g_,ve="onMouseLeave",J="onMouseEnter",K="mouse",(i==="pointerout"||i==="pointerover")&&(Pe=__,ve="onPointerLeave",J="onPointerEnter",K="pointer"),ft=Ie==null?he:pl(Ie),re=Ce==null?he:pl(Ce),he=new Pe(ve,K+"leave",Ie,u,oe),he.target=ft,he.relatedTarget=re,ve=null,Ks(oe)===D&&(Pe=new Pe(J,K+"enter",Ce,u,oe),Pe.target=re,Pe.relatedTarget=ft,ve=Pe),ft=ve,Ie&&Ce)t:{for(Pe=Ie,J=Ce,K=0,re=Pe;re;re=al(re))K++;for(re=0,ve=J;ve;ve=al(ve))re++;for(;0<K-re;)Pe=al(Pe),K--;for(;0<re-K;)J=al(J),re--;for(;K--;){if(Pe===J||J!==null&&Pe===J.alternate)break t;Pe=al(Pe),J=al(J)}Pe=null}else Pe=null;Ie!==null&&P_(te,he,Ie,Pe,!1),Ce!==null&&ft!==null&&P_(te,ft,Ce,Pe,!0)}}e:{if(he=D?pl(D):window,Ie=he.nodeName&&he.nodeName.toLowerCase(),Ie==="select"||Ie==="input"&&he.type==="file")var Ae=r2;else if(w_(he))if(_0)Ae=l2;else{Ae=s2;var Ue=o2}else(Ie=he.nodeName)&&Ie.toLowerCase()==="input"&&(he.type==="checkbox"||he.type==="radio")&&(Ae=a2);if(Ae&&(Ae=Ae(i,D))){y0(te,Ae,u,oe);break e}Ue&&Ue(i,he,D),i==="focusout"&&(Ue=he._wrapperState)&&Ue.controlled&&he.type==="number"&&jf(he,"number",he.value)}switch(Ue=D?pl(D):window,i){case"focusin":(w_(Ue)||Ue.contentEditable==="true")&&(hl=Ue,em=D,ec=null);break;case"focusout":ec=em=hl=null;break;case"mousedown":tm=!0;break;case"contextmenu":case"mouseup":case"dragend":tm=!1,C_(te,u,oe);break;case"selectionchange":if(h2)break;case"keydown":case"keyup":C_(te,u,oe)}var Ge;if(Zm)e:{switch(i){case"compositionstart":var Ve="onCompositionStart";break e;case"compositionend":Ve="onCompositionEnd";break e;case"compositionupdate":Ve="onCompositionUpdate";break e}Ve=void 0}else cl?m0(i,u)&&(Ve="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(Ve="onCompositionStart");Ve&&(f0&&u.locale!=="ko"&&(cl||Ve!=="onCompositionStart"?Ve==="onCompositionEnd"&&cl&&(Ge=p0()):(us=oe,jm="value"in us?us.value:us.textContent,cl=!0)),Ue=dd(D,Ve),0<Ue.length&&(Ve=new y_(Ve,i,null,u,oe),te.push({event:Ve,listeners:Ue}),Ge?Ve.data=Ge:(Ge=g0(u),Ge!==null&&(Ve.data=Ge)))),(Ge=Qb?e2(i,u):t2(i,u))&&(D=dd(D,"onBeforeInput"),0<D.length&&(oe=new y_("onBeforeInput","beforeinput",null,u,oe),te.push({event:oe,listeners:D}),oe.data=Ge))}I0(te,o)})}function fc(i,o,u){return{instance:i,listener:o,currentTarget:u}}function dd(i,o){for(var u=o+"Capture",g=[];i!==null;){var _=i,b=_.stateNode;_.tag===5&&b!==null&&(_=b,b=ac(i,u),b!=null&&g.unshift(fc(i,b,_)),b=ac(i,o),b!=null&&g.push(fc(i,b,_))),i=i.return}return g}function al(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function P_(i,o,u,g,_){for(var b=o._reactName,M=[];u!==null&&u!==g;){var l=u,N=l.alternate,D=l.stateNode;if(N!==null&&N===g)break;l.tag===5&&D!==null&&(l=D,_?(N=ac(u,b),N!=null&&M.unshift(fc(u,N,l))):_||(N=ac(u,b),N!=null&&M.push(fc(u,N,l)))),u=u.return}M.length!==0&&i.push({event:o,listeners:M})}var m2=/\r\n?/g,g2=/\u0000|\uFFFD/g;function M_(i){return(typeof i=="string"?i:""+i).replace(m2,`
`).replace(g2,"")}function Nh(i,o,u){if(o=M_(o),M_(i)!==o&&u)throw Error(ze(425))}function pd(){}var im=null,nm=null;function rm(i,o){return i==="textarea"||i==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var om=typeof setTimeout=="function"?setTimeout:void 0,y2=typeof clearTimeout=="function"?clearTimeout:void 0,z_=typeof Promise=="function"?Promise:void 0,_2=typeof queueMicrotask=="function"?queueMicrotask:typeof z_<"u"?function(i){return z_.resolve(null).then(i).catch(v2)}:om;function v2(i){setTimeout(function(){throw i})}function _f(i,o){var u=o,g=0;do{var _=u.nextSibling;if(i.removeChild(u),_&&_.nodeType===8)if(u=_.data,u==="/$"){if(g===0){i.removeChild(_),cc(o);return}g--}else u!=="$"&&u!=="$?"&&u!=="$!"||g++;u=_}while(u);cc(o)}function fs(i){for(;i!=null;i=i.nextSibling){var o=i.nodeType;if(o===1||o===3)break;if(o===8){if(o=i.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return i}function A_(i){i=i.previousSibling;for(var o=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"){if(o===0)return i;o--}else u==="/$"&&o++}i=i.previousSibling}return null}var Bl=Math.random().toString(36).slice(2),ro="__reactFiber$"+Bl,mc="__reactProps$"+Bl,ko="__reactContainer$"+Bl,sm="__reactEvents$"+Bl,x2="__reactListeners$"+Bl,w2="__reactHandles$"+Bl;function Ks(i){var o=i[ro];if(o)return o;for(var u=i.parentNode;u;){if(o=u[ko]||u[ro]){if(u=o.alternate,o.child!==null||u!==null&&u.child!==null)for(i=A_(i);i!==null;){if(u=i[ro])return u;i=A_(i)}return o}i=u,u=i.parentNode}return null}function Tc(i){return i=i[ro]||i[ko],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function pl(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(ze(33))}function Rd(i){return i[mc]||null}var am=[],fl=-1;function bs(i){return{current:i}}function li(i){0>fl||(i.current=am[fl],am[fl]=null,fl--)}function ii(i,o){fl++,am[fl]=i.current,i.current=o}var xs={},gn=bs(xs),qn=bs(!1),ta=xs;function kl(i,o){var u=i.type.contextTypes;if(!u)return xs;var g=i.stateNode;if(g&&g.__reactInternalMemoizedUnmaskedChildContext===o)return g.__reactInternalMemoizedMaskedChildContext;var _={},b;for(b in u)_[b]=o[b];return g&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=o,i.__reactInternalMemoizedMaskedChildContext=_),_}function Zn(i){return i=i.childContextTypes,i!=null}function fd(){li(qn),li(gn)}function L_(i,o,u){if(gn.current!==xs)throw Error(ze(168));ii(gn,o),ii(qn,u)}function M0(i,o,u){var g=i.stateNode;if(o=o.childContextTypes,typeof g.getChildContext!="function")return u;g=g.getChildContext();for(var _ in g)if(!(_ in o))throw Error(ze(108,ob(i)||"Unknown",_));return _i({},u,g)}function md(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||xs,ta=gn.current,ii(gn,i),ii(qn,qn.current),!0}function D_(i,o,u){var g=i.stateNode;if(!g)throw Error(ze(169));u?(i=M0(i,o,ta),g.__reactInternalMemoizedMergedChildContext=i,li(qn),li(gn),ii(gn,i)):li(qn),ii(qn,u)}var bo=null,Bd=!1,vf=!1;function z0(i){bo===null?bo=[i]:bo.push(i)}function b2(i){Bd=!0,z0(i)}function Ss(){if(!vf&&bo!==null){vf=!0;var i=0,o=Xt;try{var u=bo;for(Xt=1;i<u.length;i++){var g=u[i];do g=g(!0);while(g!==null)}bo=null,Bd=!1}catch(_){throw bo!==null&&(bo=bo.slice(i+1)),i0(Om,Ss),_}finally{Xt=o,vf=!1}}return null}var ml=[],gl=0,gd=null,yd=0,xr=[],wr=0,ia=null,So=1,Eo="";function Ws(i,o){ml[gl++]=yd,ml[gl++]=gd,gd=i,yd=o}function A0(i,o,u){xr[wr++]=So,xr[wr++]=Eo,xr[wr++]=ia,ia=i;var g=So;i=Eo;var _=32-jr(g)-1;g&=~(1<<_),u+=1;var b=32-jr(o)+_;if(30<b){var M=_-_%5;b=(g&(1<<M)-1).toString(32),g>>=M,_-=M,So=1<<32-jr(o)+_|u<<_|g,Eo=b+i}else So=1<<b|u<<_|g,Eo=i}function Hm(i){i.return!==null&&(Ws(i,1),A0(i,1,0))}function Wm(i){for(;i===gd;)gd=ml[--gl],ml[gl]=null,yd=ml[--gl],ml[gl]=null;for(;i===ia;)ia=xr[--wr],xr[wr]=null,Eo=xr[--wr],xr[wr]=null,So=xr[--wr],xr[wr]=null}var ir=null,tr=null,di=!1,Vr=null;function L0(i,o){var u=br(5,null,null,0);u.elementType="DELETED",u.stateNode=o,u.return=i,o=i.deletions,o===null?(i.deletions=[u],i.flags|=16):o.push(u)}function R_(i,o){switch(i.tag){case 5:var u=i.type;return o=o.nodeType!==1||u.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(i.stateNode=o,ir=i,tr=fs(o.firstChild),!0):!1;case 6:return o=i.pendingProps===""||o.nodeType!==3?null:o,o!==null?(i.stateNode=o,ir=i,tr=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(u=ia!==null?{id:So,overflow:Eo}:null,i.memoizedState={dehydrated:o,treeContext:u,retryLane:1073741824},u=br(18,null,null,0),u.stateNode=o,u.return=i,i.child=u,ir=i,tr=null,!0):!1;default:return!1}}function lm(i){return(i.mode&1)!==0&&(i.flags&128)===0}function um(i){if(di){var o=tr;if(o){var u=o;if(!R_(i,o)){if(lm(i))throw Error(ze(418));o=fs(u.nextSibling);var g=ir;o&&R_(i,o)?L0(g,u):(i.flags=i.flags&-4097|2,di=!1,ir=i)}}else{if(lm(i))throw Error(ze(418));i.flags=i.flags&-4097|2,di=!1,ir=i}}}function B_(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;ir=i}function Uh(i){if(i!==ir)return!1;if(!di)return B_(i),di=!0,!1;var o;if((o=i.tag!==3)&&!(o=i.tag!==5)&&(o=i.type,o=o!=="head"&&o!=="body"&&!rm(i.type,i.memoizedProps)),o&&(o=tr)){if(lm(i))throw D0(),Error(ze(418));for(;o;)L0(i,o),o=fs(o.nextSibling)}if(B_(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(ze(317));e:{for(i=i.nextSibling,o=0;i;){if(i.nodeType===8){var u=i.data;if(u==="/$"){if(o===0){tr=fs(i.nextSibling);break e}o--}else u!=="$"&&u!=="$!"&&u!=="$?"||o++}i=i.nextSibling}tr=null}}else tr=ir?fs(i.stateNode.nextSibling):null;return!0}function D0(){for(var i=tr;i;)i=fs(i.nextSibling)}function Il(){tr=ir=null,di=!1}function Xm(i){Vr===null?Vr=[i]:Vr.push(i)}var S2=Mo.ReactCurrentBatchConfig;function Nr(i,o){if(i&&i.defaultProps){o=_i({},o),i=i.defaultProps;for(var u in i)o[u]===void 0&&(o[u]=i[u]);return o}return o}var _d=bs(null),vd=null,yl=null,Km=null;function Ym(){Km=yl=vd=null}function Jm(i){var o=_d.current;li(_d),i._currentValue=o}function cm(i,o,u){for(;i!==null;){var g=i.alternate;if((i.childLanes&o)!==o?(i.childLanes|=o,g!==null&&(g.childLanes|=o)):g!==null&&(g.childLanes&o)!==o&&(g.childLanes|=o),i===u)break;i=i.return}}function El(i,o){vd=i,Km=yl=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&o&&($n=!0),i.firstContext=null)}function Er(i){var o=i._currentValue;if(Km!==i)if(i={context:i,memoizedValue:o,next:null},yl===null){if(vd===null)throw Error(ze(308));yl=i,vd.dependencies={lanes:0,firstContext:i}}else yl=yl.next=i;return o}var Ys=null;function Qm(i){Ys===null?Ys=[i]:Ys.push(i)}function R0(i,o,u,g){var _=o.interleaved;return _===null?(u.next=u,Qm(o)):(u.next=_.next,_.next=u),o.interleaved=u,Io(i,g)}function Io(i,o){i.lanes|=o;var u=i.alternate;for(u!==null&&(u.lanes|=o),u=i,i=i.return;i!==null;)i.childLanes|=o,u=i.alternate,u!==null&&(u.childLanes|=o),u=i,i=i.return;return u.tag===3?u.stateNode:null}var os=!1;function eg(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function B0(i,o){i=i.updateQueue,o.updateQueue===i&&(o.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function To(i,o){return{eventTime:i,lane:o,tag:0,payload:null,callback:null,next:null}}function ms(i,o,u){var g=i.updateQueue;if(g===null)return null;if(g=g.shared,Ot&2){var _=g.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),g.pending=o,Io(i,u)}return _=g.interleaved,_===null?(o.next=o,Qm(g)):(o.next=_.next,_.next=o),g.interleaved=o,Io(i,u)}function Jh(i,o,u){if(o=o.updateQueue,o!==null&&(o=o.shared,(u&4194240)!==0)){var g=o.lanes;g&=i.pendingLanes,u|=g,o.lanes=u,Nm(i,u)}}function F_(i,o){var u=i.updateQueue,g=i.alternate;if(g!==null&&(g=g.updateQueue,u===g)){var _=null,b=null;if(u=u.firstBaseUpdate,u!==null){do{var M={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};b===null?_=b=M:b=b.next=M,u=u.next}while(u!==null);b===null?_=b=o:b=b.next=o}else _=b=o;u={baseState:g.baseState,firstBaseUpdate:_,lastBaseUpdate:b,shared:g.shared,effects:g.effects},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=o:i.next=o,u.lastBaseUpdate=o}function xd(i,o,u,g){var _=i.updateQueue;os=!1;var b=_.firstBaseUpdate,M=_.lastBaseUpdate,l=_.shared.pending;if(l!==null){_.shared.pending=null;var N=l,D=N.next;N.next=null,M===null?b=D:M.next=D,M=N;var oe=i.alternate;oe!==null&&(oe=oe.updateQueue,l=oe.lastBaseUpdate,l!==M&&(l===null?oe.firstBaseUpdate=D:l.next=D,oe.lastBaseUpdate=N))}if(b!==null){var te=_.baseState;M=0,oe=D=N=null,l=b;do{var he=l.lane,Ie=l.eventTime;if((g&he)===he){oe!==null&&(oe=oe.next={eventTime:Ie,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var Ce=i,Pe=l;switch(he=o,Ie=u,Pe.tag){case 1:if(Ce=Pe.payload,typeof Ce=="function"){te=Ce.call(Ie,te,he);break e}te=Ce;break e;case 3:Ce.flags=Ce.flags&-65537|128;case 0:if(Ce=Pe.payload,he=typeof Ce=="function"?Ce.call(Ie,te,he):Ce,he==null)break e;te=_i({},te,he);break e;case 2:os=!0}}l.callback!==null&&l.lane!==0&&(i.flags|=64,he=_.effects,he===null?_.effects=[l]:he.push(l))}else Ie={eventTime:Ie,lane:he,tag:l.tag,payload:l.payload,callback:l.callback,next:null},oe===null?(D=oe=Ie,N=te):oe=oe.next=Ie,M|=he;if(l=l.next,l===null){if(l=_.shared.pending,l===null)break;he=l,l=he.next,he.next=null,_.lastBaseUpdate=he,_.shared.pending=null}}while(1);if(oe===null&&(N=te),_.baseState=N,_.firstBaseUpdate=D,_.lastBaseUpdate=oe,o=_.shared.interleaved,o!==null){_=o;do M|=_.lane,_=_.next;while(_!==o)}else b===null&&(_.shared.lanes=0);ra|=M,i.lanes=M,i.memoizedState=te}}function O_(i,o,u){if(i=o.effects,o.effects=null,i!==null)for(o=0;o<i.length;o++){var g=i[o],_=g.callback;if(_!==null){if(g.callback=null,g=u,typeof _!="function")throw Error(ze(191,_));_.call(g)}}}var F0=new Rv.Component().refs;function hm(i,o,u,g){o=i.memoizedState,u=u(g,o),u=u==null?o:_i({},o,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var Fd={isMounted:function(i){return(i=i._reactInternals)?aa(i)===i:!1},enqueueSetState:function(i,o,u){i=i._reactInternals;var g=Pn(),_=ys(i),b=To(g,_);b.payload=o,u!=null&&(b.callback=u),o=ms(i,b,_),o!==null&&($r(o,i,_,g),Jh(o,i,_))},enqueueReplaceState:function(i,o,u){i=i._reactInternals;var g=Pn(),_=ys(i),b=To(g,_);b.tag=1,b.payload=o,u!=null&&(b.callback=u),o=ms(i,b,_),o!==null&&($r(o,i,_,g),Jh(o,i,_))},enqueueForceUpdate:function(i,o){i=i._reactInternals;var u=Pn(),g=ys(i),_=To(u,g);_.tag=2,o!=null&&(_.callback=o),o=ms(i,_,g),o!==null&&($r(o,i,g,u),Jh(o,i,g))}};function N_(i,o,u,g,_,b,M){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(g,b,M):o.prototype&&o.prototype.isPureReactComponent?!dc(u,g)||!dc(_,b):!0}function O0(i,o,u){var g=!1,_=xs,b=o.contextType;return typeof b=="object"&&b!==null?b=Er(b):(_=Zn(o)?ta:gn.current,g=o.contextTypes,b=(g=g!=null)?kl(i,_):xs),o=new o(u,b),i.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Fd,i.stateNode=o,o._reactInternals=i,g&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=_,i.__reactInternalMemoizedMaskedChildContext=b),o}function U_(i,o,u,g){i=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(u,g),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(u,g),o.state!==i&&Fd.enqueueReplaceState(o,o.state,null)}function dm(i,o,u,g){var _=i.stateNode;_.props=u,_.state=i.memoizedState,_.refs=F0,eg(i);var b=o.contextType;typeof b=="object"&&b!==null?_.context=Er(b):(b=Zn(o)?ta:gn.current,_.context=kl(i,b)),_.state=i.memoizedState,b=o.getDerivedStateFromProps,typeof b=="function"&&(hm(i,o,b,u),_.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(o=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),o!==_.state&&Fd.enqueueReplaceState(_,_.state,null),xd(i,u,_,g),_.state=i.memoizedState),typeof _.componentDidMount=="function"&&(i.flags|=4194308)}function $u(i,o,u){if(i=u.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(ze(309));var g=u.stateNode}if(!g)throw Error(ze(147,i));var _=g,b=""+i;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===b?o.ref:(o=function(M){var l=_.refs;l===F0&&(l=_.refs={}),M===null?delete l[b]:l[b]=M},o._stringRef=b,o)}if(typeof i!="string")throw Error(ze(284));if(!u._owner)throw Error(ze(290,i))}return i}function Vh(i,o){throw i=Object.prototype.toString.call(o),Error(ze(31,i==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":i))}function V_(i){var o=i._init;return o(i._payload)}function N0(i){function o(J,K){if(i){var re=J.deletions;re===null?(J.deletions=[K],J.flags|=16):re.push(K)}}function u(J,K){if(!i)return null;for(;K!==null;)o(J,K),K=K.sibling;return null}function g(J,K){for(J=new Map;K!==null;)K.key!==null?J.set(K.key,K):J.set(K.index,K),K=K.sibling;return J}function _(J,K){return J=_s(J,K),J.index=0,J.sibling=null,J}function b(J,K,re){return J.index=re,i?(re=J.alternate,re!==null?(re=re.index,re<K?(J.flags|=2,K):re):(J.flags|=2,K)):(J.flags|=1048576,K)}function M(J){return i&&J.alternate===null&&(J.flags|=2),J}function l(J,K,re,ve){return K===null||K.tag!==6?(K=Cf(re,J.mode,ve),K.return=J,K):(K=_(K,re),K.return=J,K)}function N(J,K,re,ve){var Ae=re.type;return Ae===ul?oe(J,K,re.props.children,ve,re.key):K!==null&&(K.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===rs&&V_(Ae)===K.type)?(ve=_(K,re.props),ve.ref=$u(J,K,re),ve.return=J,ve):(ve=rd(re.type,re.key,re.props,null,J.mode,ve),ve.ref=$u(J,K,re),ve.return=J,ve)}function D(J,K,re,ve){return K===null||K.tag!==4||K.stateNode.containerInfo!==re.containerInfo||K.stateNode.implementation!==re.implementation?(K=kf(re,J.mode,ve),K.return=J,K):(K=_(K,re.children||[]),K.return=J,K)}function oe(J,K,re,ve,Ae){return K===null||K.tag!==7?(K=ea(re,J.mode,ve,Ae),K.return=J,K):(K=_(K,re),K.return=J,K)}function te(J,K,re){if(typeof K=="string"&&K!==""||typeof K=="number")return K=Cf(""+K,J.mode,re),K.return=J,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case Mh:return re=rd(K.type,K.key,K.props,null,J.mode,re),re.ref=$u(J,null,K),re.return=J,re;case ll:return K=kf(K,J.mode,re),K.return=J,K;case rs:var ve=K._init;return te(J,ve(K._payload),re)}if(Hu(K)||Ou(K))return K=ea(K,J.mode,re,null),K.return=J,K;Vh(J,K)}return null}function he(J,K,re,ve){var Ae=K!==null?K.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return Ae!==null?null:l(J,K,""+re,ve);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case Mh:return re.key===Ae?N(J,K,re,ve):null;case ll:return re.key===Ae?D(J,K,re,ve):null;case rs:return Ae=re._init,he(J,K,Ae(re._payload),ve)}if(Hu(re)||Ou(re))return Ae!==null?null:oe(J,K,re,ve,null);Vh(J,re)}return null}function Ie(J,K,re,ve,Ae){if(typeof ve=="string"&&ve!==""||typeof ve=="number")return J=J.get(re)||null,l(K,J,""+ve,Ae);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case Mh:return J=J.get(ve.key===null?re:ve.key)||null,N(K,J,ve,Ae);case ll:return J=J.get(ve.key===null?re:ve.key)||null,D(K,J,ve,Ae);case rs:var Ue=ve._init;return Ie(J,K,re,Ue(ve._payload),Ae)}if(Hu(ve)||Ou(ve))return J=J.get(re)||null,oe(K,J,ve,Ae,null);Vh(K,ve)}return null}function Ce(J,K,re,ve){for(var Ae=null,Ue=null,Ge=K,Ve=K=0,gt=null;Ge!==null&&Ve<re.length;Ve++){Ge.index>Ve?(gt=Ge,Ge=null):gt=Ge.sibling;var Je=he(J,Ge,re[Ve],ve);if(Je===null){Ge===null&&(Ge=gt);break}i&&Ge&&Je.alternate===null&&o(J,Ge),K=b(Je,K,Ve),Ue===null?Ae=Je:Ue.sibling=Je,Ue=Je,Ge=gt}if(Ve===re.length)return u(J,Ge),di&&Ws(J,Ve),Ae;if(Ge===null){for(;Ve<re.length;Ve++)Ge=te(J,re[Ve],ve),Ge!==null&&(K=b(Ge,K,Ve),Ue===null?Ae=Ge:Ue.sibling=Ge,Ue=Ge);return di&&Ws(J,Ve),Ae}for(Ge=g(J,Ge);Ve<re.length;Ve++)gt=Ie(Ge,J,Ve,re[Ve],ve),gt!==null&&(i&&gt.alternate!==null&&Ge.delete(gt.key===null?Ve:gt.key),K=b(gt,K,Ve),Ue===null?Ae=gt:Ue.sibling=gt,Ue=gt);return i&&Ge.forEach(function(qt){return o(J,qt)}),di&&Ws(J,Ve),Ae}function Pe(J,K,re,ve){var Ae=Ou(re);if(typeof Ae!="function")throw Error(ze(150));if(re=Ae.call(re),re==null)throw Error(ze(151));for(var Ue=Ae=null,Ge=K,Ve=K=0,gt=null,Je=re.next();Ge!==null&&!Je.done;Ve++,Je=re.next()){Ge.index>Ve?(gt=Ge,Ge=null):gt=Ge.sibling;var qt=he(J,Ge,Je.value,ve);if(qt===null){Ge===null&&(Ge=gt);break}i&&Ge&&qt.alternate===null&&o(J,Ge),K=b(qt,K,Ve),Ue===null?Ae=qt:Ue.sibling=qt,Ue=qt,Ge=gt}if(Je.done)return u(J,Ge),di&&Ws(J,Ve),Ae;if(Ge===null){for(;!Je.done;Ve++,Je=re.next())Je=te(J,Je.value,ve),Je!==null&&(K=b(Je,K,Ve),Ue===null?Ae=Je:Ue.sibling=Je,Ue=Je);return di&&Ws(J,Ve),Ae}for(Ge=g(J,Ge);!Je.done;Ve++,Je=re.next())Je=Ie(Ge,J,Ve,Je.value,ve),Je!==null&&(i&&Je.alternate!==null&&Ge.delete(Je.key===null?Ve:Je.key),K=b(Je,K,Ve),Ue===null?Ae=Je:Ue.sibling=Je,Ue=Je);return i&&Ge.forEach(function(ni){return o(J,ni)}),di&&Ws(J,Ve),Ae}function ft(J,K,re,ve){if(typeof re=="object"&&re!==null&&re.type===ul&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case Mh:e:{for(var Ae=re.key,Ue=K;Ue!==null;){if(Ue.key===Ae){if(Ae=re.type,Ae===ul){if(Ue.tag===7){u(J,Ue.sibling),K=_(Ue,re.props.children),K.return=J,J=K;break e}}else if(Ue.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===rs&&V_(Ae)===Ue.type){u(J,Ue.sibling),K=_(Ue,re.props),K.ref=$u(J,Ue,re),K.return=J,J=K;break e}u(J,Ue);break}else o(J,Ue);Ue=Ue.sibling}re.type===ul?(K=ea(re.props.children,J.mode,ve,re.key),K.return=J,J=K):(ve=rd(re.type,re.key,re.props,null,J.mode,ve),ve.ref=$u(J,K,re),ve.return=J,J=ve)}return M(J);case ll:e:{for(Ue=re.key;K!==null;){if(K.key===Ue)if(K.tag===4&&K.stateNode.containerInfo===re.containerInfo&&K.stateNode.implementation===re.implementation){u(J,K.sibling),K=_(K,re.children||[]),K.return=J,J=K;break e}else{u(J,K);break}else o(J,K);K=K.sibling}K=kf(re,J.mode,ve),K.return=J,J=K}return M(J);case rs:return Ue=re._init,ft(J,K,Ue(re._payload),ve)}if(Hu(re))return Ce(J,K,re,ve);if(Ou(re))return Pe(J,K,re,ve);Vh(J,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,K!==null&&K.tag===6?(u(J,K.sibling),K=_(K,re),K.return=J,J=K):(u(J,K),K=Cf(re,J.mode,ve),K.return=J,J=K),M(J)):u(J,K)}return ft}var Pl=N0(!0),U0=N0(!1),Cc={},so=bs(Cc),gc=bs(Cc),yc=bs(Cc);function Js(i){if(i===Cc)throw Error(ze(174));return i}function tg(i,o){switch(ii(yc,o),ii(gc,i),ii(so,Cc),i=o.nodeType,i){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:qf(null,"");break;default:i=i===8?o.parentNode:o,o=i.namespaceURI||null,i=i.tagName,o=qf(o,i)}li(so),ii(so,o)}function Ml(){li(so),li(gc),li(yc)}function V0(i){Js(yc.current);var o=Js(so.current),u=qf(o,i.type);o!==u&&(ii(gc,i),ii(so,u))}function ig(i){gc.current===i&&(li(so),li(gc))}var gi=bs(0);function wd(i){for(var o=i;o!==null;){if(o.tag===13){var u=o.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var xf=[];function ng(){for(var i=0;i<xf.length;i++)xf[i]._workInProgressVersionPrimary=null;xf.length=0}var Qh=Mo.ReactCurrentDispatcher,wf=Mo.ReactCurrentBatchConfig,na=0,yi=null,ji=null,Xi=null,bd=!1,tc=!1,_c=0,E2=0;function pn(){throw Error(ze(321))}function rg(i,o){if(o===null)return!1;for(var u=0;u<o.length&&u<i.length;u++)if(!qr(i[u],o[u]))return!1;return!0}function og(i,o,u,g,_,b){if(na=b,yi=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Qh.current=i===null||i.memoizedState===null?I2:P2,i=u(g,_),tc){b=0;do{if(tc=!1,_c=0,25<=b)throw Error(ze(301));b+=1,Xi=ji=null,o.updateQueue=null,Qh.current=M2,i=u(g,_)}while(tc)}if(Qh.current=Sd,o=ji!==null&&ji.next!==null,na=0,Xi=ji=yi=null,bd=!1,o)throw Error(ze(300));return i}function sg(){var i=_c!==0;return _c=0,i}function no(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Xi===null?yi.memoizedState=Xi=i:Xi=Xi.next=i,Xi}function Tr(){if(ji===null){var i=yi.alternate;i=i!==null?i.memoizedState:null}else i=ji.next;var o=Xi===null?yi.memoizedState:Xi.next;if(o!==null)Xi=o,ji=i;else{if(i===null)throw Error(ze(310));ji=i,i={memoizedState:ji.memoizedState,baseState:ji.baseState,baseQueue:ji.baseQueue,queue:ji.queue,next:null},Xi===null?yi.memoizedState=Xi=i:Xi=Xi.next=i}return Xi}function vc(i,o){return typeof o=="function"?o(i):o}function bf(i){var o=Tr(),u=o.queue;if(u===null)throw Error(ze(311));u.lastRenderedReducer=i;var g=ji,_=g.baseQueue,b=u.pending;if(b!==null){if(_!==null){var M=_.next;_.next=b.next,b.next=M}g.baseQueue=_=b,u.pending=null}if(_!==null){b=_.next,g=g.baseState;var l=M=null,N=null,D=b;do{var oe=D.lane;if((na&oe)===oe)N!==null&&(N=N.next={lane:0,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null}),g=D.hasEagerState?D.eagerState:i(g,D.action);else{var te={lane:oe,action:D.action,hasEagerState:D.hasEagerState,eagerState:D.eagerState,next:null};N===null?(l=N=te,M=g):N=N.next=te,yi.lanes|=oe,ra|=oe}D=D.next}while(D!==null&&D!==b);N===null?M=g:N.next=l,qr(g,o.memoizedState)||($n=!0),o.memoizedState=g,o.baseState=M,o.baseQueue=N,u.lastRenderedState=g}if(i=u.interleaved,i!==null){_=i;do b=_.lane,yi.lanes|=b,ra|=b,_=_.next;while(_!==i)}else _===null&&(u.lanes=0);return[o.memoizedState,u.dispatch]}function Sf(i){var o=Tr(),u=o.queue;if(u===null)throw Error(ze(311));u.lastRenderedReducer=i;var g=u.dispatch,_=u.pending,b=o.memoizedState;if(_!==null){u.pending=null;var M=_=_.next;do b=i(b,M.action),M=M.next;while(M!==_);qr(b,o.memoizedState)||($n=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),u.lastRenderedState=b}return[b,g]}function j0(){}function $0(i,o){var u=yi,g=Tr(),_=o(),b=!qr(g.memoizedState,_);if(b&&(g.memoizedState=_,$n=!0),g=g.queue,ag(G0.bind(null,u,g,i),[i]),g.getSnapshot!==o||b||Xi!==null&&Xi.memoizedState.tag&1){if(u.flags|=2048,xc(9,Z0.bind(null,u,g,_,o),void 0,null),Ki===null)throw Error(ze(349));na&30||q0(u,o,_)}return _}function q0(i,o,u){i.flags|=16384,i={getSnapshot:o,value:u},o=yi.updateQueue,o===null?(o={lastEffect:null,stores:null},yi.updateQueue=o,o.stores=[i]):(u=o.stores,u===null?o.stores=[i]:u.push(i))}function Z0(i,o,u,g){o.value=u,o.getSnapshot=g,H0(o)&&W0(i)}function G0(i,o,u){return u(function(){H0(o)&&W0(i)})}function H0(i){var o=i.getSnapshot;i=i.value;try{var u=o();return!qr(i,u)}catch{return!0}}function W0(i){var o=Io(i,1);o!==null&&$r(o,i,1,-1)}function j_(i){var o=no();return typeof i=="function"&&(i=i()),o.memoizedState=o.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vc,lastRenderedState:i},o.queue=i,i=i.dispatch=k2.bind(null,yi,i),[o.memoizedState,i]}function xc(i,o,u,g){return i={tag:i,create:o,destroy:u,deps:g,next:null},o=yi.updateQueue,o===null?(o={lastEffect:null,stores:null},yi.updateQueue=o,o.lastEffect=i.next=i):(u=o.lastEffect,u===null?o.lastEffect=i.next=i:(g=u.next,u.next=i,i.next=g,o.lastEffect=i)),i}function X0(){return Tr().memoizedState}function ed(i,o,u,g){var _=no();yi.flags|=i,_.memoizedState=xc(1|o,u,void 0,g===void 0?null:g)}function Od(i,o,u,g){var _=Tr();g=g===void 0?null:g;var b=void 0;if(ji!==null){var M=ji.memoizedState;if(b=M.destroy,g!==null&&rg(g,M.deps)){_.memoizedState=xc(o,u,b,g);return}}yi.flags|=i,_.memoizedState=xc(1|o,u,b,g)}function $_(i,o){return ed(8390656,8,i,o)}function ag(i,o){return Od(2048,8,i,o)}function K0(i,o){return Od(4,2,i,o)}function Y0(i,o){return Od(4,4,i,o)}function J0(i,o){if(typeof o=="function")return i=i(),o(i),function(){o(null)};if(o!=null)return i=i(),o.current=i,function(){o.current=null}}function Q0(i,o,u){return u=u!=null?u.concat([i]):null,Od(4,4,J0.bind(null,o,i),u)}function lg(){}function ex(i,o){var u=Tr();o=o===void 0?null:o;var g=u.memoizedState;return g!==null&&o!==null&&rg(o,g[1])?g[0]:(u.memoizedState=[i,o],i)}function tx(i,o){var u=Tr();o=o===void 0?null:o;var g=u.memoizedState;return g!==null&&o!==null&&rg(o,g[1])?g[0]:(i=i(),u.memoizedState=[i,o],i)}function ix(i,o,u){return na&21?(qr(u,o)||(u=o0(),yi.lanes|=u,ra|=u,i.baseState=!0),o):(i.baseState&&(i.baseState=!1,$n=!0),i.memoizedState=u)}function T2(i,o){var u=Xt;Xt=u!==0&&4>u?u:4,i(!0);var g=wf.transition;wf.transition={};try{i(!1),o()}finally{Xt=u,wf.transition=g}}function nx(){return Tr().memoizedState}function C2(i,o,u){var g=ys(i);if(u={lane:g,action:u,hasEagerState:!1,eagerState:null,next:null},rx(i))ox(o,u);else if(u=R0(i,o,u,g),u!==null){var _=Pn();$r(u,i,g,_),sx(u,o,g)}}function k2(i,o,u){var g=ys(i),_={lane:g,action:u,hasEagerState:!1,eagerState:null,next:null};if(rx(i))ox(o,_);else{var b=i.alternate;if(i.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var M=o.lastRenderedState,l=b(M,u);if(_.hasEagerState=!0,_.eagerState=l,qr(l,M)){var N=o.interleaved;N===null?(_.next=_,Qm(o)):(_.next=N.next,N.next=_),o.interleaved=_;return}}catch{}finally{}u=R0(i,o,_,g),u!==null&&(_=Pn(),$r(u,i,g,_),sx(u,o,g))}}function rx(i){var o=i.alternate;return i===yi||o!==null&&o===yi}function ox(i,o){tc=bd=!0;var u=i.pending;u===null?o.next=o:(o.next=u.next,u.next=o),i.pending=o}function sx(i,o,u){if(u&4194240){var g=o.lanes;g&=i.pendingLanes,u|=g,o.lanes=u,Nm(i,u)}}var Sd={readContext:Er,useCallback:pn,useContext:pn,useEffect:pn,useImperativeHandle:pn,useInsertionEffect:pn,useLayoutEffect:pn,useMemo:pn,useReducer:pn,useRef:pn,useState:pn,useDebugValue:pn,useDeferredValue:pn,useTransition:pn,useMutableSource:pn,useSyncExternalStore:pn,useId:pn,unstable_isNewReconciler:!1},I2={readContext:Er,useCallback:function(i,o){return no().memoizedState=[i,o===void 0?null:o],i},useContext:Er,useEffect:$_,useImperativeHandle:function(i,o,u){return u=u!=null?u.concat([i]):null,ed(4194308,4,J0.bind(null,o,i),u)},useLayoutEffect:function(i,o){return ed(4194308,4,i,o)},useInsertionEffect:function(i,o){return ed(4,2,i,o)},useMemo:function(i,o){var u=no();return o=o===void 0?null:o,i=i(),u.memoizedState=[i,o],i},useReducer:function(i,o,u){var g=no();return o=u!==void 0?u(o):o,g.memoizedState=g.baseState=o,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:o},g.queue=i,i=i.dispatch=C2.bind(null,yi,i),[g.memoizedState,i]},useRef:function(i){var o=no();return i={current:i},o.memoizedState=i},useState:j_,useDebugValue:lg,useDeferredValue:function(i){return no().memoizedState=i},useTransition:function(){var i=j_(!1),o=i[0];return i=T2.bind(null,i[1]),no().memoizedState=i,[o,i]},useMutableSource:function(){},useSyncExternalStore:function(i,o,u){var g=yi,_=no();if(di){if(u===void 0)throw Error(ze(407));u=u()}else{if(u=o(),Ki===null)throw Error(ze(349));na&30||q0(g,o,u)}_.memoizedState=u;var b={value:u,getSnapshot:o};return _.queue=b,$_(G0.bind(null,g,b,i),[i]),g.flags|=2048,xc(9,Z0.bind(null,g,b,u,o),void 0,null),u},useId:function(){var i=no(),o=Ki.identifierPrefix;if(di){var u=Eo,g=So;u=(g&~(1<<32-jr(g)-1)).toString(32)+u,o=":"+o+"R"+u,u=_c++,0<u&&(o+="H"+u.toString(32)),o+=":"}else u=E2++,o=":"+o+"r"+u.toString(32)+":";return i.memoizedState=o},unstable_isNewReconciler:!1},P2={readContext:Er,useCallback:ex,useContext:Er,useEffect:ag,useImperativeHandle:Q0,useInsertionEffect:K0,useLayoutEffect:Y0,useMemo:tx,useReducer:bf,useRef:X0,useState:function(){return bf(vc)},useDebugValue:lg,useDeferredValue:function(i){var o=Tr();return ix(o,ji.memoizedState,i)},useTransition:function(){var i=bf(vc)[0],o=Tr().memoizedState;return[i,o]},useMutableSource:j0,useSyncExternalStore:$0,useId:nx,unstable_isNewReconciler:!1},M2={readContext:Er,useCallback:ex,useContext:Er,useEffect:ag,useImperativeHandle:Q0,useInsertionEffect:K0,useLayoutEffect:Y0,useMemo:tx,useReducer:Sf,useRef:X0,useState:function(){return Sf(vc)},useDebugValue:lg,useDeferredValue:function(i){var o=Tr();return ji===null?o.memoizedState=i:ix(o,ji.memoizedState,i)},useTransition:function(){var i=Sf(vc)[0],o=Tr().memoizedState;return[i,o]},useMutableSource:j0,useSyncExternalStore:$0,useId:nx,unstable_isNewReconciler:!1};function zl(i,o){try{var u="",g=o;do u+=rb(g),g=g.return;while(g);var _=u}catch(b){_=`
Error generating stack: `+b.message+`
`+b.stack}return{value:i,source:o,stack:_,digest:null}}function Ef(i,o,u){return{value:i,source:null,stack:u??null,digest:o??null}}function pm(i,o){try{console.error(o.value)}catch(u){setTimeout(function(){throw u})}}var z2=typeof WeakMap=="function"?WeakMap:Map;function ax(i,o,u){u=To(-1,u),u.tag=3,u.payload={element:null};var g=o.value;return u.callback=function(){Td||(Td=!0,Sm=g),pm(i,o)},u}function lx(i,o,u){u=To(-1,u),u.tag=3;var g=i.type.getDerivedStateFromError;if(typeof g=="function"){var _=o.value;u.payload=function(){return g(_)},u.callback=function(){pm(i,o)}}var b=i.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(u.callback=function(){pm(i,o),typeof g!="function"&&(gs===null?gs=new Set([this]):gs.add(this));var M=o.stack;this.componentDidCatch(o.value,{componentStack:M!==null?M:""})}),u}function q_(i,o,u){var g=i.pingCache;if(g===null){g=i.pingCache=new z2;var _=new Set;g.set(o,_)}else _=g.get(o),_===void 0&&(_=new Set,g.set(o,_));_.has(u)||(_.add(u),i=Z2.bind(null,i,o,u),o.then(i,i))}function Z_(i){do{var o;if((o=i.tag===13)&&(o=i.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return i;i=i.return}while(i!==null);return null}function G_(i,o,u,g,_){return i.mode&1?(i.flags|=65536,i.lanes=_,i):(i===o?i.flags|=65536:(i.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(o=To(-1,1),o.tag=2,ms(u,o,1))),u.lanes|=1),i)}var A2=Mo.ReactCurrentOwner,$n=!1;function In(i,o,u,g){o.child=i===null?U0(o,null,u,g):Pl(o,i.child,u,g)}function H_(i,o,u,g,_){u=u.render;var b=o.ref;return El(o,_),g=og(i,o,u,g,b,_),u=sg(),i!==null&&!$n?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~_,Po(i,o,_)):(di&&u&&Hm(o),o.flags|=1,In(i,o,g,_),o.child)}function W_(i,o,u,g,_){if(i===null){var b=u.type;return typeof b=="function"&&!gg(b)&&b.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(o.tag=15,o.type=b,ux(i,o,b,g,_)):(i=rd(u.type,null,g,o,o.mode,_),i.ref=o.ref,i.return=o,o.child=i)}if(b=i.child,!(i.lanes&_)){var M=b.memoizedProps;if(u=u.compare,u=u!==null?u:dc,u(M,g)&&i.ref===o.ref)return Po(i,o,_)}return o.flags|=1,i=_s(b,g),i.ref=o.ref,i.return=o,o.child=i}function ux(i,o,u,g,_){if(i!==null){var b=i.memoizedProps;if(dc(b,g)&&i.ref===o.ref)if($n=!1,o.pendingProps=g=b,(i.lanes&_)!==0)i.flags&131072&&($n=!0);else return o.lanes=i.lanes,Po(i,o,_)}return fm(i,o,u,g,_)}function cx(i,o,u){var g=o.pendingProps,_=g.children,b=i!==null?i.memoizedState:null;if(g.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},ii(vl,er),er|=u;else{if(!(u&1073741824))return i=b!==null?b.baseLanes|u:u,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:i,cachePool:null,transitions:null},o.updateQueue=null,ii(vl,er),er|=i,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},g=b!==null?b.baseLanes:u,ii(vl,er),er|=g}else b!==null?(g=b.baseLanes|u,o.memoizedState=null):g=u,ii(vl,er),er|=g;return In(i,o,_,u),o.child}function hx(i,o){var u=o.ref;(i===null&&u!==null||i!==null&&i.ref!==u)&&(o.flags|=512,o.flags|=2097152)}function fm(i,o,u,g,_){var b=Zn(u)?ta:gn.current;return b=kl(o,b),El(o,_),u=og(i,o,u,g,b,_),g=sg(),i!==null&&!$n?(o.updateQueue=i.updateQueue,o.flags&=-2053,i.lanes&=~_,Po(i,o,_)):(di&&g&&Hm(o),o.flags|=1,In(i,o,u,_),o.child)}function X_(i,o,u,g,_){if(Zn(u)){var b=!0;md(o)}else b=!1;if(El(o,_),o.stateNode===null)td(i,o),O0(o,u,g),dm(o,u,g,_),g=!0;else if(i===null){var M=o.stateNode,l=o.memoizedProps;M.props=l;var N=M.context,D=u.contextType;typeof D=="object"&&D!==null?D=Er(D):(D=Zn(u)?ta:gn.current,D=kl(o,D));var oe=u.getDerivedStateFromProps,te=typeof oe=="function"||typeof M.getSnapshotBeforeUpdate=="function";te||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(l!==g||N!==D)&&U_(o,M,g,D),os=!1;var he=o.memoizedState;M.state=he,xd(o,g,M,_),N=o.memoizedState,l!==g||he!==N||qn.current||os?(typeof oe=="function"&&(hm(o,u,oe,g),N=o.memoizedState),(l=os||N_(o,u,l,g,he,N,D))?(te||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount()),typeof M.componentDidMount=="function"&&(o.flags|=4194308)):(typeof M.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=g,o.memoizedState=N),M.props=g,M.state=N,M.context=D,g=l):(typeof M.componentDidMount=="function"&&(o.flags|=4194308),g=!1)}else{M=o.stateNode,B0(i,o),l=o.memoizedProps,D=o.type===o.elementType?l:Nr(o.type,l),M.props=D,te=o.pendingProps,he=M.context,N=u.contextType,typeof N=="object"&&N!==null?N=Er(N):(N=Zn(u)?ta:gn.current,N=kl(o,N));var Ie=u.getDerivedStateFromProps;(oe=typeof Ie=="function"||typeof M.getSnapshotBeforeUpdate=="function")||typeof M.UNSAFE_componentWillReceiveProps!="function"&&typeof M.componentWillReceiveProps!="function"||(l!==te||he!==N)&&U_(o,M,g,N),os=!1,he=o.memoizedState,M.state=he,xd(o,g,M,_);var Ce=o.memoizedState;l!==te||he!==Ce||qn.current||os?(typeof Ie=="function"&&(hm(o,u,Ie,g),Ce=o.memoizedState),(D=os||N_(o,u,D,g,he,Ce,N)||!1)?(oe||typeof M.UNSAFE_componentWillUpdate!="function"&&typeof M.componentWillUpdate!="function"||(typeof M.componentWillUpdate=="function"&&M.componentWillUpdate(g,Ce,N),typeof M.UNSAFE_componentWillUpdate=="function"&&M.UNSAFE_componentWillUpdate(g,Ce,N)),typeof M.componentDidUpdate=="function"&&(o.flags|=4),typeof M.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof M.componentDidUpdate!="function"||l===i.memoizedProps&&he===i.memoizedState||(o.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&he===i.memoizedState||(o.flags|=1024),o.memoizedProps=g,o.memoizedState=Ce),M.props=g,M.state=Ce,M.context=N,g=D):(typeof M.componentDidUpdate!="function"||l===i.memoizedProps&&he===i.memoizedState||(o.flags|=4),typeof M.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&he===i.memoizedState||(o.flags|=1024),g=!1)}return mm(i,o,u,g,b,_)}function mm(i,o,u,g,_,b){hx(i,o);var M=(o.flags&128)!==0;if(!g&&!M)return _&&D_(o,u,!1),Po(i,o,b);g=o.stateNode,A2.current=o;var l=M&&typeof u.getDerivedStateFromError!="function"?null:g.render();return o.flags|=1,i!==null&&M?(o.child=Pl(o,i.child,null,b),o.child=Pl(o,null,l,b)):In(i,o,l,b),o.memoizedState=g.state,_&&D_(o,u,!0),o.child}function dx(i){var o=i.stateNode;o.pendingContext?L_(i,o.pendingContext,o.pendingContext!==o.context):o.context&&L_(i,o.context,!1),tg(i,o.containerInfo)}function K_(i,o,u,g,_){return Il(),Xm(_),o.flags|=256,In(i,o,u,g),o.child}var gm={dehydrated:null,treeContext:null,retryLane:0};function ym(i){return{baseLanes:i,cachePool:null,transitions:null}}function px(i,o,u){var g=o.pendingProps,_=gi.current,b=!1,M=(o.flags&128)!==0,l;if((l=M)||(l=i!==null&&i.memoizedState===null?!1:(_&2)!==0),l?(b=!0,o.flags&=-129):(i===null||i.memoizedState!==null)&&(_|=1),ii(gi,_&1),i===null)return um(o),i=o.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(o.mode&1?i.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(M=g.children,i=g.fallback,b?(g=o.mode,b=o.child,M={mode:"hidden",children:M},!(g&1)&&b!==null?(b.childLanes=0,b.pendingProps=M):b=Vd(M,g,0,null),i=ea(i,g,u,null),b.return=o,i.return=o,b.sibling=i,o.child=b,o.child.memoizedState=ym(u),o.memoizedState=gm,i):ug(o,M));if(_=i.memoizedState,_!==null&&(l=_.dehydrated,l!==null))return L2(i,o,M,g,l,_,u);if(b){b=g.fallback,M=o.mode,_=i.child,l=_.sibling;var N={mode:"hidden",children:g.children};return!(M&1)&&o.child!==_?(g=o.child,g.childLanes=0,g.pendingProps=N,o.deletions=null):(g=_s(_,N),g.subtreeFlags=_.subtreeFlags&14680064),l!==null?b=_s(l,b):(b=ea(b,M,u,null),b.flags|=2),b.return=o,g.return=o,g.sibling=b,o.child=g,g=b,b=o.child,M=i.child.memoizedState,M=M===null?ym(u):{baseLanes:M.baseLanes|u,cachePool:null,transitions:M.transitions},b.memoizedState=M,b.childLanes=i.childLanes&~u,o.memoizedState=gm,g}return b=i.child,i=b.sibling,g=_s(b,{mode:"visible",children:g.children}),!(o.mode&1)&&(g.lanes=u),g.return=o,g.sibling=null,i!==null&&(u=o.deletions,u===null?(o.deletions=[i],o.flags|=16):u.push(i)),o.child=g,o.memoizedState=null,g}function ug(i,o){return o=Vd({mode:"visible",children:o},i.mode,0,null),o.return=i,i.child=o}function jh(i,o,u,g){return g!==null&&Xm(g),Pl(o,i.child,null,u),i=ug(o,o.pendingProps.children),i.flags|=2,o.memoizedState=null,i}function L2(i,o,u,g,_,b,M){if(u)return o.flags&256?(o.flags&=-257,g=Ef(Error(ze(422))),jh(i,o,M,g)):o.memoizedState!==null?(o.child=i.child,o.flags|=128,null):(b=g.fallback,_=o.mode,g=Vd({mode:"visible",children:g.children},_,0,null),b=ea(b,_,M,null),b.flags|=2,g.return=o,b.return=o,g.sibling=b,o.child=g,o.mode&1&&Pl(o,i.child,null,M),o.child.memoizedState=ym(M),o.memoizedState=gm,b);if(!(o.mode&1))return jh(i,o,M,null);if(_.data==="$!"){if(g=_.nextSibling&&_.nextSibling.dataset,g)var l=g.dgst;return g=l,b=Error(ze(419)),g=Ef(b,g,void 0),jh(i,o,M,g)}if(l=(M&i.childLanes)!==0,$n||l){if(g=Ki,g!==null){switch(M&-M){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(g.suspendedLanes|M)?0:_,_!==0&&_!==b.retryLane&&(b.retryLane=_,Io(i,_),$r(g,i,_,-1))}return mg(),g=Ef(Error(ze(421))),jh(i,o,M,g)}return _.data==="$?"?(o.flags|=128,o.child=i.child,o=G2.bind(null,i),_._reactRetry=o,null):(i=b.treeContext,tr=fs(_.nextSibling),ir=o,di=!0,Vr=null,i!==null&&(xr[wr++]=So,xr[wr++]=Eo,xr[wr++]=ia,So=i.id,Eo=i.overflow,ia=o),o=ug(o,g.children),o.flags|=4096,o)}function Y_(i,o,u){i.lanes|=o;var g=i.alternate;g!==null&&(g.lanes|=o),cm(i.return,o,u)}function Tf(i,o,u,g,_){var b=i.memoizedState;b===null?i.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:g,tail:u,tailMode:_}:(b.isBackwards=o,b.rendering=null,b.renderingStartTime=0,b.last=g,b.tail=u,b.tailMode=_)}function fx(i,o,u){var g=o.pendingProps,_=g.revealOrder,b=g.tail;if(In(i,o,g.children,u),g=gi.current,g&2)g=g&1|2,o.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=o.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Y_(i,u,o);else if(i.tag===19)Y_(i,u,o);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===o)break e;for(;i.sibling===null;){if(i.return===null||i.return===o)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}g&=1}if(ii(gi,g),!(o.mode&1))o.memoizedState=null;else switch(_){case"forwards":for(u=o.child,_=null;u!==null;)i=u.alternate,i!==null&&wd(i)===null&&(_=u),u=u.sibling;u=_,u===null?(_=o.child,o.child=null):(_=u.sibling,u.sibling=null),Tf(o,!1,_,u,b);break;case"backwards":for(u=null,_=o.child,o.child=null;_!==null;){if(i=_.alternate,i!==null&&wd(i)===null){o.child=_;break}i=_.sibling,_.sibling=u,u=_,_=i}Tf(o,!0,u,null,b);break;case"together":Tf(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function td(i,o){!(o.mode&1)&&i!==null&&(i.alternate=null,o.alternate=null,o.flags|=2)}function Po(i,o,u){if(i!==null&&(o.dependencies=i.dependencies),ra|=o.lanes,!(u&o.childLanes))return null;if(i!==null&&o.child!==i.child)throw Error(ze(153));if(o.child!==null){for(i=o.child,u=_s(i,i.pendingProps),o.child=u,u.return=o;i.sibling!==null;)i=i.sibling,u=u.sibling=_s(i,i.pendingProps),u.return=o;u.sibling=null}return o.child}function D2(i,o,u){switch(o.tag){case 3:dx(o),Il();break;case 5:V0(o);break;case 1:Zn(o.type)&&md(o);break;case 4:tg(o,o.stateNode.containerInfo);break;case 10:var g=o.type._context,_=o.memoizedProps.value;ii(_d,g._currentValue),g._currentValue=_;break;case 13:if(g=o.memoizedState,g!==null)return g.dehydrated!==null?(ii(gi,gi.current&1),o.flags|=128,null):u&o.child.childLanes?px(i,o,u):(ii(gi,gi.current&1),i=Po(i,o,u),i!==null?i.sibling:null);ii(gi,gi.current&1);break;case 19:if(g=(u&o.childLanes)!==0,i.flags&128){if(g)return fx(i,o,u);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ii(gi,gi.current),g)break;return null;case 22:case 23:return o.lanes=0,cx(i,o,u)}return Po(i,o,u)}var mx,_m,gx,yx;mx=function(i,o){for(var u=o.child;u!==null;){if(u.tag===5||u.tag===6)i.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return;u=u.return}u.sibling.return=u.return,u=u.sibling}};_m=function(){};gx=function(i,o,u,g){var _=i.memoizedProps;if(_!==g){i=o.stateNode,Js(so.current);var b=null;switch(u){case"input":_=Uf(i,_),g=Uf(i,g),b=[];break;case"select":_=_i({},_,{value:void 0}),g=_i({},g,{value:void 0}),b=[];break;case"textarea":_=$f(i,_),g=$f(i,g),b=[];break;default:typeof _.onClick!="function"&&typeof g.onClick=="function"&&(i.onclick=pd)}Zf(u,g);var M;u=null;for(D in _)if(!g.hasOwnProperty(D)&&_.hasOwnProperty(D)&&_[D]!=null)if(D==="style"){var l=_[D];for(M in l)l.hasOwnProperty(M)&&(u||(u={}),u[M]="")}else D!=="dangerouslySetInnerHTML"&&D!=="children"&&D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(oc.hasOwnProperty(D)?b||(b=[]):(b=b||[]).push(D,null));for(D in g){var N=g[D];if(l=_!=null?_[D]:void 0,g.hasOwnProperty(D)&&N!==l&&(N!=null||l!=null))if(D==="style")if(l){for(M in l)!l.hasOwnProperty(M)||N&&N.hasOwnProperty(M)||(u||(u={}),u[M]="");for(M in N)N.hasOwnProperty(M)&&l[M]!==N[M]&&(u||(u={}),u[M]=N[M])}else u||(b||(b=[]),b.push(D,u)),u=N;else D==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,l=l?l.__html:void 0,N!=null&&l!==N&&(b=b||[]).push(D,N)):D==="children"?typeof N!="string"&&typeof N!="number"||(b=b||[]).push(D,""+N):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&(oc.hasOwnProperty(D)?(N!=null&&D==="onScroll"&&ai("scroll",i),b||l===N||(b=[])):(b=b||[]).push(D,N))}u&&(b=b||[]).push("style",u);var D=b;(o.updateQueue=D)&&(o.flags|=4)}};yx=function(i,o,u,g){u!==g&&(o.flags|=4)};function qu(i,o){if(!di)switch(i.tailMode){case"hidden":o=i.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var g=null;u!==null;)u.alternate!==null&&(g=u),u=u.sibling;g===null?o||i.tail===null?i.tail=null:i.tail.sibling=null:g.sibling=null}}function fn(i){var o=i.alternate!==null&&i.alternate.child===i.child,u=0,g=0;if(o)for(var _=i.child;_!==null;)u|=_.lanes|_.childLanes,g|=_.subtreeFlags&14680064,g|=_.flags&14680064,_.return=i,_=_.sibling;else for(_=i.child;_!==null;)u|=_.lanes|_.childLanes,g|=_.subtreeFlags,g|=_.flags,_.return=i,_=_.sibling;return i.subtreeFlags|=g,i.childLanes=u,o}function R2(i,o,u){var g=o.pendingProps;switch(Wm(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return fn(o),null;case 1:return Zn(o.type)&&fd(),fn(o),null;case 3:return g=o.stateNode,Ml(),li(qn),li(gn),ng(),g.pendingContext&&(g.context=g.pendingContext,g.pendingContext=null),(i===null||i.child===null)&&(Uh(o)?o.flags|=4:i===null||i.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Vr!==null&&(Cm(Vr),Vr=null))),_m(i,o),fn(o),null;case 5:ig(o);var _=Js(yc.current);if(u=o.type,i!==null&&o.stateNode!=null)gx(i,o,u,g,_),i.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!g){if(o.stateNode===null)throw Error(ze(166));return fn(o),null}if(i=Js(so.current),Uh(o)){g=o.stateNode,u=o.type;var b=o.memoizedProps;switch(g[ro]=o,g[mc]=b,i=(o.mode&1)!==0,u){case"dialog":ai("cancel",g),ai("close",g);break;case"iframe":case"object":case"embed":ai("load",g);break;case"video":case"audio":for(_=0;_<Xu.length;_++)ai(Xu[_],g);break;case"source":ai("error",g);break;case"img":case"image":case"link":ai("error",g),ai("load",g);break;case"details":ai("toggle",g);break;case"input":s_(g,b),ai("invalid",g);break;case"select":g._wrapperState={wasMultiple:!!b.multiple},ai("invalid",g);break;case"textarea":l_(g,b),ai("invalid",g)}Zf(u,b),_=null;for(var M in b)if(b.hasOwnProperty(M)){var l=b[M];M==="children"?typeof l=="string"?g.textContent!==l&&(b.suppressHydrationWarning!==!0&&Nh(g.textContent,l,i),_=["children",l]):typeof l=="number"&&g.textContent!==""+l&&(b.suppressHydrationWarning!==!0&&Nh(g.textContent,l,i),_=["children",""+l]):oc.hasOwnProperty(M)&&l!=null&&M==="onScroll"&&ai("scroll",g)}switch(u){case"input":zh(g),a_(g,b,!0);break;case"textarea":zh(g),u_(g);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(g.onclick=pd)}g=_,o.updateQueue=g,g!==null&&(o.flags|=4)}else{M=_.nodeType===9?_:_.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=qv(u)),i==="http://www.w3.org/1999/xhtml"?u==="script"?(i=M.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof g.is=="string"?i=M.createElement(u,{is:g.is}):(i=M.createElement(u),u==="select"&&(M=i,g.multiple?M.multiple=!0:g.size&&(M.size=g.size))):i=M.createElementNS(i,u),i[ro]=o,i[mc]=g,mx(i,o,!1,!1),o.stateNode=i;e:{switch(M=Gf(u,g),u){case"dialog":ai("cancel",i),ai("close",i),_=g;break;case"iframe":case"object":case"embed":ai("load",i),_=g;break;case"video":case"audio":for(_=0;_<Xu.length;_++)ai(Xu[_],i);_=g;break;case"source":ai("error",i),_=g;break;case"img":case"image":case"link":ai("error",i),ai("load",i),_=g;break;case"details":ai("toggle",i),_=g;break;case"input":s_(i,g),_=Uf(i,g),ai("invalid",i);break;case"option":_=g;break;case"select":i._wrapperState={wasMultiple:!!g.multiple},_=_i({},g,{value:void 0}),ai("invalid",i);break;case"textarea":l_(i,g),_=$f(i,g),ai("invalid",i);break;default:_=g}Zf(u,_),l=_;for(b in l)if(l.hasOwnProperty(b)){var N=l[b];b==="style"?Hv(i,N):b==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&Zv(i,N)):b==="children"?typeof N=="string"?(u!=="textarea"||N!=="")&&sc(i,N):typeof N=="number"&&sc(i,""+N):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(oc.hasOwnProperty(b)?N!=null&&b==="onScroll"&&ai("scroll",i):N!=null&&Lm(i,b,N,M))}switch(u){case"input":zh(i),a_(i,g,!1);break;case"textarea":zh(i),u_(i);break;case"option":g.value!=null&&i.setAttribute("value",""+vs(g.value));break;case"select":i.multiple=!!g.multiple,b=g.value,b!=null?xl(i,!!g.multiple,b,!1):g.defaultValue!=null&&xl(i,!!g.multiple,g.defaultValue,!0);break;default:typeof _.onClick=="function"&&(i.onclick=pd)}switch(u){case"button":case"input":case"select":case"textarea":g=!!g.autoFocus;break e;case"img":g=!0;break e;default:g=!1}}g&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return fn(o),null;case 6:if(i&&o.stateNode!=null)yx(i,o,i.memoizedProps,g);else{if(typeof g!="string"&&o.stateNode===null)throw Error(ze(166));if(u=Js(yc.current),Js(so.current),Uh(o)){if(g=o.stateNode,u=o.memoizedProps,g[ro]=o,(b=g.nodeValue!==u)&&(i=ir,i!==null))switch(i.tag){case 3:Nh(g.nodeValue,u,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Nh(g.nodeValue,u,(i.mode&1)!==0)}b&&(o.flags|=4)}else g=(u.nodeType===9?u:u.ownerDocument).createTextNode(g),g[ro]=o,o.stateNode=g}return fn(o),null;case 13:if(li(gi),g=o.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(di&&tr!==null&&o.mode&1&&!(o.flags&128))D0(),Il(),o.flags|=98560,b=!1;else if(b=Uh(o),g!==null&&g.dehydrated!==null){if(i===null){if(!b)throw Error(ze(318));if(b=o.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(ze(317));b[ro]=o}else Il(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;fn(o),b=!1}else Vr!==null&&(Cm(Vr),Vr=null),b=!0;if(!b)return o.flags&65536?o:null}return o.flags&128?(o.lanes=u,o):(g=g!==null,g!==(i!==null&&i.memoizedState!==null)&&g&&(o.child.flags|=8192,o.mode&1&&(i===null||gi.current&1?$i===0&&($i=3):mg())),o.updateQueue!==null&&(o.flags|=4),fn(o),null);case 4:return Ml(),_m(i,o),i===null&&pc(o.stateNode.containerInfo),fn(o),null;case 10:return Jm(o.type._context),fn(o),null;case 17:return Zn(o.type)&&fd(),fn(o),null;case 19:if(li(gi),b=o.memoizedState,b===null)return fn(o),null;if(g=(o.flags&128)!==0,M=b.rendering,M===null)if(g)qu(b,!1);else{if($i!==0||i!==null&&i.flags&128)for(i=o.child;i!==null;){if(M=wd(i),M!==null){for(o.flags|=128,qu(b,!1),g=M.updateQueue,g!==null&&(o.updateQueue=g,o.flags|=4),o.subtreeFlags=0,g=u,u=o.child;u!==null;)b=u,i=g,b.flags&=14680066,M=b.alternate,M===null?(b.childLanes=0,b.lanes=i,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=M.childLanes,b.lanes=M.lanes,b.child=M.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=M.memoizedProps,b.memoizedState=M.memoizedState,b.updateQueue=M.updateQueue,b.type=M.type,i=M.dependencies,b.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),u=u.sibling;return ii(gi,gi.current&1|2),o.child}i=i.sibling}b.tail!==null&&Pi()>Al&&(o.flags|=128,g=!0,qu(b,!1),o.lanes=4194304)}else{if(!g)if(i=wd(M),i!==null){if(o.flags|=128,g=!0,u=i.updateQueue,u!==null&&(o.updateQueue=u,o.flags|=4),qu(b,!0),b.tail===null&&b.tailMode==="hidden"&&!M.alternate&&!di)return fn(o),null}else 2*Pi()-b.renderingStartTime>Al&&u!==1073741824&&(o.flags|=128,g=!0,qu(b,!1),o.lanes=4194304);b.isBackwards?(M.sibling=o.child,o.child=M):(u=b.last,u!==null?u.sibling=M:o.child=M,b.last=M)}return b.tail!==null?(o=b.tail,b.rendering=o,b.tail=o.sibling,b.renderingStartTime=Pi(),o.sibling=null,u=gi.current,ii(gi,g?u&1|2:u&1),o):(fn(o),null);case 22:case 23:return fg(),g=o.memoizedState!==null,i!==null&&i.memoizedState!==null!==g&&(o.flags|=8192),g&&o.mode&1?er&1073741824&&(fn(o),o.subtreeFlags&6&&(o.flags|=8192)):fn(o),null;case 24:return null;case 25:return null}throw Error(ze(156,o.tag))}function B2(i,o){switch(Wm(o),o.tag){case 1:return Zn(o.type)&&fd(),i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 3:return Ml(),li(qn),li(gn),ng(),i=o.flags,i&65536&&!(i&128)?(o.flags=i&-65537|128,o):null;case 5:return ig(o),null;case 13:if(li(gi),i=o.memoizedState,i!==null&&i.dehydrated!==null){if(o.alternate===null)throw Error(ze(340));Il()}return i=o.flags,i&65536?(o.flags=i&-65537|128,o):null;case 19:return li(gi),null;case 4:return Ml(),null;case 10:return Jm(o.type._context),null;case 22:case 23:return fg(),null;case 24:return null;default:return null}}var $h=!1,mn=!1,F2=typeof WeakSet=="function"?WeakSet:Set,tt=null;function _l(i,o){var u=i.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(g){Si(i,o,g)}else u.current=null}function vm(i,o,u){try{u()}catch(g){Si(i,o,g)}}var J_=!1;function O2(i,o){if(im=cd,i=w0(),Gm(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var g=u.getSelection&&u.getSelection();if(g&&g.rangeCount!==0){u=g.anchorNode;var _=g.anchorOffset,b=g.focusNode;g=g.focusOffset;try{u.nodeType,b.nodeType}catch{u=null;break e}var M=0,l=-1,N=-1,D=0,oe=0,te=i,he=null;t:for(;;){for(var Ie;te!==u||_!==0&&te.nodeType!==3||(l=M+_),te!==b||g!==0&&te.nodeType!==3||(N=M+g),te.nodeType===3&&(M+=te.nodeValue.length),(Ie=te.firstChild)!==null;)he=te,te=Ie;for(;;){if(te===i)break t;if(he===u&&++D===_&&(l=M),he===b&&++oe===g&&(N=M),(Ie=te.nextSibling)!==null)break;te=he,he=te.parentNode}te=Ie}u=l===-1||N===-1?null:{start:l,end:N}}else u=null}u=u||{start:0,end:0}}else u=null;for(nm={focusedElem:i,selectionRange:u},cd=!1,tt=o;tt!==null;)if(o=tt,i=o.child,(o.subtreeFlags&1028)!==0&&i!==null)i.return=o,tt=i;else for(;tt!==null;){o=tt;try{var Ce=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Ce!==null){var Pe=Ce.memoizedProps,ft=Ce.memoizedState,J=o.stateNode,K=J.getSnapshotBeforeUpdate(o.elementType===o.type?Pe:Nr(o.type,Pe),ft);J.__reactInternalSnapshotBeforeUpdate=K}break;case 3:var re=o.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ze(163))}}catch(ve){Si(o,o.return,ve)}if(i=o.sibling,i!==null){i.return=o.return,tt=i;break}tt=o.return}return Ce=J_,J_=!1,Ce}function ic(i,o,u){var g=o.updateQueue;if(g=g!==null?g.lastEffect:null,g!==null){var _=g=g.next;do{if((_.tag&i)===i){var b=_.destroy;_.destroy=void 0,b!==void 0&&vm(o,u,b)}_=_.next}while(_!==g)}}function Nd(i,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var u=o=o.next;do{if((u.tag&i)===i){var g=u.create;u.destroy=g()}u=u.next}while(u!==o)}}function xm(i){var o=i.ref;if(o!==null){var u=i.stateNode;switch(i.tag){case 5:i=u;break;default:i=u}typeof o=="function"?o(i):o.current=i}}function _x(i){var o=i.alternate;o!==null&&(i.alternate=null,_x(o)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(o=i.stateNode,o!==null&&(delete o[ro],delete o[mc],delete o[sm],delete o[x2],delete o[w2])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function vx(i){return i.tag===5||i.tag===3||i.tag===4}function Q_(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||vx(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function wm(i,o,u){var g=i.tag;if(g===5||g===6)i=i.stateNode,o?u.nodeType===8?u.parentNode.insertBefore(i,o):u.insertBefore(i,o):(u.nodeType===8?(o=u.parentNode,o.insertBefore(i,u)):(o=u,o.appendChild(i)),u=u._reactRootContainer,u!=null||o.onclick!==null||(o.onclick=pd));else if(g!==4&&(i=i.child,i!==null))for(wm(i,o,u),i=i.sibling;i!==null;)wm(i,o,u),i=i.sibling}function bm(i,o,u){var g=i.tag;if(g===5||g===6)i=i.stateNode,o?u.insertBefore(i,o):u.appendChild(i);else if(g!==4&&(i=i.child,i!==null))for(bm(i,o,u),i=i.sibling;i!==null;)bm(i,o,u),i=i.sibling}var tn=null,Ur=!1;function ns(i,o,u){for(u=u.child;u!==null;)xx(i,o,u),u=u.sibling}function xx(i,o,u){if(oo&&typeof oo.onCommitFiberUnmount=="function")try{oo.onCommitFiberUnmount(zd,u)}catch{}switch(u.tag){case 5:mn||_l(u,o);case 6:var g=tn,_=Ur;tn=null,ns(i,o,u),tn=g,Ur=_,tn!==null&&(Ur?(i=tn,u=u.stateNode,i.nodeType===8?i.parentNode.removeChild(u):i.removeChild(u)):tn.removeChild(u.stateNode));break;case 18:tn!==null&&(Ur?(i=tn,u=u.stateNode,i.nodeType===8?_f(i.parentNode,u):i.nodeType===1&&_f(i,u),cc(i)):_f(tn,u.stateNode));break;case 4:g=tn,_=Ur,tn=u.stateNode.containerInfo,Ur=!0,ns(i,o,u),tn=g,Ur=_;break;case 0:case 11:case 14:case 15:if(!mn&&(g=u.updateQueue,g!==null&&(g=g.lastEffect,g!==null))){_=g=g.next;do{var b=_,M=b.destroy;b=b.tag,M!==void 0&&(b&2||b&4)&&vm(u,o,M),_=_.next}while(_!==g)}ns(i,o,u);break;case 1:if(!mn&&(_l(u,o),g=u.stateNode,typeof g.componentWillUnmount=="function"))try{g.props=u.memoizedProps,g.state=u.memoizedState,g.componentWillUnmount()}catch(l){Si(u,o,l)}ns(i,o,u);break;case 21:ns(i,o,u);break;case 22:u.mode&1?(mn=(g=mn)||u.memoizedState!==null,ns(i,o,u),mn=g):ns(i,o,u);break;default:ns(i,o,u)}}function ev(i){var o=i.updateQueue;if(o!==null){i.updateQueue=null;var u=i.stateNode;u===null&&(u=i.stateNode=new F2),o.forEach(function(g){var _=H2.bind(null,i,g);u.has(g)||(u.add(g),g.then(_,_))})}}function Or(i,o){var u=o.deletions;if(u!==null)for(var g=0;g<u.length;g++){var _=u[g];try{var b=i,M=o,l=M;e:for(;l!==null;){switch(l.tag){case 5:tn=l.stateNode,Ur=!1;break e;case 3:tn=l.stateNode.containerInfo,Ur=!0;break e;case 4:tn=l.stateNode.containerInfo,Ur=!0;break e}l=l.return}if(tn===null)throw Error(ze(160));xx(b,M,_),tn=null,Ur=!1;var N=_.alternate;N!==null&&(N.return=null),_.return=null}catch(D){Si(_,o,D)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)wx(o,i),o=o.sibling}function wx(i,o){var u=i.alternate,g=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Or(o,i),io(i),g&4){try{ic(3,i,i.return),Nd(3,i)}catch(Pe){Si(i,i.return,Pe)}try{ic(5,i,i.return)}catch(Pe){Si(i,i.return,Pe)}}break;case 1:Or(o,i),io(i),g&512&&u!==null&&_l(u,u.return);break;case 5:if(Or(o,i),io(i),g&512&&u!==null&&_l(u,u.return),i.flags&32){var _=i.stateNode;try{sc(_,"")}catch(Pe){Si(i,i.return,Pe)}}if(g&4&&(_=i.stateNode,_!=null)){var b=i.memoizedProps,M=u!==null?u.memoizedProps:b,l=i.type,N=i.updateQueue;if(i.updateQueue=null,N!==null)try{l==="input"&&b.type==="radio"&&b.name!=null&&jv(_,b),Gf(l,M);var D=Gf(l,b);for(M=0;M<N.length;M+=2){var oe=N[M],te=N[M+1];oe==="style"?Hv(_,te):oe==="dangerouslySetInnerHTML"?Zv(_,te):oe==="children"?sc(_,te):Lm(_,oe,te,D)}switch(l){case"input":Vf(_,b);break;case"textarea":$v(_,b);break;case"select":var he=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!b.multiple;var Ie=b.value;Ie!=null?xl(_,!!b.multiple,Ie,!1):he!==!!b.multiple&&(b.defaultValue!=null?xl(_,!!b.multiple,b.defaultValue,!0):xl(_,!!b.multiple,b.multiple?[]:"",!1))}_[mc]=b}catch(Pe){Si(i,i.return,Pe)}}break;case 6:if(Or(o,i),io(i),g&4){if(i.stateNode===null)throw Error(ze(162));_=i.stateNode,b=i.memoizedProps;try{_.nodeValue=b}catch(Pe){Si(i,i.return,Pe)}}break;case 3:if(Or(o,i),io(i),g&4&&u!==null&&u.memoizedState.isDehydrated)try{cc(o.containerInfo)}catch(Pe){Si(i,i.return,Pe)}break;case 4:Or(o,i),io(i);break;case 13:Or(o,i),io(i),_=i.child,_.flags&8192&&(b=_.memoizedState!==null,_.stateNode.isHidden=b,!b||_.alternate!==null&&_.alternate.memoizedState!==null||(dg=Pi())),g&4&&ev(i);break;case 22:if(oe=u!==null&&u.memoizedState!==null,i.mode&1?(mn=(D=mn)||oe,Or(o,i),mn=D):Or(o,i),io(i),g&8192){if(D=i.memoizedState!==null,(i.stateNode.isHidden=D)&&!oe&&i.mode&1)for(tt=i,oe=i.child;oe!==null;){for(te=tt=oe;tt!==null;){switch(he=tt,Ie=he.child,he.tag){case 0:case 11:case 14:case 15:ic(4,he,he.return);break;case 1:_l(he,he.return);var Ce=he.stateNode;if(typeof Ce.componentWillUnmount=="function"){g=he,u=he.return;try{o=g,Ce.props=o.memoizedProps,Ce.state=o.memoizedState,Ce.componentWillUnmount()}catch(Pe){Si(g,u,Pe)}}break;case 5:_l(he,he.return);break;case 22:if(he.memoizedState!==null){iv(te);continue}}Ie!==null?(Ie.return=he,tt=Ie):iv(te)}oe=oe.sibling}e:for(oe=null,te=i;;){if(te.tag===5){if(oe===null){oe=te;try{_=te.stateNode,D?(b=_.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(l=te.stateNode,N=te.memoizedProps.style,M=N!=null&&N.hasOwnProperty("display")?N.display:null,l.style.display=Gv("display",M))}catch(Pe){Si(i,i.return,Pe)}}}else if(te.tag===6){if(oe===null)try{te.stateNode.nodeValue=D?"":te.memoizedProps}catch(Pe){Si(i,i.return,Pe)}}else if((te.tag!==22&&te.tag!==23||te.memoizedState===null||te===i)&&te.child!==null){te.child.return=te,te=te.child;continue}if(te===i)break e;for(;te.sibling===null;){if(te.return===null||te.return===i)break e;oe===te&&(oe=null),te=te.return}oe===te&&(oe=null),te.sibling.return=te.return,te=te.sibling}}break;case 19:Or(o,i),io(i),g&4&&ev(i);break;case 21:break;default:Or(o,i),io(i)}}function io(i){var o=i.flags;if(o&2){try{e:{for(var u=i.return;u!==null;){if(vx(u)){var g=u;break e}u=u.return}throw Error(ze(160))}switch(g.tag){case 5:var _=g.stateNode;g.flags&32&&(sc(_,""),g.flags&=-33);var b=Q_(i);bm(i,b,_);break;case 3:case 4:var M=g.stateNode.containerInfo,l=Q_(i);wm(i,l,M);break;default:throw Error(ze(161))}}catch(N){Si(i,i.return,N)}i.flags&=-3}o&4096&&(i.flags&=-4097)}function N2(i,o,u){tt=i,bx(i)}function bx(i,o,u){for(var g=(i.mode&1)!==0;tt!==null;){var _=tt,b=_.child;if(_.tag===22&&g){var M=_.memoizedState!==null||$h;if(!M){var l=_.alternate,N=l!==null&&l.memoizedState!==null||mn;l=$h;var D=mn;if($h=M,(mn=N)&&!D)for(tt=_;tt!==null;)M=tt,N=M.child,M.tag===22&&M.memoizedState!==null?nv(_):N!==null?(N.return=M,tt=N):nv(_);for(;b!==null;)tt=b,bx(b),b=b.sibling;tt=_,$h=l,mn=D}tv(i)}else _.subtreeFlags&8772&&b!==null?(b.return=_,tt=b):tv(i)}}function tv(i){for(;tt!==null;){var o=tt;if(o.flags&8772){var u=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:mn||Nd(5,o);break;case 1:var g=o.stateNode;if(o.flags&4&&!mn)if(u===null)g.componentDidMount();else{var _=o.elementType===o.type?u.memoizedProps:Nr(o.type,u.memoizedProps);g.componentDidUpdate(_,u.memoizedState,g.__reactInternalSnapshotBeforeUpdate)}var b=o.updateQueue;b!==null&&O_(o,b,g);break;case 3:var M=o.updateQueue;if(M!==null){if(u=null,o.child!==null)switch(o.child.tag){case 5:u=o.child.stateNode;break;case 1:u=o.child.stateNode}O_(o,M,u)}break;case 5:var l=o.stateNode;if(u===null&&o.flags&4){u=l;var N=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&u.focus();break;case"img":N.src&&(u.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var D=o.alternate;if(D!==null){var oe=D.memoizedState;if(oe!==null){var te=oe.dehydrated;te!==null&&cc(te)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ze(163))}mn||o.flags&512&&xm(o)}catch(he){Si(o,o.return,he)}}if(o===i){tt=null;break}if(u=o.sibling,u!==null){u.return=o.return,tt=u;break}tt=o.return}}function iv(i){for(;tt!==null;){var o=tt;if(o===i){tt=null;break}var u=o.sibling;if(u!==null){u.return=o.return,tt=u;break}tt=o.return}}function nv(i){for(;tt!==null;){var o=tt;try{switch(o.tag){case 0:case 11:case 15:var u=o.return;try{Nd(4,o)}catch(N){Si(o,u,N)}break;case 1:var g=o.stateNode;if(typeof g.componentDidMount=="function"){var _=o.return;try{g.componentDidMount()}catch(N){Si(o,_,N)}}var b=o.return;try{xm(o)}catch(N){Si(o,b,N)}break;case 5:var M=o.return;try{xm(o)}catch(N){Si(o,M,N)}}}catch(N){Si(o,o.return,N)}if(o===i){tt=null;break}var l=o.sibling;if(l!==null){l.return=o.return,tt=l;break}tt=o.return}}var U2=Math.ceil,Ed=Mo.ReactCurrentDispatcher,cg=Mo.ReactCurrentOwner,Sr=Mo.ReactCurrentBatchConfig,Ot=0,Ki=null,Bi=null,nn=0,er=0,vl=bs(0),$i=0,wc=null,ra=0,Ud=0,hg=0,nc=null,jn=null,dg=0,Al=1/0,wo=null,Td=!1,Sm=null,gs=null,qh=!1,cs=null,Cd=0,rc=0,Em=null,id=-1,nd=0;function Pn(){return Ot&6?Pi():id!==-1?id:id=Pi()}function ys(i){return i.mode&1?Ot&2&&nn!==0?nn&-nn:S2.transition!==null?(nd===0&&(nd=o0()),nd):(i=Xt,i!==0||(i=window.event,i=i===void 0?16:d0(i.type)),i):1}function $r(i,o,u,g){if(50<rc)throw rc=0,Em=null,Error(ze(185));Sc(i,u,g),(!(Ot&2)||i!==Ki)&&(i===Ki&&(!(Ot&2)&&(Ud|=u),$i===4&&as(i,nn)),Gn(i,g),u===1&&Ot===0&&!(o.mode&1)&&(Al=Pi()+500,Bd&&Ss()))}function Gn(i,o){var u=i.callbackNode;Sb(i,o);var g=ud(i,i===Ki?nn:0);if(g===0)u!==null&&d_(u),i.callbackNode=null,i.callbackPriority=0;else if(o=g&-g,i.callbackPriority!==o){if(u!=null&&d_(u),o===1)i.tag===0?b2(rv.bind(null,i)):z0(rv.bind(null,i)),_2(function(){!(Ot&6)&&Ss()}),u=null;else{switch(s0(g)){case 1:u=Om;break;case 4:u=n0;break;case 16:u=ld;break;case 536870912:u=r0;break;default:u=ld}u=Mx(u,Sx.bind(null,i))}i.callbackPriority=o,i.callbackNode=u}}function Sx(i,o){if(id=-1,nd=0,Ot&6)throw Error(ze(327));var u=i.callbackNode;if(Tl()&&i.callbackNode!==u)return null;var g=ud(i,i===Ki?nn:0);if(g===0)return null;if(g&30||g&i.expiredLanes||o)o=kd(i,g);else{o=g;var _=Ot;Ot|=2;var b=Tx();(Ki!==i||nn!==o)&&(wo=null,Al=Pi()+500,Qs(i,o));do try{$2();break}catch(l){Ex(i,l)}while(1);Ym(),Ed.current=b,Ot=_,Bi!==null?o=0:(Ki=null,nn=0,o=$i)}if(o!==0){if(o===2&&(_=Yf(i),_!==0&&(g=_,o=Tm(i,_))),o===1)throw u=wc,Qs(i,0),as(i,g),Gn(i,Pi()),u;if(o===6)as(i,g);else{if(_=i.current.alternate,!(g&30)&&!V2(_)&&(o=kd(i,g),o===2&&(b=Yf(i),b!==0&&(g=b,o=Tm(i,b))),o===1))throw u=wc,Qs(i,0),as(i,g),Gn(i,Pi()),u;switch(i.finishedWork=_,i.finishedLanes=g,o){case 0:case 1:throw Error(ze(345));case 2:Xs(i,jn,wo);break;case 3:if(as(i,g),(g&130023424)===g&&(o=dg+500-Pi(),10<o)){if(ud(i,0)!==0)break;if(_=i.suspendedLanes,(_&g)!==g){Pn(),i.pingedLanes|=i.suspendedLanes&_;break}i.timeoutHandle=om(Xs.bind(null,i,jn,wo),o);break}Xs(i,jn,wo);break;case 4:if(as(i,g),(g&4194240)===g)break;for(o=i.eventTimes,_=-1;0<g;){var M=31-jr(g);b=1<<M,M=o[M],M>_&&(_=M),g&=~b}if(g=_,g=Pi()-g,g=(120>g?120:480>g?480:1080>g?1080:1920>g?1920:3e3>g?3e3:4320>g?4320:1960*U2(g/1960))-g,10<g){i.timeoutHandle=om(Xs.bind(null,i,jn,wo),g);break}Xs(i,jn,wo);break;case 5:Xs(i,jn,wo);break;default:throw Error(ze(329))}}}return Gn(i,Pi()),i.callbackNode===u?Sx.bind(null,i):null}function Tm(i,o){var u=nc;return i.current.memoizedState.isDehydrated&&(Qs(i,o).flags|=256),i=kd(i,o),i!==2&&(o=jn,jn=u,o!==null&&Cm(o)),i}function Cm(i){jn===null?jn=i:jn.push.apply(jn,i)}function V2(i){for(var o=i;;){if(o.flags&16384){var u=o.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var g=0;g<u.length;g++){var _=u[g],b=_.getSnapshot;_=_.value;try{if(!qr(b(),_))return!1}catch{return!1}}}if(u=o.child,o.subtreeFlags&16384&&u!==null)u.return=o,o=u;else{if(o===i)break;for(;o.sibling===null;){if(o.return===null||o.return===i)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function as(i,o){for(o&=~hg,o&=~Ud,i.suspendedLanes|=o,i.pingedLanes&=~o,i=i.expirationTimes;0<o;){var u=31-jr(o),g=1<<u;i[u]=-1,o&=~g}}function rv(i){if(Ot&6)throw Error(ze(327));Tl();var o=ud(i,0);if(!(o&1))return Gn(i,Pi()),null;var u=kd(i,o);if(i.tag!==0&&u===2){var g=Yf(i);g!==0&&(o=g,u=Tm(i,g))}if(u===1)throw u=wc,Qs(i,0),as(i,o),Gn(i,Pi()),u;if(u===6)throw Error(ze(345));return i.finishedWork=i.current.alternate,i.finishedLanes=o,Xs(i,jn,wo),Gn(i,Pi()),null}function pg(i,o){var u=Ot;Ot|=1;try{return i(o)}finally{Ot=u,Ot===0&&(Al=Pi()+500,Bd&&Ss())}}function oa(i){cs!==null&&cs.tag===0&&!(Ot&6)&&Tl();var o=Ot;Ot|=1;var u=Sr.transition,g=Xt;try{if(Sr.transition=null,Xt=1,i)return i()}finally{Xt=g,Sr.transition=u,Ot=o,!(Ot&6)&&Ss()}}function fg(){er=vl.current,li(vl)}function Qs(i,o){i.finishedWork=null,i.finishedLanes=0;var u=i.timeoutHandle;if(u!==-1&&(i.timeoutHandle=-1,y2(u)),Bi!==null)for(u=Bi.return;u!==null;){var g=u;switch(Wm(g),g.tag){case 1:g=g.type.childContextTypes,g!=null&&fd();break;case 3:Ml(),li(qn),li(gn),ng();break;case 5:ig(g);break;case 4:Ml();break;case 13:li(gi);break;case 19:li(gi);break;case 10:Jm(g.type._context);break;case 22:case 23:fg()}u=u.return}if(Ki=i,Bi=i=_s(i.current,null),nn=er=o,$i=0,wc=null,hg=Ud=ra=0,jn=nc=null,Ys!==null){for(o=0;o<Ys.length;o++)if(u=Ys[o],g=u.interleaved,g!==null){u.interleaved=null;var _=g.next,b=u.pending;if(b!==null){var M=b.next;b.next=_,g.next=M}u.pending=g}Ys=null}return i}function Ex(i,o){do{var u=Bi;try{if(Ym(),Qh.current=Sd,bd){for(var g=yi.memoizedState;g!==null;){var _=g.queue;_!==null&&(_.pending=null),g=g.next}bd=!1}if(na=0,Xi=ji=yi=null,tc=!1,_c=0,cg.current=null,u===null||u.return===null){$i=1,wc=o,Bi=null;break}e:{var b=i,M=u.return,l=u,N=o;if(o=nn,l.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var D=N,oe=l,te=oe.tag;if(!(oe.mode&1)&&(te===0||te===11||te===15)){var he=oe.alternate;he?(oe.updateQueue=he.updateQueue,oe.memoizedState=he.memoizedState,oe.lanes=he.lanes):(oe.updateQueue=null,oe.memoizedState=null)}var Ie=Z_(M);if(Ie!==null){Ie.flags&=-257,G_(Ie,M,l,b,o),Ie.mode&1&&q_(b,D,o),o=Ie,N=D;var Ce=o.updateQueue;if(Ce===null){var Pe=new Set;Pe.add(N),o.updateQueue=Pe}else Ce.add(N);break e}else{if(!(o&1)){q_(b,D,o),mg();break e}N=Error(ze(426))}}else if(di&&l.mode&1){var ft=Z_(M);if(ft!==null){!(ft.flags&65536)&&(ft.flags|=256),G_(ft,M,l,b,o),Xm(zl(N,l));break e}}b=N=zl(N,l),$i!==4&&($i=2),nc===null?nc=[b]:nc.push(b),b=M;do{switch(b.tag){case 3:b.flags|=65536,o&=-o,b.lanes|=o;var J=ax(b,N,o);F_(b,J);break e;case 1:l=N;var K=b.type,re=b.stateNode;if(!(b.flags&128)&&(typeof K.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(gs===null||!gs.has(re)))){b.flags|=65536,o&=-o,b.lanes|=o;var ve=lx(b,l,o);F_(b,ve);break e}}b=b.return}while(b!==null)}kx(u)}catch(Ae){o=Ae,Bi===u&&u!==null&&(Bi=u=u.return);continue}break}while(1)}function Tx(){var i=Ed.current;return Ed.current=Sd,i===null?Sd:i}function mg(){($i===0||$i===3||$i===2)&&($i=4),Ki===null||!(ra&268435455)&&!(Ud&268435455)||as(Ki,nn)}function kd(i,o){var u=Ot;Ot|=2;var g=Tx();(Ki!==i||nn!==o)&&(wo=null,Qs(i,o));do try{j2();break}catch(_){Ex(i,_)}while(1);if(Ym(),Ot=u,Ed.current=g,Bi!==null)throw Error(ze(261));return Ki=null,nn=0,$i}function j2(){for(;Bi!==null;)Cx(Bi)}function $2(){for(;Bi!==null&&!fb();)Cx(Bi)}function Cx(i){var o=Px(i.alternate,i,er);i.memoizedProps=i.pendingProps,o===null?kx(i):Bi=o,cg.current=null}function kx(i){var o=i;do{var u=o.alternate;if(i=o.return,o.flags&32768){if(u=B2(u,o),u!==null){u.flags&=32767,Bi=u;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{$i=6,Bi=null;return}}else if(u=R2(u,o,er),u!==null){Bi=u;return}if(o=o.sibling,o!==null){Bi=o;return}Bi=o=i}while(o!==null);$i===0&&($i=5)}function Xs(i,o,u){var g=Xt,_=Sr.transition;try{Sr.transition=null,Xt=1,q2(i,o,u,g)}finally{Sr.transition=_,Xt=g}return null}function q2(i,o,u,g){do Tl();while(cs!==null);if(Ot&6)throw Error(ze(327));u=i.finishedWork;var _=i.finishedLanes;if(u===null)return null;if(i.finishedWork=null,i.finishedLanes=0,u===i.current)throw Error(ze(177));i.callbackNode=null,i.callbackPriority=0;var b=u.lanes|u.childLanes;if(Eb(i,b),i===Ki&&(Bi=Ki=null,nn=0),!(u.subtreeFlags&2064)&&!(u.flags&2064)||qh||(qh=!0,Mx(ld,function(){return Tl(),null})),b=(u.flags&15990)!==0,u.subtreeFlags&15990||b){b=Sr.transition,Sr.transition=null;var M=Xt;Xt=1;var l=Ot;Ot|=4,cg.current=null,O2(i,u),wx(u,i),c2(nm),cd=!!im,nm=im=null,i.current=u,N2(u),mb(),Ot=l,Xt=M,Sr.transition=b}else i.current=u;if(qh&&(qh=!1,cs=i,Cd=_),b=i.pendingLanes,b===0&&(gs=null),_b(u.stateNode),Gn(i,Pi()),o!==null)for(g=i.onRecoverableError,u=0;u<o.length;u++)_=o[u],g(_.value,{componentStack:_.stack,digest:_.digest});if(Td)throw Td=!1,i=Sm,Sm=null,i;return Cd&1&&i.tag!==0&&Tl(),b=i.pendingLanes,b&1?i===Em?rc++:(rc=0,Em=i):rc=0,Ss(),null}function Tl(){if(cs!==null){var i=s0(Cd),o=Sr.transition,u=Xt;try{if(Sr.transition=null,Xt=16>i?16:i,cs===null)var g=!1;else{if(i=cs,cs=null,Cd=0,Ot&6)throw Error(ze(331));var _=Ot;for(Ot|=4,tt=i.current;tt!==null;){var b=tt,M=b.child;if(tt.flags&16){var l=b.deletions;if(l!==null){for(var N=0;N<l.length;N++){var D=l[N];for(tt=D;tt!==null;){var oe=tt;switch(oe.tag){case 0:case 11:case 15:ic(8,oe,b)}var te=oe.child;if(te!==null)te.return=oe,tt=te;else for(;tt!==null;){oe=tt;var he=oe.sibling,Ie=oe.return;if(_x(oe),oe===D){tt=null;break}if(he!==null){he.return=Ie,tt=he;break}tt=Ie}}}var Ce=b.alternate;if(Ce!==null){var Pe=Ce.child;if(Pe!==null){Ce.child=null;do{var ft=Pe.sibling;Pe.sibling=null,Pe=ft}while(Pe!==null)}}tt=b}}if(b.subtreeFlags&2064&&M!==null)M.return=b,tt=M;else e:for(;tt!==null;){if(b=tt,b.flags&2048)switch(b.tag){case 0:case 11:case 15:ic(9,b,b.return)}var J=b.sibling;if(J!==null){J.return=b.return,tt=J;break e}tt=b.return}}var K=i.current;for(tt=K;tt!==null;){M=tt;var re=M.child;if(M.subtreeFlags&2064&&re!==null)re.return=M,tt=re;else e:for(M=K;tt!==null;){if(l=tt,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Nd(9,l)}}catch(Ae){Si(l,l.return,Ae)}if(l===M){tt=null;break e}var ve=l.sibling;if(ve!==null){ve.return=l.return,tt=ve;break e}tt=l.return}}if(Ot=_,Ss(),oo&&typeof oo.onPostCommitFiberRoot=="function")try{oo.onPostCommitFiberRoot(zd,i)}catch{}g=!0}return g}finally{Xt=u,Sr.transition=o}}return!1}function ov(i,o,u){o=zl(u,o),o=ax(i,o,1),i=ms(i,o,1),o=Pn(),i!==null&&(Sc(i,1,o),Gn(i,o))}function Si(i,o,u){if(i.tag===3)ov(i,i,u);else for(;o!==null;){if(o.tag===3){ov(o,i,u);break}else if(o.tag===1){var g=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(gs===null||!gs.has(g))){i=zl(u,i),i=lx(o,i,1),o=ms(o,i,1),i=Pn(),o!==null&&(Sc(o,1,i),Gn(o,i));break}}o=o.return}}function Z2(i,o,u){var g=i.pingCache;g!==null&&g.delete(o),o=Pn(),i.pingedLanes|=i.suspendedLanes&u,Ki===i&&(nn&u)===u&&($i===4||$i===3&&(nn&130023424)===nn&&500>Pi()-dg?Qs(i,0):hg|=u),Gn(i,o)}function Ix(i,o){o===0&&(i.mode&1?(o=Dh,Dh<<=1,!(Dh&130023424)&&(Dh=4194304)):o=1);var u=Pn();i=Io(i,o),i!==null&&(Sc(i,o,u),Gn(i,u))}function G2(i){var o=i.memoizedState,u=0;o!==null&&(u=o.retryLane),Ix(i,u)}function H2(i,o){var u=0;switch(i.tag){case 13:var g=i.stateNode,_=i.memoizedState;_!==null&&(u=_.retryLane);break;case 19:g=i.stateNode;break;default:throw Error(ze(314))}g!==null&&g.delete(o),Ix(i,u)}var Px;Px=function(i,o,u){if(i!==null)if(i.memoizedProps!==o.pendingProps||qn.current)$n=!0;else{if(!(i.lanes&u)&&!(o.flags&128))return $n=!1,D2(i,o,u);$n=!!(i.flags&131072)}else $n=!1,di&&o.flags&1048576&&A0(o,yd,o.index);switch(o.lanes=0,o.tag){case 2:var g=o.type;td(i,o),i=o.pendingProps;var _=kl(o,gn.current);El(o,u),_=og(null,o,g,i,_,u);var b=sg();return o.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Zn(g)?(b=!0,md(o)):b=!1,o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,eg(o),_.updater=Fd,o.stateNode=_,_._reactInternals=o,dm(o,g,i,u),o=mm(null,o,g,!0,b,u)):(o.tag=0,di&&b&&Hm(o),In(null,o,_,u),o=o.child),o;case 16:g=o.elementType;e:{switch(td(i,o),i=o.pendingProps,_=g._init,g=_(g._payload),o.type=g,_=o.tag=X2(g),i=Nr(g,i),_){case 0:o=fm(null,o,g,i,u);break e;case 1:o=X_(null,o,g,i,u);break e;case 11:o=H_(null,o,g,i,u);break e;case 14:o=W_(null,o,g,Nr(g.type,i),u);break e}throw Error(ze(306,g,""))}return o;case 0:return g=o.type,_=o.pendingProps,_=o.elementType===g?_:Nr(g,_),fm(i,o,g,_,u);case 1:return g=o.type,_=o.pendingProps,_=o.elementType===g?_:Nr(g,_),X_(i,o,g,_,u);case 3:e:{if(dx(o),i===null)throw Error(ze(387));g=o.pendingProps,b=o.memoizedState,_=b.element,B0(i,o),xd(o,g,null,u);var M=o.memoizedState;if(g=M.element,b.isDehydrated)if(b={element:g,isDehydrated:!1,cache:M.cache,pendingSuspenseBoundaries:M.pendingSuspenseBoundaries,transitions:M.transitions},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){_=zl(Error(ze(423)),o),o=K_(i,o,g,u,_);break e}else if(g!==_){_=zl(Error(ze(424)),o),o=K_(i,o,g,u,_);break e}else for(tr=fs(o.stateNode.containerInfo.firstChild),ir=o,di=!0,Vr=null,u=U0(o,null,g,u),o.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Il(),g===_){o=Po(i,o,u);break e}In(i,o,g,u)}o=o.child}return o;case 5:return V0(o),i===null&&um(o),g=o.type,_=o.pendingProps,b=i!==null?i.memoizedProps:null,M=_.children,rm(g,_)?M=null:b!==null&&rm(g,b)&&(o.flags|=32),hx(i,o),In(i,o,M,u),o.child;case 6:return i===null&&um(o),null;case 13:return px(i,o,u);case 4:return tg(o,o.stateNode.containerInfo),g=o.pendingProps,i===null?o.child=Pl(o,null,g,u):In(i,o,g,u),o.child;case 11:return g=o.type,_=o.pendingProps,_=o.elementType===g?_:Nr(g,_),H_(i,o,g,_,u);case 7:return In(i,o,o.pendingProps,u),o.child;case 8:return In(i,o,o.pendingProps.children,u),o.child;case 12:return In(i,o,o.pendingProps.children,u),o.child;case 10:e:{if(g=o.type._context,_=o.pendingProps,b=o.memoizedProps,M=_.value,ii(_d,g._currentValue),g._currentValue=M,b!==null)if(qr(b.value,M)){if(b.children===_.children&&!qn.current){o=Po(i,o,u);break e}}else for(b=o.child,b!==null&&(b.return=o);b!==null;){var l=b.dependencies;if(l!==null){M=b.child;for(var N=l.firstContext;N!==null;){if(N.context===g){if(b.tag===1){N=To(-1,u&-u),N.tag=2;var D=b.updateQueue;if(D!==null){D=D.shared;var oe=D.pending;oe===null?N.next=N:(N.next=oe.next,oe.next=N),D.pending=N}}b.lanes|=u,N=b.alternate,N!==null&&(N.lanes|=u),cm(b.return,u,o),l.lanes|=u;break}N=N.next}}else if(b.tag===10)M=b.type===o.type?null:b.child;else if(b.tag===18){if(M=b.return,M===null)throw Error(ze(341));M.lanes|=u,l=M.alternate,l!==null&&(l.lanes|=u),cm(M,u,o),M=b.sibling}else M=b.child;if(M!==null)M.return=b;else for(M=b;M!==null;){if(M===o){M=null;break}if(b=M.sibling,b!==null){b.return=M.return,M=b;break}M=M.return}b=M}In(i,o,_.children,u),o=o.child}return o;case 9:return _=o.type,g=o.pendingProps.children,El(o,u),_=Er(_),g=g(_),o.flags|=1,In(i,o,g,u),o.child;case 14:return g=o.type,_=Nr(g,o.pendingProps),_=Nr(g.type,_),W_(i,o,g,_,u);case 15:return ux(i,o,o.type,o.pendingProps,u);case 17:return g=o.type,_=o.pendingProps,_=o.elementType===g?_:Nr(g,_),td(i,o),o.tag=1,Zn(g)?(i=!0,md(o)):i=!1,El(o,u),O0(o,g,_),dm(o,g,_,u),mm(null,o,g,!0,i,u);case 19:return fx(i,o,u);case 22:return cx(i,o,u)}throw Error(ze(156,o.tag))};function Mx(i,o){return i0(i,o)}function W2(i,o,u,g){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function br(i,o,u,g){return new W2(i,o,u,g)}function gg(i){return i=i.prototype,!(!i||!i.isReactComponent)}function X2(i){if(typeof i=="function")return gg(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Rm)return 11;if(i===Bm)return 14}return 2}function _s(i,o){var u=i.alternate;return u===null?(u=br(i.tag,o,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=o,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&14680064,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,o=i.dependencies,u.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u}function rd(i,o,u,g,_,b){var M=2;if(g=i,typeof i=="function")gg(i)&&(M=1);else if(typeof i=="string")M=5;else e:switch(i){case ul:return ea(u.children,_,b,o);case Dm:M=8,_|=8;break;case Bf:return i=br(12,u,o,_|2),i.elementType=Bf,i.lanes=b,i;case Ff:return i=br(13,u,o,_),i.elementType=Ff,i.lanes=b,i;case Of:return i=br(19,u,o,_),i.elementType=Of,i.lanes=b,i;case Nv:return Vd(u,_,b,o);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Fv:M=10;break e;case Ov:M=9;break e;case Rm:M=11;break e;case Bm:M=14;break e;case rs:M=16,g=null;break e}throw Error(ze(130,i==null?i:typeof i,""))}return o=br(M,u,o,_),o.elementType=i,o.type=g,o.lanes=b,o}function ea(i,o,u,g){return i=br(7,i,g,o),i.lanes=u,i}function Vd(i,o,u,g){return i=br(22,i,g,o),i.elementType=Nv,i.lanes=u,i.stateNode={isHidden:!1},i}function Cf(i,o,u){return i=br(6,i,null,o),i.lanes=u,i}function kf(i,o,u){return o=br(4,i.children!==null?i.children:[],i.key,o),o.lanes=u,o.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},o}function K2(i,o,u,g,_){this.tag=o,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=af(0),this.expirationTimes=af(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=af(0),this.identifierPrefix=g,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function yg(i,o,u,g,_,b,M,l,N){return i=new K2(i,o,u,l,N),o===1?(o=1,b===!0&&(o|=8)):o=0,b=br(3,null,null,o),i.current=b,b.stateNode=i,b.memoizedState={element:g,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},eg(b),i}function Y2(i,o,u){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ll,key:g==null?null:""+g,children:i,containerInfo:o,implementation:u}}function zx(i){if(!i)return xs;i=i._reactInternals;e:{if(aa(i)!==i||i.tag!==1)throw Error(ze(170));var o=i;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Zn(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(ze(171))}if(i.tag===1){var u=i.type;if(Zn(u))return M0(i,u,o)}return o}function Ax(i,o,u,g,_,b,M,l,N){return i=yg(u,g,!0,i,_,b,M,l,N),i.context=zx(null),u=i.current,g=Pn(),_=ys(u),b=To(g,_),b.callback=o??null,ms(u,b,_),i.current.lanes=_,Sc(i,_,g),Gn(i,g),i}function jd(i,o,u,g){var _=o.current,b=Pn(),M=ys(_);return u=zx(u),o.context===null?o.context=u:o.pendingContext=u,o=To(b,M),o.payload={element:i},g=g===void 0?null:g,g!==null&&(o.callback=g),i=ms(_,o,M),i!==null&&($r(i,_,M,b),Jh(i,_,M)),M}function Id(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function sv(i,o){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<o?u:o}}function _g(i,o){sv(i,o),(i=i.alternate)&&sv(i,o)}function J2(){return null}var Lx=typeof reportError=="function"?reportError:function(i){console.error(i)};function vg(i){this._internalRoot=i}$d.prototype.render=vg.prototype.render=function(i){var o=this._internalRoot;if(o===null)throw Error(ze(409));jd(i,o,null,null)};$d.prototype.unmount=vg.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var o=i.containerInfo;oa(function(){jd(null,i,null,null)}),o[ko]=null}};function $d(i){this._internalRoot=i}$d.prototype.unstable_scheduleHydration=function(i){if(i){var o=u0();i={blockedOn:null,target:i,priority:o};for(var u=0;u<ss.length&&o!==0&&o<ss[u].priority;u++);ss.splice(u,0,i),u===0&&h0(i)}};function xg(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function qd(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function av(){}function Q2(i,o,u,g,_){if(_){if(typeof g=="function"){var b=g;g=function(){var D=Id(M);b.call(D)}}var M=Ax(o,g,i,0,null,!1,!1,"",av);return i._reactRootContainer=M,i[ko]=M.current,pc(i.nodeType===8?i.parentNode:i),oa(),M}for(;_=i.lastChild;)i.removeChild(_);if(typeof g=="function"){var l=g;g=function(){var D=Id(N);l.call(D)}}var N=yg(i,0,!1,null,null,!1,!1,"",av);return i._reactRootContainer=N,i[ko]=N.current,pc(i.nodeType===8?i.parentNode:i),oa(function(){jd(o,N,u,g)}),N}function Zd(i,o,u,g,_){var b=u._reactRootContainer;if(b){var M=b;if(typeof _=="function"){var l=_;_=function(){var N=Id(M);l.call(N)}}jd(o,M,i,_)}else M=Q2(u,o,i,_,g);return Id(M)}a0=function(i){switch(i.tag){case 3:var o=i.stateNode;if(o.current.memoizedState.isDehydrated){var u=Wu(o.pendingLanes);u!==0&&(Nm(o,u|1),Gn(o,Pi()),!(Ot&6)&&(Al=Pi()+500,Ss()))}break;case 13:oa(function(){var g=Io(i,1);if(g!==null){var _=Pn();$r(g,i,1,_)}}),_g(i,1)}};Um=function(i){if(i.tag===13){var o=Io(i,134217728);if(o!==null){var u=Pn();$r(o,i,134217728,u)}_g(i,134217728)}};l0=function(i){if(i.tag===13){var o=ys(i),u=Io(i,o);if(u!==null){var g=Pn();$r(u,i,o,g)}_g(i,o)}};u0=function(){return Xt};c0=function(i,o){var u=Xt;try{return Xt=i,o()}finally{Xt=u}};Wf=function(i,o,u){switch(o){case"input":if(Vf(i,u),o=u.name,u.type==="radio"&&o!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<u.length;o++){var g=u[o];if(g!==i&&g.form===i.form){var _=Rd(g);if(!_)throw Error(ze(90));Vv(g),Vf(g,_)}}}break;case"textarea":$v(i,u);break;case"select":o=u.value,o!=null&&xl(i,!!u.multiple,o,!1)}};Kv=pg;Yv=oa;var eS={usingClientEntryPoint:!1,Events:[Tc,pl,Rd,Wv,Xv,pg]},Zu={findFiberByHostInstance:Ks,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},tS={bundleType:Zu.bundleType,version:Zu.version,rendererPackageName:Zu.rendererPackageName,rendererConfig:Zu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Mo.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=e0(i),i===null?null:i.stateNode},findFiberByHostInstance:Zu.findFiberByHostInstance||J2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Zh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Zh.isDisabled&&Zh.supportsFiber)try{zd=Zh.inject(tS),oo=Zh}catch{}}rr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eS;rr.createPortal=function(i,o){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xg(o))throw Error(ze(200));return Y2(i,o,null,u)};rr.createRoot=function(i,o){if(!xg(i))throw Error(ze(299));var u=!1,g="",_=Lx;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onRecoverableError!==void 0&&(_=o.onRecoverableError)),o=yg(i,1,!1,null,null,u,!1,g,_),i[ko]=o.current,pc(i.nodeType===8?i.parentNode:i),new vg(o)};rr.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var o=i._reactInternals;if(o===void 0)throw typeof i.render=="function"?Error(ze(188)):(i=Object.keys(i).join(","),Error(ze(268,i)));return i=e0(o),i=i===null?null:i.stateNode,i};rr.flushSync=function(i){return oa(i)};rr.hydrate=function(i,o,u){if(!qd(o))throw Error(ze(200));return Zd(null,i,o,!0,u)};rr.hydrateRoot=function(i,o,u){if(!xg(i))throw Error(ze(405));var g=u!=null&&u.hydratedSources||null,_=!1,b="",M=Lx;if(u!=null&&(u.unstable_strictMode===!0&&(_=!0),u.identifierPrefix!==void 0&&(b=u.identifierPrefix),u.onRecoverableError!==void 0&&(M=u.onRecoverableError)),o=Ax(o,null,i,1,u??null,_,!1,b,M),i[ko]=o.current,pc(i),g)for(i=0;i<g.length;i++)u=g[i],_=u._getVersion,_=_(u._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[u,_]:o.mutableSourceEagerHydrationData.push(u,_);return new $d(o)};rr.render=function(i,o,u){if(!qd(o))throw Error(ze(200));return Zd(null,i,o,!1,u)};rr.unmountComponentAtNode=function(i){if(!qd(i))throw Error(ze(40));return i._reactRootContainer?(oa(function(){Zd(null,null,i,!1,function(){i._reactRootContainer=null,i[ko]=null})}),!0):!1};rr.unstable_batchedUpdates=pg;rr.unstable_renderSubtreeIntoContainer=function(i,o,u,g){if(!qd(u))throw Error(ze(200));if(i==null||i._reactInternals===void 0)throw Error(ze(38));return Zd(i,o,u,!1,g)};rr.version="18.2.0-next-9e3b772b8-20220608";function Dx(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Dx)}catch(i){console.error(i)}}Dx(),Av.exports=rr;var wg=Av.exports;const iS=Pd(wg);var Rx={exports:{}},If,lv;function nS(){return lv||(lv=1,If={tocSelector:".js-toc",contentSelector:".js-toc-content",headingSelector:"h1, h2, h3",ignoreSelector:".js-toc-ignore",hasInnerContainers:!1,linkClass:"toc-link",extraLinkClasses:"",activeLinkClass:"is-active-link",listClass:"toc-list",extraListClasses:"",isCollapsedClass:"is-collapsed",collapsibleClass:"is-collapsible",listItemClass:"toc-list-item",activeListItemClass:"is-active-li",collapseDepth:0,scrollSmooth:!0,scrollSmoothDuration:420,scrollSmoothOffset:0,scrollEndCallback:function(i){},headingsOffset:1,throttleTimeout:50,positionFixedSelector:null,positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto",includeHtml:!1,includeTitleTags:!1,onClick:function(i){},orderedList:!0,scrollContainer:null,skipRendering:!1,headingLabelCallback:!1,ignoreHiddenElements:!1,headingObjectCallback:null,basePath:"",disableTocScrollSync:!1,tocScrollOffset:0}),If}var Pf,uv;function rS(){return uv||(uv=1,Pf=function(i){var o=[].forEach,u=[].some,g=document.body,_,b=!0,M=" ";function l(J,K){var re=K.appendChild(D(J));if(J.children.length){var ve=oe(J.isCollapsed);J.children.forEach(function(Ae){l(Ae,ve)}),re.appendChild(ve)}}function N(J,K){var re=!1,ve=oe(re);if(K.forEach(function(Ae){l(Ae,ve)}),_=J||_,_!==null)return _.firstChild&&_.removeChild(_.firstChild),K.length===0?_:_.appendChild(ve)}function D(J){var K=document.createElement("li"),re=document.createElement("a");return i.listItemClass&&K.setAttribute("class",i.listItemClass),i.onClick&&(re.onclick=i.onClick),i.includeTitleTags&&re.setAttribute("title",J.textContent),i.includeHtml&&J.childNodes.length?o.call(J.childNodes,function(ve){re.appendChild(ve.cloneNode(!0))}):re.textContent=J.textContent,re.setAttribute("href",i.basePath+"#"+J.id),re.setAttribute("class",i.linkClass+M+"node-name--"+J.nodeName+M+i.extraLinkClasses),K.appendChild(re),K}function oe(J){var K=i.orderedList?"ol":"ul",re=document.createElement(K),ve=i.listClass+M+i.extraListClasses;return J&&(ve=ve+M+i.collapsibleClass,ve=ve+M+i.isCollapsedClass),re.setAttribute("class",ve),re}function te(){if(i.scrollContainer&&document.querySelector(i.scrollContainer)){var J;J=document.querySelector(i.scrollContainer).scrollTop}else J=document.documentElement.scrollTop||g.scrollTop;var K=document.querySelector(i.positionFixedSelector);i.fixedSidebarOffset==="auto"&&(i.fixedSidebarOffset=_.offsetTop),J>i.fixedSidebarOffset?K.className.indexOf(i.positionFixedClass)===-1&&(K.className+=M+i.positionFixedClass):K.className=K.className.split(M+i.positionFixedClass).join("")}function he(J){var K=0;return J!==null&&(K=J.offsetTop,i.hasInnerContainers&&(K+=he(J.offsetParent))),K}function Ie(J){if(i.scrollContainer&&document.querySelector(i.scrollContainer)){var K;K=document.querySelector(i.scrollContainer).scrollTop}else K=document.documentElement.scrollTop||g.scrollTop;i.positionFixedSelector&&te();var re=J,ve;if(b&&_!==null&&re.length>0){u.call(re,function(qt,ni){if(he(qt)>K+i.headingsOffset+10){var Fi=ni===0?ni:ni-1;return ve=re[Fi],!0}else if(ni===re.length-1)return ve=re[re.length-1],!0});var Ae=_.querySelector("."+i.activeLinkClass),Ue=_.querySelector("."+i.linkClass+".node-name--"+ve.nodeName+'[href="'+i.basePath+"#"+ve.id.replace(/([ #;&,.+*~':"!^$[\]()=>|/\\@])/g,"\\$1")+'"]');if(Ae===Ue)return;var Ge=_.querySelectorAll("."+i.linkClass);o.call(Ge,function(qt){qt.className=qt.className.split(M+i.activeLinkClass).join("")});var Ve=_.querySelectorAll("."+i.listItemClass);o.call(Ve,function(qt){qt.className=qt.className.split(M+i.activeListItemClass).join("")}),Ue&&Ue.className.indexOf(i.activeLinkClass)===-1&&(Ue.className+=M+i.activeLinkClass);var gt=Ue&&Ue.parentNode;gt&&gt.className.indexOf(i.activeListItemClass)===-1&&(gt.className+=M+i.activeListItemClass);var Je=_.querySelectorAll("."+i.listClass+"."+i.collapsibleClass);o.call(Je,function(qt){qt.className.indexOf(i.isCollapsedClass)===-1&&(qt.className+=M+i.isCollapsedClass)}),Ue&&Ue.nextSibling&&Ue.nextSibling.className.indexOf(i.isCollapsedClass)!==-1&&(Ue.nextSibling.className=Ue.nextSibling.className.split(M+i.isCollapsedClass).join("")),Ce(Ue&&Ue.parentNode.parentNode)}}function Ce(J){return J&&J.className.indexOf(i.collapsibleClass)!==-1&&J.className.indexOf(i.isCollapsedClass)!==-1?(J.className=J.className.split(M+i.isCollapsedClass).join(""),Ce(J.parentNode.parentNode)):J}function Pe(J){var K=J.target||J.srcElement;typeof K.className!="string"||K.className.indexOf(i.linkClass)===-1||(b=!1)}function ft(){b=!0}return{enableTocAnimation:ft,disableTocAnimation:Pe,render:N,updateToc:Ie}}),Pf}var Mf,cv;function oS(){return cv||(cv=1,Mf=function(o){var u=[].reduce;function g(oe){return oe[oe.length-1]}function _(oe){return+oe.nodeName.toUpperCase().replace("H","")}function b(oe){try{return oe instanceof window.HTMLElement||oe instanceof window.parent.HTMLElement}catch{return oe instanceof window.HTMLElement}}function M(oe){if(!b(oe))return oe;if(o.ignoreHiddenElements&&(!oe.offsetHeight||!oe.offsetParent))return null;const te=oe.getAttribute("data-heading-label")||(o.headingLabelCallback?String(o.headingLabelCallback(oe.textContent)):oe.textContent.trim());var he={id:oe.id,children:[],nodeName:oe.nodeName,headingLevel:_(oe),textContent:te};return o.includeHtml&&(he.childNodes=oe.childNodes),o.headingObjectCallback?o.headingObjectCallback(he,oe):he}function l(oe,te){for(var he=M(oe),Ie=he.headingLevel,Ce=te,Pe=g(Ce),ft=Pe?Pe.headingLevel:0,J=Ie-ft;J>0&&(Pe=g(Ce),!(Pe&&Ie===Pe.headingLevel));)Pe&&Pe.children!==void 0&&(Ce=Pe.children),J--;return Ie>=o.collapseDepth&&(he.isCollapsed=!0),Ce.push(he),Ce}function N(oe,te){var he=te;o.ignoreSelector&&(he=te.split(",").map(function(Ce){return Ce.trim()+":not("+o.ignoreSelector+")"}));try{return oe.querySelectorAll(he)}catch{return console.warn("Headers not found with selector: "+he),null}}function D(oe){return u.call(oe,function(he,Ie){var Ce=M(Ie);return Ce&&l(Ce,he.nest),he},{nest:[]})}return{nestHeadingsArray:D,selectHeadings:N}}),Mf}var zf,hv;function sS(){return hv||(hv=1,zf=function(o){var u=o.tocElement||document.querySelector(o.tocSelector);if(u&&u.scrollHeight>u.clientHeight){var g=u.querySelector("."+o.activeListItemClass);g&&(u.scrollTop=g.offsetTop-o.tocScrollOffset)}}),zf}var Af={},dv;function aS(){if(dv)return Af;dv=1,Af.initSmoothScrolling=i;function i(u){var g=u.duration,_=u.offset,b=location.hash?N(location.href):location.href;M();function M(){document.body.addEventListener("click",oe,!1);function oe(te){!l(te.target)||te.target.className.indexOf("no-smooth-scroll")>-1||te.target.href.charAt(te.target.href.length-2)==="#"&&te.target.href.charAt(te.target.href.length-1)==="!"||te.target.className.indexOf(u.linkClass)===-1||o(te.target.hash,{duration:g,offset:_,callback:function(){D(te.target.hash)}})}}function l(oe){return oe.tagName.toLowerCase()==="a"&&(oe.hash.length>0||oe.href.charAt(oe.href.length-1)==="#")&&(N(oe.href)===b||N(oe.href)+"#"===b)}function N(oe){return oe.slice(0,oe.lastIndexOf("#"))}function D(oe){var te=document.getElementById(oe.substring(1));te&&(/^(?:a|select|input|button|textarea)$/i.test(te.tagName)||(te.tabIndex=-1),te.focus())}}function o(u,g){var _=window.pageYOffset,b={duration:g.duration,offset:g.offset||0,callback:g.callback,easing:g.easing||Ie},M=document.querySelector('[id="'+decodeURI(u).split("#").join("")+'"]')||document.querySelector('[id="'+u.split("#").join("")+'"]'),l=typeof u=="string"?b.offset+(u?M&&M.getBoundingClientRect().top||0:-(document.documentElement.scrollTop||document.body.scrollTop)):u,N=typeof b.duration=="function"?b.duration(l):b.duration,D,oe;requestAnimationFrame(function(Ce){D=Ce,te(Ce)});function te(Ce){oe=Ce-D,window.scrollTo(0,b.easing(oe,_,l,N)),oe<N?requestAnimationFrame(te):he()}function he(){window.scrollTo(0,_+l),typeof b.callback=="function"&&b.callback()}function Ie(Ce,Pe,ft,J){return Ce/=J/2,Ce<1?ft/2*Ce*Ce+Pe:(Ce--,-ft/2*(Ce*(Ce-2)-1)+Pe)}}return Af}(function(i,o){(function(u,g){i.exports=g(u)})(typeof Gh<"u"?Gh:window||Gh,function(u){var g=nS(),_={},b={},M=rS(),l=oS(),N=sS(),D,oe,te=!!u&&!!u.document&&!!u.document.querySelector&&!!u.addEventListener;if(typeof window>"u"&&!te)return;var he,Ie=Object.prototype.hasOwnProperty;function Ce(){for(var K={},re=0;re<arguments.length;re++){var ve=arguments[re];for(var Ae in ve)Ie.call(ve,Ae)&&(K[Ae]=ve[Ae])}return K}function Pe(K,re,ve){re||(re=250);var Ae,Ue;return function(){var Ge=ve||this,Ve=+new Date,gt=arguments;Ae&&Ve<Ae+re?(clearTimeout(Ue),Ue=setTimeout(function(){Ae=Ve,K.apply(Ge,gt)},re)):(Ae=Ve,K.apply(Ge,gt))}}function ft(K){try{return K.contentElement||document.querySelector(K.contentSelector)}catch{return console.warn("Contents element not found: "+K.contentSelector),null}}function J(K){try{return K.tocElement||document.querySelector(K.tocSelector)}catch{return console.warn("TOC element not found: "+K.tocSelector),null}}return b.destroy=function(){var K=J(_);K!==null&&(_.skipRendering||K&&(K.innerHTML=""),_.scrollContainer&&document.querySelector(_.scrollContainer)?(document.querySelector(_.scrollContainer).removeEventListener("scroll",this._scrollListener,!1),document.querySelector(_.scrollContainer).removeEventListener("resize",this._scrollListener,!1),D&&document.querySelector(_.scrollContainer).removeEventListener("click",this._clickListener,!1)):(document.removeEventListener("scroll",this._scrollListener,!1),document.removeEventListener("resize",this._scrollListener,!1),D&&document.removeEventListener("click",this._clickListener,!1)))},b.init=function(K){if(te){_=Ce(g,K||{}),this.options=_,this.state={},_.scrollSmooth&&(_.duration=_.scrollSmoothDuration,_.offset=_.scrollSmoothOffset,b.scrollSmooth=aS().initSmoothScrolling(_)),D=M(_),oe=l(_),this._buildHtml=D,this._parseContent=oe,this._headingsArray=he,b.destroy();var re=ft(_);if(re!==null){var ve=J(_);if(ve!==null&&(he=oe.selectHeadings(re,_.headingSelector),he!==null)){var Ae=oe.nestHeadingsArray(he),Ue=Ae.nest;if(!_.skipRendering)D.render(ve,Ue);else return this;this._scrollListener=Pe(function(Ve){D.updateToc(he),!_.disableTocScrollSync&&N(_);var gt=Ve&&Ve.target&&Ve.target.scrollingElement&&Ve.target.scrollingElement.scrollTop===0;(Ve&&(Ve.eventPhase===0||Ve.currentTarget===null)||gt)&&(D.updateToc(he),_.scrollEndCallback&&_.scrollEndCallback(Ve))},_.throttleTimeout),this._scrollListener(),_.scrollContainer&&document.querySelector(_.scrollContainer)?(document.querySelector(_.scrollContainer).addEventListener("scroll",this._scrollListener,!1),document.querySelector(_.scrollContainer).addEventListener("resize",this._scrollListener,!1)):(document.addEventListener("scroll",this._scrollListener,!1),document.addEventListener("resize",this._scrollListener,!1));var Ge=null;return this._clickListener=Pe(function(Ve){_.scrollSmooth&&D.disableTocAnimation(Ve),D.updateToc(he),Ge&&clearTimeout(Ge),Ge=setTimeout(function(){D.enableTocAnimation()},_.scrollSmoothDuration)},_.throttleTimeout),_.scrollContainer&&document.querySelector(_.scrollContainer)?document.querySelector(_.scrollContainer).addEventListener("click",this._clickListener,!1):document.addEventListener("click",this._clickListener,!1),this}}}},b.refresh=function(K){b.destroy(),b.init(K||this.options)},u.tocbot=b,b})})(Rx);var lS=Rx.exports;const pv=Pd(lS),uS="modulepreload",cS=function(i){return"/OpenStoryMaps/"+i},fv={},hS=function(o,u,g){if(!u||u.length===0)return o();const _=document.getElementsByTagName("link");return Promise.all(u.map(b=>{if(b=cS(b),b in fv)return;fv[b]=!0;const M=b.endsWith(".css"),l=M?'[rel="stylesheet"]':"";if(!!g)for(let oe=_.length-1;oe>=0;oe--){const te=_[oe];if(te.href===b&&(!M||te.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${b}"]${l}`))return;const D=document.createElement("link");if(D.rel=M?"stylesheet":uS,M||(D.as="script",D.crossOrigin=""),D.href=b,document.head.appendChild(D),M)return new Promise((oe,te)=>{D.addEventListener("load",oe),D.addEventListener("error",()=>te(new Error(`Unable to preload CSS for ${b}`)))})})).then(()=>o())},dS=mt.createContext(null);function pS(i){const o=i.clone();return o.pixelsToGLUnits=i.pixelsToGLUnits,o}function mv(i){return{longitude:i.center.lng,latitude:i.center.lat,zoom:i.zoom,pitch:i.pitch,bearing:i.bearing,padding:i.padding}}function gv(i,o){const u=o.viewState||o;let g=!1;if("longitude"in u&&"latitude"in u){const _=i.center;i.center=new _.constructor(u.longitude,u.latitude),g=g||_!==i.center}if("zoom"in u){const _=i.zoom;i.zoom=u.zoom,g=g||_!==i.zoom}if("bearing"in u){const _=i.bearing;i.bearing=u.bearing,g=g||_!==i.bearing}if("pitch"in u){const _=i.pitch;i.pitch=u.pitch,g=g||_!==i.pitch}return u.padding&&!i.isPaddingEqual(u.padding)&&(g=!0,i.padding=u.padding),g}const fS=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function yv(i){if(!i)return null;if(typeof i=="string"||("toJS"in i&&(i=i.toJS()),!i.layers))return i;const o={};for(const g of i.layers)o[g.id]=g;const u=i.layers.map(g=>{const _=o[g.ref];let b=null;if("interactive"in g&&(b={...g},delete b.interactive),_){b=b||{...g},delete b.ref;for(const M of fS)M in _&&(b[M]=_[M])}return b||g});return{...i,layers:u}}function mS(i,o){const u=Array.isArray(i)?i[0]:i?i.x:0,g=Array.isArray(i)?i[1]:i?i.y:0,_=Array.isArray(o)?o[0]:o?o.x:0,b=Array.isArray(o)?o[1]:o?o.y:0;return u===_&&g===b}function ls(i,o){if(i===o)return!0;if(!i||!o)return!1;if(Array.isArray(i)){if(!Array.isArray(o)||i.length!==o.length)return!1;for(let u=0;u<i.length;u++)if(!ls(i[u],o[u]))return!1;return!0}else if(Array.isArray(o))return!1;if(typeof i=="object"&&typeof o=="object"){const u=Object.keys(i),g=Object.keys(o);if(u.length!==g.length)return!1;for(const _ of u)if(!o.hasOwnProperty(_)||!ls(i[_],o[_]))return!1;return!0}return!1}const _v={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Lf={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},vv={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},gS=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],yS=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ll{constructor(o,u,g){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=_=>{const b=this.props[vv[_.type]];b&&b(_)},this._onPointerEvent=_=>{(_.type==="mousemove"||_.type==="mouseout")&&this._updateHover(_);const b=this.props[_v[_.type]];b&&(this.props.interactiveLayerIds&&_.type!=="mouseover"&&_.type!=="mouseout"&&(_.features=this._hoveredFeatures||this._queryRenderedFeatures(_.point)),b(_),delete _.features)},this._onCameraEvent=_=>{if(!this._internalUpdate){const b=this.props[Lf[_.type]];b&&b(_)}_.type in this._deferredEvents&&(this._deferredEvents[_.type]=!1)},this._MapClass=o,this.props=u,this._initialize(g)}get map(){return this._map}get transform(){return this._renderTransform}setProps(o){const u=this.props;this.props=o;const g=this._updateSettings(o,u);g&&this._createShadowTransform(this._map);const _=this._updateSize(o),b=this._updateViewState(o,!0);this._updateStyle(o,u),this._updateStyleComponents(o,u),this._updateHandlers(o,u),(g||_||b&&!this._map.isMoving())&&this.redraw()}static reuse(o,u){const g=Ll.savedMaps.pop();if(!g)return null;const _=g.map,b=_.getContainer();for(u.className=b.className;b.childNodes.length>0;)u.appendChild(b.childNodes[0]);_._container=u;const M=_._resizeObserver;M&&(M.disconnect(),M.observe(u)),g.setProps({...o,styleDiffing:!1}),_.resize();const{initialViewState:l}=o;return l&&(l.bounds?_.fitBounds(l.bounds,{...l.fitBoundsOptions,duration:0}):g._updateViewState(l,!1)),_.isStyleLoaded()?_.fire("load"):_.once("styledata",()=>_.fire("load")),_._update(),g}_initialize(o){const{props:u}=this,g={...u,...u.initialViewState,accessToken:u.mapboxAccessToken||_S()||null,container:o,style:yv(u.mapStyle)},_=g.initialViewState||g.viewState||g;if(Object.assign(g,{center:[_.longitude||0,_.latitude||0],zoom:_.zoom||0,pitch:_.pitch||0,bearing:_.bearing||0}),u.gl){const D=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=D,u.gl)}const b=new this._MapClass(g);_.padding&&b.setPadding(_.padding),u.cursor&&(b.getCanvas().style.cursor=u.cursor),this._createShadowTransform(b);const M=b._render;b._render=D=>{this._inRender=!0,M.call(b,D),this._inRender=!1};const l=b._renderTaskQueue.run;b._renderTaskQueue.run=D=>{l.call(b._renderTaskQueue,D),this._onBeforeRepaint()},b.on("render",()=>this._onAfterRepaint());const N=b.fire;b.fire=this._fireEvent.bind(this,N),b.on("resize",()=>{this._renderTransform.resize(b.transform.width,b.transform.height)}),b.on("styledata",()=>this._updateStyleComponents(this.props,{})),b.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const D in _v)b.on(D,this._onPointerEvent);for(const D in Lf)b.on(D,this._onCameraEvent);for(const D in vv)b.on(D,this._onEvent);this._map=b}recycle(){const u=this.map.getContainer().querySelector("[mapboxgl-children]");u==null||u.remove(),Ll.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const o=this._map;!this._inRender&&o.style&&(o._frame&&(o._frame.cancel(),o._frame=null),o._render())}_createShadowTransform(o){const u=pS(o.transform);o.painter.transform=u,this._renderTransform=u}_updateSize(o){const{viewState:u}=o;if(u){const g=this._map;if(u.width!==g.transform.width||u.height!==g.transform.height)return g.resize(),!0}return!1}_updateViewState(o,u){if(this._internalUpdate)return!1;const g=this._map,_=this._renderTransform,{zoom:b,pitch:M,bearing:l}=_,N=g.isMoving();N&&(_.cameraElevationReference="sea");const D=gv(_,{...mv(g.transform),...o});if(N&&(_.cameraElevationReference="ground"),D&&u){const oe=this._deferredEvents;oe.move=!0,oe.zoom||(oe.zoom=b!==_.zoom),oe.rotate||(oe.rotate=l!==_.bearing),oe.pitch||(oe.pitch=M!==_.pitch)}return N||gv(g.transform,o),D}_updateSettings(o,u){const g=this._map;let _=!1;for(const b of gS)b in o&&!ls(o[b],u[b])&&(_=!0,g[`set${b[0].toUpperCase()}${b.slice(1)}`](o[b]));return _}_updateStyle(o,u){if(o.cursor!==u.cursor&&(this._map.getCanvas().style.cursor=o.cursor),o.mapStyle!==u.mapStyle){const g={diff:o.styleDiffing};return"localIdeographFontFamily"in o&&(g.localIdeographFontFamily=o.localIdeographFontFamily),this._map.setStyle(yv(o.mapStyle),g),!0}return!1}_updateStyleComponents(o,u){const g=this._map;let _=!1;return g.style.loaded()&&("light"in o&&!ls(o.light,u.light)&&(_=!0,g.setLight(o.light)),"fog"in o&&!ls(o.fog,u.fog)&&(_=!0,g.setFog(o.fog)),"terrain"in o&&!ls(o.terrain,u.terrain)&&(!o.terrain||g.getSource(o.terrain.source))&&(_=!0,g.setTerrain(o.terrain))),_}_updateHandlers(o,u){const g=this._map;let _=!1;for(const b of yS){const M=o[b];ls(M,u[b])||(_=!0,M?g[b].enable(M):g[b].disable())}return _}_queryRenderedFeatures(o){const u=this._map,{interactiveLayerIds:g=[]}=this.props;try{return u.queryRenderedFeatures(o,{layers:g.filter(u.getLayer.bind(u))})}catch{return[]}}_updateHover(o){var u;const{props:g}=this;if(g.interactiveLayerIds&&(g.onMouseMove||g.onMouseEnter||g.onMouseLeave)){const b=o.type,M=((u=this._hoveredFeatures)===null||u===void 0?void 0:u.length)>0,l=this._queryRenderedFeatures(o.point),N=l.length>0;!N&&M&&(o.type="mouseleave",this._onPointerEvent(o)),this._hoveredFeatures=l,N&&!M&&(o.type="mouseenter",this._onPointerEvent(o)),o.type=b}else this._hoveredFeatures=null}_fireEvent(o,u,g){const _=this._map,b=_.transform,M=typeof u=="string"?u:u.type;return M==="move"&&this._updateViewState(this.props,!1),M in Lf&&(typeof u=="object"&&(u.viewState=mv(b)),this._map.isMoving())?(_.transform=this._renderTransform,o.call(_,u,g),_.transform=b,_):(o.call(_,u,g),_)}_onBeforeRepaint(){const o=this._map;this._internalUpdate=!0;for(const g in this._deferredEvents)this._deferredEvents[g]&&o.fire(g);this._internalUpdate=!1;const u=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=u}}}Ll.savedMaps=[];function _S(){let i=null;if(typeof location<"u"){const o=/access_token=([^&\/]*)/.exec(location.search);i=o&&o[1]}try{i=i||{}.MapboxAccessToken}catch{}try{i=i||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return i}const vS=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function xS(i,o){if(!i)return null;const u=i.map,g={getMap:()=>u,getCenter:()=>i.transform.center,getZoom:()=>i.transform.zoom,getBearing:()=>i.transform.bearing,getPitch:()=>i.transform.pitch,getPadding:()=>i.transform.padding,getBounds:()=>i.transform.getBounds(),project:_=>i.transform.locationPoint(o.LngLat.convert(_)),unproject:_=>i.transform.pointLocation(o.Point.convert(_)),queryTerrainElevation:(_,b)=>{const M=u.transform;u.transform=i.transform;const l=u.queryTerrainElevation(_,b);return u.transform=M,l}};for(const _ of wS(u))!(_ in g)&&!vS.includes(_)&&(g[_]=u[_].bind(u));return g}function wS(i){const o=new Set;let u=i;for(;u;){for(const g of Object.getOwnPropertyNames(u))g[0]!=="_"&&typeof i[g]=="function"&&g!=="fire"&&g!=="setEventedParent"&&o.add(g);u=Object.getPrototypeOf(u)}return Array.from(o)}const bS=typeof document<"u"?mt.useLayoutEffect:mt.useEffect,SS=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function ES(i,o){for(const u of SS)u in o&&(i[u]=o[u]);o.RTLTextPlugin&&i.getRTLTextPluginStatus&&i.getRTLTextPluginStatus()==="unavailable"&&i.setRTLTextPlugin(o.RTLTextPlugin,u=>{u&&console.error(u)},!1)}const Gd=mt.createContext(null),TS={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:i=>console.error(i.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},bg=mt.forwardRef((i,o)=>{const u=mt.useContext(dS),[g,_]=mt.useState(null),b=mt.useRef(),{current:M}=mt.useRef({mapLib:null,map:null});mt.useEffect(()=>{const D=i.mapLib;let oe=!0,te;return Promise.resolve(D||hS(()=>import("./index-fc2e9253.js").then(he=>he.i),[])).then(he=>{if(oe){if(he.Map||(he=he.default),!he||!he.Map)throw new Error("Invalid mapLib");if(ES(he,i),!he.supported||he.supported(i))i.reuseMaps&&(te=Ll.reuse(i,b.current)),te||(te=new Ll(he.Map,i,b.current)),M.map=xS(te,he),M.mapLib=he,_(te),u==null||u.onMapMount(M.map,i.id);else throw new Error("Map is not supported by this browser")}}).catch(he=>{i.onError({type:"error",target:null,originalEvent:null,error:he})}),()=>{oe=!1,te&&(u==null||u.onMapUnmount(i.id),i.reuseMaps?te.recycle():te.destroy())}},[]),bS(()=>{g&&g.setProps(i)}),mt.useImperativeHandle(o,()=>M.map,[g]);const l=mt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...i.style}),[i.style]),N={height:"100%"};return mt.createElement("div",{id:i.id,ref:b,style:l},g&&mt.createElement(Gd.Provider,{value:M},mt.createElement("div",{"mapboxgl-children":"",style:N},i.children)))});bg.displayName="Map";bg.defaultProps=TS;const CS=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function la(i,o){if(!i||!o)return;const u=i.style;for(const g in o){const _=o[g];Number.isFinite(_)&&!CS.test(g)?u[g]=`${_}px`:u[g]=_}}const kS={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function Bx(i){const{map:o,mapLib:u}=mt.useContext(Gd),g=mt.useRef({props:i});g.current.props=i;const _=mt.useMemo(()=>{let b=!1;mt.Children.forEach(i.children,N=>{N&&(b=!0)});const M={...i,element:b?document.createElement("div"):null},l=new u.Marker(M).setLngLat([i.longitude,i.latitude]);return l.getElement().addEventListener("click",N=>{var D,oe;(oe=(D=g.current.props).onClick)===null||oe===void 0||oe.call(D,{type:"click",target:l,originalEvent:N})}),l.on("dragstart",N=>{var D,oe;const te=N;te.lngLat=_.getLngLat(),(oe=(D=g.current.props).onDragStart)===null||oe===void 0||oe.call(D,te)}),l.on("drag",N=>{var D,oe;const te=N;te.lngLat=_.getLngLat(),(oe=(D=g.current.props).onDrag)===null||oe===void 0||oe.call(D,te)}),l.on("dragend",N=>{var D,oe;const te=N;te.lngLat=_.getLngLat(),(oe=(D=g.current.props).onDragEnd)===null||oe===void 0||oe.call(D,te)}),l},[]);return mt.useEffect(()=>(_.addTo(o.getMap()),()=>{_.remove()}),[]),mt.useEffect(()=>{la(_.getElement(),i.style)},[i.style]),(_.getLngLat().lng!==i.longitude||_.getLngLat().lat!==i.latitude)&&_.setLngLat([i.longitude,i.latitude]),i.offset&&!mS(_.getOffset(),i.offset)&&_.setOffset(i.offset),_.isDraggable()!==i.draggable&&_.setDraggable(i.draggable),_.getRotation()!==i.rotation&&_.setRotation(i.rotation),_.getRotationAlignment()!==i.rotationAlignment&&_.setRotationAlignment(i.rotationAlignment),_.getPitchAlignment()!==i.pitchAlignment&&_.setPitchAlignment(i.pitchAlignment),_.getPopup()!==i.popup&&_.setPopup(i.popup),wg.createPortal(i.children,_.getElement())}Bx.defaultProps=kS;mt.memo(Bx);function xv(i){return new Set(i?i.trim().split(/\s+/):[])}function IS(i){const{map:o,mapLib:u}=mt.useContext(Gd),g=mt.useMemo(()=>document.createElement("div"),[]),_=mt.useRef({props:i});_.current.props=i;const b=mt.useMemo(()=>{const M={...i},l=new u.Popup(M).setLngLat([i.longitude,i.latitude]);return l.once("open",N=>{var D,oe;(oe=(D=_.current.props).onOpen)===null||oe===void 0||oe.call(D,N)}),l},[]);if(mt.useEffect(()=>{const M=l=>{var N,D;(D=(N=_.current.props).onClose)===null||D===void 0||D.call(N,l)};return b.on("close",M),b.setDOMContent(g).addTo(o.getMap()),()=>{b.off("close",M),b.isOpen()&&b.remove()}},[]),mt.useEffect(()=>{la(b.getElement(),i.style)},[i.style]),b.isOpen()&&((b.getLngLat().lng!==i.longitude||b.getLngLat().lat!==i.latitude)&&b.setLngLat([i.longitude,i.latitude]),i.offset&&!ls(b.options.offset,i.offset)&&b.setOffset(i.offset),(b.options.anchor!==i.anchor||b.options.maxWidth!==i.maxWidth)&&(b.options.anchor=i.anchor,b.setMaxWidth(i.maxWidth)),b.options.className!==i.className)){const M=xv(b.options.className),l=xv(i.className);for(const N of M)l.has(N)||b.removeClassName(N);for(const N of l)M.has(N)||b.addClassName(N);b.options.className=i.className}return wg.createPortal(i.children,g)}mt.memo(IS);function kc(i,o,u,g){const _=mt.useContext(Gd),b=mt.useMemo(()=>i(_),[]);return mt.useEffect(()=>{const M=g||u||o,l=typeof o=="function"&&typeof u=="function"?o:null,N=typeof u=="function"?u:typeof o=="function"?o:null,{map:D}=_;return D.hasControl(b)||(D.addControl(b,M==null?void 0:M.position),l&&l(_)),()=>{N&&N(_),D.hasControl(b)&&D.removeControl(b)}},[]),b}function PS(i){const o=kc(({mapLib:u})=>new u.AttributionControl(i),{position:i.position});return mt.useEffect(()=>{la(o._container,i.style)},[i.style]),null}mt.memo(PS);function MS(i){const o=kc(({mapLib:u})=>new u.FullscreenControl({container:i.containerId&&document.getElementById(i.containerId)}),{position:i.position});return mt.useEffect(()=>{la(o._controlContainer,i.style)},[i.style]),null}mt.memo(MS);const Fx=mt.forwardRef((i,o)=>{const u=mt.useRef({props:i}),g=kc(({mapLib:_})=>{const b=new _.GeolocateControl(i),M=b._setupUI;return b._setupUI=l=>{b._container.hasChildNodes()||M(l)},b.on("geolocate",l=>{var N,D;(D=(N=u.current.props).onGeolocate)===null||D===void 0||D.call(N,l)}),b.on("error",l=>{var N,D;(D=(N=u.current.props).onError)===null||D===void 0||D.call(N,l)}),b.on("outofmaxbounds",l=>{var N,D;(D=(N=u.current.props).onOutOfMaxBounds)===null||D===void 0||D.call(N,l)}),b.on("trackuserlocationstart",l=>{var N,D;(D=(N=u.current.props).onTrackUserLocationStart)===null||D===void 0||D.call(N,l)}),b.on("trackuserlocationend",l=>{var N,D;(D=(N=u.current.props).onTrackUserLocationEnd)===null||D===void 0||D.call(N,l)}),b},{position:i.position});return u.current.props=i,mt.useImperativeHandle(o,()=>({trigger:()=>g.trigger()}),[]),mt.useEffect(()=>{la(g._container,i.style)},[i.style]),null});Fx.displayName="GeolocateControl";mt.memo(Fx);function zS(i){const o=kc(({mapLib:u})=>new u.NavigationControl(i),{position:i.position});return mt.useEffect(()=>{la(o._container,i.style)},[i.style]),null}const AS=mt.memo(zS),LS={unit:"metric",maxWidth:100};function Ox(i){const o=kc(({mapLib:u})=>new u.ScaleControl(i),{position:i.position});return(o.options.unit!==i.unit||o.options.maxWidth!==i.maxWidth)&&(o.options.maxWidth=i.maxWidth,o.setUnit(i.unit)),mt.useEffect(()=>{la(o._container,i.style)},[i.style]),null}Ox.defaultProps=LS;mt.memo(Ox);var Nx={exports:{}};(function(i,o){(function(u,g){i.exports=g()})(Gh,function(){var u,g,_;function b(l,N){if(!u)u=N;else if(!g)g=N;else{var D="var sharedChunk = {}; ("+u+")(sharedChunk); ("+g+")(sharedChunk);",oe={};u(oe),_=N(oe),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}b(["exports"],function(l){function N(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var D=oe;function oe(n,e){this.x=n,this.y=e}oe.prototype={clone:function(){return new oe(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,e){return this.clone()._rotateAround(n,e)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var e=n.x-this.x,r=n.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,e){return Math.atan2(this.x*e-this.y*n,this.x*n+this.y*e)},_matMult:function(n){var e=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=e,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var e=Math.cos(n),r=Math.sin(n),a=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=a,this},_rotateAround:function(n,e){var r=Math.cos(n),a=Math.sin(n),h=e.y+a*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},oe.convert=function(n){return n instanceof oe?n:Array.isArray(n)?new oe(n[0],n[1]):n};var te=N(D),he=Ie;function Ie(n,e,r,a){this.cx=3*n,this.bx=3*(r-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=e,this.p2x=r,this.p2y=a}Ie.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,e){if(e===void 0&&(e=1e-6),n<0)return 0;if(n>1)return 1;for(var r=n,a=0;a<8;a++){var h=this.sampleCurveX(r)-n;if(Math.abs(h)<e)return r;var m=this.sampleCurveDerivativeX(r);if(Math.abs(m)<1e-6)break;r-=h/m}var y=0,v=1;for(r=n,a=0;a<20&&(h=this.sampleCurveX(r),!(Math.abs(h-n)<e));a++)n>h?y=r:v=r,r=.5*(v-y)+y;return r},solve:function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))}};var Ce=N(he);function Pe(n,e,r,a){const h=new Ce(n,e,r,a);return function(m){return h.solve(m)}}const ft=Pe(.25,.1,.25,1);function J(n,e,r){return Math.min(r,Math.max(e,n))}function K(n,e,r){const a=r-e,h=((n-e)%a+a)%a+e;return h===e?r:h}function re(n,...e){for(const r of e)for(const a in r)n[a]=r[a];return n}let ve=1;function Ae(n,e,r){const a={};for(const h in n)a[h]=e.call(r||this,n[h],h,n);return a}function Ue(n,e,r){const a={};for(const h in n)e.call(r||this,n[h],h,n)&&(a[h]=n[h]);return a}function Ge(n){return Array.isArray(n)?n.map(Ge):typeof n=="object"&&n?Ae(n,Ge):n}const Ve={};function gt(n){Ve[n]||(typeof console<"u"&&console.warn(n),Ve[n]=!0)}function Je(n,e,r){return(r.y-n.y)*(e.x-n.x)>(e.y-n.y)*(r.x-n.x)}function qt(n){let e=0;for(let r,a,h=0,m=n.length,y=m-1;h<m;y=h++)r=n[h],a=n[y],e+=(a.x-r.x)*(r.y+a.y);return e}function ni(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Fi=null;function Cr(n){if(Fi==null){const e=n.navigator?n.navigator.userAgent:null;Fi=!!n.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Fi}function sr(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap}const on="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ar,We;const dt={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){return this.getImageCanvasContext(n).getImageData(-e,-e,n.width+2*e,n.height+2*e)},getImageCanvasContext(n){const e=window.document.createElement("canvas"),r=e.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return e.width=n.width,e.height=n.height,r.drawImage(n,0,0,n.width,n.height),r},resolveURL:n=>(ar||(ar=document.createElement("a")),ar.href=n,ar.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(We==null&&(We=matchMedia("(prefers-reduced-motion: reduce)")),We.matches)}},xt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class Ut extends Error{constructor(e,r,a,h){super(`AJAXError: ${r} (${e}): ${a}`),this.status=e,this.statusText=r,this.url=a,this.body=h}}const Vt=ni()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Oi=n=>xt.REGISTERED_PROTOCOLS[n.substring(0,n.indexOf("://"))];function Bt(n,e){const r=new AbortController,a=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Vt(),signal:r.signal});let h=!1,m=!1;return n.type==="json"&&a.headers.set("Accept","application/json"),m||fetch(a).then(y=>y.ok?(v=>{(n.type==="arrayBuffer"||n.type==="image"?v.arrayBuffer():n.type==="json"?v.json():v.text()).then(S=>{m||(h=!0,e(null,S,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(S=>{m||e(new Error(S.message))})})(y):y.blob().then(v=>e(new Ut(y.status,y.statusText,n.url,v)))).catch(y=>{y.code!==20&&e(new Error(y.message))}),{cancel:()=>{m=!0,h||r.abort()}}}const Hn=function(n,e){if(/:\/\//.test(n.url)&&!/^https?:|^file:/.test(n.url)){if(ni()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e);if(!ni())return(Oi(n.url)||Bt)(n,e)}if(!(/^file:/.test(r=n.url)||/^file:/.test(Vt())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return Bt(n,e);if(ni()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var r;return function(a,h){const m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type!=="arrayBuffer"&&a.type!=="image"||(m.responseType="arraybuffer");for(const y in a.headers)m.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(a.type==="json")try{y=JSON.parse(m.response)}catch(v){return h(v)}h(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const y=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});h(new Ut(m.status,m.statusText,a.url,y))}},m.send(a.body),{cancel:()=>m.abort()}}(n,e)},yn=function(n,e){return Hn(re(n,{type:"arrayBuffer"}),e)};function An(n){if(!n||n.indexOf("://")<=0||n.indexOf("data:image/")===0||n.indexOf("blob:")===0)return!0;const e=new URL(n),r=window.location;return e.protocol===r.protocol&&e.host===r.host}function zo(n,e,r){r[n]&&r[n].indexOf(e)!==-1||(r[n]=r[n]||[],r[n].push(e))}function kr(n,e,r){if(r&&r[n]){const a=r[n].indexOf(e);a!==-1&&r[n].splice(a,1)}}class Ln{constructor(e,r={}){re(this,r),this.type=e}}class lr extends Ln{constructor(e,r={}){super("error",re({error:e},r))}}class Zr{on(e,r){return this._listeners=this._listeners||{},zo(e,r,this._listeners),this}off(e,r){return kr(e,r,this._listeners),kr(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},zo(e,r,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,r){typeof e=="string"&&(e=new Ln(e,r||{}));const a=e.type;if(this.listens(a)){e.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const v of h)v.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const v of m)kr(a,v,this._oneTimeListeners),v.call(this,e);const y=this._eventedParent;y&&(re(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof lr&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ir=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ao(n,e){const r={};for(const a in n)a!=="ref"&&(r[a]=n[a]);return Ir.forEach(a=>{a in e&&(r[a]=e[a])}),r}function jt(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!jt(n[r],e[r]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const r in n)if(!jt(n[r],e[r]))return!1;return!0}return n===e}const Dt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ao(n,e,r){r.push({command:Dt.addSource,args:[n,e[n]]})}function lo(n,e,r){e.push({command:Dt.removeSource,args:[n]}),r[n]=!0}function ua(n,e,r,a){lo(n,r,a),ao(n,e,r)}function ca(n,e,r){let a;for(a in n[r])if(Object.prototype.hasOwnProperty.call(n[r],a)&&a!=="data"&&!jt(n[r][a],e[r][a]))return!1;for(a in e[r])if(Object.prototype.hasOwnProperty.call(e[r],a)&&a!=="data"&&!jt(n[r][a],e[r][a]))return!1;return!0}function ri(n,e,r,a,h,m){let y;for(y in e=e||{},n=n||{})Object.prototype.hasOwnProperty.call(n,y)&&(jt(n[y],e[y])||r.push({command:m,args:[a,y,e[y],h]}));for(y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(n,y)&&(jt(n[y],e[y])||r.push({command:m,args:[a,y,e[y],h]}))}function Es(n){return n.id}function Lo(n,e){return n[e.id]=e,n}class Be{constructor(e,r,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),r!=null&&r.__line__&&(this.line=r.__line__)}}function Yi(n,...e){for(const r of e)for(const a in r)n[a]=r[a];return n}class sn extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Pr{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,h]of r)this.bindings[a]=h}concat(e){return new Pr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Gr={kind:"null"},De={kind:"number"},yt={kind:"string"},_t={kind:"boolean"},qi={kind:"color"},Mr={kind:"object"},lt={kind:"value"},ur={kind:"collator"},cr={kind:"formatted"},Hr={kind:"padding"},Dn={kind:"resolvedImage"};function Ni(n,e){return{kind:"array",itemType:n,N:e}}function Zt(n){if(n.kind==="array"){const e=Zt(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const ha=[Gr,De,yt,_t,qi,cr,Mr,Ni(lt),Hr,Dn];function zr(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!zr(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const r of ha)if(!zr(r,e))return null}}return`Expected ${Zt(n)} but found ${Zt(e)} instead.`}function Wr(n,e){return e.some(r=>r.kind===n.kind)}function G(n,e){return e.some(r=>r==="null"?n===null:r==="array"?Array.isArray(n):r==="object"?n&&!Array.isArray(n)&&typeof n=="object":r===typeof n)}function A(n,e){return n.kind==="array"&&e.kind==="array"?n.itemType.kind===e.itemType.kind&&typeof n.N=="number":n.kind===e.kind}const R=.96422,U=.82521,X=4/29,Q=6/29,ae=3*Q*Q,ne=Q*Q*Q,ee=Math.PI/180,ue=180/Math.PI;function be(n){return(n%=360)<0&&(n+=360),n}function Te([n,e,r,a]){let h,m;const y=nt((.2225045*(n=Ee(n))+.7168786*(e=Ee(e))+.0606169*(r=Ee(r)))/1);n===e&&e===r?h=m=y:(h=nt((.4360747*n+.3850649*e+.1430804*r)/R),m=nt((.0139322*n+.0971045*e+.7141733*r)/U));const v=116*y-16;return[v<0?0:v,500*(h-y),200*(y-m),a]}function Ee(n){return n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function nt(n){return n>ne?Math.pow(n,1/3):n/ae+X}function pt([n,e,r,a]){let h=(n+16)/116,m=isNaN(e)?h:h+e/500,y=isNaN(r)?h:h-r/200;return h=1*it(h),m=R*it(m),y=U*it(y),[Ye(3.1338561*m-1.6168667*h-.4906146*y),Ye(-.9787684*m+1.9161415*h+.033454*y),Ye(.0719453*m-.2289914*h+1.4052427*y),a]}function Ye(n){return(n=n<=.00304?12.92*n:1.055*Math.pow(n,1/2.4)-.055)<0?0:n>1?1:n}function it(n){return n>Q?n*n*n:ae*(n-X)}function ct(n){return parseInt(n.padEnd(2,n),16)/255}function It(n,e){return vt(e?n/100:n,0,1)}function vt(n,e,r){return Math.min(Math.max(e,n),r)}function Nt(n){return!n.some(Number.isNaN)}const Gt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ht{constructor(e,r,a,h=1,m=!0){this.r=e,this.g=r,this.b=a,this.a=h,m||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,r,a,h]))}static parse(e){if(e instanceof ht)return e;if(typeof e!="string")return;const r=function(a){if((a=a.toLowerCase())==="transparent")return[0,0,0,0];const h=Gt[a];if(h){const[y,v,S]=h;return[y/255,v/255,S/255,1]}if(a.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(a)){const y=a.length<6?1:2;let v=1;return[ct(a.slice(v,v+=y)),ct(a.slice(v,v+=y)),ct(a.slice(v,v+=y)),ct(a.slice(v,v+y)||"ff")]}if(a.startsWith("rgb")){const y=a.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,S,C,I,z,L,F,O,q,W,Y,le]=y,ie=[I||" ",F||" ",W].join("");if(ie==="  "||ie==="  /"||ie===",,"||ie===",,,"){const de=[C,L,q].join(""),fe=de==="%%%"?100:de===""?255:0;if(fe){const we=[vt(+S/fe,0,1),vt(+z/fe,0,1),vt(+O/fe,0,1),Y?It(+Y,le):1];if(Nt(we))return we}}return}}const m=a.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,v,S,C,I,z,L,F,O]=m,q=[S||" ",I||" ",L].join("");if(q==="  "||q==="  /"||q===",,"||q===",,,"){const W=[+v,vt(+C,0,100),vt(+z,0,100),F?It(+F,O):1];if(Nt(W))return function([Y,le,ie,de]){function fe(we){const qe=(we+Y/30)%12,Xe=le*Math.min(ie,1-ie);return ie-Xe*Math.max(-1,Math.min(qe-3,9-qe,1))}return Y=be(Y),le/=100,ie/=100,[fe(0),fe(8),fe(4),de]}(W)}}}(e);return r?new ht(...r,!1):void 0}get rgb(){const{r:e,g:r,b:a,a:h}=this,m=h||1/0;return this.overwriteGetter("rgb",[e/m,r/m,a/m,h])}get hcl(){return this.overwriteGetter("hcl",function(e){const[r,a,h,m]=Te(e),y=Math.sqrt(a*a+h*h);return[Math.round(1e4*y)?be(Math.atan2(h,a)*ue):NaN,y,r,m]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Te(this.rgb))}overwriteGetter(e,r){return Object.defineProperty(this,e,{value:r}),r}toString(){const[e,r,a,h]=this.rgb;return`rgba(${[e,r,a].map(m=>Math.round(255*m)).join(",")},${h})`}}ht.black=new ht(0,0,0,1),ht.white=new ht(1,1,1,1),ht.transparent=new ht(0,0,0,0),ht.red=new ht(1,0,0,1);class Jt{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class oi{constructor(e,r,a,h,m){this.text=e,this.image=r,this.scale=a,this.fontStack=h,this.textColor=m}}class Mi{constructor(e){this.sections=e}static fromString(e){return new Mi([new oi(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Mi?e:Mi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Ui{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ui)return e;if(typeof e=="number")return new Ui([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const r of e)if(typeof r!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Ui(e)}}toString(){return JSON.stringify(this.values)}}class Rn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Rn({name:e,available:!1}):null}}function Ic(n,e,r,a){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[n,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[n,e,r,a]:[n,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xr(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof ht||n instanceof Jt||n instanceof Mi||n instanceof Ui||n instanceof Rn)return!0;if(Array.isArray(n)){for(const e of n)if(!Xr(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Xr(n[e]))return!1;return!0}return!1}function vi(n){if(n===null)return Gr;if(typeof n=="string")return yt;if(typeof n=="boolean")return _t;if(typeof n=="number")return De;if(n instanceof ht)return qi;if(n instanceof Jt)return ur;if(n instanceof Mi)return cr;if(n instanceof Ui)return Hr;if(n instanceof Rn)return Dn;if(Array.isArray(n)){const e=n.length;let r;for(const a of n){const h=vi(a);if(r){if(r===h)continue;r=lt;break}r=h}return Ni(r||lt,e)}return Mr}function Ts(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof ht||n instanceof Mi||n instanceof Ui||n instanceof Rn?n.toString():JSON.stringify(n)}class uo{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Xr(e[1]))return r.error("invalid value");const a=e[1];let h=vi(a);const m=r.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new uo(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ei{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const co={string:yt,number:De,boolean:_t,object:Mr};class Wn{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,h=1;const m=e[0];if(m==="array"){let v,S;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in co)||C==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=co[C],h++}else v=lt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);S=e[2],h++}a=Ni(v,S)}else{if(!co[m])throw new Error(`Types doesn't contain name = ${m}`);a=co[m]}const y=[];for(;h<e.length;h++){const v=r.parse(e[h],h,lt);if(!v)return null;y.push(v)}return new Wn(a,y)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!zr(this.type,vi(a)))return a;if(r===this.args.length-1)throw new Ei(`Expected value to be of type ${Zt(this.type)}, but found ${Zt(vi(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Pc={"to-boolean":_t,"to-color":qi,"to-number":De,"to-string":yt};class Kr{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0];if(!Pc[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");const h=Pc[a],m=[];for(let y=1;y<e.length;y++){const v=r.parse(e[y],y,lt);if(!v)return null;m.push(v)}return new Kr(h,m)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const h of this.args){if(r=h.evaluate(e),a=null,r instanceof ht)return r;if(typeof r=="string"){const m=e.parseColor(r);if(m)return m}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Ic(r[0],r[1],r[2],r[3]),!a))return new ht(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Ei(a||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="padding"){let r;for(const a of this.args){r=a.evaluate(e);const h=Ui.parse(r);if(h)return h}throw new Ei(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const h=Number(r);if(!isNaN(h))return h}throw new Ei(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Mi.fromString(Ts(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Rn.fromString(Ts(this.args[0].evaluate(e))):Ts(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Do=["Unknown","Point","LineString","Polygon"];class da{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Do[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=ht.parse(e)),r}}class Ro{constructor(e,r,a=[],h,m=new Pr,y=[]){this.registry=e,this.path=a,this.key=a.map(v=>`[${v}]`).join(""),this.scope=m,this.errors=y,this.expectedType=h,this._isConstant=r}parse(e,r,a,h,m={}){return r?this.concat(r,a,h)._parse(e,m):this._parse(e,m)}_parse(e,r){function a(h,m,y){return y==="assert"?new Wn(m,[h]):y==="coerce"?new Kr(m,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const v=this.expectedType,S=y.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||S.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string")if(v.kind!=="padding"||S.kind!=="value"&&S.kind!=="number"&&S.kind!=="array"){if(this.checkSubtype(v,S))return null}else y=a(y,v,r.typeAnnotation||"coerce");else y=a(y,v,r.typeAnnotation||"coerce");else y=a(y,v,r.typeAnnotation||"assert")}if(!(y instanceof uo)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const v=new da;try{y=new uo(y.type,y.evaluate(v))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a){const h=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new Ro(this.registry,this._isConstant,h,r||null,m,this.errors)}error(e,...r){const a=`${this.key}${r.map(h=>`[${h}]`).join("")}`;this.errors.push(new sn(a,e))}checkSubtype(e,r){const a=zr(e,r);return a&&this.error(a),a}}class Yr{constructor(e,r,a){this.type=ur,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const h=r.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,_t);if(!h)return null;const m=r.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,_t);if(!m)return null;let y=null;return a.locale&&(y=r.parse(a.locale,1,yt),!y)?null:new Yr(h,m,y)}evaluate(e){return new Jt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const Ct=8192;function Fl(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Bo(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Hd(n,e){const r=(180+n[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(r*h*Ct),Math.round(a*h*Ct)]}function Mc(n,e,r){const a=n[0]-e[0],h=n[1]-e[1],m=n[0]-r[0],y=n[1]-r[1];return a*y-m*h==0&&a*m<=0&&h*y<=0}function pa(n,e){let r=!1;for(let y=0,v=e.length;y<v;y++){const S=e[y];for(let C=0,I=S.length;C<I-1;C++){if(Mc(n,S[C],S[C+1]))return!1;(h=S[C])[1]>(a=n)[1]!=(m=S[C+1])[1]>a[1]&&a[0]<(m[0]-h[0])*(a[1]-h[1])/(m[1]-h[1])+h[0]&&(r=!r)}}var a,h,m;return r}function Wd(n,e){for(let r=0;r<e.length;r++)if(pa(n,e[r]))return!0;return!1}function Ol(n,e,r,a){const h=a[0]-r[0],m=a[1]-r[1],y=(n[0]-r[0])*m-h*(n[1]-r[1]),v=(e[0]-r[0])*m-h*(e[1]-r[1]);return y>0&&v<0||y<0&&v>0}function zc(n,e,r){for(const C of r)for(let I=0;I<C.length-1;++I)if((v=[(y=C[I+1])[0]-(m=C[I])[0],y[1]-m[1]])[0]*(S=[(h=e)[0]-(a=n)[0],h[1]-a[1]])[1]-v[1]*S[0]!=0&&Ol(a,h,m,y)&&Ol(m,y,a,h))return!0;var a,h,m,y,v,S;return!1}function Ac(n,e){for(let r=0;r<n.length;++r)if(!pa(n[r],e))return!1;for(let r=0;r<n.length-1;++r)if(zc(n[r],n[r+1],e))return!1;return!0}function Xd(n,e){for(let r=0;r<e.length;r++)if(Ac(n,e[r]))return!0;return!1}function Nl(n,e,r){const a=[];for(let h=0;h<n.length;h++){const m=[];for(let y=0;y<n[h].length;y++){const v=Hd(n[h][y],r);Fl(e,v),m.push(v)}a.push(m)}return a}function Lc(n,e,r){const a=[];for(let h=0;h<n.length;h++){const m=Nl(n[h],e,r);a.push(m)}return a}function Ul(n,e,r,a){if(n[0]<r[0]||n[0]>r[2]){const h=.5*a;let m=n[0]-r[0]>h?-a:r[0]-n[0]>h?a:0;m===0&&(m=n[0]-r[2]>h?-a:r[2]-n[0]>h?a:0),n[0]+=m}Fl(e,n)}function Vl(n,e,r,a){const h=Math.pow(2,a.z)*Ct,m=[a.x*Ct,a.y*Ct],y=[];for(const v of n)for(const S of v){const C=[S.x+m[0],S.y+m[1]];Ul(C,e,r,h),y.push(C)}return y}function Dc(n,e,r,a){const h=Math.pow(2,a.z)*Ct,m=[a.x*Ct,a.y*Ct],y=[];for(const S of n){const C=[];for(const I of S){const z=[I.x+m[0],I.y+m[1]];Fl(e,z),C.push(z)}y.push(C)}if(e[2]-e[0]<=h/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const S of y)for(const C of S)Ul(C,e,r,h)}var v;return y}class ho{constructor(e,r){this.type=_t,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Xr(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){const m=a.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new ho(a,a.features[h].geometry)}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ho(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new ho(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const v=Nl(a.coordinates,m,y),S=Vl(r.geometry(),h,m,y);if(!Bo(h,m))return!1;for(const C of S)if(!pa(C,v))return!1}if(a.type==="MultiPolygon"){const v=Lc(a.coordinates,m,y),S=Vl(r.geometry(),h,m,y);if(!Bo(h,m))return!1;for(const C of S)if(!Wd(C,v))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=r.canonicalID();if(a.type==="Polygon"){const v=Nl(a.coordinates,m,y),S=Dc(r.geometry(),h,m,y);if(!Bo(h,m))return!1;for(const C of S)if(!Ac(C,v))return!1}if(a.type==="MultiPolygon"){const v=Lc(a.coordinates,m,y),S=Dc(r.geometry(),h,m,y);if(!Bo(h,m))return!1;for(const C of S)if(!Xd(C,v))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Fo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Fo(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Bn{constructor(e,r,a,h){this.name=e,this.type=r,this._evaluate=a,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,r){const a=e[0],h=Bn.definitions[a];if(!h)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=y.filter(([C])=>!Array.isArray(C)||C.length===e.length-1);let S=null;for(const[C,I]of v){S=new Ro(r.registry,fa,r.path,null,r.scope);const z=[];let L=!1;for(let F=1;F<e.length;F++){const O=e[F],q=Array.isArray(C)?C[F-1]:C.type,W=S.parse(O,1+z.length,q);if(!W){L=!0;break}z.push(W)}if(!L)if(Array.isArray(C)&&C.length!==z.length)S.error(`Expected ${C.length} arguments, but found ${z.length} instead.`);else{for(let F=0;F<z.length;F++){const O=Array.isArray(C)?C[F]:C.type,q=z[F];S.concat(F+1).checkSubtype(O,q.type)}if(S.errors.length===0)return new Bn(a,m,I,z)}}if(v.length===1)r.errors.push(...S.errors);else{const C=(v.length?v:y).map(([z])=>{return L=z,Array.isArray(L)?`(${L.map(Zt).join(", ")})`:`(${Zt(L.type)}...)`;var L}).join(" | "),I=[];for(let z=1;z<e.length;z++){const L=r.parse(e[z],1+I.length);if(!L)return null;I.push(Zt(L.type))}r.error(`Expected arguments of type ${C}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){Bn.definitions=r;for(const a in r)e[a]=Bn}}function fa(n){if(n instanceof Fo)return fa(n.boundExpression);if(n instanceof Bn&&n.name==="error"||n instanceof Yr||n instanceof ho)return!1;const e=n instanceof Kr||n instanceof Wn;let r=!0;return n.eachChild(a=>{r=e?r&&fa(a):r&&a instanceof uo}),!!r&&ma(n)&&Cs(n,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ma(n){if(n instanceof Bn&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof ho)return!1;let e=!0;return n.eachChild(r=>{e&&!ma(r)&&(e=!1)}),e}function Oo(n){if(n instanceof Bn&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(r=>{e&&!Oo(r)&&(e=!1)}),e}function Cs(n,e){if(n instanceof Bn&&e.indexOf(n.name)>=0)return!1;let r=!0;return n.eachChild(a=>{r&&!Cs(a,e)&&(r=!1)}),r}function ga(n,e){const r=n.length-1;let a,h,m=0,y=r,v=0;for(;m<=y;)if(v=Math.floor((m+y)/2),a=n[v],h=n[v+1],a<=e){if(v===r||e<h)return v;m=v+1}else{if(!(a>e))throw new Ei("Input is not a number.");y=v-1}return 0}class ks{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[h,m]of a)this.labels.push(h),this.outputs.push(m)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,De);if(!a)return null;const h=[];let m=null;r.expectedType&&r.expectedType.kind!=="value"&&(m=r.expectedType);for(let y=1;y<e.length;y+=2){const v=y===1?-1/0:e[y],S=e[y+1],C=y,I=y+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const z=r.parse(S,I,m);if(!z)return null;m=m||z.type,h.push([v,z])}return new ks(m,a,h)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return a[0].evaluate(e);const m=r.length;return h>=r[m-1]?a[m-1].evaluate(e):a[ga(r,h)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function No(n,e,r){return n+r*(e-n)}function Is(n,e,r){return n.map((a,h)=>No(a,e[h],r))}const _n={number:No,color:function(n,e,r,a="rgb"){switch(a){case"rgb":{const[h,m,y,v]=Is(n.rgb,e.rgb,r);return new ht(h,m,y,v,!1)}case"hcl":{const[h,m,y,v]=n.hcl,[S,C,I,z]=e.hcl;let L,F;if(isNaN(h)||isNaN(S))isNaN(h)?isNaN(S)?L=NaN:(L=S,y!==1&&y!==0||(F=C)):(L=h,I!==1&&I!==0||(F=m));else{let le=S-h;S>h&&le>180?le-=360:S<h&&h-S>180&&(le+=360),L=h+r*le}const[O,q,W,Y]=function([le,ie,de,fe]){return le=isNaN(le)?0:le*ee,pt([de,Math.cos(le)*ie,Math.sin(le)*ie,fe])}([L,F??No(m,C,r),No(y,I,r),No(v,z,r)]);return new ht(O,q,W,Y,!1)}case"lab":{const[h,m,y,v]=pt(Is(n.lab,e.lab,r));return new ht(h,m,y,v,!1)}}},array:Is,padding:function(n,e,r){return new Ui(Is(n.values,e.values,r))}};class vn{constructor(e,r,a,h,m){this.type=e,this.operator=r,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,v]of m)this.labels.push(y),this.outputs.push(v)}static interpolationFactor(e,r,a,h){let m=0;if(e.name==="exponential")m=jl(r,e.base,a,h);else if(e.name==="linear")m=jl(r,1,a,h);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new Ce(y[0],y[1],y[2],y[3]).solve(jl(r,1,a,h))}return m}static parse(e,r){let[a,h,m,...y]=e;if(!Array.isArray(h)||h.length===0)return r.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const C=h[1];if(typeof C!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if(h[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(C.length!==4||C.some(I=>typeof I!="number"||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(m=r.parse(m,2,De),!m)return null;const v=[];let S=null;a==="interpolate-hcl"||a==="interpolate-lab"?S=qi:r.expectedType&&r.expectedType.kind!=="value"&&(S=r.expectedType);for(let C=0;C<y.length;C+=2){const I=y[C],z=y[C+1],L=C+3,F=C+4;if(typeof I!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const O=r.parse(z,F,S);if(!O)return null;S=S||O.type,v.push([I,O])}return A(S,De)||A(S,qi)||A(S,Hr)||A(S,Ni(De))?new vn(S,a,h,m,v):r.error(`Type ${Zt(S)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=r[0])return a[0].evaluate(e);const m=r.length;if(h>=r[m-1])return a[m-1].evaluate(e);const y=ga(r,h),v=vn.interpolationFactor(this.interpolation,h,r[y],r[y+1]),S=a[y].evaluate(e),C=a[y+1].evaluate(e);switch(this.operator){case"interpolate":return _n[this.type.kind](S,C,v);case"interpolate-hcl":return _n.color(S,C,v,"hcl");case"interpolate-lab":return _n.color(S,C,v,"lab")}}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function jl(n,e,r,a){const h=a-r,m=n-r;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}class ya{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const h=r.expectedType;h&&h.kind!=="value"&&(a=h);const m=[];for(const v of e.slice(1)){const S=r.parse(v,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!S)return null;a=a||S.type,m.push(S)}if(!a)throw new Error("No output type");const y=h&&m.some(v=>zr(h,v.type));return new ya(y?lt:a,m)}evaluate(e){let r,a=null,h=0;for(const m of this.args)if(h++,a=m.evaluate(e),a&&a instanceof Rn&&!a.available&&(r||(r=a.name),a=null,h===this.args.length&&(a=r)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class _a{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return r.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return r.error("Variable names must contain only alphanumeric characters or '_'.",m);const v=r.parse(e[m+1],m+1);if(!v)return null;a.push([y,v])}const h=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return h?new _a(a,h):null}outputDefined(){return this.result.outputDefined()}}class $l{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,De),h=r.parse(e[2],2,Ni(r.expectedType||lt));return a&&h?new $l(h.type.itemType,a,h):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new Ei(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new Ei(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new Ei(`Array index must be an integer, but found ${r} instead.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class ql{constructor(e,r){this.type=_t,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,lt),h=r.parse(e[2],2,lt);return a&&h?Wr(a.type,[_t,yt,De,Gr,lt])?new ql(a,h):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zt(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!G(r,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${Zt(vi(r))} instead.`);if(!G(a,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${Zt(vi(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Uo{constructor(e,r,a){this.type=De,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,lt),h=r.parse(e[2],2,lt);if(!a||!h)return null;if(!Wr(a.type,[_t,yt,De,Gr,lt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Zt(a.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,De);return m?new Uo(a,h,m):null}return new Uo(a,h)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!G(r,["boolean","string","number","null"]))throw new Ei(`Expected first argument to be of type boolean, string, number or null, but found ${Zt(vi(r))} instead.`);if(!G(a,["string","array"]))throw new Ei(`Expected second argument to be of type array or string, but found ${Zt(vi(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(r,h)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Vo{constructor(e,r,a,h,m,y){this.inputType=e,this.type=r,this.input=a,this.cases=h,this.outputs=m,this.otherwise=y}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,h;r.expectedType&&r.expectedType.kind!=="value"&&(h=r.expectedType);const m={},y=[];for(let C=2;C<e.length-1;C+=2){let I=e[C];const z=e[C+1];Array.isArray(I)||(I=[I]);const L=r.concat(C);if(I.length===0)return L.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return L.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,vi(O)))return null}else a=vi(O);if(m[String(O)]!==void 0)return L.error("Branch labels must be unique.");m[String(O)]=y.length}const F=r.parse(z,C,h);if(!F)return null;h=h||F.type,y.push(F)}const v=r.parse(e[1],1,lt);if(!v)return null;const S=r.parse(e[e.length-1],e.length-1,h);return S?v.type.kind!=="value"&&r.concat(1).checkSubtype(a,v.type)?null:new Vo(a,h,v,m,y,S):null}evaluate(e){const r=this.input.evaluate(e);return(vi(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class Pt{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const h=[];for(let y=1;y<e.length-1;y+=2){const v=r.parse(e[y],y,_t);if(!v)return null;const S=r.parse(e[y+1],y+1,a);if(!S)return null;h.push([v,S]),a=a||S.type}const m=r.parse(e[e.length-1],e.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new Pt(a,h,m)}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class va{constructor(e,r,a,h){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=h}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,lt),h=r.parse(e[2],2,De);if(!a||!h)return null;if(!Wr(a.type,[Ni(lt),yt,lt]))return r.error(`Expected first argument to be of type array or string, but found ${Zt(a.type)} instead`);if(e.length===4){const m=r.parse(e[3],3,De);return m?new va(a.type,a,h,m):null}return new va(a.type,a,h)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!G(r,["string","array"]))throw new Ei(`Expected first argument to be of type array or string, but found ${Zt(vi(r))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return r.slice(a,h)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function Rc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Bc(n,e,r,a){return a.compare(e,r)===0}function jo(n,e,r){const a=n!=="=="&&n!=="!=";return class Ux{constructor(m,y,v){this.type=_t,this.lhs=m,this.rhs=y,this.collator=v,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const v=m[0];let S=y.parse(m[1],1,lt);if(!S)return null;if(!Rc(v,S.type))return y.concat(1).error(`"${v}" comparisons are not supported for type '${Zt(S.type)}'.`);let C=y.parse(m[2],2,lt);if(!C)return null;if(!Rc(v,C.type))return y.concat(2).error(`"${v}" comparisons are not supported for type '${Zt(C.type)}'.`);if(S.type.kind!==C.type.kind&&S.type.kind!=="value"&&C.type.kind!=="value")return y.error(`Cannot compare types '${Zt(S.type)}' and '${Zt(C.type)}'.`);a&&(S.type.kind==="value"&&C.type.kind!=="value"?S=new Wn(C.type,[S]):S.type.kind!=="value"&&C.type.kind==="value"&&(C=new Wn(S.type,[C])));let I=null;if(m.length===4){if(S.type.kind!=="string"&&C.type.kind!=="string"&&S.type.kind!=="value"&&C.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(I=y.parse(m[3],3,ur),!I)return null}return new Ux(S,C,I)}evaluate(m){const y=this.lhs.evaluate(m),v=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const S=vi(y),C=vi(v);if(S.kind!==C.kind||S.kind!=="string"&&S.kind!=="number")throw new Ei(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${S.kind}, ${C.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const S=vi(y),C=vi(v);if(S.kind!=="string"||C.kind!=="string")return e(m,y,v)}return this.collator?r(m,y,v,this.collator.evaluate(m)):e(m,y,v)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Kd=jo("==",function(n,e,r){return e===r},Bc),Yd=jo("!=",function(n,e,r){return e!==r},function(n,e,r,a){return!Bc(0,e,r,a)}),Jd=jo("<",function(n,e,r){return e<r},function(n,e,r,a){return a.compare(e,r)<0}),Qd=jo(">",function(n,e,r){return e>r},function(n,e,r,a){return a.compare(e,r)>0}),ep=jo("<=",function(n,e,r){return e<=r},function(n,e,r,a){return a.compare(e,r)<=0}),tp=jo(">=",function(n,e,r){return e>=r},function(n,e,r,a){return a.compare(e,r)>=0});class Zl{constructor(e,r,a,h,m){this.type=yt,this.number=e,this.locale=r,this.currency=a,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,De);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return r.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=r.parse(h.locale,1,yt),!m))return null;let y=null;if(h.currency&&(y=r.parse(h.currency,1,yt),!y))return null;let v=null;if(h["min-fraction-digits"]&&(v=r.parse(h["min-fraction-digits"],1,De),!v))return null;let S=null;return h["max-fraction-digits"]&&(S=r.parse(h["max-fraction-digits"],1,De),!S)?null:new Zl(a,m,y,v,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class xa{constructor(e){this.type=cr,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const h=[];let m=!1;for(let y=1;y<=e.length-1;++y){const v=e[y];if(m&&typeof v=="object"&&!Array.isArray(v)){m=!1;let S=null;if(v["font-scale"]&&(S=r.parse(v["font-scale"],1,De),!S))return null;let C=null;if(v["text-font"]&&(C=r.parse(v["text-font"],1,Ni(yt)),!C))return null;let I=null;if(v["text-color"]&&(I=r.parse(v["text-color"],1,qi),!I))return null;const z=h[h.length-1];z.scale=S,z.font=C,z.textColor=I}else{const S=r.parse(e[y],1,lt);if(!S)return null;const C=S.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:S,scale:null,font:null,textColor:null})}}return new xa(h)}evaluate(e){return new Mi(this.sections.map(r=>{const a=r.content.evaluate(e);return vi(a)===Dn?new oi("",a,null,null,null):new oi(Ts(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}}class Gl{constructor(e){this.type=Dn,this.input=e}static parse(e,r){if(e.length!==2)return r.error("Expected two arguments.");const a=r.parse(e[1],1,yt);return a?new Gl(a):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),a=Rn.fromString(r);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(r)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class Hl{constructor(e){this.type=De,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Zt(a.type)} instead.`):new Hl(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new Ei(`Expected value to be of type string or array, but found ${Zt(vi(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const $o={"==":Kd,"!=":Yd,">":Qd,"<":Jd,">=":tp,"<=":ep,array:Wn,at:$l,boolean:Wn,case:Pt,coalesce:ya,collator:Yr,format:xa,image:Gl,in:ql,"index-of":Uo,interpolate:vn,"interpolate-hcl":vn,"interpolate-lab":vn,length:Hl,let:_a,literal:uo,match:Vo,number:Wn,"number-format":Zl,object:Wn,slice:va,step:ks,string:Wn,"to-boolean":Kr,"to-color":Kr,"to-number":Kr,"to-string":Kr,var:Fo,within:ho};function Fc(n,[e,r,a,h]){e=e.evaluate(n),r=r.evaluate(n),a=a.evaluate(n);const m=h?h.evaluate(n):1,y=Ic(e,r,a,m);if(y)throw new Ei(y);return new ht(e/255,r/255,a/255,m,!1)}function Oc(n,e){return n in e}function Wl(n,e){const r=e[n];return r===void 0?null:r}function po(n){return{type:n}}function Nc(n){return{result:"success",value:n}}function qo(n){return{result:"error",value:n}}function Zo(n){return n["property-type"]==="data-driven"||n["property-type"]==="cross-faded-data-driven"}function Uc(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Xl(n){return!!n.expression&&n.expression.interpolated}function Ft(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}function wa(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function ip(n){return n}function Vc(n,e){const r=e.type==="color",a=n.stops&&typeof n.stops[0][0]=="object",h=a||!(a||n.property!==void 0),m=n.type||(Xl(e)?"exponential":"interval");if(r||e.type==="padding"){const I=r?ht.parse:Ui.parse;(n=Yi({},n)).stops&&(n.stops=n.stops.map(z=>[z[0],I(z[1])])),n.default=I(n.default?n.default:e.default)}if(n.colorSpace&&(y=n.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${n.colorSpace}"`);var y;let v,S,C;if(m==="exponential")v=ba;else if(m==="interval")v=rp;else if(m==="categorical"){v=np,S=Object.create(null);for(const I of n.stops)S[I[0]]=I[1];C=typeof n.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);v=op}if(a){const I={},z=[];for(let O=0;O<n.stops.length;O++){const q=n.stops[O],W=q[0].zoom;I[W]===void 0&&(I[W]={zoom:W,type:n.type,property:n.property,default:n.default,stops:[]},z.push(W)),I[W].stops.push([q[0].value,q[1]])}const L=[];for(const O of z)L.push([I[O].zoom,Vc(I[O],e)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:vn.interpolationFactor.bind(void 0,F),zoomStops:L.map(O=>O[0]),evaluate:({zoom:O},q)=>ba({stops:L,base:n.base},e,O).evaluate(O,q)}}if(h){const I=m==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:I,interpolationFactor:vn.interpolationFactor.bind(void 0,I),zoomStops:n.stops.map(z=>z[0]),evaluate:({zoom:z})=>v(n,e,z,S,C)}}return{kind:"source",evaluate(I,z){const L=z&&z.properties?z.properties[n.property]:void 0;return L===void 0?Ps(n.default,e.default):v(n,e,L,S,C)}}}function Ps(n,e,r){return n!==void 0?n:e!==void 0?e:r!==void 0?r:void 0}function np(n,e,r,a,h){return Ps(typeof r===h?a[r]:void 0,n.default,e.default)}function rp(n,e,r){if(Ft(r)!=="number")return Ps(n.default,e.default);const a=n.stops.length;if(a===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[a-1][0])return n.stops[a-1][1];const h=ga(n.stops.map(m=>m[0]),r);return n.stops[h][1]}function ba(n,e,r){const a=n.base!==void 0?n.base:1;if(Ft(r)!=="number")return Ps(n.default,e.default);const h=n.stops.length;if(h===1||r<=n.stops[0][0])return n.stops[0][1];if(r>=n.stops[h-1][0])return n.stops[h-1][1];const m=ga(n.stops.map(I=>I[0]),r),y=function(I,z,L,F){const O=F-L,q=I-L;return O===0?0:z===1?q/O:(Math.pow(z,q)-1)/(Math.pow(z,O)-1)}(r,a,n.stops[m][0],n.stops[m+1][0]),v=n.stops[m][1],S=n.stops[m+1][1],C=_n[e.type]||ip;return typeof v.evaluate=="function"?{evaluate(...I){const z=v.evaluate.apply(void 0,I),L=S.evaluate.apply(void 0,I);if(z!==void 0&&L!==void 0)return C(z,L,y,n.colorSpace)}}:C(v,S,y,n.colorSpace)}function op(n,e,r){switch(e.type){case"color":r=ht.parse(r);break;case"formatted":r=Mi.fromString(r.toString());break;case"resolvedImage":r=Rn.fromString(r.toString());break;case"padding":r=Ui.parse(r);break;default:Ft(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0)}return Ps(r,n.default,e.default)}Bn.register($o,{error:[{kind:"error"},[yt],(n,[e])=>{throw new Ei(e.evaluate(n))}],typeof:[yt,[lt],(n,[e])=>Zt(vi(e.evaluate(n)))],"to-rgba":[Ni(De,4),[qi],(n,[e])=>{const[r,a,h,m]=e.evaluate(n).rgb;return[255*r,255*a,255*h,m]}],rgb:[qi,[De,De,De],Fc],rgba:[qi,[De,De,De,De],Fc],has:{type:_t,overloads:[[[yt],(n,[e])=>Oc(e.evaluate(n),n.properties())],[[yt,Mr],(n,[e,r])=>Oc(e.evaluate(n),r.evaluate(n))]]},get:{type:lt,overloads:[[[yt],(n,[e])=>Wl(e.evaluate(n),n.properties())],[[yt,Mr],(n,[e,r])=>Wl(e.evaluate(n),r.evaluate(n))]]},"feature-state":[lt,[yt],(n,[e])=>Wl(e.evaluate(n),n.featureState||{})],properties:[Mr,[],n=>n.properties()],"geometry-type":[yt,[],n=>n.geometryType()],id:[lt,[],n=>n.id()],zoom:[De,[],n=>n.globals.zoom],"heatmap-density":[De,[],n=>n.globals.heatmapDensity||0],"line-progress":[De,[],n=>n.globals.lineProgress||0],accumulated:[lt,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[De,po(De),(n,e)=>{let r=0;for(const a of e)r+=a.evaluate(n);return r}],"*":[De,po(De),(n,e)=>{let r=1;for(const a of e)r*=a.evaluate(n);return r}],"-":{type:De,overloads:[[[De,De],(n,[e,r])=>e.evaluate(n)-r.evaluate(n)],[[De],(n,[e])=>-e.evaluate(n)]]},"/":[De,[De,De],(n,[e,r])=>e.evaluate(n)/r.evaluate(n)],"%":[De,[De,De],(n,[e,r])=>e.evaluate(n)%r.evaluate(n)],ln2:[De,[],()=>Math.LN2],pi:[De,[],()=>Math.PI],e:[De,[],()=>Math.E],"^":[De,[De,De],(n,[e,r])=>Math.pow(e.evaluate(n),r.evaluate(n))],sqrt:[De,[De],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[De,[De],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[De,[De],(n,[e])=>Math.log(e.evaluate(n))],log2:[De,[De],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[De,[De],(n,[e])=>Math.sin(e.evaluate(n))],cos:[De,[De],(n,[e])=>Math.cos(e.evaluate(n))],tan:[De,[De],(n,[e])=>Math.tan(e.evaluate(n))],asin:[De,[De],(n,[e])=>Math.asin(e.evaluate(n))],acos:[De,[De],(n,[e])=>Math.acos(e.evaluate(n))],atan:[De,[De],(n,[e])=>Math.atan(e.evaluate(n))],min:[De,po(De),(n,e)=>Math.min(...e.map(r=>r.evaluate(n)))],max:[De,po(De),(n,e)=>Math.max(...e.map(r=>r.evaluate(n)))],abs:[De,[De],(n,[e])=>Math.abs(e.evaluate(n))],round:[De,[De],(n,[e])=>{const r=e.evaluate(n);return r<0?-Math.round(-r):Math.round(r)}],floor:[De,[De],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[De,[De],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[_t,[yt,lt],(n,[e,r])=>n.properties()[e.value]===r.value],"filter-id-==":[_t,[lt],(n,[e])=>n.id()===e.value],"filter-type-==":[_t,[yt],(n,[e])=>n.geometryType()===e.value],"filter-<":[_t,[yt,lt],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a<h}],"filter-id-<":[_t,[lt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[_t,[yt,lt],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a>h}],"filter-id->":[_t,[lt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[_t,[yt,lt],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[_t,[lt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[_t,[yt,lt],(n,[e,r])=>{const a=n.properties()[e.value],h=r.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[_t,[lt],(n,[e])=>{const r=n.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[_t,[lt],(n,[e])=>e.value in n.properties()],"filter-has-id":[_t,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[_t,[Ni(yt)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[_t,[Ni(lt)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[_t,[yt,Ni(lt)],(n,[e,r])=>r.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[_t,[yt,Ni(lt)],(n,[e,r])=>function(a,h,m,y){for(;m<=y;){const v=m+y>>1;if(h[v]===a)return!0;h[v]>a?y=v-1:m=v+1}return!1}(n.properties()[e.value],r.value,0,r.value.length-1)],all:{type:_t,overloads:[[[_t,_t],(n,[e,r])=>e.evaluate(n)&&r.evaluate(n)],[po(_t),(n,e)=>{for(const r of e)if(!r.evaluate(n))return!1;return!0}]]},any:{type:_t,overloads:[[[_t,_t],(n,[e,r])=>e.evaluate(n)||r.evaluate(n)],[po(_t),(n,e)=>{for(const r of e)if(r.evaluate(n))return!0;return!1}]]},"!":[_t,[_t],(n,[e])=>!e.evaluate(n)],"is-supported-script":[_t,[yt],(n,[e])=>{const r=n.globals&&n.globals.isSupportedScript;return!r||r(e.evaluate(n))}],upcase:[yt,[yt],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[yt,[yt],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[yt,po(lt),(n,e)=>e.map(r=>Ts(r.evaluate(n))).join("")],"resolved-locale":[yt,[ur],(n,[e])=>e.evaluate(n).resolvedLocale()]});class Kl{constructor(e,r){var a;this.expression=e,this._warningHistory={},this._evaluator=new da,this._defaultValue=r?(a=r).type==="color"&&wa(a.default)?new ht(0,0,0,0):a.type==="color"?ht.parse(a.default)||null:a.type==="padding"?Ui.parse(a.default)||null:a.default===void 0?null:a.default:null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(e,r,a,h,m,y){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,h,m,y){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Ei(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Sa(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in $o}function Ea(n,e){const r=new Ro($o,fa,[],e?function(h){const m={color:qi,string:yt,number:De,enum:yt,boolean:_t,formatted:cr,padding:Hr,resolvedImage:Dn};return h.type==="array"?Ni(m[h.value]||lt,h.length):m[h.type]}(e):void 0),a=r.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Nc(new Kl(a,e)):qo(r.errors)}class si{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent=e!=="constant"&&!Oo(r.expression)}evaluateWithoutErrorHandling(e,r,a,h,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,h,m,y)}evaluate(e,r,a,h,m,y){return this._styleExpression.evaluate(e,r,a,h,m,y)}}class Yl{constructor(e,r,a,h){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Oo(r.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,r,a,h,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,h,m,y)}evaluate(e,r,a,h,m,y){return this._styleExpression.evaluate(e,r,a,h,m,y)}interpolationFactor(e,r,a){return this.interpolationType?vn.interpolationFactor(this.interpolationType,e,r,a):0}}function Tt(n,e){const r=Ea(n,e);if(r.result==="error")return r;const a=r.value.expression,h=ma(a);if(!h&&!Zo(e))return qo([new sn("","data expressions not supported")]);const m=Cs(a,["zoom"]);if(!m&&!Uc(e))return qo([new sn("","zoom expressions not supported")]);const y=Ht(a);return y||m?y instanceof sn?qo([y]):y instanceof vn&&!Xl(e)?qo([new sn("",'"interpolate" expressions cannot be used with this property')]):Nc(y?new Yl(h?"camera":"composite",r.value,y.labels,y instanceof vn?y.interpolation:void 0):new si(h?"constant":"source",r.value)):qo([new sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Go{constructor(e,r){this._parameters=e,this._specification=r,Yi(this,Vc(this._parameters,this._specification))}static deserialize(e){return new Go(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ht(n){let e=null;if(n instanceof _a)e=Ht(n.result);else if(n instanceof ya){for(const r of n.args)if(e=Ht(r),e)break}else(n instanceof ks||n instanceof vn)&&n.input instanceof Bn&&n.input.name==="zoom"&&(e=n);return e instanceof sn||n.eachChild(r=>{const a=Ht(r);a instanceof sn?e=a:!e&&a?e=new sn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new sn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Wt(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!Wt(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Ta={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ca(n){if(n==null)return{filter:()=>!0,needGeometry:!1};Wt(n)||(n=ka(n));const e=Ea(n,Ta);if(e.result==="error")throw new Error(e.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,a,h)=>e.value.evaluate(r,a,{},h),needGeometry:jc(n)}}function sp(n,e){return n<e?-1:n>e?1:0}function jc(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(jc(n[e]))return!0;return!1}function ka(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?Jl(n[1],n[2],"=="):e==="!="?Ms(Jl(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Jl(n[1],n[2],e):e==="any"?(r=n.slice(1),["any"].concat(r.map(ka))):e==="all"?["all"].concat(n.slice(1).map(ka)):e==="none"?["all"].concat(n.slice(1).map(ka).map(Ms)):e==="in"?Ql(n[1],n.slice(2)):e==="!in"?Ms(Ql(n[1],n.slice(2))):e==="has"?eu(n[1]):e==="!has"?Ms(eu(n[1])):e!=="within"||n;var r}function Jl(n,e,r){switch(n){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,n,e]}}function Ql(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",n,["literal",e.sort(sp)]]:["filter-in-small",n,["literal",e]]}}function eu(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ms(n){return["!",n]}function Ia(n){const e=typeof n;if(e==="number"||e==="boolean"||e==="string"||n==null)return JSON.stringify(n);if(Array.isArray(n)){let h="[";for(const m of n)h+=`${Ia(m)},`;return`${h}]`}const r=Object.keys(n).sort();let a="{";for(let h=0;h<r.length;h++)a+=`${JSON.stringify(r[h])}:${Ia(n[r[h]])},`;return`${a}}`}function tu(n){let e="";for(const r of Ir)e+=`/${Ia(n[r])}`;return e}function $c(n){const e=n.value;return e?[new Be(n.key,e,"constants have been deprecated as of v8")]:[]}function pi(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function fo(n){if(Array.isArray(n))return n.map(fo);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const r in n)e[r]=fo(n[r]);return e}return pi(n)}function Fn(n){const e=n.key,r=n.value,a=n.valueSpec||{},h=n.objectElementValidators||{},m=n.style,y=n.styleSpec,v=n.validateSpec;let S=[];const C=Ft(r);if(C!=="object")return[new Be(e,r,`object expected, ${C} found`)];for(const I in r){const z=I.split(".")[0],L=a[z]||a["*"];let F;if(h[z])F=h[z];else if(a[z])F=v;else if(h["*"])F=h["*"];else{if(!a["*"]){S.push(new Be(e,r[I],`unknown property "${I}"`));continue}F=v}S=S.concat(F({key:(e&&`${e}.`)+I,value:r[I],valueSpec:L,style:m,styleSpec:y,object:r,objectKey:I,validateSpec:v},r))}for(const I in a)h[I]||a[I].required&&a[I].default===void 0&&r[I]===void 0&&S.push(new Be(e,r,`missing required property "${I}"`));return S}function qc(n){const e=n.value,r=n.valueSpec,a=n.style,h=n.styleSpec,m=n.key,y=n.arrayElementValidator||n.validateSpec;if(Ft(e)!=="array")return[new Be(m,e,`array expected, ${Ft(e)} found`)];if(r.length&&e.length!==r.length)return[new Be(m,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new Be(m,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let v={type:r.value,values:r.values};h.$version<7&&(v.function=r.function),Ft(r.value)==="object"&&(v=r.value);let S=[];for(let C=0;C<e.length;C++)S=S.concat(y({array:e,arrayIndex:C,value:e[C],valueSpec:v,validateSpec:n.validateSpec,style:a,styleSpec:h,key:`${m}[${C}]`}));return S}function iu(n){const e=n.key,r=n.value,a=n.valueSpec;let h=Ft(r);return h==="number"&&r!=r&&(h="NaN"),h!=="number"?[new Be(e,r,`number expected, ${h} found`)]:"minimum"in a&&r<a.minimum?[new Be(e,r,`${r} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&r>a.maximum?[new Be(e,r,`${r} is greater than the maximum value ${a.maximum}`)]:[]}function Zc(n){const e=n.valueSpec,r=pi(n.value.type);let a,h,m,y={};const v=r!=="categorical"&&n.value.property===void 0,S=!v,C=Ft(n.value.stops)==="array"&&Ft(n.value.stops[0])==="array"&&Ft(n.value.stops[0][0])==="object",I=Fn({key:n.key,value:n.value,valueSpec:n.styleSpec.function,validateSpec:n.validateSpec,style:n.style,styleSpec:n.styleSpec,objectElementValidators:{stops:function(F){if(r==="identity")return[new Be(F.key,F.value,'identity function may not have a "stops" property')];let O=[];const q=F.value;return O=O.concat(qc({key:F.key,value:q,valueSpec:F.valueSpec,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:z})),Ft(q)==="array"&&q.length===0&&O.push(new Be(F.key,q,"array must have at least one stop")),O},default:function(F){return F.validateSpec({key:F.key,value:F.value,valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec})}}});return r==="identity"&&v&&I.push(new Be(n.key,n.value,'missing required property "property"')),r==="identity"||n.value.stops||I.push(new Be(n.key,n.value,'missing required property "stops"')),r==="exponential"&&n.valueSpec.expression&&!Xl(n.valueSpec)&&I.push(new Be(n.key,n.value,"exponential functions not supported")),n.styleSpec.$version>=8&&(S&&!Zo(n.valueSpec)?I.push(new Be(n.key,n.value,"property functions not supported")):v&&!Uc(n.valueSpec)&&I.push(new Be(n.key,n.value,"zoom functions not supported"))),r!=="categorical"&&!C||n.value.property!==void 0||I.push(new Be(n.key,n.value,'"property" property is required')),I;function z(F){let O=[];const q=F.value,W=F.key;if(Ft(q)!=="array")return[new Be(W,q,`array expected, ${Ft(q)} found`)];if(q.length!==2)return[new Be(W,q,`array length 2 expected, length ${q.length} found`)];if(C){if(Ft(q[0])!=="object")return[new Be(W,q,`object expected, ${Ft(q[0])} found`)];if(q[0].zoom===void 0)return[new Be(W,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new Be(W,q,"object stop key must have value")];if(m&&m>pi(q[0].zoom))return[new Be(W,q[0].zoom,"stop zoom values must appear in ascending order")];pi(q[0].zoom)!==m&&(m=pi(q[0].zoom),h=void 0,y={}),O=O.concat(Fn({key:`${W}[0]`,value:q[0],valueSpec:{zoom:{}},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:iu,value:L}}))}else O=O.concat(L({key:`${W}[0]`,value:q[0],valueSpec:{},validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec},q));return Sa(fo(q[1]))?O.concat([new Be(`${W}[1]`,q[1],"expressions are not allowed in function stops.")]):O.concat(F.validateSpec({key:`${W}[1]`,value:q[1],valueSpec:e,validateSpec:F.validateSpec,style:F.style,styleSpec:F.styleSpec}))}function L(F,O){const q=Ft(F.value),W=pi(F.value),Y=F.value!==null?F.value:O;if(a){if(q!==a)return[new Be(F.key,Y,`${q} stop domain type must match previous stop domain type ${a}`)]}else a=q;if(q!=="number"&&q!=="string"&&q!=="boolean")return[new Be(F.key,Y,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&r!=="categorical"){let le=`number expected, ${q} found`;return Zo(e)&&r===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(F.key,Y,le)]}return r!=="categorical"||q!=="number"||isFinite(W)&&Math.floor(W)===W?r!=="categorical"&&q==="number"&&h!==void 0&&W<h?[new Be(F.key,Y,"stop domain values must appear in ascending order")]:(h=W,r==="categorical"&&W in y?[new Be(F.key,Y,"stop domain values must be unique")]:(y[W]=!0,[])):[new Be(F.key,Y,`integer expected, found ${W}`)]}}function Ho(n){const e=(n.expressionContext==="property"?Tt:Ea)(fo(n.value),n.valueSpec);if(e.result==="error")return e.value.map(a=>new Be(`${n.key}${a.key}`,n.value,a.message));const r=e.value.expression||e.value._styleExpression.expression;if(n.expressionContext==="property"&&n.propertyKey==="text-font"&&!r.outputDefined())return[new Be(n.key,n.value,`Invalid data expression for "${n.propertyKey}". Output values must be contained as literals within the expression.`)];if(n.expressionContext==="property"&&n.propertyType==="layout"&&!Oo(r))return[new Be(n.key,n.value,'"feature-state" data expressions are not supported with layout properties.')];if(n.expressionContext==="filter"&&!Oo(r))return[new Be(n.key,n.value,'"feature-state" data expressions are not supported with filters.')];if(n.expressionContext&&n.expressionContext.indexOf("cluster")===0){if(!Cs(r,["zoom","feature-state"]))return[new Be(n.key,n.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(n.expressionContext==="cluster-initial"&&!ma(r))return[new Be(n.key,n.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zs(n){const e=n.key,r=n.value,a=n.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(pi(r))===-1&&h.push(new Be(e,r,`expected one of [${a.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(a.values).indexOf(pi(r))===-1&&h.push(new Be(e,r,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(r)} found`)),h}function Pa(n){return Wt(fo(n.value))?Ho(Yi({},n,{expressionContext:"filter",valueSpec:{value:"boolean"}})):As(n)}function As(n){const e=n.value,r=n.key;if(Ft(e)!=="array")return[new Be(r,e,`array expected, ${Ft(e)} found`)];const a=n.styleSpec;let h,m=[];if(e.length<1)return[new Be(r,e,"filter array must have at least 1 element")];switch(m=m.concat(zs({key:`${r}[0]`,value:e[0],valueSpec:a.filter_operator,style:n.style,styleSpec:n.styleSpec})),pi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&pi(e[1])==="$type"&&m.push(new Be(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Be(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Ft(e[1]),h!=="string"&&m.push(new Be(`${r}[1]`,e[1],`string expected, ${h} found`)));for(let y=2;y<e.length;y++)h=Ft(e[y]),pi(e[1])==="$type"?m=m.concat(zs({key:`${r}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:n.style,styleSpec:n.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&m.push(new Be(`${r}[${y}]`,e[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(As({key:`${r}[${y}]`,value:e[y],style:n.style,styleSpec:n.styleSpec}));break;case"has":case"!has":h=Ft(e[1]),e.length!==2?m.push(new Be(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&m.push(new Be(`${r}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Ft(e[1]),e.length!==2?m.push(new Be(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&m.push(new Be(`${r}[1]`,e[1],`object expected, ${h} found`))}return m}function Gc(n,e){const r=n.key,a=n.validateSpec,h=n.style,m=n.styleSpec,y=n.value,v=n.objectKey,S=m[`${e}_${n.layerType}`];if(!S)return[];const C=v.match(/^(.*)-transition$/);if(e==="paint"&&C&&S[C[1]]&&S[C[1]].transition)return a({key:r,value:y,valueSpec:m.transition,style:h,styleSpec:m});const I=n.valueSpec||S[v];if(!I)return[new Be(r,y,`unknown property "${v}"`)];let z;if(Ft(y)==="string"&&Zo(I)&&!I.tokens&&(z=/^{([^}]+)}$/.exec(y)))return[new Be(r,y,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const L=[];return n.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&L.push(new Be(r,y,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&wa(fo(y))&&pi(y.type)==="identity"&&L.push(new Be(r,y,'"text-font" does not support identity functions'))),L.concat(a({key:n.key,value:y,valueSpec:I,style:h,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:v}))}function nu(n){return Gc(n,"paint")}function Hc(n){return Gc(n,"layout")}function Ma(n){let e=[];const r=n.value,a=n.key,h=n.style,m=n.styleSpec;r.type||r.ref||e.push(new Be(a,r,'either "type" or "ref" is required'));let y=pi(r.type);const v=pi(r.ref);if(r.id){const S=pi(r.id);for(let C=0;C<n.arrayIndex;C++){const I=h.layers[C];pi(I.id)===S&&e.push(new Be(a,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let S;["type","source","source-layer","filter","layout"].forEach(C=>{C in r&&e.push(new Be(a,r[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{pi(C.id)===v&&(S=C)}),S?S.ref?e.push(new Be(a,r.ref,"ref cannot reference another ref layer")):y=pi(S.type):e.push(new Be(a,r.ref,`ref layer "${v}" not found`))}else if(y!=="background")if(r.source){const S=h.sources&&h.sources[r.source],C=S&&pi(S.type);S?C==="vector"&&y==="raster"?e.push(new Be(a,r.source,`layer "${r.id}" requires a raster source`)):C==="raster"&&y!=="raster"?e.push(new Be(a,r.source,`layer "${r.id}" requires a vector source`)):C!=="vector"||r["source-layer"]?C==="raster-dem"&&y!=="hillshade"?e.push(new Be(a,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!r.paint||!r.paint["line-gradient"]||C==="geojson"&&S.lineMetrics||e.push(new Be(a,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Be(a,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new Be(a,r.source,`source "${r.source}" not found`))}else e.push(new Be(a,r,'missing required property "source"'));return e=e.concat(Fn({key:a,value:r,valueSpec:m.layer,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,objectElementValidators:{"*":()=>[],type:()=>n.validateSpec({key:`${a}.type`,value:r.type,valueSpec:m.layer.type,style:n.style,styleSpec:n.styleSpec,validateSpec:n.validateSpec,object:r,objectKey:"type"}),filter:Pa,layout:S=>Fn({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":C=>Hc(Yi({layerType:y},C))}}),paint:S=>Fn({layer:r,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":C=>nu(Yi({layerType:y},C))}})}})),e}function hr(n){const e=n.value,r=n.key,a=Ft(e);return a!=="string"?[new Be(r,e,`string expected, ${a} found`)]:[]}const za={promoteId:function({key:n,value:e}){if(Ft(e)==="string")return hr({key:n,value:e});{const r=[];for(const a in e)r.push(...hr({key:`${n}.${a}`,value:e[a]}));return r}}};function Aa(n){const e=n.value,r=n.key,a=n.styleSpec,h=n.style,m=n.validateSpec;if(!e.type)return[new Be(r,e,'"type" is required')];const y=pi(e.type);let v;switch(y){case"vector":case"raster":case"raster-dem":return v=Fn({key:r,value:e,valueSpec:a[`source_${y.replace("-","_")}`],style:n.style,styleSpec:a,objectElementValidators:za,validateSpec:m}),v;case"geojson":if(v=Fn({key:r,value:e,valueSpec:a.source_geojson,style:h,styleSpec:a,validateSpec:m,objectElementValidators:za}),e.cluster)for(const S in e.clusterProperties){const[C,I]=e.clusterProperties[S],z=typeof C=="string"?[C,["accumulated"],["get",S]]:C;v.push(...Ho({key:`${r}.${S}.map`,value:I,validateSpec:m,expressionContext:"cluster-map"})),v.push(...Ho({key:`${r}.${S}.reduce`,value:z,validateSpec:m,expressionContext:"cluster-reduce"}))}return v;case"video":return Fn({key:r,value:e,valueSpec:a.source_video,style:h,validateSpec:m,styleSpec:a});case"image":return Fn({key:r,value:e,valueSpec:a.source_image,style:h,validateSpec:m,styleSpec:a});case"canvas":return[new Be(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:m,styleSpec:a})}}function Wc(n){const e=n.value,r=n.styleSpec,a=r.light,h=n.style;let m=[];const y=Ft(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Be("light",e,`object expected, ${y} found`)]),m;for(const v in e){const S=v.match(/^(.*)-transition$/);m=m.concat(S&&a[S[1]]&&a[S[1]].transition?n.validateSpec({key:v,value:e[v],valueSpec:r.transition,validateSpec:n.validateSpec,style:h,styleSpec:r}):a[v]?n.validateSpec({key:v,value:e[v],valueSpec:a[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Be(v,e[v],`unknown property "${v}"`)])}return m}function Ls(n){const e=n.value,r=n.styleSpec,a=r.terrain,h=n.style;let m=[];const y=Ft(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Be("terrain",e,`object expected, ${y} found`)]),m;for(const v in e)m=m.concat(a[v]?n.validateSpec({key:v,value:e[v],valueSpec:a[v],validateSpec:n.validateSpec,style:h,styleSpec:r}):[new Be(v,e[v],`unknown property "${v}"`)]);return m}function Xc(n){let e=[];const r=n.value,a=n.key;if(Array.isArray(r)){const h=[],m=[];for(const y in r)r[y].id&&h.includes(r[y].id)&&e.push(new Be(a,r,`all the sprites' ids must be unique, but ${r[y].id} is duplicated`)),h.push(r[y].id),r[y].url&&m.includes(r[y].url)&&e.push(new Be(a,r,`all the sprites' URLs must be unique, but ${r[y].url} is duplicated`)),m.push(r[y].url),e=e.concat(Fn({key:`${a}[${y}]`,value:r[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:n.validateSpec}));return e}return hr({key:a,value:r})}const Kc={"*":()=>[],array:qc,boolean:function(n){const e=n.value,r=n.key,a=Ft(e);return a!=="boolean"?[new Be(r,e,`boolean expected, ${a} found`)]:[]},number:iu,color:function(n){const e=n.key,r=n.value,a=Ft(r);return a!=="string"?[new Be(e,r,`color expected, ${a} found`)]:ht.parse(String(r))?[]:[new Be(e,r,`color expected, "${r}" found`)]},constants:$c,enum:zs,filter:Pa,function:Zc,layer:Ma,object:Fn,source:Aa,light:Wc,terrain:Ls,string:hr,formatted:function(n){return hr(n).length===0?[]:Ho(n)},resolvedImage:function(n){return hr(n).length===0?[]:Ho(n)},padding:function(n){const e=n.key,r=n.value;if(Ft(r)==="array"){if(r.length<1||r.length>4)return[new Be(e,r,`padding requires 1 to 4 values; ${r.length} values found`)];const a={type:"number"};let h=[];for(let m=0;m<r.length;m++)h=h.concat(n.validateSpec({key:`${e}[${m}]`,value:r[m],validateSpec:n.validateSpec,valueSpec:a}));return h}return iu({key:e,value:r,valueSpec:{}})},sprite:Xc};function Ds(n){const e=n.value,r=n.valueSpec,a=n.styleSpec;return n.validateSpec=Ds,r.expression&&wa(pi(e))?Zc(n):r.expression&&Sa(fo(e))?Ho(n):r.type&&Kc[r.type]?Kc[r.type](n):Fn(Yi({},n,{valueSpec:r.type?a[r.type]:r}))}function Yc(n){const e=n.value,r=n.key,a=hr(n);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Be(r,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Be(r,e,'"glyphs" url must include a "{range}" token'))),a}function dr(n,e=ge){let r=[];return r=r.concat(Ds({key:"",value:n,valueSpec:e.$root,styleSpec:e,style:n,validateSpec:Ds,objectElementValidators:{glyphs:Yc,"*":()=>[]}})),n.constants&&(r=r.concat($c({key:"constants",value:n.constants,style:n,styleSpec:e,validateSpec:Ds}))),Rs(r)}function On(n){return function(e){return n({...e,validateSpec:Ds})}}function Rs(n){return[].concat(n).sort((e,r)=>e.line-r.line)}function xi(n){return function(...e){return Rs(n.apply(this,e))}}dr.source=xi(On(Aa)),dr.sprite=xi(On(Xc)),dr.glyphs=xi(On(Yc)),dr.light=xi(On(Wc)),dr.terrain=xi(On(Ls)),dr.layer=xi(On(Ma)),dr.filter=xi(On(Pa)),dr.paintProperty=xi(On(nu)),dr.layoutProperty=xi(On(Hc));const Jr=dr,ap=Jr.light,lp=Jr.paintProperty,up=Jr.layoutProperty;function Wo(n,e){let r=!1;if(e&&e.length)for(const a of e)n.fire(new lr(new Error(a.message))),r=!0;return r}class Bs{constructor(e,r,a){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(r=y[1])+2*(a=y[2]);for(let S=0;S<this.d*this.d;S++){const C=y[3+S],I=y[3+S+1];h.push(C===I?null:y.subarray(C,I))}const v=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],v),this.bboxes=y.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*a;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=e,this.padding=a,this.scale=r/e,this.uid=0;const m=a/r*e;this.min=-m,this.max=e+m}insert(e,r,a,h,m){this._forEachCell(r,a,h,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,r,a,h,m,y){this.cells[m].push(y)}query(e,r,a,h,m){const y=this.min,v=this.max;if(e<=y&&r<=y&&v<=a&&v<=h&&!m)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,r,a,h,this._queryCell,S,{},m),S}}_queryCell(e,r,a,h,m,y,v,S){const C=this.cells[m];if(C!==null){const I=this.keys,z=this.bboxes;for(let L=0;L<C.length;L++){const F=C[L];if(v[F]===void 0){const O=4*F;(S?S(z[O+0],z[O+1],z[O+2],z[O+3]):e<=z[O+2]&&r<=z[O+3]&&a>=z[O+0]&&h>=z[O+1])?(v[F]=!0,y.push(I[F])):v[F]=!1}}}}_forEachCell(e,r,a,h,m,y,v,S){const C=this._convertToCellCoord(e),I=this._convertToCellCoord(r),z=this._convertToCellCoord(a),L=this._convertToCellCoord(h);for(let F=C;F<=z;F++)for(let O=I;O<=L;O++){const q=this.d*O+F;if((!S||S(this._convertFromCellCoord(F),this._convertFromCellCoord(O),this._convertFromCellCoord(F+1),this._convertFromCellCoord(O+1)))&&m.call(this,e,r,a,h,q,y,v,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,r=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const h=new Int32Array(r+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let m=r;for(let y=0;y<e.length;y++){const v=e[y];h[3+y]=m,h.set(v,m),m+=v.length}return h[3+e.length]=m,h.set(this.keys,m),m+=this.keys.length,h[3+e.length+1]=m,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer}static serialize(e,r){const a=e.toArrayBuffer();return r&&r.push(a),{buffer:a}}static deserialize(e){return new Bs(e.buffer)}}const pr={};function He(n,e,r={}){if(pr[n])throw new Error(`${n} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:n,writeable:!1}),pr[n]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}He("Object",Object),He("TransferableGridIndex",Bs),He("Color",ht),He("Error",Error),He("AJAXError",Ut),He("ResolvedImage",Rn),He("StylePropertyFunction",Go),He("StyleExpression",Kl,{omit:["_evaluator"]}),He("ZoomDependentExpression",Yl),He("ZoomConstantExpression",si),He("CompoundExpression",Bn,{omit:["_evaluate"]});for(const n in $o)$o[n]._classRegistryKey||He(`Expression_${n}`,$o[n]);function La(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Fs(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob)return n;if(La(n)||sr(n))return e&&e.push(n),n;if(ArrayBuffer.isView(n)){const r=n;return e&&e.push(r.buffer),r}if(n instanceof ImageData)return e&&e.push(n.data.buffer),n;if(Array.isArray(n)){const r=[];for(const a of n)r.push(Fs(a,e));return r}if(typeof n=="object"){const r=n.constructor,a=r._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!pr[a])throw new Error(`${a} is not registered.`);const h=r.serialize?r.serialize(n,e):{};if(r.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in n){if(!n.hasOwnProperty(m)||pr[a].omit.indexOf(m)>=0)continue;const y=n[m];h[m]=pr[a].shallow.indexOf(m)>=0?y:Fs(y,e)}n instanceof Error&&(h.message=n.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof n)}function Ar(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||n instanceof Blob||La(n)||sr(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Ar);if(typeof n=="object"){const e=n.$name||"Object";if(!pr[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:r}=pr[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(n);const a=Object.create(r.prototype);for(const h of Object.keys(n)){if(h==="$name")continue;const m=n[h];a[h]=pr[e].shallow.indexOf(h)>=0?m:Ar(m)}return a}throw new Error("can't deserialize object of type "+typeof n)}class Jc{constructor(){this.first=!0}update(e,r){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Ne={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519};function Da(n){for(const e of n)if(Ra(e.charCodeAt(0)))return!0;return!1}function ru(n){for(const e of n)if(!Qc(e.charCodeAt(0)))return!1;return!0}function Qc(n){return!(Ne.Arabic(n)||Ne["Arabic Supplement"](n)||Ne["Arabic Extended-A"](n)||Ne["Arabic Presentation Forms-A"](n)||Ne["Arabic Presentation Forms-B"](n))}function Ra(n){return!(n!==746&&n!==747&&(n<4352||!(Ne["Bopomofo Extended"](n)||Ne.Bopomofo(n)||Ne["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Ne["CJK Compatibility Ideographs"](n)||Ne["CJK Compatibility"](n)||Ne["CJK Radicals Supplement"](n)||Ne["CJK Strokes"](n)||!(!Ne["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Ne["CJK Unified Ideographs Extension A"](n)||Ne["CJK Unified Ideographs"](n)||Ne["Enclosed CJK Letters and Months"](n)||Ne["Hangul Compatibility Jamo"](n)||Ne["Hangul Jamo Extended-A"](n)||Ne["Hangul Jamo Extended-B"](n)||Ne["Hangul Jamo"](n)||Ne["Hangul Syllables"](n)||Ne.Hiragana(n)||Ne["Ideographic Description Characters"](n)||Ne.Kanbun(n)||Ne["Kangxi Radicals"](n)||Ne["Katakana Phonetic Extensions"](n)||Ne.Katakana(n)&&n!==12540||!(!Ne["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Ne["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Ne["Unified Canadian Aboriginal Syllabics"](n)||Ne["Unified Canadian Aboriginal Syllabics Extended"](n)||Ne["Vertical Forms"](n)||Ne["Yijing Hexagram Symbols"](n)||Ne["Yi Syllables"](n)||Ne["Yi Radicals"](n))))}function eh(n){return!(Ra(n)||function(e){return!!(Ne["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ne["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ne["Letterlike Symbols"](e)||Ne["Number Forms"](e)||Ne["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ne["Control Pictures"](e)&&e!==9251||Ne["Optical Character Recognition"](e)||Ne["Enclosed Alphanumerics"](e)||Ne["Geometric Shapes"](e)||Ne["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ne["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ne["CJK Symbols and Punctuation"](e)||Ne.Katakana(e)||Ne["Private Use Area"](e)||Ne["CJK Compatibility Forms"](e)||Ne["Small Form Variants"](e)||Ne["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Ba(n){return n>=1424&&n<=2303||Ne["Arabic Presentation Forms-A"](n)||Ne["Arabic Presentation Forms-B"](n)}function Fa(n,e){return!(!e&&Ba(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Ne.Khmer(n))}function th(n){for(const e of n)if(Ba(e.charCodeAt(0)))return!0;return!1}const ou="deferred",Oa="loading",su="loaded";let Os=null,an="unavailable",Qr=null;const ih=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(an="error"),Os&&Os(n)};function au(){Na.fire(new Ln("pluginStateChange",{pluginStatus:an,pluginURL:Qr}))}const Na=new Zr,lu=function(){return an},nh=function(){if(an!==ou||!Qr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");an=Oa,au(),Qr&&yn({url:Qr},n=>{n?ih(n):(an=su,au())})},Nn={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>an===su||Nn.applyArabicShaping!=null,isLoading:()=>an===Oa,setState(n){if(!ni())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");an=n.pluginStatus,Qr=n.pluginURL},isParsed(){if(!ni())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Nn.applyArabicShaping!=null&&Nn.processBidirectionalText!=null&&Nn.processStyledBidirectionalText!=null},getPluginURL(){if(!ni())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Qr}};class Qt{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Jc,this.transition={})}isSupportedScript(e){return function(r,a){for(const h of r)if(!Fa(h.charCodeAt(0),a))return!1;return!0}(e,Nn.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*r}}}class Ua{constructor(e,r){this.property=e,this.value=r,this.expression=function(a,h){if(wa(a))return new Go(a,h);if(Sa(a)){const m=Tt(a,h);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=a;return h.type==="color"&&typeof a=="string"?m=ht.parse(a):h.type!=="padding"||typeof a!="number"&&!Array.isArray(a)||(m=Ui.parse(a)),{kind:"constant",evaluate:()=>m}}}(r===void 0?e.specification.default:r,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class uu{constructor(e){this.property=e,this.value=new Ua(e,void 0)}transitioned(e,r){return new Ns(this.property,this.value,r,re({},e.transition,this.transition),e.now)}untransitioned(){return new Ns(this.property,this.value,null,{},0)}}class rh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ge(this._values[e].value.value)}setValue(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new uu(this._values[e].property)),this._values[e].value=new Ua(this._values[e].property,r===null?void 0:Ge(r))}getTransition(e){return Ge(this._values[e].transition)}setTransition(e,r){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new uu(this._values[e].property)),this._values[e].transition=Ge(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const h=this.getTransition(r);h!==void 0&&(e[`${r}-transition`]=h)}return e}transitioned(e,r){const a=new oh(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,r._values[h]);return a}untransitioned(){const e=new oh(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Ns{constructor(e,r,a,h,m){this.property=e,this.value=r,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const h=e.now||0,m=this.value.possiblyEvaluate(e,r,a),y=this.prior;if(y){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return y.possiblyEvaluate(e,r,a);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,r,a),m,function(S){if(S<=0)return 0;if(S>=1)return 1;const C=S*S,I=C*S;return 4*(S<.5?I:3*(S-C)+I-.75)}(v))}}return m}}class oh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const h=new Va(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,r,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ge(this._values[e].value)}setValue(e,r){this._values[e]=new Ua(this._values[e].property,r===null?void 0:Ge(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const h=new Va(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,r,a);return h}}class fr{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,h){return this.property.evaluate(this.value,this.parameters,e,r,a,h)}}class Va{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Qe{constructor(e){this.specification=e}possiblyEvaluate(e,r){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(r)}interpolate(e,r,a){const h=_n[this.specification.type];return h?h(e,r,a):e}}class at{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,h){return new fr(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,h)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new fr(this,{kind:"constant",value:void 0},e.parameters);const h=_n[this.specification.type];if(h){const m=h(e.value.value,r.value.value,a);return new fr(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,r,a,h,m,y){return e.kind==="constant"?e.value:e.evaluate(r,a,h,m,y)}}class ja extends at{possiblyEvaluate(e,r,a,h){if(e.value===void 0)return new fr(this,{kind:"constant",value:void 0},r);if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},a,h),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,v=this._calculate(y,y,y,r);return new fr(this,{kind:"constant",value:v},r)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new fr(this,{kind:"constant",value:m},r)}return new fr(this,e.expression,r)}evaluate(e,r,a,h,m,y){if(e.kind==="source"){const v=e.evaluate(r,a,h,m,y);return this._calculate(v,v,v,r)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},a,h),e.evaluate({zoom:Math.floor(r.zoom)},a,h),e.evaluate({zoom:Math.floor(r.zoom)+1},a,h),r):e.value}_calculate(e,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class hu{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(r,null,{},a,h);return this._calculate(m,m,m,r)}return this._calculate(e.expression.evaluate(new Qt(Math.floor(r.zoom-1),r)),e.expression.evaluate(new Qt(Math.floor(r.zoom),r)),e.expression.evaluate(new Qt(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,a,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:a,to:r}}interpolate(e){return e}}class du{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,h){return!!e.expression.evaluate(r,null,{},a,h)}interpolate(){return!1}}class ln{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const a=e[r];a.specification.overridable&&this.overridableProperties.push(r);const h=this.defaultPropertyValues[r]=new Ua(a,void 0),m=this.defaultTransitionablePropertyValues[r]=new uu(a);this.defaultTransitioningPropertyValues[r]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=h.possiblyEvaluate({})}}}He("DataDrivenProperty",at),He("DataConstantProperty",Qe),He("CrossFadedDataDrivenProperty",ja),He("CrossFadedProperty",hu),He("ColorRampProperty",du);const sh="-transition";class mr extends Zr{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new cu(r.layout)),r.paint)){this._transitionablePaint=new rh(r.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Va(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,a={}){r!=null&&this._validate(up,`layers.${this.id}.layout.${e}`,e,r,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return e.endsWith(sh)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,a={}){if(r!=null&&this._validate(lp,`layers.${this.id}.paint.${e}`,e,r,a))return!1;if(e.endsWith(sh))return this._transitionablePaint.setTransition(e.slice(0,-11),r||void 0),!1;{const h=this._transitionablePaint._values[e],m=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,v,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ue(e,(r,a)=>!(r===void 0||a==="layout"&&!Object.keys(r).length||a==="paint"&&!Object.keys(r).length))}_validate(e,r,a,h,m={}){return(!m||m.validate!==!1)&&Wo(this,e.call(Jr,{key:r,layerType:this.type,objectKey:a,value:h,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof fr&&Zo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const Xo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class $a{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ui{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wi(n,e=1){let r=0,a=0;return{members:n.map(h=>{const m=Xo[h.type].BYTES_PER_ELEMENT,y=r=pu(r,Math.max(e,m)),v=h.components||1;return a=Math.max(a,m),r+=m*v,{name:h.name,type:h.type,components:v,offset:y}}),size:pu(r,Math.max(a,e)),alignment:e}}function pu(n,e){return Math.ceil(n/e)*e}class Us extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.int16[h+0]=r,this.int16[h+1]=a,e}}Us.prototype.bytesPerElement=4,He("StructArrayLayout2i4",Us);class qa extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const m=3*e;return this.int16[m+0]=r,this.int16[m+1]=a,this.int16[m+2]=h,e}}qa.prototype.bytesPerElement=6,He("StructArrayLayout3i6",qa);class gr extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,h)}emplace(e,r,a,h,m){const y=4*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=m,e}}gr.prototype.bytesPerElement=8,He("StructArrayLayout4i8",gr);class Za extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,h,m,y)}emplace(e,r,a,h,m,y,v){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=v,e}}Za.prototype.bytesPerElement=12,He("StructArrayLayout2i4i12",Za);class Vs extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,h,m,y)}emplace(e,r,a,h,m,y,v){const S=4*e,C=8*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.uint8[C+4]=h,this.uint8[C+5]=m,this.uint8[C+6]=y,this.uint8[C+7]=v,e}}Vs.prototype.bytesPerElement=8,He("StructArrayLayout2i4ub8",Vs);class Ko extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.float32[h+0]=r,this.float32[h+1]=a,e}}Ko.prototype.bytesPerElement=8,He("StructArrayLayout2f8",Ko);class js extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y,v,S,C,I){const z=this.length;return this.resize(z+1),this.emplace(z,e,r,a,h,m,y,v,S,C,I)}emplace(e,r,a,h,m,y,v,S,C,I,z){const L=10*e;return this.uint16[L+0]=r,this.uint16[L+1]=a,this.uint16[L+2]=h,this.uint16[L+3]=m,this.uint16[L+4]=y,this.uint16[L+5]=v,this.uint16[L+6]=S,this.uint16[L+7]=C,this.uint16[L+8]=I,this.uint16[L+9]=z,e}}js.prototype.bytesPerElement=20,He("StructArrayLayout10ui20",js);class fu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y,v,S,C,I,z,L){const F=this.length;return this.resize(F+1),this.emplace(F,e,r,a,h,m,y,v,S,C,I,z,L)}emplace(e,r,a,h,m,y,v,S,C,I,z,L,F){const O=12*e;return this.int16[O+0]=r,this.int16[O+1]=a,this.int16[O+2]=h,this.int16[O+3]=m,this.uint16[O+4]=y,this.uint16[O+5]=v,this.uint16[O+6]=S,this.uint16[O+7]=C,this.int16[O+8]=I,this.int16[O+9]=z,this.int16[O+10]=L,this.int16[O+11]=F,e}}fu.prototype.bytesPerElement=24,He("StructArrayLayout4i4ui4i24",fu);class Yo extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const m=3*e;return this.float32[m+0]=r,this.float32[m+1]=a,this.float32[m+2]=h,e}}Yo.prototype.bytesPerElement=12,He("StructArrayLayout3f12",Yo);class mo extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}mo.prototype.bytesPerElement=4,He("StructArrayLayout1ul4",mo);class mu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y,v,S,C){const I=this.length;return this.resize(I+1),this.emplace(I,e,r,a,h,m,y,v,S,C)}emplace(e,r,a,h,m,y,v,S,C,I){const z=10*e,L=5*e;return this.int16[z+0]=r,this.int16[z+1]=a,this.int16[z+2]=h,this.int16[z+3]=m,this.int16[z+4]=y,this.int16[z+5]=v,this.uint32[L+3]=S,this.uint16[z+8]=C,this.uint16[z+9]=I,e}}mu.prototype.bytesPerElement=20,He("StructArrayLayout6i1ul2ui20",mu);class Ga extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y){const v=this.length;return this.resize(v+1),this.emplace(v,e,r,a,h,m,y)}emplace(e,r,a,h,m,y,v){const S=6*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=h,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=v,e}}Ga.prototype.bytesPerElement=12,He("StructArrayLayout2i2i2i12",Ga);class go extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,h,m)}emplace(e,r,a,h,m,y){const v=4*e,S=8*e;return this.float32[v+0]=r,this.float32[v+1]=a,this.float32[v+2]=h,this.int16[S+6]=m,this.int16[S+7]=y,e}}go.prototype.bytesPerElement=16,He("StructArrayLayout2f1f2i16",go);class gu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,h)}emplace(e,r,a,h,m){const y=12*e,v=3*e;return this.uint8[y+0]=r,this.uint8[y+1]=a,this.float32[v+1]=h,this.float32[v+2]=m,e}}gu.prototype.bytesPerElement=12,He("StructArrayLayout2ub2f12",gu);class Ha extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const m=3*e;return this.uint16[m+0]=r,this.uint16[m+1]=a,this.uint16[m+2]=h,e}}Ha.prototype.bytesPerElement=6,He("StructArrayLayout3ui6",Ha);class Wa extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y,v,S,C,I,z,L,F,O,q,W,Y){const le=this.length;return this.resize(le+1),this.emplace(le,e,r,a,h,m,y,v,S,C,I,z,L,F,O,q,W,Y)}emplace(e,r,a,h,m,y,v,S,C,I,z,L,F,O,q,W,Y,le){const ie=24*e,de=12*e,fe=48*e;return this.int16[ie+0]=r,this.int16[ie+1]=a,this.uint16[ie+2]=h,this.uint16[ie+3]=m,this.uint32[de+2]=y,this.uint32[de+3]=v,this.uint32[de+4]=S,this.uint16[ie+10]=C,this.uint16[ie+11]=I,this.uint16[ie+12]=z,this.float32[de+7]=L,this.float32[de+8]=F,this.uint8[fe+36]=O,this.uint8[fe+37]=q,this.uint8[fe+38]=W,this.uint32[de+10]=Y,this.int16[ie+22]=le,e}}Wa.prototype.bytesPerElement=48,He("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Wa);class yu extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h,m,y,v,S,C,I,z,L,F,O,q,W,Y,le,ie,de,fe,we,qe,Xe,$e,Fe,Le,Ze){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,e,r,a,h,m,y,v,S,C,I,z,L,F,O,q,W,Y,le,ie,de,fe,we,qe,Xe,$e,Fe,Le,Ze)}emplace(e,r,a,h,m,y,v,S,C,I,z,L,F,O,q,W,Y,le,ie,de,fe,we,qe,Xe,$e,Fe,Le,Ze,Oe){const ke=34*e,rt=17*e;return this.int16[ke+0]=r,this.int16[ke+1]=a,this.int16[ke+2]=h,this.int16[ke+3]=m,this.int16[ke+4]=y,this.int16[ke+5]=v,this.int16[ke+6]=S,this.int16[ke+7]=C,this.uint16[ke+8]=I,this.uint16[ke+9]=z,this.uint16[ke+10]=L,this.uint16[ke+11]=F,this.uint16[ke+12]=O,this.uint16[ke+13]=q,this.uint16[ke+14]=W,this.uint16[ke+15]=Y,this.uint16[ke+16]=le,this.uint16[ke+17]=ie,this.uint16[ke+18]=de,this.uint16[ke+19]=fe,this.uint16[ke+20]=we,this.uint16[ke+21]=qe,this.uint16[ke+22]=Xe,this.uint32[rt+12]=$e,this.float32[rt+13]=Fe,this.float32[rt+14]=Le,this.float32[rt+15]=Ze,this.float32[rt+16]=Oe,e}}yu.prototype.bytesPerElement=68,He("StructArrayLayout8i15ui1ul4f68",yu);class Xa extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Xa.prototype.bytesPerElement=4,He("StructArrayLayout1f4",Xa);class At extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,r,a)}emplace(e,r,a,h){const m=4*e;return this.uint32[2*e+0]=r,this.uint16[m+2]=a,this.uint16[m+3]=h,e}}At.prototype.bytesPerElement=8,He("StructArrayLayout1ul2ui8",At);class p extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const h=2*e;return this.uint16[h+0]=r,this.uint16[h+1]=a,e}}p.prototype.bytesPerElement=4,He("StructArrayLayout2ui4",p);class t extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}t.prototype.bytesPerElement=2,He("StructArrayLayout1ui2",t);class s extends ui{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,a,h)}emplace(e,r,a,h,m){const y=4*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=m,e}}s.prototype.bytesPerElement=16,He("StructArrayLayout4f16",s);class c extends $a{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new te(this.anchorPointX,this.anchorPointY)}}c.prototype.size=20;class d extends mu{get(e){return new c(this,e)}}He("CollisionBoxArray",d);class f extends $a{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}f.prototype.size=48;class x extends Wa{get(e){return new f(this,e)}}He("PlacedSymbolArray",x);class w extends $a{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}w.prototype.size=68;class E extends yu{get(e){return new w(this,e)}}He("SymbolInstanceArray",E);class T extends Xa{getoffsetX(e){return this.float32[1*e+0]}}He("GlyphOffsetArray",T);class k extends qa{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}He("SymbolLineVertexArray",k);class P extends $a{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}P.prototype.size=8;class B extends At{get(e){return new P(this,e)}}He("FeatureIndexArray",B);class j extends Us{}class V extends Us{}class Z extends Us{}class $ extends Za{}class se extends Vs{}class pe extends Ko{}class H extends js{}class ce extends fu{}class me extends Yo{}class ye extends mo{}class _e extends Ga{}class Se extends gu{}class xe extends Ha{}class Re extends p{}const Ke=wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:wt}=Ke;class Me{constructor(e=[]){this.segments=e}prepareSegment(e,r,a,h){let m=this.segments[this.segments.length-1];return e>Me.MAX_VERTEX_ARRAY_LENGTH&&gt(`Max vertices per segment is ${Me.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Me.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:r.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,h){return new Me([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function ot(n,e){return 256*(n=J(Math.floor(n),0,255))+J(Math.floor(e),0,255)}Me.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,He("SegmentVector",Me);const je=wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Mt={exports:{}},kt={exports:{}};kt.exports=function(n,e){var r,a,h,m,y,v,S,C;for(a=n.length-(r=3&n.length),h=e,y=3432918353,v=461845907,C=0;C<a;)S=255&n.charCodeAt(C)|(255&n.charCodeAt(++C))<<8|(255&n.charCodeAt(++C))<<16|(255&n.charCodeAt(++C))<<24,++C,h=27492+(65535&(m=5*(65535&(h=(h^=S=(65535&(S=(S=(65535&S)*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(S=0,r){case 3:S^=(255&n.charCodeAt(C+2))<<16;case 2:S^=(255&n.charCodeAt(C+1))<<8;case 1:h^=S=(65535&(S=(S=(65535&(S^=255&n.charCodeAt(C)))*y+(((S>>>16)*y&65535)<<16)&4294967295)<<15|S>>>17))*v+(((S>>>16)*v&65535)<<16)&4294967295}return h^=n.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var St=kt.exports,ut={exports:{}};ut.exports=function(n,e){for(var r,a=n.length,h=e^a,m=0;a>=4;)r=1540483477*(65535&(r=255&n.charCodeAt(m)|(255&n.charCodeAt(++m))<<8|(255&n.charCodeAt(++m))<<16|(255&n.charCodeAt(++m))<<24))+((1540483477*(r>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:h^=(255&n.charCodeAt(m+2))<<16;case 2:h^=(255&n.charCodeAt(m+1))<<8;case 1:h=1540483477*(65535&(h^=255&n.charCodeAt(m)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var ti=St,Vi=ut.exports;Mt.exports=ti,Mt.exports.murmur3=ti,Mt.exports.murmur2=Vi;var fi=N(Mt.exports);class zi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,a,h){this.ids.push(xn(e)),this.positions.push(r,a,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=xn(e);let a=0,h=this.ids.length-1;for(;a<h;){const y=a+h>>1;this.ids[y]>=r?h=y:a=y+1}const m=[];for(;this.ids[a]===r;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(e,r){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Xn(a,h,0,a.length-1),r&&r.push(a.buffer,h.buffer),{ids:a,positions:h}}static deserialize(e){const r=new zi;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function xn(n){const e=+n;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:fi(String(n))}function Xn(n,e,r,a){for(;r<a;){const h=n[r+a>>1];let m=r-1,y=a+1;for(;;){do m++;while(n[m]<h);do y--;while(n[y]>h);if(m>=y)break;Kn(n,m,y),Kn(e,3*m,3*y),Kn(e,3*m+1,3*y+1),Kn(e,3*m+2,3*y+2)}y-r<a-y?(Xn(n,e,r,y),r=y+1):(Xn(n,e,y+1,a),a=y)}}function Kn(n,e,r){const a=n[e];n[e]=n[r],n[r]=a}He("FeaturePositionMap",zi);class Ji{constructor(e,r){this.gl=e.gl,this.location=r}}class yr extends Ji{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class $s extends Ji{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Zi extends Ji{constructor(e,r){super(e,r),this.current=ht.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Ai=new Float32Array(16);function Lt(n){return[ot(255*n.r,255*n.g),ot(255*n.b,255*n.a)]}class Ti{constructor(e,r,a){this.value=e,this.uniformNames=r.map(h=>`u_${h}`),this.type=a}setUniform(e,r,a){e.set(a.constantOr(this.value))}getBinding(e,r,a){return this.type==="color"?new Zi(e,r):new yr(e,r)}}class Li{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=e.tlbr}setUniform(e,r,a,h){const m=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,r,a){return a.substr(0,9)==="u_pattern"?new $s(e,r):new yr(e,r)}}class Rt{constructor(e,r,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,r,a,h,m){const y=this.paintVertexArray.length,v=this.expression.evaluate(new Qt(0),r,{},h,[],m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,v)}updatePaintArray(e,r,a,h){const m=this.expression.evaluate({zoom:0},a,h);this._setPaintValue(e,r,m)}_setPaintValue(e,r,a){if(this.type==="color"){const h=Lt(a);for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=e;h<r;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ci{constructor(e,r,a,h,m,y){this.expression=e,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,r,a,h,m){const y=this.expression.evaluate(new Qt(this.zoom),r,{},h,[],m),v=this.expression.evaluate(new Qt(this.zoom+1),r,{},h,[],m),S=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(S,e,y,v)}updatePaintArray(e,r,a,h){const m=this.expression.evaluate({zoom:this.zoom},a,h),y=this.expression.evaluate({zoom:this.zoom+1},a,h);this._setPaintValue(e,r,m,y)}_setPaintValue(e,r,a,h){if(this.type==="color"){const m=Lt(a),y=Lt(h);for(let v=e;v<r;v++)this.paintVertexArray.emplace(v,m[0],m[1],y[0],y[1])}else{for(let m=e;m<r;m++)this.paintVertexArray.emplace(m,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,h=J(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,r,a){return new yr(e,r)}}class wn{constructor(e,r,a,h,m,y){this.expression=e,this.type=r,this.useIntegerZoom=a,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,r,a){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,h,m){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,r,a,h){if(!h||!a)return;const{min:m,mid:y,max:v}=a,S=h[m],C=h[y],I=h[v];if(S&&C&&I)for(let z=e;z<r;z++)this.zoomInPaintVertexArray.emplace(z,C.tl[0],C.tl[1],C.br[0],C.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],C.pixelRatio,S.pixelRatio),this.zoomOutPaintVertexArray.emplace(z,C.tl[0],C.tl[1],C.br[0],C.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],C.pixelRatio,I.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,je.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,je.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ka{constructor(e,r,a){this.binders={},this._buffers=[];const h=[];for(const m in e.paint._values){if(!a(m))continue;const y=e.paint.get(m);if(!(y instanceof fr&&Zo(y.property.specification)))continue;const v=cp(m,e.type),S=y.value,C=y.property.specification.type,I=y.property.useIntegerZoom,z=y.property.specification["property-type"],L=z==="cross-faded"||z==="cross-faded-data-driven";if(S.kind==="constant")this.binders[m]=L?new Li(S.value,v):new Ti(S.value,v,C),h.push(`/u_${m}`);else if(S.kind==="source"||L){const F=ah(m,C,"source");this.binders[m]=L?new wn(S,C,I,r,F,e.id):new Rt(S,v,C,F),h.push(`/a_${m}`)}else{const F=ah(m,C,"composite");this.binders[m]=new Ci(S,v,C,I,r,F),h.push(`/z_${m}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Rt||r instanceof Ci?r.maxValue:0}populatePaintArrays(e,r,a,h,m){for(const y in this.binders){const v=this.binders[y];(v instanceof Rt||v instanceof Ci||v instanceof wn)&&v.populatePaintArray(e,r,a,h,m)}}setConstantPatternPositions(e,r){for(const a in this.binders){const h=this.binders[a];h instanceof Li&&h.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,a,h,m){let y=!1;for(const v in e){const S=r.getPositions(v);for(const C of S){const I=a.feature(C.index);for(const z in this.binders){const L=this.binders[z];if((L instanceof Rt||L instanceof Ci||L instanceof wn)&&L.expression.isStateDependent===!0){const F=h.paint.get(z);L.expression=F.value,L.updatePaintArray(C.start,C.end,I,e[v],m),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof Ti||a instanceof Li)&&e.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Rt||a instanceof Ci)for(let h=0;h<a.paintVertexAttributes.length;h++)e.push(a.paintVertexAttributes[h].name);else if(a instanceof wn)for(let h=0;h<je.members.length;h++)e.push(je.members[h].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Ti||a instanceof Li||a instanceof Ci)for(const h of a.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const a=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Ti||m instanceof Li||m instanceof Ci){for(const y of m.uniformNames)if(r[y]){const v=m.getBinding(e,r[y],y);a.push({name:y,property:h,binding:v})}}}return a}setUniforms(e,r,a,h){for(const{name:m,property:y,binding:v}of r)this.binders[y].setUniform(v,h,a.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const a=this.binders[r];if(e&&a instanceof wn){const h=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(a instanceof Rt||a instanceof Ci)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Rt||a instanceof Ci||a instanceof wn)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Rt||r instanceof Ci||r instanceof wn)&&r.destroy()}}}class Lr{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Ka(h,r,a);this.needsUpload=!1,this._featureMap=new zi,this._bufferOffset=0}populatePaintArrays(e,r,a,h,m,y){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(e,r,h,m,y);r.id!==void 0&&this._featureMap.add(r.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,h){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function cp(n,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}function ah(n,e,r){const a={color:{source:Ko,composite:s},number:{source:Xa,composite:Ko}},h=function(m){return{"line-pattern":{source:H,composite:H},"fill-pattern":{source:H,composite:H},"fill-extrusion-pattern":{source:H,composite:H}}[m]}(n);return h&&h[r]||a[e][r]}He("ConstantBinder",Ti),He("CrossFadedConstantBinder",Li),He("SourceExpressionBinder",Rt),He("CrossFadedCompositeBinder",wn),He("CompositeExpressionBinder",Ci),He("ProgramConfiguration",Ka,{omit:["_buffers"]}),He("ProgramConfigurationSet",Lr);const Kt=8192,_u=Math.pow(2,14)-1,qs=-_u-1;function Dr(n){const e=Kt/n.extent,r=n.loadGeometry();for(let a=0;a<r.length;a++){const h=r[a];for(let m=0;m<h.length;m++){const y=h[m],v=Math.round(y.x*e),S=Math.round(y.y*e);y.x=J(v,qs,_u),y.y=J(S,qs,_u),(v<y.x||v>y.x+1||S<y.y||S>y.y+1)&&gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Zs(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?Dr(n):[]}}function lh(n,e,r,a,h){n.emplaceBack(2*e+(a+1)/2,2*r+(h+1)/2)}class hp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new V,this.indexArray=new xe,this.segments=new Me,this.programConfigurations=new Lr(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){const h=this.layers[0],m=[];let y=null,v=!1;h.type==="circle"&&(y=h.layout.get("circle-sort-key"),v=!y.isConstant());for(const{feature:S,id:C,index:I,sourceLayerIndex:z}of e){const L=this.layers[0]._featureFilter.needGeometry,F=Zs(S,L);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),F,a))continue;const O=v?y.evaluate(F,{},a):void 0,q={id:C,properties:S.properties,type:S.type,sourceLayerIndex:z,index:I,geometry:L?F.geometry:Dr(S),patterns:{},sortKey:O};m.push(q)}v&&m.sort((S,C)=>S.sortKey-C.sortKey);for(const S of m){const{geometry:C,index:I,sourceLayerIndex:z}=S,L=e[I].feature;this.addFeature(S,C,I,a),r.featureIndex.insert(L,C,I,z,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,h){for(const m of r)for(const y of m){const v=y.x,S=y.y;if(v<0||v>=Kt||S<0||S>=Kt)continue;const C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),I=C.vertexLength;lh(this.layoutVertexArray,v,S,-1,-1),lh(this.layoutVertexArray,v,S,1,-1),lh(this.layoutVertexArray,v,S,1,1),lh(this.layoutVertexArray,v,S,-1,1),this.indexArray.emplaceBack(I,I+1,I+2),this.indexArray.emplaceBack(I,I+3,I+2),C.vertexLength+=4,C.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h)}}function Sg(n,e){for(let r=0;r<n.length;r++)if(Ya(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(Ya(n,e[r]))return!0;return!!dp(n,e)}function Vx(n,e,r){return!!Ya(n,e)||!!pp(e,n,r)}function Eg(n,e){if(n.length===1)return Cg(e,n[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let h=0;h<a.length;h++)if(Ya(n,a[h]))return!0}for(let r=0;r<n.length;r++)if(Cg(e,n[r]))return!0;for(let r=0;r<e.length;r++)if(dp(n,e[r]))return!0;return!1}function jx(n,e,r){if(n.length>1){if(dp(n,e))return!0;for(let a=0;a<e.length;a++)if(pp(e[a],n,r))return!0}for(let a=0;a<n.length;a++)if(pp(n[a],e,r))return!0;return!1}function dp(n,e){if(n.length===0||e.length===0)return!1;for(let r=0;r<n.length-1;r++){const a=n[r],h=n[r+1];for(let m=0;m<e.length-1;m++)if($x(a,h,e[m],e[m+1]))return!0}return!1}function $x(n,e,r,a){return Je(n,r,a)!==Je(e,r,a)&&Je(n,e,r)!==Je(n,e,a)}function pp(n,e,r){const a=r*r;if(e.length===1)return n.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(Tg(n,e[h-1],e[h])<a)return!0;return!1}function Tg(n,e,r){const a=e.distSqr(r);if(a===0)return n.distSqr(e);const h=((n.x-e.x)*(r.x-e.x)+(n.y-e.y)*(r.y-e.y))/a;return n.distSqr(h<0?e:h>1?r:r.sub(e)._mult(h)._add(e))}function Cg(n,e){let r,a,h,m=!1;for(let y=0;y<n.length;y++){r=n[y];for(let v=0,S=r.length-1;v<r.length;S=v++)a=r[v],h=r[S],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(m=!m)}return m}function Ya(n,e){let r=!1;for(let a=0,h=n.length-1;a<n.length;h=a++){const m=n[a],y=n[h];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(r=!r)}return r}function qx(n,e,r){const a=r[0],h=r[2];if(n.x<a.x&&e.x<a.x||n.x>h.x&&e.x>h.x||n.y<a.y&&e.y<a.y||n.y>h.y&&e.y>h.y)return!1;const m=Je(n,e,r[0]);return m!==Je(n,e,r[1])||m!==Je(n,e,r[2])||m!==Je(n,e,r[3])}function vu(n,e,r){const a=e.paint.get(n).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(n)}function uh(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function ch(n,e,r,a,h){if(!e[0]&&!e[1])return n;const m=te.convert(e)._mult(h);r==="viewport"&&m._rotate(-a);const y=[];for(let v=0;v<n.length;v++)y.push(n[v].sub(m));return y}let kg,Ig;He("CircleBucket",hp,{omit:["layers"]});var Zx={get paint(){return Ig=Ig||new ln({"circle-radius":new at(ge.paint_circle["circle-radius"]),"circle-color":new at(ge.paint_circle["circle-color"]),"circle-blur":new at(ge.paint_circle["circle-blur"]),"circle-opacity":new at(ge.paint_circle["circle-opacity"]),"circle-translate":new Qe(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Qe(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qe(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qe(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new at(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new at(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new at(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return kg=kg||new ln({"circle-sort-key":new at(ge.layout_circle["circle-sort-key"])})}},un=1e-6,Ja=typeof Float32Array<"u"?Float32Array:Array;function fp(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Pg(n,e,r){var a=e[0],h=e[1],m=e[2],y=e[3],v=e[4],S=e[5],C=e[6],I=e[7],z=e[8],L=e[9],F=e[10],O=e[11],q=e[12],W=e[13],Y=e[14],le=e[15],ie=r[0],de=r[1],fe=r[2],we=r[3];return n[0]=ie*a+de*v+fe*z+we*q,n[1]=ie*h+de*S+fe*L+we*W,n[2]=ie*m+de*C+fe*F+we*Y,n[3]=ie*y+de*I+fe*O+we*le,n[4]=(ie=r[4])*a+(de=r[5])*v+(fe=r[6])*z+(we=r[7])*q,n[5]=ie*h+de*S+fe*L+we*W,n[6]=ie*m+de*C+fe*F+we*Y,n[7]=ie*y+de*I+fe*O+we*le,n[8]=(ie=r[8])*a+(de=r[9])*v+(fe=r[10])*z+(we=r[11])*q,n[9]=ie*h+de*S+fe*L+we*W,n[10]=ie*m+de*C+fe*F+we*Y,n[11]=ie*y+de*I+fe*O+we*le,n[12]=(ie=r[12])*a+(de=r[13])*v+(fe=r[14])*z+(we=r[15])*q,n[13]=ie*h+de*S+fe*L+we*W,n[14]=ie*m+de*C+fe*F+we*Y,n[15]=ie*y+de*I+fe*O+we*le,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var xu,Gx=Pg;function hh(n,e,r){var a=e[0],h=e[1],m=e[2],y=e[3];return n[0]=r[0]*a+r[4]*h+r[8]*m+r[12]*y,n[1]=r[1]*a+r[5]*h+r[9]*m+r[13]*y,n[2]=r[2]*a+r[6]*h+r[10]*m+r[14]*y,n[3]=r[3]*a+r[7]*h+r[11]*m+r[15]*y,n}xu=new Ja(4),Ja!=Float32Array&&(xu[0]=0,xu[1]=0,xu[2]=0,xu[3]=0);class Hx extends mr{constructor(e){super(e,Zx)}createBucket(e){return new hp(e)}queryRadius(e){const r=e;return vu("circle-radius",this,r)+vu("circle-stroke-width",this,r)+uh(this.paint.get("circle-translate"))}queryIntersectsFeature(e,r,a,h,m,y,v,S){const C=ch(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),I=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),z=this.paint.get("circle-pitch-alignment")==="map",L=z?C:function(O,q){return O.map(W=>Mg(W,q))}(C,S),F=z?I*v:I;for(const O of h)for(const q of O){const W=z?q:Mg(q,S);let Y=F;const le=hh([],[q.x,q.y,0,1],S);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=le[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=y.cameraToCenterDistance/le[3]),Vx(L,W,Y))return!0}return!1}}function Mg(n,e){const r=hh([],[n.x,n.y,0,1],e);return new te(r[0]/r[3],r[1]/r[3])}class zg extends hp{}let Ag;He("HeatmapBucket",zg,{omit:["layers"]});var Wx={get paint(){return Ag=Ag||new ln({"heatmap-radius":new at(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new at(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qe(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new du(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qe(ge.paint_heatmap["heatmap-opacity"])})}};function mp(n,{width:e,height:r},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*r*a)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*r*a}`)}else h=new Uint8Array(e*r*a);return n.width=e,n.height=r,n.data=h,n}function Lg(n,{width:e,height:r},a){if(e===n.width&&r===n.height)return;const h=mp({},{width:e,height:r},a);gp(n,h,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,e),height:Math.min(n.height,r)},a),n.width=e,n.height=r,n.data=h.data}function gp(n,e,r,a,h,m){if(h.width===0||h.height===0)return e;if(h.width>n.width||h.height>n.height||r.x>n.width-h.width||r.y>n.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=n.data,v=e.data;if(y===v)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<h.height;S++){const C=((r.y+S)*n.width+r.x)*m,I=((a.y+S)*e.width+a.x)*m;for(let z=0;z<h.width*m;z++)v[I+z]=y[C+z]}return e}class wu{constructor(e,r){mp(this,e,1,r)}resize(e){Lg(this,e,1)}clone(){return new wu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,h,m){gp(e,r,a,h,m,1)}}class Yn{constructor(e,r){mp(this,e,4,r)}resize(e){Lg(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Yn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,h,m){gp(e,r,a,h,m,4)}}function Dg(n){const e={},r=n.resolution||256,a=n.clips?n.clips.length:1,h=n.image||new Yn({width:r,height:a});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const m=(y,v,S)=>{e[n.evaluationKey]=S;const C=n.expression.evaluate(e);h.data[y+v+0]=Math.floor(255*C.r/C.a),h.data[y+v+1]=Math.floor(255*C.g/C.a),h.data[y+v+2]=Math.floor(255*C.b/C.a),h.data[y+v+3]=Math.floor(255*C.a)};if(n.clips)for(let y=0,v=0;y<a;++y,v+=4*r)for(let S=0,C=0;S<r;S++,C+=4){const I=S/(r-1),{start:z,end:L}=n.clips[y];m(v,C,z*(1-I)+L*I)}else for(let y=0,v=0;y<r;y++,v+=4)m(0,v,y/(r-1));return h}He("AlphaImage",wu),He("RGBAImage",Yn);class Xx extends mr{createBucket(e){return new zg(e)}constructor(e){super(e,Wx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Rg;var Kx={get paint(){return Rg=Rg||new ln({"hillshade-illumination-direction":new Qe(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qe(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qe(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qe(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qe(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qe(ge.paint_hillshade["hillshade-accent-color"])})}};class Yx extends mr{constructor(e){super(e,Kx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Jx=wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qx}=Jx;var yp={exports:{}};function dh(n,e,r){r=r||2;var a,h,m,y,v,S,C,I=e&&e.length,z=I?e[0]*r:n.length,L=Bg(n,0,z,r,!0),F=[];if(!L||L.next===L.prev)return F;if(I&&(L=function(q,W,Y,le){var ie,de,fe,we=[];for(ie=0,de=W.length;ie<de;ie++)(fe=Bg(q,W[ie]*le,ie<de-1?W[ie+1]*le:q.length,le,!1))===fe.next&&(fe.steiner=!0),we.push(a1(fe));for(we.sort(r1),ie=0;ie<we.length;ie++)Y=o1(we[ie],Y);return Y}(n,e,L,r)),n.length>80*r){a=m=n[0],h=y=n[1];for(var O=r;O<z;O+=r)(v=n[O])<a&&(a=v),(S=n[O+1])<h&&(h=S),v>m&&(m=v),S>y&&(y=S);C=(C=Math.max(m-a,y-h))!==0?32767/C:0}return bu(L,F,r,a,h,C,0),F}function Bg(n,e,r,a,h){var m,y;if(h===xp(n,e,r,a)>0)for(m=e;m<r;m+=a)y=Ng(m,n[m],n[m+1],y);else for(m=r-a;m>=e;m-=a)y=Ng(m,n[m],n[m+1],y);return y&&ph(y,y.next)&&(Eu(y),y=y.next),y}function Gs(n,e){if(!n)return n;e||(e=n);var r,a=n;do if(r=!1,a.steiner||!ph(a,a.next)&&mi(a.prev,a,a.next)!==0)a=a.next;else{if(Eu(a),(a=e=a.prev)===a.next)break;r=!0}while(r||a!==e);return e}function bu(n,e,r,a,h,m,y){if(n){!y&&m&&function(I,z,L,F){var O=I;do O.z===0&&(O.z=_p(O.x,O.y,z,L,F)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==I);O.prevZ.nextZ=null,O.prevZ=null,function(q){var W,Y,le,ie,de,fe,we,qe,Xe=1;do{for(Y=q,q=null,de=null,fe=0;Y;){for(fe++,le=Y,we=0,W=0;W<Xe&&(we++,le=le.nextZ);W++);for(qe=Xe;we>0||qe>0&&le;)we!==0&&(qe===0||!le||Y.z<=le.z)?(ie=Y,Y=Y.nextZ,we--):(ie=le,le=le.nextZ,qe--),de?de.nextZ=ie:q=ie,ie.prevZ=de,de=ie;Y=le}de.nextZ=null,Xe*=2}while(fe>1)}(O)}(n,a,h,m);for(var v,S,C=n;n.prev!==n.next;)if(v=n.prev,S=n.next,m?t1(n,a,h,m):e1(n))e.push(v.i/r|0),e.push(n.i/r|0),e.push(S.i/r|0),Eu(n),n=S.next,C=S.next;else if((n=S)===C){y?y===1?bu(n=i1(Gs(n),e,r),e,r,a,h,m,2):y===2&&n1(n,e,r,a,h,m):bu(Gs(n),e,r,a,h,m,1);break}}}function e1(n){var e=n.prev,r=n,a=n.next;if(mi(e,r,a)>=0)return!1;for(var h=e.x,m=r.x,y=a.x,v=e.y,S=r.y,C=a.y,I=h<m?h<y?h:y:m<y?m:y,z=v<S?v<C?v:C:S<C?S:C,L=h>m?h>y?h:y:m>y?m:y,F=v>S?v>C?v:C:S>C?S:C,O=a.next;O!==e;){if(O.x>=I&&O.x<=L&&O.y>=z&&O.y<=F&&Qa(h,v,m,S,y,C,O.x,O.y)&&mi(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function t1(n,e,r,a){var h=n.prev,m=n,y=n.next;if(mi(h,m,y)>=0)return!1;for(var v=h.x,S=m.x,C=y.x,I=h.y,z=m.y,L=y.y,F=v<S?v<C?v:C:S<C?S:C,O=I<z?I<L?I:L:z<L?z:L,q=v>S?v>C?v:C:S>C?S:C,W=I>z?I>L?I:L:z>L?z:L,Y=_p(F,O,e,r,a),le=_p(q,W,e,r,a),ie=n.prevZ,de=n.nextZ;ie&&ie.z>=Y&&de&&de.z<=le;){if(ie.x>=F&&ie.x<=q&&ie.y>=O&&ie.y<=W&&ie!==h&&ie!==y&&Qa(v,I,S,z,C,L,ie.x,ie.y)&&mi(ie.prev,ie,ie.next)>=0||(ie=ie.prevZ,de.x>=F&&de.x<=q&&de.y>=O&&de.y<=W&&de!==h&&de!==y&&Qa(v,I,S,z,C,L,de.x,de.y)&&mi(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;ie&&ie.z>=Y;){if(ie.x>=F&&ie.x<=q&&ie.y>=O&&ie.y<=W&&ie!==h&&ie!==y&&Qa(v,I,S,z,C,L,ie.x,ie.y)&&mi(ie.prev,ie,ie.next)>=0)return!1;ie=ie.prevZ}for(;de&&de.z<=le;){if(de.x>=F&&de.x<=q&&de.y>=O&&de.y<=W&&de!==h&&de!==y&&Qa(v,I,S,z,C,L,de.x,de.y)&&mi(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function i1(n,e,r){var a=n;do{var h=a.prev,m=a.next.next;!ph(h,m)&&Fg(h,a,a.next,m)&&Su(h,m)&&Su(m,h)&&(e.push(h.i/r|0),e.push(a.i/r|0),e.push(m.i/r|0),Eu(a),Eu(a.next),a=n=m),a=a.next}while(a!==n);return Gs(a)}function n1(n,e,r,a,h,m){var y=n;do{for(var v=y.next.next;v!==y.prev;){if(y.i!==v.i&&l1(y,v)){var S=Og(y,v);return y=Gs(y,y.next),S=Gs(S,S.next),bu(y,e,r,a,h,m,0),void bu(S,e,r,a,h,m,0)}v=v.next}y=y.next}while(y!==n)}function r1(n,e){return n.x-e.x}function o1(n,e){var r=function(h,m){var y,v=m,S=h.x,C=h.y,I=-1/0;do{if(C<=v.y&&C>=v.next.y&&v.next.y!==v.y){var z=v.x+(C-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(z<=S&&z>I&&(I=z,y=v.x<v.next.x?v:v.next,z===S))return y}v=v.next}while(v!==m);if(!y)return null;var L,F=y,O=y.x,q=y.y,W=1/0;v=y;do S>=v.x&&v.x>=O&&S!==v.x&&Qa(C<q?S:I,C,O,q,C<q?I:S,C,v.x,v.y)&&(L=Math.abs(C-v.y)/(S-v.x),Su(v,h)&&(L<W||L===W&&(v.x>y.x||v.x===y.x&&s1(y,v)))&&(y=v,W=L)),v=v.next;while(v!==F);return y}(n,e);if(!r)return e;var a=Og(r,n);return Gs(a,a.next),Gs(r,r.next)}function s1(n,e){return mi(n.prev,n,e.prev)<0&&mi(e.next,n,n.next)<0}function _p(n,e,r,a,h){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a1(n){var e=n,r=n;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==n);return r}function Qa(n,e,r,a,h,m,y,v){return(h-y)*(e-v)>=(n-y)*(m-v)&&(n-y)*(a-v)>=(r-y)*(e-v)&&(r-y)*(m-v)>=(h-y)*(a-v)}function l1(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(r,a){var h=r;do{if(h.i!==r.i&&h.next.i!==r.i&&h.i!==a.i&&h.next.i!==a.i&&Fg(h,h.next,r,a))return!0;h=h.next}while(h!==r);return!1}(n,e)&&(Su(n,e)&&Su(e,n)&&function(r,a){var h=r,m=!1,y=(r.x+a.x)/2,v=(r.y+a.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&y<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==r);return m}(n,e)&&(mi(n.prev,n,e.prev)||mi(n,e.prev,e))||ph(n,e)&&mi(n.prev,n,n.next)>0&&mi(e.prev,e,e.next)>0)}function mi(n,e,r){return(e.y-n.y)*(r.x-e.x)-(e.x-n.x)*(r.y-e.y)}function ph(n,e){return n.x===e.x&&n.y===e.y}function Fg(n,e,r,a){var h=mh(mi(n,e,r)),m=mh(mi(n,e,a)),y=mh(mi(r,a,n)),v=mh(mi(r,a,e));return h!==m&&y!==v||!(h!==0||!fh(n,r,e))||!(m!==0||!fh(n,a,e))||!(y!==0||!fh(r,n,a))||!(v!==0||!fh(r,e,a))}function fh(n,e,r){return e.x<=Math.max(n.x,r.x)&&e.x>=Math.min(n.x,r.x)&&e.y<=Math.max(n.y,r.y)&&e.y>=Math.min(n.y,r.y)}function mh(n){return n>0?1:n<0?-1:0}function Su(n,e){return mi(n.prev,n,n.next)<0?mi(n,e,n.next)>=0&&mi(n,n.prev,e)>=0:mi(n,e,n.prev)<0||mi(n,n.next,e)<0}function Og(n,e){var r=new vp(n.i,n.x,n.y),a=new vp(e.i,e.x,e.y),h=n.next,m=e.prev;return n.next=e,e.prev=n,r.next=h,h.prev=r,a.next=r,r.prev=a,m.next=a,a.prev=m,a}function Ng(n,e,r,a){var h=new vp(n,e,r);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Eu(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function vp(n,e,r){this.i=n,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function xp(n,e,r,a){for(var h=0,m=e,y=r-a;m<r;m+=a)h+=(n[y]-n[m])*(n[m+1]+n[y+1]),y=m;return h}yp.exports=dh,yp.exports.default=dh,dh.deviation=function(n,e,r,a){var h=e&&e.length,m=Math.abs(xp(n,0,h?e[0]*r:n.length,r));if(h)for(var y=0,v=e.length;y<v;y++)m-=Math.abs(xp(n,e[y]*r,y<v-1?e[y+1]*r:n.length,r));var S=0;for(y=0;y<a.length;y+=3){var C=a[y]*r,I=a[y+1]*r,z=a[y+2]*r;S+=Math.abs((n[C]-n[z])*(n[I+1]-n[C+1])-(n[C]-n[I])*(n[z+1]-n[C+1]))}return m===0&&S===0?0:Math.abs((S-m)/m)},dh.flatten=function(n){for(var e=n[0][0].length,r={vertices:[],holes:[],dimensions:e},a=0,h=0;h<n.length;h++){for(var m=0;m<n[h].length;m++)for(var y=0;y<e;y++)r.vertices.push(n[h][m][y]);h>0&&r.holes.push(a+=n[h-1].length)}return r};var Ug=N(yp.exports);function u1(n,e,r,a,h){Vg(n,e,r||0,a||n.length-1,h||c1)}function Vg(n,e,r,a,h){for(;a>r;){if(a-r>600){var m=a-r+1,y=e-r+1,v=Math.log(m),S=.5*Math.exp(2*v/3),C=.5*Math.sqrt(v*S*(m-S)/m)*(y-m/2<0?-1:1);Vg(n,e,Math.max(r,Math.floor(e-y*S/m+C)),Math.min(a,Math.floor(e+(m-y)*S/m+C)),h)}var I=n[e],z=r,L=a;for(Tu(n,r,e),h(n[a],I)>0&&Tu(n,r,a);z<L;){for(Tu(n,z,L),z++,L--;h(n[z],I)<0;)z++;for(;h(n[L],I)>0;)L--}h(n[r],I)===0?Tu(n,r,L):Tu(n,++L,a),L<=e&&(r=L+1),e<=L&&(a=L-1)}}function Tu(n,e,r){var a=n[e];n[e]=n[r],n[r]=a}function c1(n,e){return n<e?-1:n>e?1:0}function wp(n,e){const r=n.length;if(r<=1)return[n];const a=[];let h,m;for(let y=0;y<r;y++){const v=qt(n[y]);v!==0&&(n[y].area=Math.abs(v),m===void 0&&(m=v<0),m===v<0?(h&&a.push(h),h=[n[y]]):h.push(n[y]))}if(h&&a.push(h),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(u1(a[y],e,1,a[y].length-1,h1),a[y]=a[y].slice(0,e));return a}function h1(n,e){return e.area-n.area}function bp(n,e,r){const a=r.patternDependencies;let h=!1;for(const m of e){const y=m.paint.get(`${n}-pattern`);y.isConstant()||(h=!0);const v=y.constantOr(null);v&&(h=!0,a[v.to]=!0,a[v.from]=!0)}return h}function Sp(n,e,r,a,h){const m=h.patternDependencies;for(const y of e){const v=y.paint.get(`${n}-pattern`).value;if(v.kind!=="constant"){let S=v.evaluate({zoom:a-1},r,{},h.availableImages),C=v.evaluate({zoom:a},r,{},h.availableImages),I=v.evaluate({zoom:a+1},r,{},h.availableImages);S=S&&S.name?S.name:S,C=C&&C.name?C.name:C,I=I&&I.name?I.name:I,m[S]=!0,m[C]=!0,m[I]=!0,r.patterns[y.id]={min:S,mid:C,max:I}}}return r}class Ep{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Z,this.indexArray=new xe,this.indexArray2=new Re,this.programConfigurations=new Lr(e.layers,e.zoom),this.segments=new Me,this.segments2=new Me,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=bp("fill",this.layers,r);const h=this.layers[0].layout.get("fill-sort-key"),m=!h.isConstant(),y=[];for(const{feature:v,id:S,index:C,sourceLayerIndex:I}of e){const z=this.layers[0]._featureFilter.needGeometry,L=Zs(v,z);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),L,a))continue;const F=m?h.evaluate(L,{},a,r.availableImages):void 0,O={id:S,properties:v.properties,type:v.type,sourceLayerIndex:I,index:C,geometry:z?L.geometry:Dr(v),patterns:{},sortKey:F};y.push(O)}m&&y.sort((v,S)=>v.sortKey-S.sortKey);for(const v of y){const{geometry:S,index:C,sourceLayerIndex:I}=v;if(this.hasPattern){const z=Sp("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(v,S,C,a,{});r.featureIndex.insert(e[C].feature,S,C,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qx),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,a,h,m){for(const y of wp(r,500)){let v=0;for(const F of y)v+=F.length;const S=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),C=S.vertexLength,I=[],z=[];for(const F of y){if(F.length===0)continue;F!==y[0]&&z.push(I.length/2);const O=this.segments2.prepareSegment(F.length,this.layoutVertexArray,this.indexArray2),q=O.vertexLength;this.layoutVertexArray.emplaceBack(F[0].x,F[0].y),this.indexArray2.emplaceBack(q+F.length-1,q),I.push(F[0].x),I.push(F[0].y);for(let W=1;W<F.length;W++)this.layoutVertexArray.emplaceBack(F[W].x,F[W].y),this.indexArray2.emplaceBack(q+W-1,q+W),I.push(F[W].x),I.push(F[W].y);O.vertexLength+=F.length,O.primitiveLength+=F.length}const L=Ug(I,z);for(let F=0;F<L.length;F+=3)this.indexArray.emplaceBack(C+L[F],C+L[F+1],C+L[F+2]);S.vertexLength+=v,S.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,h)}}let jg,$g;He("FillBucket",Ep,{omit:["layers","patternFeatures"]});var d1={get paint(){return $g=$g||new ln({"fill-antialias":new Qe(ge.paint_fill["fill-antialias"]),"fill-opacity":new at(ge.paint_fill["fill-opacity"]),"fill-color":new at(ge.paint_fill["fill-color"]),"fill-outline-color":new at(ge.paint_fill["fill-outline-color"]),"fill-translate":new Qe(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Qe(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new ja(ge.paint_fill["fill-pattern"])})},get layout(){return jg=jg||new ln({"fill-sort-key":new at(ge.layout_fill["fill-sort-key"])})}};class p1 extends mr{constructor(e){super(e,d1)}recalculate(e,r){super.recalculate(e,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new Ep(e)}queryRadius(){return uh(this.paint.get("fill-translate"))}queryIntersectsFeature(e,r,a,h,m,y,v){return Eg(ch(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),h)}isTileClipped(){return!0}}const f1=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),m1=wi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:g1}=f1;var Jo={},y1=D,qg=el;function el(n,e,r,a,h){this.properties={},this.extent=r,this.type=0,this._pbf=n,this._geometry=-1,this._keys=a,this._values=h,n.readFields(_1,this,e)}function _1(n,e,r){n==1?e.id=r.readVarint():n==2?function(a,h){for(var m=a.readVarint()+a.pos;a.pos<m;){var y=h._keys[a.readVarint()],v=h._values[a.readVarint()];h.properties[y]=v}}(r,e):n==3?e.type=r.readVarint():n==4&&(e._geometry=r.pos)}function v1(n){for(var e,r,a=0,h=0,m=n.length,y=m-1;h<m;y=h++)a+=((r=n[y]).x-(e=n[h]).x)*(e.y+r.y);return a}el.types=["Unknown","Point","LineString","Polygon"],el.prototype.loadGeometry=function(){var n=this._pbf;n.pos=this._geometry;for(var e,r=n.readVarint()+n.pos,a=1,h=0,m=0,y=0,v=[];n.pos<r;){if(h<=0){var S=n.readVarint();a=7&S,h=S>>3}if(h--,a===1||a===2)m+=n.readSVarint(),y+=n.readSVarint(),a===1&&(e&&v.push(e),e=[]),e.push(new y1(m,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&v.push(e),v},el.prototype.bbox=function(){var n=this._pbf;n.pos=this._geometry;for(var e=n.readVarint()+n.pos,r=1,a=0,h=0,m=0,y=1/0,v=-1/0,S=1/0,C=-1/0;n.pos<e;){if(a<=0){var I=n.readVarint();r=7&I,a=I>>3}if(a--,r===1||r===2)(h+=n.readSVarint())<y&&(y=h),h>v&&(v=h),(m+=n.readSVarint())<S&&(S=m),m>C&&(C=m);else if(r!==7)throw new Error("unknown command "+r)}return[y,S,v,C]},el.prototype.toGeoJSON=function(n,e,r){var a,h,m=this.extent*Math.pow(2,r),y=this.extent*n,v=this.extent*e,S=this.loadGeometry(),C=el.types[this.type];function I(F){for(var O=0;O<F.length;O++){var q=F[O];F[O]=[360*(q.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(q.y+v)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(a=0;a<S.length;a++)z[a]=S[a][0];I(S=z);break;case 2:for(a=0;a<S.length;a++)I(S[a]);break;case 3:for(S=function(F){var O=F.length;if(O<=1)return[F];for(var q,W,Y=[],le=0;le<O;le++){var ie=v1(F[le]);ie!==0&&(W===void 0&&(W=ie<0),W===ie<0?(q&&Y.push(q),q=[F[le]]):q.push(F[le]))}return q&&Y.push(q),Y}(S),a=0;a<S.length;a++)for(h=0;h<S[a].length;h++)I(S[a][h])}S.length===1?S=S[0]:C="Multi"+C;var L={type:"Feature",geometry:{type:C,coordinates:S},properties:this.properties};return"id"in this&&(L.id=this.id),L};var x1=qg,Zg=Gg;function Gg(n,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=n,this._keys=[],this._values=[],this._features=[],n.readFields(w1,this,e),this.length=this._features.length}function w1(n,e,r){n===15?e.version=r.readVarint():n===1?e.name=r.readString():n===5?e.extent=r.readVarint():n===2?e._features.push(r.pos):n===3?e._keys.push(r.readString()):n===4&&e._values.push(function(a){for(var h=null,m=a.readVarint()+a.pos;a.pos<m;){var y=a.readVarint()>>3;h=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return h}(r))}Gg.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[n];var e=this._pbf.readVarint()+this._pbf.pos;return new x1(this._pbf,e,this.extent,this._keys,this._values)};var b1=Zg;function S1(n,e,r){if(n===3){var a=new b1(r,r.readVarint()+r.pos);a.length&&(e[a.name]=a)}}Jo.VectorTile=function(n,e){this.layers=n.readFields(S1,{},e)},Jo.VectorTileFeature=qg,Jo.VectorTileLayer=Zg;const E1=Jo.VectorTileFeature.types,Tp=Math.pow(2,13);function Cu(n,e,r,a,h,m,y,v){n.emplaceBack(e,r,2*Math.floor(a*Tp)+y,h*Tp*2,m*Tp*2,Math.round(v))}class Cp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new $,this.centroidVertexArray=new j,this.indexArray=new xe,this.programConfigurations=new Lr(e.layers,e.zoom),this.segments=new Me,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.features=[],this.hasPattern=bp("fill-extrusion",this.layers,r);for(const{feature:h,id:m,index:y,sourceLayerIndex:v}of e){const S=this.layers[0]._featureFilter.needGeometry,C=Zs(h,S);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),C,a))continue;const I={id:m,sourceLayerIndex:v,index:y,geometry:S?C.geometry:Dr(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(Sp("fill-extrusion",this.layers,I,this.zoom,r)):this.addFeature(I,I.geometry,y,a,{}),r.featureIndex.insert(h,I.geometry,y,v,this.index,!0)}}addFeatures(e,r,a){for(const h of this.features){const{geometry:m}=h;this.addFeature(h,m,h.index,r,a)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,g1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,m1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,r,a,h,m){const y={x:0,y:0,vertexCount:0};for(const v of wp(r,500)){let S=0;for(const O of v)S+=O.length;let C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const O of v){if(O.length===0||C1(O))continue;let q=0;for(let W=0;W<O.length;W++){const Y=O[W];if(W>=1){const le=O[W-1];if(!T1(Y,le)){C.vertexLength+4>Me.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ie=Y.sub(le)._perp()._unit(),de=le.dist(Y);q+de>32768&&(q=0),Cu(this.layoutVertexArray,Y.x,Y.y,ie.x,ie.y,0,0,q),Cu(this.layoutVertexArray,Y.x,Y.y,ie.x,ie.y,0,1,q),y.x+=2*Y.x,y.y+=2*Y.y,y.vertexCount+=2,q+=de,Cu(this.layoutVertexArray,le.x,le.y,ie.x,ie.y,0,0,q),Cu(this.layoutVertexArray,le.x,le.y,ie.x,ie.y,0,1,q),y.x+=2*le.x,y.y+=2*le.y,y.vertexCount+=2;const fe=C.vertexLength;this.indexArray.emplaceBack(fe,fe+2,fe+1),this.indexArray.emplaceBack(fe+1,fe+2,fe+3),C.vertexLength+=4,C.primitiveLength+=2}}}}if(C.vertexLength+S>Me.MAX_VERTEX_ARRAY_LENGTH&&(C=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray)),E1[e.type]!=="Polygon")continue;const I=[],z=[],L=C.vertexLength;for(const O of v)if(O.length!==0){O!==v[0]&&z.push(I.length/2);for(let q=0;q<O.length;q++){const W=O[q];Cu(this.layoutVertexArray,W.x,W.y,0,0,1,1,0),y.x+=W.x,y.y+=W.y,y.vertexCount+=1,I.push(W.x),I.push(W.y)}}const F=Ug(I,z);for(let O=0;O<F.length;O+=3)this.indexArray.emplaceBack(L+F[O],L+F[O+2],L+F[O+1]);C.primitiveLength+=F.length/3,C.vertexLength+=S}for(let v=0;v<y.vertexCount;v++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,h)}}function T1(n,e){return n.x===e.x&&(n.x<0||n.x>Kt)||n.y===e.y&&(n.y<0||n.y>Kt)}function C1(n){return n.every(e=>e.x<0)||n.every(e=>e.x>Kt)||n.every(e=>e.y<0)||n.every(e=>e.y>Kt)}let Hg;He("FillExtrusionBucket",Cp,{omit:["layers","features"]});var k1={get paint(){return Hg=Hg||new ln({"fill-extrusion-opacity":new Qe(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new at(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qe(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qe(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ja(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new at(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new at(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qe(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class I1 extends mr{constructor(e){super(e,k1)}createBucket(e){return new Cp(e)}queryRadius(){return uh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(e,r,a,h,m,y,v,S){const C=ch(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),I=this.paint.get("fill-extrusion-height").evaluate(r,a),z=this.paint.get("fill-extrusion-base").evaluate(r,a),L=function(O,q,W,Y){const le=[];for(const ie of O){const de=[ie.x,ie.y,0,1];hh(de,de,q),le.push(new te(de[0]/de[3],de[1]/de[3]))}return le}(C,S),F=function(O,q,W,Y){const le=[],ie=[],de=Y[8]*q,fe=Y[9]*q,we=Y[10]*q,qe=Y[11]*q,Xe=Y[8]*W,$e=Y[9]*W,Fe=Y[10]*W,Le=Y[11]*W;for(const Ze of O){const Oe=[],ke=[];for(const rt of Ze){const et=rt.x,bt=rt.y,Yt=Y[0]*et+Y[4]*bt+Y[12],ei=Y[1]*et+Y[5]*bt+Y[13],ki=Y[2]*et+Y[6]*bt+Y[14],Un=Y[3]*et+Y[7]*bt+Y[15],cn=ki+we,ci=Un+qe,Ri=Yt+Xe,Gi=ei+$e,Sn=ki+Fe,hn=Un+Le,bi=new te((Yt+de)/ci,(ei+fe)/ci);bi.z=cn/ci,Oe.push(bi);const Ii=new te(Ri/hn,Gi/hn);Ii.z=Sn/hn,ke.push(Ii)}le.push(Oe),ie.push(ke)}return[le,ie]}(h,z,I,S);return function(O,q,W){let Y=1/0;Eg(W,q)&&(Y=Wg(W,q[0]));for(let le=0;le<q.length;le++){const ie=q[le],de=O[le];for(let fe=0;fe<ie.length-1;fe++){const we=ie[fe],qe=[we,ie[fe+1],de[fe+1],de[fe],we];Sg(W,qe)&&(Y=Math.min(Y,Wg(W,qe)))}}return Y!==1/0&&Y}(F[0],F[1],L)}}function ku(n,e){return n.x*e.x+n.y*e.y}function Wg(n,e){if(n.length===1){let r=0;const a=e[r++];let h;for(;!h||a.equals(h);)if(h=e[r++],!h)return 1/0;for(;r<e.length;r++){const m=e[r],y=n[0],v=h.sub(a),S=m.sub(a),C=y.sub(a),I=ku(v,v),z=ku(v,S),L=ku(S,S),F=ku(C,v),O=ku(C,S),q=I*L-z*z,W=(L*F-z*O)/q,Y=(I*O-z*F)/q,le=a.z*(1-W-Y)+h.z*W+m.z*Y;if(isFinite(le))return le}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}const P1=wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:M1}=P1,z1=wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:A1}=z1,L1=Jo.VectorTileFeature.types,D1=Math.cos(Math.PI/180*37.5),Xg=Math.pow(2,14)/.5;class kp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new se,this.layoutVertexArray2=new pe,this.indexArray=new xe,this.programConfigurations=new Lr(e.layers,e.zoom),this.segments=new Me,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,a){this.hasPattern=bp("line",this.layers,r);const h=this.layers[0].layout.get("line-sort-key"),m=!h.isConstant(),y=[];for(const{feature:v,id:S,index:C,sourceLayerIndex:I}of e){const z=this.layers[0]._featureFilter.needGeometry,L=Zs(v,z);if(!this.layers[0]._featureFilter.filter(new Qt(this.zoom),L,a))continue;const F=m?h.evaluate(L,{},a):void 0,O={id:S,properties:v.properties,type:v.type,sourceLayerIndex:I,index:C,geometry:z?L.geometry:Dr(v),patterns:{},sortKey:F};y.push(O)}m&&y.sort((v,S)=>v.sortKey-S.sortKey);for(const v of y){const{geometry:S,index:C,sourceLayerIndex:I}=v;if(this.hasPattern){const z=Sp("line",this.layers,v,this.zoom,r);this.patternFeatures.push(z)}else this.addFeature(v,S,C,a,{});r.featureIndex.insert(e[C].feature,S,C,I,this.index)}}update(e,r,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,a)}addFeatures(e,r,a){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,r,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,A1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,M1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,h,m){const y=this.layers[0].layout,v=y.get("line-join").evaluate(e,{}),S=y.get("line-cap"),C=y.get("line-miter-limit"),I=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const z of r)this.addLine(z,e,v,S,C,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,h)}addLine(e,r,a,h,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Y=0;Y<e.length-1;Y++)this.totalDistance+=e[Y].dist(e[Y+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=L1[r.type]==="Polygon";let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let C=0;for(;C<S-1&&e[C].equals(e[C+1]);)C++;if(S<(v?3:2))return;a==="bevel"&&(m=1.05);const I=this.overscaling<=16?15*Kt/(512*this.overscaling):0,z=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let L,F,O,q,W;this.e1=this.e2=-1,v&&(L=e[S-2],W=e[C].sub(L)._unit()._perp());for(let Y=C;Y<S;Y++){if(O=Y===S-1?v?e[C+1]:void 0:e[Y+1],O&&e[Y].equals(O))continue;W&&(q=W),L&&(F=L),L=e[Y],W=O?O.sub(L)._unit()._perp():q,q=q||W;let le=q.add(W);le.x===0&&le.y===0||le._unit();const ie=q.x*W.x+q.y*W.y,de=le.x*W.x+le.y*W.y,fe=de!==0?1/de:1/0,we=2*Math.sqrt(2-2*de),qe=de<D1&&F&&O,Xe=q.x*W.y-q.y*W.x>0;if(qe&&Y>C){const Le=L.dist(F);if(Le>2*I){const Ze=L.sub(L.sub(F)._mult(I/Le)._round());this.updateDistance(F,Ze),this.addCurrentVertex(Ze,q,0,0,z),F=Ze}}const $e=F&&O;let Fe=$e?a:v?"butt":h;if($e&&Fe==="round"&&(fe<y?Fe="miter":fe<=2&&(Fe="fakeround")),Fe==="miter"&&fe>m&&(Fe="bevel"),Fe==="bevel"&&(fe>2&&(Fe="flipbevel"),fe<m&&(Fe="miter")),F&&this.updateDistance(F,L),Fe==="miter")le._mult(fe),this.addCurrentVertex(L,le,0,0,z);else if(Fe==="flipbevel"){if(fe>100)le=W.mult(-1);else{const Le=fe*q.add(W).mag()/q.sub(W).mag();le._perp()._mult(Le*(Xe?-1:1))}this.addCurrentVertex(L,le,0,0,z),this.addCurrentVertex(L,le.mult(-1),0,0,z)}else if(Fe==="bevel"||Fe==="fakeround"){const Le=-Math.sqrt(fe*fe-1),Ze=Xe?Le:0,Oe=Xe?0:Le;if(F&&this.addCurrentVertex(L,q,Ze,Oe,z),Fe==="fakeround"){const ke=Math.round(180*we/Math.PI/20);for(let rt=1;rt<ke;rt++){let et=rt/ke;if(et!==.5){const Yt=et-.5;et+=et*Yt*(et-1)*((1.0904+ie*(ie*(3.55645-1.43519*ie)-3.2452))*Yt*Yt+(.848013+ie*(.215638*ie-1.06021)))}const bt=W.sub(q)._mult(et)._add(q)._unit()._mult(Xe?-1:1);this.addHalfVertex(L,bt.x,bt.y,!1,Xe,0,z)}}O&&this.addCurrentVertex(L,W,-Ze,-Oe,z)}else if(Fe==="butt")this.addCurrentVertex(L,le,0,0,z);else if(Fe==="square"){const Le=F?1:-1;this.addCurrentVertex(L,le,Le,Le,z)}else Fe==="round"&&(F&&(this.addCurrentVertex(L,q,0,0,z),this.addCurrentVertex(L,q,1,1,z,!0)),O&&(this.addCurrentVertex(L,W,-1,-1,z,!0),this.addCurrentVertex(L,W,0,0,z)));if(qe&&Y<S-1){const Le=L.dist(O);if(Le>2*I){const Ze=L.add(O.sub(L)._mult(I/Le)._round());this.updateDistance(L,Ze),this.addCurrentVertex(Ze,W,0,0,z),L=Ze}}}}addCurrentVertex(e,r,a,h,m,y=!1){const v=r.y*h-r.x,S=-r.y-r.x*h;this.addHalfVertex(e,r.x+r.y*a,r.y-r.x*a,y,!1,a,m),this.addHalfVertex(e,v,S,y,!0,-h,m),this.distance>Xg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,r,a,h,m,y))}addHalfVertex({x:e,y:r},a,h,m,y,v,S){const C=.5*(this.lineClips?this.scaledDistance*(Xg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(r<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const I=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),S.primitiveLength++),y?this.e2=I:this.e1=I}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}let Kg,Yg;He("LineBucket",kp,{omit:["layers","patternFeatures"]});var Jg={get paint(){return Yg=Yg||new ln({"line-opacity":new at(ge.paint_line["line-opacity"]),"line-color":new at(ge.paint_line["line-color"]),"line-translate":new Qe(ge.paint_line["line-translate"]),"line-translate-anchor":new Qe(ge.paint_line["line-translate-anchor"]),"line-width":new at(ge.paint_line["line-width"]),"line-gap-width":new at(ge.paint_line["line-gap-width"]),"line-offset":new at(ge.paint_line["line-offset"]),"line-blur":new at(ge.paint_line["line-blur"]),"line-dasharray":new hu(ge.paint_line["line-dasharray"]),"line-pattern":new ja(ge.paint_line["line-pattern"]),"line-gradient":new du(ge.paint_line["line-gradient"])})},get layout(){return Kg=Kg||new ln({"line-cap":new Qe(ge.layout_line["line-cap"]),"line-join":new at(ge.layout_line["line-join"]),"line-miter-limit":new Qe(ge.layout_line["line-miter-limit"]),"line-round-limit":new Qe(ge.layout_line["line-round-limit"]),"line-sort-key":new at(ge.layout_line["line-sort-key"])})}};class R1 extends at{possiblyEvaluate(e,r){return r=new Qt(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,h){return r=re({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,h)}}let gh;class B1 extends mr{constructor(e){super(e,Jg),this.gradientVersion=0,gh||(gh=new R1(Jg.paint.properties["line-width"].specification),gh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){e==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ks,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,r){super.recalculate(e,r),this.paint._values["line-floorwidth"]=gh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new kp(e)}queryRadius(e){const r=e,a=Qg(vu("line-width",this,r),vu("line-gap-width",this,r)),h=vu("line-offset",this,r);return a/2+Math.abs(h)+uh(this.paint.get("line-translate"))}queryIntersectsFeature(e,r,a,h,m,y,v){const S=ch(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),C=v/2*Qg(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),I=this.paint.get("line-offset").evaluate(r,a);return I&&(h=function(z,L){const F=[];for(let O=0;O<z.length;O++){const q=z[O],W=[];for(let Y=0;Y<q.length;Y++){const le=q[Y-1],ie=q[Y],de=q[Y+1],fe=Y===0?new te(0,0):ie.sub(le)._unit()._perp(),we=Y===q.length-1?new te(0,0):de.sub(ie)._unit()._perp(),qe=fe._add(we)._unit(),Xe=qe.x*we.x+qe.y*we.y;Xe!==0&&qe._mult(1/Xe),W.push(qe._mult(L)._add(ie))}F.push(W)}return F}(h,I*v)),function(z,L,F){for(let O=0;O<L.length;O++){const q=L[O];if(z.length>=3){for(let W=0;W<q.length;W++)if(Ya(z,q[W]))return!0}if(jx(z,q,F))return!0}return!1}(S,h,C)}isTileClipped(){return!0}}function Qg(n,e){return e>0?e+2*n:n}const F1=wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),O1=wi([{name:"a_projected_pos",components:3,type:"Float32"}],4);wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const N1=wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ey=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),U1=wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function V1(n,e,r){return n.sections.forEach(a=>{a.text=function(h,m,y){const v=m.layout.get("text-transform").evaluate(y,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),Nn.applyArabicShaping&&(h=Nn.applyArabicShaping(h)),h}(a.text,e,r)}),n}wi([{name:"triangle",components:3,type:"Uint16"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),wi([{type:"Float32",name:"offsetX"}]),wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Iu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Di=24,ty=$t,iy=function(n,e,r,a,h){var m,y,v=8*h-a-1,S=(1<<v)-1,C=S>>1,I=-7,z=r?h-1:0,L=r?-1:1,F=n[e+z];for(z+=L,m=F&(1<<-I)-1,F>>=-I,I+=v;I>0;m=256*m+n[e+z],z+=L,I-=8);for(y=m&(1<<-I)-1,m>>=-I,I+=a;I>0;y=256*y+n[e+z],z+=L,I-=8);if(m===0)m=1-C;else{if(m===S)return y?NaN:1/0*(F?-1:1);y+=Math.pow(2,a),m-=C}return(F?-1:1)*y*Math.pow(2,m-a)},ny=function(n,e,r,a,h,m){var y,v,S,C=8*m-h-1,I=(1<<C)-1,z=I>>1,L=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,F=a?0:m-1,O=a?1:-1,q=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(v=isNaN(e)?1:0,y=I):(y=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-y))<1&&(y--,S*=2),(e+=y+z>=1?L/S:L*Math.pow(2,1-z))*S>=2&&(y++,S/=2),y+z>=I?(v=0,y=I):y+z>=1?(v=(e*S-1)*Math.pow(2,h),y+=z):(v=e*Math.pow(2,z-1)*Math.pow(2,h),y=0));h>=8;n[r+F]=255&v,F+=O,v/=256,h-=8);for(y=y<<h|v,C+=h;C>0;n[r+F]=255&y,F+=O,y/=256,C-=8);n[r+F-O]|=128*q};function $t(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}$t.Varint=0,$t.Fixed64=1,$t.Bytes=2,$t.Fixed32=5;var Ip=4294967296,ry=1/Ip,oy=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function yo(n){return n.type===$t.Bytes?n.readVarint()+n.pos:n.pos+1}function tl(n,e,r){return r?4294967296*e+(n>>>0):4294967296*(e>>>0)+(n>>>0)}function sy(n,e,r){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(a);for(var h=r.pos-1;h>=n;h--)r.buf[h+a]=r.buf[h]}function j1(n,e){for(var r=0;r<n.length;r++)e.writeVarint(n[r])}function $1(n,e){for(var r=0;r<n.length;r++)e.writeSVarint(n[r])}function q1(n,e){for(var r=0;r<n.length;r++)e.writeFloat(n[r])}function Z1(n,e){for(var r=0;r<n.length;r++)e.writeDouble(n[r])}function G1(n,e){for(var r=0;r<n.length;r++)e.writeBoolean(n[r])}function H1(n,e){for(var r=0;r<n.length;r++)e.writeFixed32(n[r])}function W1(n,e){for(var r=0;r<n.length;r++)e.writeSFixed32(n[r])}function X1(n,e){for(var r=0;r<n.length;r++)e.writeFixed64(n[r])}function K1(n,e){for(var r=0;r<n.length;r++)e.writeSFixed64(n[r])}function yh(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+16777216*n[e+3]}function il(n,e,r){n[r]=e,n[r+1]=e>>>8,n[r+2]=e>>>16,n[r+3]=e>>>24}function ay(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}$t.prototype={destroy:function(){this.buf=null},readFields:function(n,e,r){for(r=r||this.length;this.pos<r;){var a=this.readVarint(),h=a>>3,m=this.pos;this.type=7&a,n(h,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=yh(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=ay(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=yh(this.buf,this.pos)+yh(this.buf,this.pos+4)*Ip;return this.pos+=8,n},readSFixed64:function(){var n=yh(this.buf,this.pos)+ay(this.buf,this.pos+4)*Ip;return this.pos+=8,n},readFloat:function(){var n=iy(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=iy(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e,r,a=this.buf;return e=127&(r=a[this.pos++]),r<128?e:(e|=(127&(r=a[this.pos++]))<<7,r<128?e:(e|=(127&(r=a[this.pos++]))<<14,r<128?e:(e|=(127&(r=a[this.pos++]))<<21,r<128?e:function(h,m,y){var v,S,C=y.buf;if(v=(112&(S=C[y.pos++]))>>4,S<128||(v|=(127&(S=C[y.pos++]))<<3,S<128)||(v|=(127&(S=C[y.pos++]))<<10,S<128)||(v|=(127&(S=C[y.pos++]))<<17,S<128)||(v|=(127&(S=C[y.pos++]))<<24,S<128)||(v|=(1&(S=C[y.pos++]))<<31,S<128))return tl(h,v,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=a[this.pos]))<<28,n,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=12&&oy?function(r,a,h){return oy.decode(r.subarray(a,h))}(this.buf,e,n):function(r,a,h){for(var m="",y=a;y<h;){var v,S,C,I=r[y],z=null,L=I>239?4:I>223?3:I>191?2:1;if(y+L>h)break;L===1?I<128&&(z=I):L===2?(192&(v=r[y+1]))==128&&(z=(31&I)<<6|63&v)<=127&&(z=null):L===3?(S=r[y+2],(192&(v=r[y+1]))==128&&(192&S)==128&&((z=(15&I)<<12|(63&v)<<6|63&S)<=2047||z>=55296&&z<=57343)&&(z=null)):L===4&&(S=r[y+2],C=r[y+3],(192&(v=r[y+1]))==128&&(192&S)==128&&(192&C)==128&&((z=(15&I)<<18|(63&v)<<12|(63&S)<<6|63&C)<=65535||z>=1114112)&&(z=null)),z===null?(z=65533,L=1):z>65535&&(z-=65536,m+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),m+=String.fromCharCode(z),y+=L}return m}(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==$t.Bytes)return n.push(this.readVarint(e));var r=yo(this);for(n=n||[];this.pos<r;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==$t.Bytes)return n.push(this.readSVarint());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==$t.Bytes)return n.push(this.readBoolean());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==$t.Bytes)return n.push(this.readFloat());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==$t.Bytes)return n.push(this.readDouble());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==$t.Bytes)return n.push(this.readFixed32());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==$t.Bytes)return n.push(this.readSFixed32());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==$t.Bytes)return n.push(this.readFixed64());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==$t.Bytes)return n.push(this.readSFixed64());var e=yo(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=7&n;if(e===$t.Varint)for(;this.buf[this.pos++]>127;);else if(e===$t.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$t.Fixed32)this.pos+=4;else{if(e!==$t.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),il(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),il(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),il(this.buf,-1&n,this.pos),il(this.buf,Math.floor(n*ry),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),il(this.buf,-1&n,this.pos),il(this.buf,Math.floor(n*ry),this.pos+4),this.pos+=8},writeVarint:function(n){(n=+n||0)>268435455||n<0?function(e,r){var a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(m,y,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)}(a,0,r),function(m,y){var v=(7&m)<<4;y.buf[y.pos++]|=v|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(h,r)}(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(4*n.length),this.pos++;var e=this.pos;this.pos=function(a,h,m){for(var y,v,S=0;S<h.length;S++){if((y=h.charCodeAt(S))>55295&&y<57344){if(!v){y>56319||S+1===h.length?(a[m++]=239,a[m++]=191,a[m++]=189):v=y;continue}if(y<56320){a[m++]=239,a[m++]=191,a[m++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(a[m++]=239,a[m++]=191,a[m++]=189,v=null);y<128?a[m++]=y:(y<2048?a[m++]=y>>6|192:(y<65536?a[m++]=y>>12|224:(a[m++]=y>>18|240,a[m++]=y>>12&63|128),a[m++]=y>>6&63|128),a[m++]=63&y|128)}return m}(this.buf,n,this.pos);var r=this.pos-e;r>=128&&sy(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(n){this.realloc(4),ny(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),ny(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=n[r]},writeRawMessage:function(n,e){this.pos++;var r=this.pos;n(e,this);var a=this.pos-r;a>=128&&sy(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeMessage:function(n,e,r){this.writeTag(n,$t.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,j1,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,$1,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,G1,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,q1,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,Z1,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,H1,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,W1,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,X1,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,K1,e)},writeBytesField:function(n,e){this.writeTag(n,$t.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,$t.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,$t.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,$t.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,$t.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,$t.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,$t.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,$t.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,$t.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,$t.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};var Pp=N(ty);const Mp=3;function Y1(n,e,r){n===1&&r.readMessage(J1,e)}function J1(n,e,r){if(n===3){const{id:a,bitmap:h,width:m,height:y,left:v,top:S,advance:C}=r.readMessage(Q1,{});e.push({id:a,bitmap:new wu({width:m+2*Mp,height:y+2*Mp},h),metrics:{width:m,height:y,left:v,top:S,advance:C}})}}function Q1(n,e,r){n===1?e.id=r.readVarint():n===2?e.bitmap=r.readBytes():n===3?e.width=r.readVarint():n===4?e.height=r.readVarint():n===5?e.left=r.readSVarint():n===6?e.top=r.readSVarint():n===7&&(e.advance=r.readVarint())}const ly=Mp;function uy(n){let e=0,r=0;for(const y of n)e+=y.w*y.h,r=Math.max(r,y.w);n.sort((y,v)=>v.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let h=0,m=0;for(const y of n)for(let v=a.length-1;v>=0;v--){const S=a[v];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,m=Math.max(m,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===S.w&&y.h===S.h){const C=a.pop();v<a.length&&(a[v]=C)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(a.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}const bn=1;class zp{constructor(e,{pixelRatio:r,version:a,stretchX:h,stretchY:m,content:y}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=h,this.stretchY=m,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+bn,this.paddedRect.y+bn]}get br(){return[this.paddedRect.x+this.paddedRect.w-bn,this.paddedRect.y+this.paddedRect.h-bn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*bn)/this.pixelRatio,(this.paddedRect.h-2*bn)/this.pixelRatio]}}class cy{constructor(e,r){const a={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,a,m),this.addImages(r,h,m);const{w:y,h:v}=uy(m),S=new Yn({width:y||1,height:v||1});for(const C in e){const I=e[C],z=a[C].paddedRect;Yn.copy(I.data,S,{x:0,y:0},{x:z.x+bn,y:z.y+bn},I.data)}for(const C in r){const I=r[C],z=h[C].paddedRect,L=z.x+bn,F=z.y+bn,O=I.data.width,q=I.data.height;Yn.copy(I.data,S,{x:0,y:0},{x:L,y:F},I.data),Yn.copy(I.data,S,{x:0,y:q-1},{x:L,y:F-1},{width:O,height:1}),Yn.copy(I.data,S,{x:0,y:0},{x:L,y:F+q},{width:O,height:1}),Yn.copy(I.data,S,{x:O-1,y:0},{x:L-1,y:F},{width:1,height:q}),Yn.copy(I.data,S,{x:0,y:0},{x:L+O,y:F},{width:1,height:q})}this.image=S,this.iconPositions=a,this.patternPositions=h}addImages(e,r,a){for(const h in e){const m=e[h],y={x:0,y:0,w:m.data.width+2*bn,h:m.data.height+2*bn};a.push(y),r[h]=new zp(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),r),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),r)}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[h,m]=e.tl;a.update(r.data,void 0,{x:h,y:m})}}var Qo;He("ImagePosition",zp),He("ImageAtlas",cy),l.WritingMode=void 0,(Qo=l.WritingMode||(l.WritingMode={}))[Qo.none=0]="none",Qo[Qo.horizontal=1]="horizontal",Qo[Qo.vertical=2]="vertical",Qo[Qo.horizontalOnly=3]="horizontalOnly";const Pu=-17;class Mu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const a=new Mu;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new Mu;return r.imageName=e,r}}class nl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const a=new nl;for(let h=0;h<e.sections.length;h++){const m=e.sections[h];m.image?a.addImageSection(m):a.addTextSection(m,r)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let r="";for(let a=0;a<e.length;a++){const h=e.charCodeAt(a+1)||null,m=e.charCodeAt(a-1)||null;r+=h&&eh(h)&&!Iu[e[a+1]]||m&&eh(m)&&!Iu[e[a-1]]||!Iu[e[a]]?e[a]:Iu[e[a]]}return r}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&vh[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&vh[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new nl;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Mu.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e){const r=e.image?e.image.name:"";if(r.length===0)return void gt("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(Mu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _h(n,e,r,a,h,m,y,v,S,C,I,z,L,F,O,q){const W=nl.fromFeature(n,h);let Y;z===l.WritingMode.vertical&&W.verticalizePunctuation();const{processBidirectionalText:le,processStyledBidirectionalText:ie}=Nn;if(le&&W.sections.length===1){Y=[];const we=le(W.toString(),Ap(W,C,m,e,a,F,O));for(const qe of we){const Xe=new nl;Xe.text=qe,Xe.sections=W.sections;for(let $e=0;$e<qe.length;$e++)Xe.sectionIndex.push(0);Y.push(Xe)}}else if(ie){Y=[];const we=ie(W.text,W.sectionIndex,Ap(W,C,m,e,a,F,O));for(const qe of we){const Xe=new nl;Xe.text=qe[0],Xe.sectionIndex=qe[1],Xe.sections=W.sections,Y.push(Xe)}}else Y=function(we,qe){const Xe=[],$e=we.text;let Fe=0;for(const Le of qe)Xe.push(we.substring(Fe,Le)),Fe=Le;return Fe<$e.length&&Xe.push(we.substring(Fe,$e.length)),Xe}(W,Ap(W,C,m,e,a,F,O));const de=[],fe={positionedLines:de,text:W.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:z,iconsInText:!1,verticalizable:!1};return function(we,qe,Xe,$e,Fe,Le,Ze,Oe,ke,rt,et,bt){let Yt=0,ei=Pu,ki=0,Un=0;const cn=Oe==="right"?1:Oe==="left"?0:.5;let ci=0;for(const bi of Fe){bi.trim();const Ii=bi.getMaxScale(),Qi=(Ii-1)*Di,dn={positionedGlyphs:[],lineOffset:0};we.positionedLines[ci]=dn;const En=dn.positionedGlyphs;let Tn=0;if(!bi.length()){ei+=Le,++ci;continue}for(let Hi=0;Hi<bi.length();Hi++){const Et=bi.getSection(Hi),Vn=bi.getSectionIndex(Hi),Wi=bi.getCharCode(Hi);let en=0,_r=null,Rr=null,Br=null,_o=Di;const vr=!(ke===l.WritingMode.horizontal||!et&&!Ra(Wi)||et&&(vh[Wi]||(Ri=Wi,Ne.Arabic(Ri)||Ne["Arabic Supplement"](Ri)||Ne["Arabic Extended-A"](Ri)||Ne["Arabic Presentation Forms-A"](Ri)||Ne["Arabic Presentation Forms-B"](Ri))));if(Et.imageName){const Qn=$e[Et.imageName];if(!Qn)continue;Br=Et.imageName,we.iconsInText=we.iconsInText||!0,Rr=Qn.paddedRect;const Cn=Qn.displaySize;Et.scale=Et.scale*Di/bt,_r={width:Cn[0],height:Cn[1],left:bn,top:-ly,advance:vr?Cn[1]:Cn[0]},en=Qi+(Di-Cn[1]*Et.scale),_o=_r.advance;const vo=vr?Cn[0]*Et.scale-Di*Ii:Cn[1]*Et.scale-Di*Ii;vo>0&&vo>Tn&&(Tn=vo)}else{const Qn=Xe[Et.fontStack],Cn=Qn&&Qn[Wi];if(Cn&&Cn.rect)Rr=Cn.rect,_r=Cn.metrics;else{const vo=qe[Et.fontStack],Ru=vo&&vo[Wi];if(!Ru)continue;_r=Ru.metrics}en=(Ii-Et.scale)*Di}vr?(we.verticalizable=!0,En.push({glyph:Wi,imageName:Br,x:Yt,y:ei+en,vertical:vr,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:Vn,metrics:_r,rect:Rr}),Yt+=_o*Et.scale+rt):(En.push({glyph:Wi,imageName:Br,x:Yt,y:ei+en,vertical:vr,scale:Et.scale,fontStack:Et.fontStack,sectionIndex:Vn,metrics:_r,rect:Rr}),Yt+=_r.advance*Et.scale+rt)}En.length!==0&&(ki=Math.max(Yt-rt,ki),iw(En,0,En.length-1,cn,Tn)),Yt=0;const hi=Le*Ii+Tn;dn.lineOffset=Math.max(Tn,Qi),ei+=hi,Un=Math.max(hi,Un),++ci}var Ri;const Gi=ei-Pu,{horizontalAlign:Sn,verticalAlign:hn}=Lp(Ze);(function(bi,Ii,Qi,dn,En,Tn,hi,Hi,Et){const Vn=(Ii-Qi)*En;let Wi=0;Wi=Tn!==hi?-Hi*dn-Pu:(-dn*Et+.5)*hi;for(const en of bi)for(const _r of en.positionedGlyphs)_r.x+=Vn,_r.y+=Wi})(we.positionedLines,cn,Sn,hn,ki,Un,Le,Gi,Fe.length),we.top+=-hn*Gi,we.bottom=we.top+Gi,we.left+=-Sn*ki,we.right=we.left+ki}(fe,e,r,a,Y,y,v,S,z,C,L,q),!function(we){for(const qe of we)if(qe.positionedGlyphs.length!==0)return!1;return!0}(de)&&fe}const vh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ew={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hy(n,e,r,a,h,m){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*Di/m+h:0}{const y=r[e.fontStack],v=y&&y[n];return v?v.metrics.advance*e.scale+h:0}}function dy(n,e,r,a){const h=Math.pow(n-e,2);return a?n<e?h/2:2*h:h+Math.abs(r)*r}function tw(n,e,r){let a=0;return n===10&&(a-=1e4),r&&(a+=150),n!==40&&n!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function py(n,e,r,a,h,m){let y=null,v=dy(e,r,h,m);for(const S of a){const C=dy(e-S.x,r,h,m)+S.badness;C<=v&&(y=S,v=C)}return{index:n,x:e,priorBreak:y,badness:v}}function fy(n){return n?fy(n.priorBreak).concat(n.index):[]}function Ap(n,e,r,a,h,m,y){if(m!=="point")return[];if(!n)return[];const v=[],S=function(L,F,O,q,W,Y){let le=0;for(let ie=0;ie<L.length();ie++){const de=L.getSection(ie);le+=hy(L.getCharCode(ie),de,q,W,F,Y)}return le/Math.max(1,Math.ceil(le/O))}(n,e,r,a,h,y),C=n.text.indexOf("")>=0;let I=0;for(let L=0;L<n.length();L++){const F=n.getSection(L),O=n.getCharCode(L);if(vh[O]||(I+=hy(O,F,a,h,e,y)),L<n.length()-1){const q=!((z=O)<11904||!(Ne["Bopomofo Extended"](z)||Ne.Bopomofo(z)||Ne["CJK Compatibility Forms"](z)||Ne["CJK Compatibility Ideographs"](z)||Ne["CJK Compatibility"](z)||Ne["CJK Radicals Supplement"](z)||Ne["CJK Strokes"](z)||Ne["CJK Symbols and Punctuation"](z)||Ne["CJK Unified Ideographs Extension A"](z)||Ne["CJK Unified Ideographs"](z)||Ne["Enclosed CJK Letters and Months"](z)||Ne["Halfwidth and Fullwidth Forms"](z)||Ne.Hiragana(z)||Ne["Ideographic Description Characters"](z)||Ne["Kangxi Radicals"](z)||Ne["Katakana Phonetic Extensions"](z)||Ne.Katakana(z)||Ne["Vertical Forms"](z)||Ne["Yi Radicals"](z)||Ne["Yi Syllables"](z)));(ew[O]||q||F.imageName)&&v.push(py(L+1,I,S,v,tw(O,n.getCharCode(L+1),q&&C),!1))}}var z;return fy(py(n.length(),I,S,v,0,!0))}function Lp(n){let e=.5,r=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function iw(n,e,r,a,h){if(!a&&!h)return;const m=n[r],y=(n[r].x+m.metrics.advance*m.scale)*a;for(let v=e;v<=r;v++)n[v].x-=y,n[v].y+=h}function nw(n,e,r){const{horizontalAlign:a,verticalAlign:h}=Lp(r),m=e[0]-n.displaySize[0]*a,y=e[1]-n.displaySize[1]*h;return{image:n,top:y,bottom:y+n.displaySize[1],left:m,right:m+n.displaySize[0]}}function my(n,e,r,a,h,m){const y=n.image;let v;if(y.content){const W=y.content,Y=y.pixelRatio||1;v=[W[0]/Y,W[1]/Y,y.displaySize[0]-W[2]/Y,y.displaySize[1]-W[3]/Y]}const S=e.left*m,C=e.right*m;let I,z,L,F;r==="width"||r==="both"?(F=h[0]+S-a[3],z=h[0]+C+a[1]):(F=h[0]+(S+C-y.displaySize[0])/2,z=F+y.displaySize[0]);const O=e.top*m,q=e.bottom*m;return r==="height"||r==="both"?(I=h[1]+O-a[0],L=h[1]+q+a[2]):(I=h[1]+(O+q-y.displaySize[1])/2,L=I+y.displaySize[1]),{image:y,top:I,right:z,bottom:L,left:F,collisionPadding:v}}const zu=255,eo=128,es=zu*eo;function gy(n,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Qt(n+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=r;let m=0;for(;m<a.length&&a[m]<=n;)m++;m=Math.max(0,m-1);let y=m;for(;y<a.length&&a[y]<n+1;)y++;y=Math.min(a.length-1,y);const v=a[m],S=a[y];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:S,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:S,minSize:r.evaluate(new Qt(v)),maxSize:r.evaluate(new Qt(S)),interpolationType:h}}}function Dp(n,e,r){let a="never";const h=n.get(e);return h?a=h:n.get(r)&&(a="always"),a}const rw=Jo.VectorTileFeature.types,ow=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xh(n,e,r,a,h,m,y,v,S,C,I,z,L){const F=v?Math.min(es,Math.round(v[0])):0,O=v?Math.min(es,Math.round(v[1])):0;n.emplaceBack(e,r,Math.round(32*a),Math.round(32*h),m,y,(F<<1)+(S?1:0),O,16*C,16*I,256*z,256*L)}function Rp(n,e,r){n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r),n.emplaceBack(e.x,e.y,r)}function sw(n){for(const e of n.sections)if(th(e.text))return!0;return!1}class Bp{constructor(e){this.layoutVertexArray=new ce,this.indexArray=new xe,this.programConfigurations=e,this.segments=new Me,this.dynamicLayoutVertexArray=new me,this.opacityVertexArray=new ye,this.hasVisibleVertices=!1,this.placedSymbolArray=new x}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,r,a,h){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,F1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,O1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ow,!0),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}He("SymbolBuffers",Bp);class Fp{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Me,this.collisionVertexArray=new Se}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,N1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}He("CollisionBuffers",Fp);class rl{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fp([]),this.placementViewportMatrix=fp([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gy(this.zoom,r["text-size"]),this.iconSizeData=gy(this.zoom,r["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=Dp(a,"text-overlap","text-allow-overlap")!=="never"||Dp(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>l.WritingMode[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Bp(new Lr(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Bp(new Lr(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new T,this.lineVertexArray=new k,this.symbolInstances=new E}calculateGlyphDependencies(e,r,a,h,m){for(let y=0;y<e.length;y++)if(r[e.charCodeAt(y)]=!0,(a||h)&&m){const v=Iu[e.charAt(y)];v&&(r[v.charCodeAt(0)]=!0)}}populate(e,r,a){const h=this.layers[0],m=h.layout,y=m.get("text-font"),v=m.get("text-field"),S=m.get("icon-image"),C=(v.value.kind!=="constant"||v.value.value instanceof Mi&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),I=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,z=m.get("symbol-sort-key");if(this.features=[],!C&&!I)return;const L=r.iconDependencies,F=r.glyphDependencies,O=r.availableImages,q=new Qt(this.zoom);for(const{feature:W,id:Y,index:le,sourceLayerIndex:ie}of e){const de=h._featureFilter.needGeometry,fe=Zs(W,de);if(!h._featureFilter.filter(q,fe,a))continue;let we,qe;if(de||(fe.geometry=Dr(W)),C){const $e=h.getValueAndResolveTokens("text-field",fe,a,O),Fe=Mi.factory($e);sw(Fe)&&(this.hasRTLText=!0),(!this.hasRTLText||lu()==="unavailable"||this.hasRTLText&&Nn.isParsed())&&(we=V1(Fe,h,fe))}if(I){const $e=h.getValueAndResolveTokens("icon-image",fe,a,O);qe=$e instanceof Rn?$e:Rn.fromString($e)}if(!we&&!qe)continue;const Xe=this.sortFeaturesByKey?z.evaluate(fe,{},a):void 0;if(this.features.push({id:Y,text:we,icon:qe,index:le,sourceLayerIndex:ie,geometry:fe.geometry,properties:W.properties,type:rw[W.type],sortKey:Xe}),qe&&(L[qe.name]=!0),we){const $e=y.evaluate(fe,{},a).join(","),Fe=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(l.WritingMode.vertical)>=0;for(const Le of we.sections)if(Le.image)L[Le.image.name]=!0;else{const Ze=Da(we.toString()),Oe=Le.fontStack||$e,ke=F[Oe]=F[Oe]||{};this.calculateGlyphDependencies(Le.text,ke,Fe,this.allowVerticalPlacement,Ze)}}}m.get("symbol-placement")==="line"&&(this.features=function(W){const Y={},le={},ie=[];let de=0;function fe($e){ie.push(W[$e]),de++}function we($e,Fe,Le){const Ze=le[$e];return delete le[$e],le[Fe]=Ze,ie[Ze].geometry[0].pop(),ie[Ze].geometry[0]=ie[Ze].geometry[0].concat(Le[0]),Ze}function qe($e,Fe,Le){const Ze=Y[Fe];return delete Y[Fe],Y[$e]=Ze,ie[Ze].geometry[0].shift(),ie[Ze].geometry[0]=Le[0].concat(ie[Ze].geometry[0]),Ze}function Xe($e,Fe,Le){const Ze=Le?Fe[0][Fe[0].length-1]:Fe[0][0];return`${$e}:${Ze.x}:${Ze.y}`}for(let $e=0;$e<W.length;$e++){const Fe=W[$e],Le=Fe.geometry,Ze=Fe.text?Fe.text.toString():null;if(!Ze){fe($e);continue}const Oe=Xe(Ze,Le),ke=Xe(Ze,Le,!0);if(Oe in le&&ke in Y&&le[Oe]!==Y[ke]){const rt=qe(Oe,ke,Le),et=we(Oe,ke,ie[rt].geometry);delete Y[Oe],delete le[ke],le[Xe(Ze,ie[et].geometry,!0)]=et,ie[rt].geometry=null}else Oe in le?we(Oe,ke,Le):ke in Y?qe(Oe,ke,Le):(fe($e),Y[Oe]=de-1,le[ke]=de-1)}return ie.filter($e=>$e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Y)=>W.sortKey-Y.sortKey)}update(e,r,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(r[e.segment+1]),m=e.dist(r[e.segment]);const y={};for(let v=e.segment+1;v<r.length;v++)y[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:h},v<r.length-1&&(h+=r[v+1].dist(r[v]));for(let v=e.segment||0;v>=0;v--)y[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:m},v>0&&(m+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const S=y[v];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,h,m,y,v,S,C,I,z,L){const F=e.indexArray,O=e.layoutVertexArray,q=e.segments.prepareSegment(4*r.length,O,F,this.canOverlap?y.sortKey:void 0),W=this.glyphOffsetArray.length,Y=q.vertexLength,le=this.allowVerticalPlacement&&v===l.WritingMode.vertical?Math.PI/2:0,ie=y.text&&y.text.sections;for(let de=0;de<r.length;de++){const{tl:fe,tr:we,bl:qe,br:Xe,tex:$e,pixelOffsetTL:Fe,pixelOffsetBR:Le,minFontScaleX:Ze,minFontScaleY:Oe,glyphOffset:ke,isSDF:rt,sectionIndex:et}=r[de],bt=q.vertexLength,Yt=ke[1];xh(O,S.x,S.y,fe.x,Yt+fe.y,$e.x,$e.y,a,rt,Fe.x,Fe.y,Ze,Oe),xh(O,S.x,S.y,we.x,Yt+we.y,$e.x+$e.w,$e.y,a,rt,Le.x,Fe.y,Ze,Oe),xh(O,S.x,S.y,qe.x,Yt+qe.y,$e.x,$e.y+$e.h,a,rt,Fe.x,Le.y,Ze,Oe),xh(O,S.x,S.y,Xe.x,Yt+Xe.y,$e.x+$e.w,$e.y+$e.h,a,rt,Le.x,Le.y,Ze,Oe),Rp(e.dynamicLayoutVertexArray,S,le),F.emplaceBack(bt,bt+1,bt+2),F.emplaceBack(bt+1,bt+2,bt+3),q.vertexLength+=4,q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ke[0]),de!==r.length-1&&et===r[de+1].sectionIndex||e.programConfigurations.populatePaintArrays(O.length,y,y.index,{},L,ie&&ie[et])}e.placedSymbolArray.emplaceBack(S.x,S.y,W,this.glyphOffsetArray.length-W,Y,C,I,S.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],v,0,!1,0,z)}_addCollisionDebugVertex(e,r,a,h,m,y){return r.emplaceBack(0,0),e.emplaceBack(a.x,a.y,h,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,r,a,h,m,y,v){const S=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),C=S.vertexLength,I=m.layoutVertexArray,z=m.collisionVertexArray,L=v.anchorX,F=v.anchorY;this._addCollisionDebugVertex(I,z,y,L,F,new te(e,r)),this._addCollisionDebugVertex(I,z,y,L,F,new te(a,r)),this._addCollisionDebugVertex(I,z,y,L,F,new te(a,h)),this._addCollisionDebugVertex(I,z,y,L,F,new te(e,h)),S.vertexLength+=4;const O=m.indexArray;O.emplaceBack(C,C+1),O.emplaceBack(C+1,C+2),O.emplaceBack(C+2,C+3),O.emplaceBack(C+3,C),S.primitiveLength+=4}addDebugCollisionBoxes(e,r,a,h){for(let m=e;m<r;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fp(_e,ey.members,Re),this.iconCollisionBox=new Fp(_e,ey.members,Re);for(let e=0;e<this.symbolInstances.length;e++){const r=this.symbolInstances.get(e);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(e,r,a,h,m,y,v,S,C){const I={};for(let z=r;z<a;z++){const L=e.get(z);I.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.textFeatureIndex=L.featureIndex;break}for(let z=h;z<m;z++){const L=e.get(z);I.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalTextFeatureIndex=L.featureIndex;break}for(let z=y;z<v;z++){const L=e.get(z);I.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.iconFeatureIndex=L.featureIndex;break}for(let z=S;z<C;z++){const L=e.get(z);I.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},I.verticalIconFeatureIndex=L.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),h=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),h=[],m=[],y=[];for(let v=0;v<this.symbolInstances.length;++v){y.push(v);const S=this.symbolInstances.get(v);h.push(0|Math.round(r*S.anchorX+a*S.anchorY)),m.push(S.featureIndex)}return y.sort((v,S)=>h[v]-h[S]||m[S]-m[v]),y}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((h,m,y)=>{h>=0&&y.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let yy,_y;He("SymbolBucket",rl,{omit:["layers","collisionBoxArray","features","compareText"]}),rl.MAX_GLYPHS=65535,rl.addDynamicAttributes=Rp;var Op={get paint(){return _y=_y||new ln({"icon-opacity":new at(ge.paint_symbol["icon-opacity"]),"icon-color":new at(ge.paint_symbol["icon-color"]),"icon-halo-color":new at(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new at(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new at(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Qe(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qe(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new at(ge.paint_symbol["text-opacity"]),"text-color":new at(ge.paint_symbol["text-color"],{runtimeType:qi,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new at(ge.paint_symbol["text-halo-color"]),"text-halo-width":new at(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new at(ge.paint_symbol["text-halo-blur"]),"text-translate":new Qe(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Qe(ge.paint_symbol["text-translate-anchor"])})},get layout(){return yy=yy||new ln({"symbol-placement":new Qe(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Qe(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qe(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new at(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qe(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qe(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qe(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qe(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qe(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qe(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new at(ge.layout_symbol["icon-size"]),"icon-text-fit":new Qe(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qe(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new at(ge.layout_symbol["icon-image"]),"icon-rotate":new at(ge.layout_symbol["icon-rotate"]),"icon-padding":new at(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Qe(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new at(ge.layout_symbol["icon-offset"]),"icon-anchor":new at(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qe(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qe(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qe(ge.layout_symbol["text-rotation-alignment"]),"text-field":new at(ge.layout_symbol["text-field"]),"text-font":new at(ge.layout_symbol["text-font"]),"text-size":new at(ge.layout_symbol["text-size"]),"text-max-width":new at(ge.layout_symbol["text-max-width"]),"text-line-height":new Qe(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new at(ge.layout_symbol["text-letter-spacing"]),"text-justify":new at(ge.layout_symbol["text-justify"]),"text-radial-offset":new at(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qe(ge.layout_symbol["text-variable-anchor"]),"text-anchor":new at(ge.layout_symbol["text-anchor"]),"text-max-angle":new Qe(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Qe(ge.layout_symbol["text-writing-mode"]),"text-rotate":new at(ge.layout_symbol["text-rotate"]),"text-padding":new Qe(ge.layout_symbol["text-padding"]),"text-keep-upright":new Qe(ge.layout_symbol["text-keep-upright"]),"text-transform":new at(ge.layout_symbol["text-transform"]),"text-offset":new at(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Qe(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Qe(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Qe(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Qe(ge.layout_symbol["text-optional"])})}};class vy{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Gr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}He("FormatSectionOverride",vy,{omit:["defaultValue"]});class wh extends mr{constructor(e){super(e,Op)}recalculate(e,r){if(super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const m of a)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,r,a,h){const m=this.layout.get(e).evaluate(r,{},a,h),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Sa(y.value)||!m?m:function(v,S){return S.replace(/{([^{}]+)}/g,(C,I)=>I in v?String(v[I]):"")}(r.properties,m)}createBucket(e){return new rl(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Op.paint.overridableProperties){if(!wh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new vy(r),h=new Kl(a,r.property.specification);let m=null;m=r.value.kind==="constant"||r.value.kind==="source"?new si("source",h):new Yl("composite",h,r.value.zoomStops),this.paint._values[e]=new fr(r.property,m,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&wh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),h=Op.paint.properties[r];let m=!1;const y=v=>{for(const S of v)if(h.overrides&&h.overrides.hasOverride(S))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Mi)y(a.value.value.sections);else if(a.value.kind==="source"){const v=C=>{m||(C instanceof uo&&vi(C.value)===cr?y(C.value.sections):C instanceof xa?y(C.sections):C.eachChild(v))},S=a.value;S._styleExpression&&v(S._styleExpression.expression)}return m}}let xy;var aw={get paint(){return xy=xy||new ln({"background-color":new Qe(ge.paint_background["background-color"]),"background-pattern":new hu(ge.paint_background["background-pattern"]),"background-opacity":new Qe(ge.paint_background["background-opacity"])})}};class lw extends mr{constructor(e){super(e,aw)}}let wy;var uw={get paint(){return wy=wy||new ln({"raster-opacity":new Qe(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qe(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qe(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qe(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Qe(ge.paint_raster["raster-saturation"]),"raster-contrast":new Qe(ge.paint_raster["raster-contrast"]),"raster-resampling":new Qe(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Qe(ge.paint_raster["raster-fade-duration"])})}};class cw extends mr{constructor(e){super(e,uw)}}class hw extends mr{constructor(e){super(e,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class dw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Np=63710088e-1;class ts{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ts(K(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,h=e.lat*r,m=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*r);return Np*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof ts)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ts(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ts(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const by=2*Math.PI*Np;function Sy(n){return by*Math.cos(n*Math.PI/180)}function Ey(n){return(180+n)/360}function Ty(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function Cy(n,e){return n/Sy(e)}function Up(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}class bh{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=ts.convert(e);return new bh(Ey(a.lng),Ty(a.lat),Cy(r,a.lat))}toLngLat(){return new ts(360*this.x-180,Up(this.y))}toAltitude(){return this.z*Sy(Up(this.y))}meterInMercatorCoordinateUnits(){return 1/by*(e=Up(this.y),1/Math.cos(e*Math.PI/180));var e}}function ky(n,e,r){var a=2*Math.PI*6378137/256/Math.pow(2,r);return[n*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class Vp{constructor(e,r,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||r<0||r>=Math.pow(2,e))throw new Error(`x=${r}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=r,this.y=a,this.key=Au(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r,a){const h=(y=this.y,v=this.z,S=ky(256*(m=this.x),256*(y=Math.pow(2,v)-y-1),v),C=ky(256*(m+1),256*(y+1),v),S[0]+","+S[1]+","+C[0]+","+C[1]);var m,y,v,S,C;const I=function(z,L,F){let O,q="";for(let W=z;W>0;W--)O=1<<W-1,q+=(L&O?1:0)+(F&O?2:0);return q}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,I).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const r=this.z-e.z;return r>0&&e.x===this.x>>r&&e.y===this.y>>r}getTilePoint(e){const r=Math.pow(2,this.z);return new te((e.x*r-this.x)*Kt,(e.y*r-this.y)*Kt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Iy{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Au(e,r.z,r.z,r.x,r.y)}}class Jn{constructor(e,r,a,h,m){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=r,this.canonical=new Vp(a,+h,+m),this.key=Au(r,e,a,h,m)}clone(){return new Jn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-e;return e>this.canonical.z?new Jn(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jn(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?Au(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y):Au(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Jn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new Jn(r,this.wrap,r,a,h),new Jn(r,this.wrap,r,a+1,h),new Jn(r,this.wrap,r,a,h+1),new Jn(r,this.wrap,r,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Jn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Jn(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Iy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new bh(e.x-this.wrap,e.y))}}function Au(n,e,r,a,h){(n*=2)<0&&(n=-1*n-1);const m=1<<r;return(m*m*n+m*h+a).toString(36)+r.toString(36)+e.toString(36)}He("CanonicalTileID",Vp),He("OverscaledTileID",Jn,{omit:["posMatrix"]});class Py{constructor(e,r,a){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void gt(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const h=this.dim=r.height-2;this.data=new Uint32Array(r.data.buffer),this.encoding=a||"mapbox";for(let m=0;m<h;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(h,m)]=this.data[this._idx(h-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,h)]=this.data[this._idx(m,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let m=0;m<h;m++)for(let y=0;y<h;y++){const v=this.get(m,y);v>this.max&&(this.max=v),v<this.min&&(this.min=v)}}get(e,r){const a=new Uint8Array(this.data.buffer),h=4*this._idx(e,r);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[h],a[h+1],a[h+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,a){return(256*e*256+256*r+a)/10-1e4}_unpackTerrarium(e,r,a){return 256*e+r+a/256-32768}getPixels(){return new Yn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=r*this.dim,m=r*this.dim+this.dim,y=a*this.dim,v=a*this.dim+this.dim;switch(r){case-1:h=m-1;break;case 1:m=h+1}switch(a){case-1:y=v-1;break;case 1:v=y+1}const S=-r*this.dim,C=-a*this.dim;for(let I=y;I<v;I++)for(let z=h;z<m;z++)this.data[this._idx(z,I)]=e.data[this._idx(z+S,I+C)]}}He("DEMData",Py);class My{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class zy{constructor(e,r,a,h,m){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=a,e._y=h,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(e[r]=this[r]);return e}}class Ay{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Bs(Kt,16,0),this.grid3D=new Bs(Kt,16,0),this.featureIndexArray=new B,this.promoteId=r}insert(e,r,a,h,m,y){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,m);const S=y?this.grid3D:this.grid;for(let C=0;C<r.length;C++){const I=r[C],z=[1/0,1/0,-1/0,-1/0];for(let L=0;L<I.length;L++){const F=I[L];z[0]=Math.min(z[0],F.x),z[1]=Math.min(z[1],F.y),z[2]=Math.max(z[2],F.x),z[3]=Math.max(z[3],F.y)}z[0]<Kt&&z[1]<Kt&&z[2]>=0&&z[3]>=0&&S.insert(v,z[0],z[1],z[2],z[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Jo.VectorTile(new Pp(this.rawTileData)).layers,this.sourceLayerCoder=new My(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,r,a,h){this.loadVTLayers();const m=e.params||{},y=Kt/e.tileSize/e.scale,v=Ca(m.filter),S=e.queryGeometry,C=e.queryPadding*y,I=Dy(S),z=this.grid.query(I.minX-C,I.minY-C,I.maxX+C,I.maxY+C),L=Dy(e.cameraQueryGeometry),F=this.grid3D.query(L.minX-C,L.minY-C,L.maxX+C,L.maxY+C,(W,Y,le,ie)=>function(de,fe,we,qe,Xe){for(const Fe of de)if(fe<=Fe.x&&we<=Fe.y&&qe>=Fe.x&&Xe>=Fe.y)return!0;const $e=[new te(fe,we),new te(fe,Xe),new te(qe,Xe),new te(qe,we)];if(de.length>2){for(const Fe of $e)if(Ya(de,Fe))return!0}for(let Fe=0;Fe<de.length-1;Fe++)if(qx(de[Fe],de[Fe+1],$e))return!0;return!1}(e.cameraQueryGeometry,W-C,Y-C,le+C,ie+C));for(const W of F)z.push(W);z.sort(pw);const O={};let q;for(let W=0;W<z.length;W++){const Y=z[W];if(Y===q)continue;q=Y;const le=this.featureIndexArray.get(Y);let ie=null;this.loadMatchingFeature(O,le.bucketIndex,le.sourceLayerIndex,le.featureIndex,v,m.layers,m.availableImages,r,a,h,(de,fe,we)=>(ie||(ie=Dr(de)),fe.queryIntersectsFeature(S,de,we,ie,this.z,e.transform,y,e.pixelPosMatrix)))}return O}loadMatchingFeature(e,r,a,h,m,y,v,S,C,I,z){const L=this.bucketLayerIDs[r];if(y&&!function(W,Y){for(let le=0;le<W.length;le++)if(Y.indexOf(W[le])>=0)return!0;return!1}(y,L))return;const F=this.sourceLayerCoder.decode(a),O=this.vtLayers[F].feature(h);if(m.needGeometry){const W=Zs(O,!0);if(!m.filter(new Qt(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!m.filter(new Qt(this.tileID.overscaledZ),O))return;const q=this.getId(O,F);for(let W=0;W<L.length;W++){const Y=L[W];if(y&&y.indexOf(Y)<0)continue;const le=S[Y];if(!le)continue;let ie={};q&&I&&(ie=I.getState(le.sourceLayer||"_geojsonTileLayer",q));const de=re({},C[Y]);de.paint=Ly(de.paint,le.paint,O,ie,v),de.layout=Ly(de.layout,le.layout,O,ie,v);const fe=!z||z(O,le,ie);if(!fe)continue;const we=new zy(O,this.z,this.x,this.y,q);we.layer=de;let qe=e[Y];qe===void 0&&(qe=e[Y]=[]),qe.push({featureIndex:h,feature:we,intersectionZ:fe})}}lookupSymbolFeatures(e,r,a,h,m,y,v,S){const C={};this.loadVTLayers();const I=Ca(m);for(const z of e)this.loadMatchingFeature(C,a,h,z,I,y,v,S,r);return C}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof a=="boolean"&&(a=Number(a))),a}}function Ly(n,e,r,a,h){return Ae(n,(m,y)=>{const v=e instanceof Va?e.get(y):null;return v&&v.evaluate?v.evaluate(r,a,h):v})}function Dy(n){let e=1/0,r=1/0,a=-1/0,h=-1/0;for(const m of n)e=Math.min(e,m.x),r=Math.min(r,m.y),a=Math.max(a,m.x),h=Math.max(h,m.y);return{minX:e,minY:r,maxX:a,maxY:h}}function pw(n,e){return e-n}function Ry(n,e,r,a,h){const m=[];for(let y=0;y<n.length;y++){const v=n[y];let S;for(let C=0;C<v.length-1;C++){let I=v[C],z=v[C+1];I.x<e&&z.x<e||(I.x<e?I=new te(e,I.y+(e-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x<e&&(z=new te(e,I.y+(e-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y<r&&z.y<r||(I.y<r?I=new te(I.x+(r-I.y)/(z.y-I.y)*(z.x-I.x),r)._round():z.y<r&&(z=new te(I.x+(r-I.y)/(z.y-I.y)*(z.x-I.x),r)._round()),I.x>=a&&z.x>=a||(I.x>=a?I=new te(a,I.y+(a-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x>=a&&(z=new te(a,I.y+(a-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y>=h&&z.y>=h||(I.y>=h?I=new te(I.x+(h-I.y)/(z.y-I.y)*(z.x-I.x),h)._round():z.y>=h&&(z=new te(I.x+(h-I.y)/(z.y-I.y)*(z.x-I.x),h)._round()),S&&I.equals(S[S.length-1])||(S=[I],m.push(S)),S.push(z)))))}}return m}He("FeatureIndex",Ay,{omit:["rawTileData","sourceLayerCoder"]});class is extends te{constructor(e,r,a,h){super(e,r),this.angle=a,h!==void 0&&(this.segment=h)}clone(){return new is(this.x,this.y,this.angle,this.segment)}}function By(n,e,r,a,h){if(e.segment===void 0||r===0)return!0;let m=e,y=e.segment+1,v=0;for(;v>-r/2;){if(y--,y<0)return!1;v-=n[y].dist(m),m=n[y]}v+=n[y].dist(n[y+1]),y++;const S=[];let C=0;for(;v<r/2;){const I=n[y],z=n[y+1];if(!z)return!1;let L=n[y-1].angleTo(I)-I.angleTo(z);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:v,angleDelta:L}),C+=L;v-S[0].distance>a;)C-=S.shift().angleDelta;if(C>h)return!1;y++,v+=I.dist(z)}return!0}function Fy(n){let e=0;for(let r=0;r<n.length-1;r++)e+=n[r].dist(n[r+1]);return e}function Oy(n,e,r){return n?.6*e*r:0}function Ny(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function fw(n,e,r,a,h,m){const y=Oy(r,h,m),v=Ny(r,a)*m;let S=0;const C=Fy(n)/2;for(let I=0;I<n.length-1;I++){const z=n[I],L=n[I+1],F=z.dist(L);if(S+F>C){const O=(C-S)/F,q=_n.number(z.x,L.x,O),W=_n.number(z.y,L.y,O),Y=new is(q,W,L.angleTo(z),I);return Y._round(),!y||By(n,Y,v,y,e)?Y:void 0}S+=F}}function mw(n,e,r,a,h,m,y,v,S){const C=Oy(a,m,y),I=Ny(a,h),z=I*y,L=n[0].x===0||n[0].x===S||n[0].y===0||n[0].y===S;return e-z<e/4&&(e=z+e/4),Uy(n,L?e/2*v%e:(I/2+2*m)*y*v%e,e,C,r,z,L,!1,S)}function Uy(n,e,r,a,h,m,y,v,S){const C=m/2,I=Fy(n);let z=0,L=e-r,F=[];for(let O=0;O<n.length-1;O++){const q=n[O],W=n[O+1],Y=q.dist(W),le=W.angleTo(q);for(;L+r<z+Y;){L+=r;const ie=(L-z)/Y,de=_n.number(q.x,W.x,ie),fe=_n.number(q.y,W.y,ie);if(de>=0&&de<S&&fe>=0&&fe<S&&L-C>=0&&L+C<=I){const we=new is(de,fe,le,O);we._round(),a&&!By(n,we,m,a,h)||F.push(we)}}z+=Y}return v||F.length||y||(F=Uy(n,z/2,r,a,h,m,y,!0,S)),F}He("Anchor",is);const ol=bn;function Vy(n,e,r,a){const h=[],m=n.image,y=m.pixelRatio,v=m.paddedRect.w-2*ol,S=m.paddedRect.h-2*ol,C=n.right-n.left,I=n.bottom-n.top,z=m.stretchX||[[0,v]],L=m.stretchY||[[0,S]],F=(Le,Ze)=>Le+Ze[1]-Ze[0],O=z.reduce(F,0),q=L.reduce(F,0),W=v-O,Y=S-q;let le=0,ie=O,de=0,fe=q,we=0,qe=W,Xe=0,$e=Y;if(m.content&&a){const Le=m.content;le=Sh(z,0,Le[0]),de=Sh(L,0,Le[1]),ie=Sh(z,Le[0],Le[2]),fe=Sh(L,Le[1],Le[3]),we=Le[0]-le,Xe=Le[1]-de,qe=Le[2]-Le[0]-ie,$e=Le[3]-Le[1]-fe}const Fe=(Le,Ze,Oe,ke)=>{const rt=Eh(Le.stretch-le,ie,C,n.left),et=Th(Le.fixed-we,qe,Le.stretch,O),bt=Eh(Ze.stretch-de,fe,I,n.top),Yt=Th(Ze.fixed-Xe,$e,Ze.stretch,q),ei=Eh(Oe.stretch-le,ie,C,n.left),ki=Th(Oe.fixed-we,qe,Oe.stretch,O),Un=Eh(ke.stretch-de,fe,I,n.top),cn=Th(ke.fixed-Xe,$e,ke.stretch,q),ci=new te(rt,bt),Ri=new te(ei,bt),Gi=new te(ei,Un),Sn=new te(rt,Un),hn=new te(et/y,Yt/y),bi=new te(ki/y,cn/y),Ii=e*Math.PI/180;if(Ii){const En=Math.sin(Ii),Tn=Math.cos(Ii),hi=[Tn,-En,En,Tn];ci._matMult(hi),Ri._matMult(hi),Sn._matMult(hi),Gi._matMult(hi)}const Qi=Le.stretch+Le.fixed,dn=Ze.stretch+Ze.fixed;return{tl:ci,tr:Ri,bl:Sn,br:Gi,tex:{x:m.paddedRect.x+ol+Qi,y:m.paddedRect.y+ol+dn,w:Oe.stretch+Oe.fixed-Qi,h:ke.stretch+ke.fixed-dn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:hn,pixelOffsetBR:bi,minFontScaleX:qe/y/C,minFontScaleY:$e/y/I,isSDF:r}};if(a&&(m.stretchX||m.stretchY)){const Le=jy(z,W,O),Ze=jy(L,Y,q);for(let Oe=0;Oe<Le.length-1;Oe++){const ke=Le[Oe],rt=Le[Oe+1];for(let et=0;et<Ze.length-1;et++)h.push(Fe(ke,Ze[et],rt,Ze[et+1]))}}else h.push(Fe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:S+1}));return h}function Sh(n,e,r){let a=0;for(const h of n)a+=Math.max(e,Math.min(r,h[1]))-Math.max(e,Math.min(r,h[0]));return a}function jy(n,e,r){const a=[{fixed:-ol,stretch:0}];for(const[h,m]of n){const y=a[a.length-1];a.push({fixed:h-y.stretch,stretch:y.stretch}),a.push({fixed:h-y.stretch,stretch:y.stretch+(m-h)})}return a.push({fixed:e+ol,stretch:r}),a}function Eh(n,e,r,a){return n/e*r+a}function Th(n,e,r,a){return n-e*r/a}class Ch{constructor(e,r,a,h,m,y,v,S,C,I){if(this.boxStartIndex=e.length,C){let z=y.top,L=y.bottom;const F=y.collisionPadding;F&&(z-=F[1],L+=F[3]);let O=L-z;O>0&&(O=Math.max(10,O),this.circleDiameter=O)}else{let z=y.top*v-S[0],L=y.bottom*v+S[2],F=y.left*v-S[3],O=y.right*v+S[1];const q=y.collisionPadding;if(q&&(F-=q[0]*v,z-=q[1]*v,O+=q[2]*v,L+=q[3]*v),I){const W=new te(F,z),Y=new te(O,z),le=new te(F,L),ie=new te(O,L),de=I*Math.PI/180;W._rotate(de),Y._rotate(de),le._rotate(de),ie._rotate(de),F=Math.min(W.x,Y.x,le.x,ie.x),O=Math.max(W.x,Y.x,le.x,ie.x),z=Math.min(W.y,Y.y,le.y,ie.y),L=Math.max(W.y,Y.y,le.y,ie.y)}e.emplaceBack(r.x,r.y,F,z,O,L,a,h,m)}this.boxEndIndex=e.length}}class gw{constructor(e=[],r=yw){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,h=r[e];for(;e>0;){const m=e-1>>1,y=r[m];if(a(h,y)>=0)break;r[e]=y,e=m}r[e]=h}_down(e){const{data:r,compare:a}=this,h=this.length>>1,m=r[e];for(;e<h;){let y=1+(e<<1),v=r[y];const S=y+1;if(S<this.length&&a(r[S],v)<0&&(y=S,v=r[S]),a(v,m)>=0)break;r[e]=v,e=y}r[e]=m}}function yw(n,e){return n<e?-1:n>e?1:0}function _w(n,e=1,r=!1){let a=1/0,h=1/0,m=-1/0,y=-1/0;const v=n[0];for(let F=0;F<v.length;F++){const O=v[F];(!F||O.x<a)&&(a=O.x),(!F||O.y<h)&&(h=O.y),(!F||O.x>m)&&(m=O.x),(!F||O.y>y)&&(y=O.y)}const S=Math.min(m-a,y-h);let C=S/2;const I=new gw([],vw);if(S===0)return new te(a,h);for(let F=a;F<m;F+=S)for(let O=h;O<y;O+=S)I.push(new sl(F+C,O+C,C,n));let z=function(F){let O=0,q=0,W=0;const Y=F[0];for(let le=0,ie=Y.length,de=ie-1;le<ie;de=le++){const fe=Y[le],we=Y[de],qe=fe.x*we.y-we.x*fe.y;q+=(fe.x+we.x)*qe,W+=(fe.y+we.y)*qe,O+=3*qe}return new sl(q/O,W/O,0,F)}(n),L=I.length;for(;I.length;){const F=I.pop();(F.d>z.d||!z.d)&&(z=F,r&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,L)),F.max-z.d<=e||(C=F.h/2,I.push(new sl(F.p.x-C,F.p.y-C,C,n)),I.push(new sl(F.p.x+C,F.p.y-C,C,n)),I.push(new sl(F.p.x-C,F.p.y+C,C,n)),I.push(new sl(F.p.x+C,F.p.y+C,C,n)),L+=4)}return r&&(console.log(`num probes: ${L}`),console.log(`best distance: ${z.d}`)),z.p}function vw(n,e){return e.max-n.max}function sl(n,e,r,a){this.p=new te(n,e),this.h=r,this.d=function(h,m){let y=!1,v=1/0;for(let S=0;S<m.length;S++){const C=m[S];for(let I=0,z=C.length,L=z-1;I<z;L=I++){const F=C[I],O=C[L];F.y>h.y!=O.y>h.y&&h.x<(O.x-F.x)*(h.y-F.y)/(O.y-F.y)+F.x&&(y=!y),v=Math.min(v,Tg(h,F,O))}}return(y?1:-1)*Math.sqrt(v)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const jp=Number.POSITIVE_INFINITY;function $y(n,e){return e[1]!==jp?function(r,a,h){let m=0,y=0;switch(a=Math.abs(a),h=Math.abs(h),r){case"top-right":case"top-left":case"top":y=h-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-h}switch(r){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,y]}(n,e[0],e[1]):function(r,a){let h=0,m=0;a<0&&(a=0);const y=a/Math.sqrt(2);switch(r){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-a;break;case"top":m=a-7}switch(r){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=a;break;case"right":h=-a}return[h,m]}(n,e[0])}function $p(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function xw(n,e,r,a,h,m,y,v,S,C,I){let z=m.textMaxSize.evaluate(e,{});z===void 0&&(z=y);const L=n.layers[0].layout,F=L.get("icon-offset").evaluate(e,{},I),O=Zy(r.horizontal),q=y/24,W=n.tilePixelRatio*q,Y=n.tilePixelRatio*z/24,le=n.tilePixelRatio*v,ie=n.tilePixelRatio*L.get("symbol-spacing"),de=L.get("text-padding")*n.tilePixelRatio,fe=function(ke,rt,et,bt=1){const Yt=ke.get("icon-padding").evaluate(rt,{},et),ei=Yt&&Yt.values;return[ei[0]*bt,ei[1]*bt,ei[2]*bt,ei[3]*bt]}(L,e,I,n.tilePixelRatio),we=L.get("text-max-angle")/180*Math.PI,qe=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",Xe=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",$e=L.get("symbol-placement"),Fe=ie/2,Le=L.get("icon-text-fit");let Ze;a&&Le!=="none"&&(n.allowVerticalPlacement&&r.vertical&&(Ze=my(a,r.vertical,Le,L.get("icon-text-fit-padding"),F,q)),O&&(a=my(a,O,Le,L.get("icon-text-fit-padding"),F,q)));const Oe=(ke,rt)=>{rt.x<0||rt.x>=Kt||rt.y<0||rt.y>=Kt||function(et,bt,Yt,ei,ki,Un,cn,ci,Ri,Gi,Sn,hn,bi,Ii,Qi,dn,En,Tn,hi,Hi,Et,Vn,Wi,en,_r){const Rr=et.addToLineVertexArray(bt,Yt);let Br,_o,vr,Qn,Cn=0,vo=0,Ru=0,Xy=0,Yp=-1,Jp=-1;const xo={};let Ky=fi(""),Qp=0,ef=0;if(ci._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Qp,ef]=ci.layout.get("text-offset").evaluate(Et,{},en).map(kn=>kn*Di):(Qp=ci.layout.get("text-radial-offset").evaluate(Et,{},en)*Di,ef=jp),et.allowVerticalPlacement&&ei.vertical){const kn=ci.layout.get("text-rotate").evaluate(Et,{},en)+90;vr=new Ch(Ri,bt,Gi,Sn,hn,ei.vertical,bi,Ii,Qi,kn),cn&&(Qn=new Ch(Ri,bt,Gi,Sn,hn,cn,En,Tn,Qi,kn))}if(ki){const kn=ci.layout.get("icon-rotate").evaluate(Et,{}),to=ci.layout.get("icon-text-fit")!=="none",Bu=Vy(ki,kn,Wi,to),Fu=cn?Vy(cn,kn,Wi,to):void 0;_o=new Ch(Ri,bt,Gi,Sn,hn,ki,En,Tn,!1,kn),Cn=4*Bu.length;const Qy=et.iconSizeData;let Hs=null;Qy.kind==="source"?(Hs=[eo*ci.layout.get("icon-size").evaluate(Et,{})],Hs[0]>es&&gt(`${et.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)):Qy.kind==="composite"&&(Hs=[eo*Vn.compositeIconSizes[0].evaluate(Et,{},en),eo*Vn.compositeIconSizes[1].evaluate(Et,{},en)],(Hs[0]>es||Hs[1]>es)&&gt(`${et.layerIds[0]}: Value for "icon-size" is >= ${zu}. Reduce your "icon-size".`)),et.addSymbols(et.icon,Bu,Hs,Hi,hi,Et,l.WritingMode.none,bt,Rr.lineStartIndex,Rr.lineLength,-1,en),Yp=et.icon.placedSymbolArray.length-1,Fu&&(vo=4*Fu.length,et.addSymbols(et.icon,Fu,Hs,Hi,hi,Et,l.WritingMode.vertical,bt,Rr.lineStartIndex,Rr.lineLength,-1,en),Jp=et.icon.placedSymbolArray.length-1)}const Yy=Object.keys(ei.horizontal);for(const kn of Yy){const to=ei.horizontal[kn];if(!Br){Ky=fi(to.text);const Fu=ci.layout.get("text-rotate").evaluate(Et,{},en);Br=new Ch(Ri,bt,Gi,Sn,hn,to,bi,Ii,Qi,Fu)}const Bu=to.positionedLines.length===1;if(Ru+=qy(et,bt,to,Un,ci,Qi,Et,dn,Rr,ei.vertical?l.WritingMode.horizontal:l.WritingMode.horizontalOnly,Bu?Yy:[kn],xo,Yp,Vn,en),Bu)break}ei.vertical&&(Xy+=qy(et,bt,ei.vertical,Un,ci,Qi,Et,dn,Rr,l.WritingMode.vertical,["vertical"],xo,Jp,Vn,en));const Sw=Br?Br.boxStartIndex:et.collisionBoxArray.length,Ew=Br?Br.boxEndIndex:et.collisionBoxArray.length,Tw=vr?vr.boxStartIndex:et.collisionBoxArray.length,Cw=vr?vr.boxEndIndex:et.collisionBoxArray.length,kw=_o?_o.boxStartIndex:et.collisionBoxArray.length,Iw=_o?_o.boxEndIndex:et.collisionBoxArray.length,Pw=Qn?Qn.boxStartIndex:et.collisionBoxArray.length,Mw=Qn?Qn.boxEndIndex:et.collisionBoxArray.length;let Fr=-1;const Ih=(kn,to)=>kn&&kn.circleDiameter?Math.max(kn.circleDiameter,to):to;Fr=Ih(Br,Fr),Fr=Ih(vr,Fr),Fr=Ih(_o,Fr),Fr=Ih(Qn,Fr);const Jy=Fr>-1?1:0;Jy&&(Fr*=_r/Di),et.glyphOffsetArray.length>=rl.MAX_GLYPHS&&gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Et.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,Et.sortKey),et.symbolInstances.emplaceBack(bt.x,bt.y,xo.right>=0?xo.right:-1,xo.center>=0?xo.center:-1,xo.left>=0?xo.left:-1,xo.vertical||-1,Yp,Jp,Ky,Sw,Ew,Tw,Cw,kw,Iw,Pw,Mw,Gi,Ru,Xy,Cn,vo,Jy,0,bi,Qp,ef,Fr)}(n,rt,ke,r,a,h,Ze,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,W,[de,de,de,de],qe,S,le,fe,Xe,F,e,m,C,I,y)};if($e==="line")for(const ke of Ry(e.geometry,0,0,Kt,Kt)){const rt=mw(ke,ie,we,r.vertical||O,a,24,Y,n.overscaling,Kt);for(const et of rt)O&&ww(n,O.text,Fe,et)||Oe(ke,et)}else if($e==="line-center"){for(const ke of e.geometry)if(ke.length>1){const rt=fw(ke,we,r.vertical||O,a,24,Y);rt&&Oe(ke,rt)}}else if(e.type==="Polygon")for(const ke of wp(e.geometry,0)){const rt=_w(ke,16);Oe(ke[0],new is(rt.x,rt.y,0))}else if(e.type==="LineString")for(const ke of e.geometry)Oe(ke,new is(ke[0].x,ke[0].y,0));else if(e.type==="Point")for(const ke of e.geometry)for(const rt of ke)Oe([rt],new is(rt.x,rt.y,0))}function qy(n,e,r,a,h,m,y,v,S,C,I,z,L,F,O){const q=function(le,ie,de,fe,we,qe,Xe,$e){const Fe=fe.layout.get("text-rotate").evaluate(qe,{})*Math.PI/180,Le=[];for(const Ze of ie.positionedLines)for(const Oe of Ze.positionedGlyphs){if(!Oe.rect)continue;const ke=Oe.rect||{};let rt=ly+1,et=!0,bt=1,Yt=0;const ei=(we||$e)&&Oe.vertical,ki=Oe.metrics.advance*Oe.scale/2;if($e&&ie.verticalizable&&(Yt=Ze.lineOffset/2-(Oe.imageName?-(Di-Oe.metrics.width*Oe.scale)/2:(Oe.scale-1)*Di)),Oe.imageName){const hi=Xe[Oe.imageName];et=hi.sdf,bt=hi.pixelRatio,rt=bn/bt}const Un=we?[Oe.x+ki,Oe.y]:[0,0];let cn=we?[0,0]:[Oe.x+ki+de[0],Oe.y+de[1]-Yt],ci=[0,0];ei&&(ci=cn,cn=[0,0]);const Ri=(Oe.metrics.left-rt)*Oe.scale-ki+cn[0],Gi=(-Oe.metrics.top-rt)*Oe.scale+cn[1],Sn=Ri+ke.w*Oe.scale/bt,hn=Gi+ke.h*Oe.scale/bt,bi=new te(Ri,Gi),Ii=new te(Sn,Gi),Qi=new te(Ri,hn),dn=new te(Sn,hn);if(ei){const hi=new te(-ki,ki-Pu),Hi=-Math.PI/2,Et=Di/2-ki,Vn=new te(5-Pu-Et,-(Oe.imageName?Et:0)),Wi=new te(...ci);bi._rotateAround(Hi,hi)._add(Vn)._add(Wi),Ii._rotateAround(Hi,hi)._add(Vn)._add(Wi),Qi._rotateAround(Hi,hi)._add(Vn)._add(Wi),dn._rotateAround(Hi,hi)._add(Vn)._add(Wi)}if(Fe){const hi=Math.sin(Fe),Hi=Math.cos(Fe),Et=[Hi,-hi,hi,Hi];bi._matMult(Et),Ii._matMult(Et),Qi._matMult(Et),dn._matMult(Et)}const En=new te(0,0),Tn=new te(0,0);Le.push({tl:bi,tr:Ii,bl:Qi,br:dn,tex:ke,writingMode:ie.writingMode,glyphOffset:Un,sectionIndex:Oe.sectionIndex,isSDF:et,pixelOffsetTL:En,pixelOffsetBR:Tn,minFontScaleX:0,minFontScaleY:0})}return Le}(0,r,v,h,m,y,a,n.allowVerticalPlacement),W=n.textSizeData;let Y=null;W.kind==="source"?(Y=[eo*h.layout.get("text-size").evaluate(y,{})],Y[0]>es&&gt(`${n.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)):W.kind==="composite"&&(Y=[eo*F.compositeTextSizes[0].evaluate(y,{},O),eo*F.compositeTextSizes[1].evaluate(y,{},O)],(Y[0]>es||Y[1]>es)&&gt(`${n.layerIds[0]}: Value for "text-size" is >= ${zu}. Reduce your "text-size".`)),n.addSymbols(n.text,q,Y,v,m,y,C,e,S.lineStartIndex,S.lineLength,L,O);for(const le of I)z[le]=n.text.placedSymbolArray.length-1;return 4*q.length}function Zy(n){for(const e in n)return n[e];return null}function ww(n,e,r,a){const h=n.compareText;if(e in h){const m=h[e];for(let y=m.length-1;y>=0;y--)if(a.dist(m[y])<r)return!0}else h[e]=[];return h[e].push(a),!1}const Gy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qp{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=Gy[15&a];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new qp(v,y,m,e)}constructor(e,r=64,a=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Gy.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-v%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+v+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Zp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:v}=this,S=[0,m.length-1,0],C=[];for(;S.length;){const I=S.pop()||0,z=S.pop()||0,L=S.pop()||0;if(z-L<=v){for(let W=L;W<=z;W++){const Y=y[2*W],le=y[2*W+1];Y>=e&&Y<=a&&le>=r&&le<=h&&C.push(m[W])}continue}const F=L+z>>1,O=y[2*F],q=y[2*F+1];O>=e&&O<=a&&q>=r&&q<=h&&C.push(m[F]),(I===0?e<=O:r<=q)&&(S.push(L),S.push(F-1),S.push(1-I)),(I===0?a>=O:h>=q)&&(S.push(F+1),S.push(z),S.push(1-I))}return C}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:y}=this,v=[0,h.length-1,0],S=[],C=a*a;for(;v.length;){const I=v.pop()||0,z=v.pop()||0,L=v.pop()||0;if(z-L<=y){for(let W=L;W<=z;W++)Wy(m[2*W],m[2*W+1],e,r)<=C&&S.push(h[W]);continue}const F=L+z>>1,O=m[2*F],q=m[2*F+1];Wy(O,q,e,r)<=C&&S.push(h[F]),(I===0?e-a<=O:r-a<=q)&&(v.push(L),v.push(F-1),v.push(1-I)),(I===0?e+a>=O:r+a>=q)&&(v.push(F+1),v.push(z),v.push(1-I))}return S}}function Zp(n,e,r,a,h,m){if(h-a<=r)return;const y=a+h>>1;Hy(n,e,y,a,h,m),Zp(n,e,r,a,y-1,1-m),Zp(n,e,r,y+1,h,1-m)}function Hy(n,e,r,a,h,m){for(;h>a;){if(h-a>600){const C=h-a+1,I=r-a+1,z=Math.log(C),L=.5*Math.exp(2*z/3),F=.5*Math.sqrt(z*L*(C-L)/C)*(I-C/2<0?-1:1);Hy(n,e,r,Math.max(a,Math.floor(r-I*L/C+F)),Math.min(h,Math.floor(r+(C-I)*L/C+F)),m)}const y=e[2*r+m];let v=a,S=h;for(Lu(n,e,a,r),e[2*h+m]>y&&Lu(n,e,a,h);v<S;){for(Lu(n,e,v,S),v++,S--;e[2*v+m]<y;)v++;for(;e[2*S+m]>y;)S--}e[2*a+m]===y?Lu(n,e,a,S):(S++,Lu(n,e,S,h)),S<=r&&(a=S+1),r<=S&&(h=S-1)}}function Lu(n,e,r,a){Gp(n,r,a),Gp(e,2*r,2*a),Gp(e,2*r+1,2*a+1)}function Gp(n,e,r){const a=n[e];n[e]=n[r],n[r]=a}function Wy(n,e,r,a){const h=n-r,m=e-a;return h*h+m*m}var Hp;l.PerformanceMarkers=void 0,(Hp=l.PerformanceMarkers||(l.PerformanceMarkers={})).create="create",Hp.load="load",Hp.fullLoad="fullLoad";let kh=null,Du=[];const Wp=1e3/60,Xp="loadTime",Kp="fullLoadTime",bw={mark(n){performance.mark(n)},frame(n){const e=n;kh!=null&&Du.push(e-kh),kh=e},clearMetrics(){kh=null,Du=[],performance.clearMeasures(Xp),performance.clearMeasures(Kp);for(const n in l.PerformanceMarkers)performance.clearMarks(l.PerformanceMarkers[n])},getPerformanceMetrics(){performance.measure(Xp,l.PerformanceMarkers.create,l.PerformanceMarkers.load),performance.measure(Kp,l.PerformanceMarkers.create,l.PerformanceMarkers.fullLoad);const n=performance.getEntriesByName(Xp)[0].duration,e=performance.getEntriesByName(Kp)[0].duration,r=Du.length,a=1/(Du.reduce((m,y)=>m+y,0)/r/1e3),h=Du.filter(m=>m>Wp).reduce((m,y)=>m+(y-Wp)/Wp,0);return{loadTime:n,fullLoadTime:e,fps:a,percentDroppedFrames:h/(r+h)*100,totalFrames:r}}};l.AJAXError=Ut,l.ARRAY_TYPE=Ja,l.Actor=class{constructor(n,e,r){this.receive=a=>{const h=a.data,m=h.id;if(m&&(!h.targetMapId||this.mapId===h.targetMapId))if(h.type==="<cancel>"){delete this.tasks[m];const y=this.cancelCallbacks[m];delete this.cancelCallbacks[m],y&&y()}else ni()||h.mustQueue?(this.tasks[m]=h,this.taskQueue.push(m),this.invoker.trigger()):this.processTask(m,h)},this.process=()=>{if(!this.taskQueue.length)return;const a=this.taskQueue.shift(),h=this.tasks[a];delete this.tasks[a],this.taskQueue.length&&this.invoker.trigger(),h&&this.processTask(a,h)},this.target=n,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},this.invoker=new dw(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ni()?n:window}send(n,e,r,a,h=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[m]=r);const y=Cr(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:n,hasCallback:!!r,targetMapId:a,mustQueue:h,sourceMapId:this.mapId,data:Fs(e,y)},y),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}processTask(n,e){if(e.type==="<response>"){const r=this.callbacks[n];delete this.callbacks[n],r&&(e.error?r(Ar(e.error)):r(null,Ar(e.data)))}else{let r=!1;const a=Cr(this.globalScope)?void 0:[],h=e.hasCallback?(v,S)=>{r=!0,delete this.cancelCallbacks[n],this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:v?Fs(v):null,data:Fs(S,a)},a)}:v=>{r=!0};let m=null;const y=Ar(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,y,h);else if(this.parent.getWorkerSource){const v=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,v[0],y.source)[v[1]](y,h)}else h(new Error(`Could not find function ${e.type}`));!r&&m&&m.cancel&&(this.cancelCallbacks[n]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},l.AlphaImage=wu,l.CanonicalTileID=Vp,l.CollisionBoxArray=d,l.CollisionCircleLayoutArray=class extends go{},l.Color=ht,l.DEMData=Py,l.DataConstantProperty=Qe,l.DictionaryCoder=My,l.EXTENT=Kt,l.ErrorEvent=lr,l.EvaluationParameters=Qt,l.Event=Ln,l.Evented=Zr,l.FeatureIndex=Ay,l.FillBucket=Ep,l.FillExtrusionBucket=Cp,l.GeoJSONFeature=zy,l.ImageAtlas=cy,l.ImagePosition=zp,l.KDBush=qp,l.LineBucket=kp,l.LineStripIndexArray=class extends t{},l.LngLat=ts,l.MercatorCoordinate=bh,l.ONE_EM=Di,l.OverscaledTileID=Jn,l.PerformanceUtils=bw,l.Point=te,l.Pos3dArray=class extends qa{},l.PosArray=j,l.Properties=ln,l.Protobuf=Pp,l.QuadTriangleArray=class extends Ha{},l.RGBAImage=Yn,l.RasterBoundsArray=class extends gr{},l.RequestPerformance=class{constructor(n){this._marks={start:[n.url,"start"].join("#"),end:[n.url,"end"].join("#"),measure:n.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let n=performance.getEntriesByName(this._marks.measure);return n.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),n=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),n}},l.SegmentVector=Me,l.SymbolBucket=rl,l.Transitionable=rh,l.TriangleIndexArray=xe,l.Uniform1f=yr,l.Uniform1i=class extends Ji{constructor(n,e){super(n,e),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},l.Uniform2f=class extends Ji{constructor(n,e){super(n,e),this.current=[0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1]))}},l.Uniform3f=class extends Ji{constructor(n,e){super(n,e),this.current=[0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2]))}},l.Uniform4f=$s,l.UniformColor=Zi,l.UniformMatrix4f=class extends Ji{constructor(n,e){super(n,e),this.current=Ai}set(n){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let e=1;e<16;e++)if(n[e]!==this.current[e]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}},l.UnwrappedTileID=Iy,l.ValidationError=Be,l.ZoomHistory=Jc,l.addDynamicAttributes=Rp,l.arrayBufferToImage=function(n,e){const r=new Image;r.onload=()=>{e(null,r),URL.revokeObjectURL(r.src),r.onload=null,window.requestAnimationFrame(()=>{r.src=on})},r.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const a=new Blob([new Uint8Array(n)],{type:"image/png"});r.src=n.byteLength?URL.createObjectURL(a):on},l.arrayBufferToImageBitmap=function(n,e){const r=new Blob([new Uint8Array(n)],{type:"image/png"});createImageBitmap(r).then(a=>{e(null,a)}).catch(a=>{e(new Error(`Could not load image because of ${a.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},l.asyncAll=function(n,e,r){if(!n.length)return r(null,[]);let a=n.length;const h=new Array(n.length);let m=null;n.forEach((y,v)=>{e(y,(S,C)=>{S&&(m=S),h[v]=C,--a==0&&r(m,h)})})},l.bezier=Pe,l.browser=dt,l.clamp=J,l.clipLine=Ry,l.clone=function(n){var e=new Ja(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},l.clone$1=Ge,l.collisionCircleLayout=U1,l.config=xt,l.copy=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},l.create=function(){var n=new Ja(16);return Ja!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n},l.createExpression=Ea,l.createFilter=Ca,l.createLayout=wi,l.createStyleLayer=function(n){if(n.type==="custom")return new hw(n);switch(n.type){case"background":return new lw(n);case"circle":return new Hx(n);case"fill":return new p1(n);case"fill-extrusion":return new I1(n);case"heatmap":return new Xx(n);case"hillshade":return new Yx(n);case"line":return new B1(n);case"raster":return new cw(n);case"symbol":return new wh(n)}},l.deepEqual=function n(e,r){if(Array.isArray(e)){if(!Array.isArray(r)||e.length!==r.length)return!1;for(let a=0;a<e.length;a++)if(!n(e[a],r[a]))return!1;return!0}if(typeof e=="object"&&e!==null&&r!==null){if(typeof r!="object"||Object.keys(e).length!==Object.keys(r).length)return!1;for(const a in e)if(!n(e[a],r[a]))return!1;return!0}return e===r},l.defaultEasing=ft,l.derefLayers=function(n){n=n.slice();const e=Object.create(null);for(let r=0;r<n.length;r++)e[n[r].id]=n[r];for(let r=0;r<n.length;r++)"ref"in n[r]&&(n[r]=Ao(n[r],e[n[r].ref]));return n},l.diffStyles=function(n,e){if(!n)return[{command:Dt.setStyle,args:[e]}];let r=[];try{if(!jt(n.version,e.version))return[{command:Dt.setStyle,args:[e]}];jt(n.center,e.center)||r.push({command:Dt.setCenter,args:[e.center]}),jt(n.zoom,e.zoom)||r.push({command:Dt.setZoom,args:[e.zoom]}),jt(n.bearing,e.bearing)||r.push({command:Dt.setBearing,args:[e.bearing]}),jt(n.pitch,e.pitch)||r.push({command:Dt.setPitch,args:[e.pitch]}),jt(n.sprite,e.sprite)||r.push({command:Dt.setSprite,args:[e.sprite]}),jt(n.glyphs,e.glyphs)||r.push({command:Dt.setGlyphs,args:[e.glyphs]}),jt(n.transition,e.transition)||r.push({command:Dt.setTransition,args:[e.transition]}),jt(n.light,e.light)||r.push({command:Dt.setLight,args:[e.light]});const a={},h=[];(function(y,v,S,C){let I;for(I in v=v||{},y=y||{})Object.prototype.hasOwnProperty.call(y,I)&&(Object.prototype.hasOwnProperty.call(v,I)||lo(I,S,C));for(I in v)Object.prototype.hasOwnProperty.call(v,I)&&(Object.prototype.hasOwnProperty.call(y,I)?jt(y[I],v[I])||(y[I].type==="geojson"&&v[I].type==="geojson"&&ca(y,v,I)?S.push({command:Dt.setGeoJSONSourceData,args:[I,v[I].data]}):ua(I,v,S,C)):ao(I,v,S))})(n.sources,e.sources,h,a);const m=[];n.layers&&n.layers.forEach(y=>{a[y.source]?r.push({command:Dt.removeLayer,args:[y.id]}):m.push(y)}),r=r.concat(h),function(y,v,S){v=v||[];const C=(y=y||[]).map(Es),I=v.map(Es),z=y.reduce(Lo,{}),L=v.reduce(Lo,{}),F=C.slice(),O=Object.create(null);let q,W,Y,le,ie,de,fe;for(q=0,W=0;q<C.length;q++)Y=C[q],Object.prototype.hasOwnProperty.call(L,Y)?W++:(S.push({command:Dt.removeLayer,args:[Y]}),F.splice(F.indexOf(Y,W),1));for(q=0,W=0;q<I.length;q++)Y=I[I.length-1-q],F[F.length-1-q]!==Y&&(Object.prototype.hasOwnProperty.call(z,Y)?(S.push({command:Dt.removeLayer,args:[Y]}),F.splice(F.lastIndexOf(Y,F.length-W),1)):W++,de=F[F.length-q],S.push({command:Dt.addLayer,args:[L[Y],de]}),F.splice(F.length-q,0,Y),O[Y]=!0);for(q=0;q<I.length;q++)if(Y=I[q],le=z[Y],ie=L[Y],!O[Y]&&!jt(le,ie))if(jt(le.source,ie.source)&&jt(le["source-layer"],ie["source-layer"])&&jt(le.type,ie.type)){for(fe in ri(le.layout,ie.layout,S,Y,null,Dt.setLayoutProperty),ri(le.paint,ie.paint,S,Y,null,Dt.setPaintProperty),jt(le.filter,ie.filter)||S.push({command:Dt.setFilter,args:[Y,ie.filter]}),jt(le.minzoom,ie.minzoom)&&jt(le.maxzoom,ie.maxzoom)||S.push({command:Dt.setLayerZoomRange,args:[Y,ie.minzoom,ie.maxzoom]}),le)Object.prototype.hasOwnProperty.call(le,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?ri(le[fe],ie[fe],S,Y,fe.slice(6),Dt.setPaintProperty):jt(le[fe],ie[fe])||S.push({command:Dt.setLayerProperty,args:[Y,fe,ie[fe]]}));for(fe in ie)Object.prototype.hasOwnProperty.call(ie,fe)&&!Object.prototype.hasOwnProperty.call(le,fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&(fe.indexOf("paint.")===0?ri(le[fe],ie[fe],S,Y,fe.slice(6),Dt.setPaintProperty):jt(le[fe],ie[fe])||S.push({command:Dt.setLayerProperty,args:[Y,fe,ie[fe]]}))}else S.push({command:Dt.removeLayer,args:[Y]}),de=F[F.lastIndexOf(Y)+1],S.push({command:Dt.addLayer,args:[ie,de]})}(m,e.layers,r)}catch(a){console.warn("Unable to compute style diff:",a),r=[{command:Dt.setStyle,args:[e]}]}return r},l.dot=function(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]*e[3]},l.earthRadius=Np,l.emitValidationErrors=Wo,l.emptyStyle=function(){const n={},e=ge.$version;for(const r in ge.$root){const a=ge.$root[r];if(a.required){let h=null;h=r==="version"?e:a.type==="array"?[]:{},h!=null&&(n[r]=h)}}return n},l.equals=function(n,e){var r=n[0],a=n[1],h=n[2],m=n[3],y=n[4],v=n[5],S=n[6],C=n[7],I=n[8],z=n[9],L=n[10],F=n[11],O=n[12],q=n[13],W=n[14],Y=n[15],le=e[0],ie=e[1],de=e[2],fe=e[3],we=e[4],qe=e[5],Xe=e[6],$e=e[7],Fe=e[8],Le=e[9],Ze=e[10],Oe=e[11],ke=e[12],rt=e[13],et=e[14],bt=e[15];return Math.abs(r-le)<=un*Math.max(1,Math.abs(r),Math.abs(le))&&Math.abs(a-ie)<=un*Math.max(1,Math.abs(a),Math.abs(ie))&&Math.abs(h-de)<=un*Math.max(1,Math.abs(h),Math.abs(de))&&Math.abs(m-fe)<=un*Math.max(1,Math.abs(m),Math.abs(fe))&&Math.abs(y-we)<=un*Math.max(1,Math.abs(y),Math.abs(we))&&Math.abs(v-qe)<=un*Math.max(1,Math.abs(v),Math.abs(qe))&&Math.abs(S-Xe)<=un*Math.max(1,Math.abs(S),Math.abs(Xe))&&Math.abs(C-$e)<=un*Math.max(1,Math.abs(C),Math.abs($e))&&Math.abs(I-Fe)<=un*Math.max(1,Math.abs(I),Math.abs(Fe))&&Math.abs(z-Le)<=un*Math.max(1,Math.abs(z),Math.abs(Le))&&Math.abs(L-Ze)<=un*Math.max(1,Math.abs(L),Math.abs(Ze))&&Math.abs(F-Oe)<=un*Math.max(1,Math.abs(F),Math.abs(Oe))&&Math.abs(O-ke)<=un*Math.max(1,Math.abs(O),Math.abs(ke))&&Math.abs(q-rt)<=un*Math.max(1,Math.abs(q),Math.abs(rt))&&Math.abs(W-et)<=un*Math.max(1,Math.abs(W),Math.abs(et))&&Math.abs(Y-bt)<=un*Math.max(1,Math.abs(Y),Math.abs(bt))},l.evaluateSizeForFeature=function(n,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:h}){return n.kind==="source"?a/eo:n.kind==="composite"?_n.number(a/eo,h/eo,r):e},l.evaluateSizeForZoom=function(n,e){let r=0,a=0;if(n.kind==="constant")a=n.layoutSize;else if(n.kind!=="source"){const{interpolationType:h,minZoom:m,maxZoom:y}=n,v=h?J(vn.interpolationFactor(h,e,m,y),0,1):0;n.kind==="camera"?a=_n.number(n.minSize,n.maxSize,v):r=v}return{uSizeT:r,uSize:a}},l.evaluateVariableOffset=$y,l.evented=Na,l.extend=re,l.filterObject=Ue,l.findLineIntersection=function(n,e,r,a){const h=e.y-n.y,m=e.x-n.x,y=a.y-r.y,v=a.x-r.x,S=y*m-v*h;if(S===0)return null;const C=(v*(n.y-r.y)-y*(n.x-r.x))/S;return new te(n.x+C*m,n.y+C*h)},l.fromScaling=function(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},l.getAnchorAlignment=Lp,l.getAnchorJustification=$p,l.getArrayBuffer=yn,l.getDefaultExportFromCjs=N,l.getJSON=function(n,e){return Hn(re(n,{type:"json"}),e)},l.getOverlapMode=Dp,l.getProtocolAction=Oi,l.getRTLTextPluginStatus=lu,l.getReferrer=Vt,l.getVideo=function(n,e){const r=window.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<n.length;a++){const h=window.document.createElement("source");An(n[a])||(r.crossOrigin="Anonymous"),h.src=n[a],r.appendChild(h)}return{cancel:()=>{}}},l.groupByLayout=function(n,e){const r={};for(let h=0;h<n.length;h++){const m=e&&e[n[h].id]||tu(n[h]);e&&(e[n[h].id]=m);let y=r[m];y||(y=r[m]=[]),y.push(n[h])}const a=[];for(const h in r)a.push(r[h]);return a},l.identity=fp,l.interpolate=_n,l.invert=function(n,e){var r=e[0],a=e[1],h=e[2],m=e[3],y=e[4],v=e[5],S=e[6],C=e[7],I=e[8],z=e[9],L=e[10],F=e[11],O=e[12],q=e[13],W=e[14],Y=e[15],le=r*v-a*y,ie=r*S-h*y,de=r*C-m*y,fe=a*S-h*v,we=a*C-m*v,qe=h*C-m*S,Xe=I*q-z*O,$e=I*W-L*O,Fe=I*Y-F*O,Le=z*W-L*q,Ze=z*Y-F*q,Oe=L*Y-F*W,ke=le*Oe-ie*Ze+de*Le+fe*Fe-we*$e+qe*Xe;return ke?(n[0]=(v*Oe-S*Ze+C*Le)*(ke=1/ke),n[1]=(h*Ze-a*Oe-m*Le)*ke,n[2]=(q*qe-W*we+Y*fe)*ke,n[3]=(L*we-z*qe-F*fe)*ke,n[4]=(S*Fe-y*Oe-C*$e)*ke,n[5]=(r*Oe-h*Fe+m*$e)*ke,n[6]=(W*de-O*qe-Y*ie)*ke,n[7]=(I*qe-L*de+F*ie)*ke,n[8]=(y*Ze-v*Fe+C*Xe)*ke,n[9]=(a*Fe-r*Ze-m*Xe)*ke,n[10]=(O*we-q*de+Y*le)*ke,n[11]=(z*de-I*we-F*le)*ke,n[12]=(v*$e-y*Le-S*Xe)*ke,n[13]=(r*Le-a*$e+h*Xe)*ke,n[14]=(q*ie-O*fe-W*le)*ke,n[15]=(I*fe-z*ie+L*le)*ke,n):null},l.isImageBitmap=sr,l.isSafari=Cr,l.isWorker=ni,l.keysDifference=function(n,e){const r=[];for(const a in n)a in e||r.push(a);return r},l.lazyLoadRTLTextPlugin=function(){Nn.isLoading()||Nn.isLoaded()||lu()!=="deferred"||nh()},l.makeRequest=Hn,l.mapObject=Ae,l.mercatorXfromLng=Ey,l.mercatorYfromLat=Ty,l.mercatorZfromAltitude=Cy,l.mul=Gx,l.mul$1=function(n,e,r){return n[0]=e[0]*r[0],n[1]=e[1]*r[1],n[2]=e[2]*r[2],n[3]=e[3]*r[3],n},l.multiply=Pg,l.nextPowerOfTwo=function(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},l.operations=Dt,l.ortho=function(n,e,r,a,h,m,y){var v=1/(e-r),S=1/(a-h),C=1/(m-y);return n[0]=-2*v,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*S,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*C,n[11]=0,n[12]=(e+r)*v,n[13]=(h+a)*S,n[14]=(y+m)*C,n[15]=1,n},l.parseCacheControl=function(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,h,m)=>{const y=h||m;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e},l.parseGlyphPbf=function(n){return new Pp(n).readFields(Y1,[])},l.pbf=ty,l.performSymbolLayout=function(n){n.bucket.createArrays(),n.bucket.tilePixelRatio=Kt/(512*n.bucket.overscaling),n.bucket.compareText={},n.bucket.iconsNeedLinear=!1;const e=n.bucket.layers[0].layout,r=n.bucket.layers[0]._unevaluatedLayout._values,a={layoutIconSize:r["icon-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),layoutTextSize:r["text-size"].possiblyEvaluate(new Qt(n.bucket.zoom+1),n.canonical),textMaxSize:r["text-size"].possiblyEvaluate(new Qt(18))};if(n.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:C}=n.bucket.textSizeData;a.compositeTextSizes=[r["text-size"].possiblyEvaluate(new Qt(S),n.canonical),r["text-size"].possiblyEvaluate(new Qt(C),n.canonical)]}if(n.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:C}=n.bucket.iconSizeData;a.compositeIconSizes=[r["icon-size"].possiblyEvaluate(new Qt(S),n.canonical),r["icon-size"].possiblyEvaluate(new Qt(C),n.canonical)]}const h=e.get("text-line-height")*Di,m=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",y=e.get("text-keep-upright"),v=e.get("text-size");for(const S of n.bucket.features){const C=e.get("text-font").evaluate(S,{},n.canonical).join(","),I=v.evaluate(S,{},n.canonical),z=a.layoutTextSize.evaluate(S,{},n.canonical),L=a.layoutIconSize.evaluate(S,{},n.canonical),F={horizontal:{},vertical:void 0},O=S.text;let q,W=[0,0];if(O){const ie=O.toString(),de=e.get("text-letter-spacing").evaluate(S,{},n.canonical)*Di,fe=ru(ie)?de:0,we=e.get("text-anchor").evaluate(S,{},n.canonical),qe=e.get("text-variable-anchor");if(!qe){const Ze=e.get("text-radial-offset").evaluate(S,{},n.canonical);W=Ze?$y(we,[Ze*Di,jp]):e.get("text-offset").evaluate(S,{},n.canonical).map(Oe=>Oe*Di)}let Xe=m?"center":e.get("text-justify").evaluate(S,{},n.canonical);const $e=e.get("symbol-placement"),Fe=$e==="point"?e.get("text-max-width").evaluate(S,{},n.canonical)*Di:0,Le=()=>{n.bucket.allowVerticalPlacement&&Da(ie)&&(F.vertical=_h(O,n.glyphMap,n.glyphPositions,n.imagePositions,C,Fe,h,we,"left",fe,W,l.WritingMode.vertical,!0,$e,z,I))};if(!m&&qe){const Ze=Xe==="auto"?qe.map(ke=>$p(ke)):[Xe];let Oe=!1;for(let ke=0;ke<Ze.length;ke++){const rt=Ze[ke];if(!F.horizontal[rt])if(Oe)F.horizontal[rt]=F.horizontal[0];else{const et=_h(O,n.glyphMap,n.glyphPositions,n.imagePositions,C,Fe,h,"center",rt,fe,W,l.WritingMode.horizontal,!1,$e,z,I);et&&(F.horizontal[rt]=et,Oe=et.positionedLines.length===1)}}Le()}else{Xe==="auto"&&(Xe=$p(we));const Ze=_h(O,n.glyphMap,n.glyphPositions,n.imagePositions,C,Fe,h,we,Xe,fe,W,l.WritingMode.horizontal,!1,$e,z,I);Ze&&(F.horizontal[Xe]=Ze),Le(),Da(ie)&&m&&y&&(F.vertical=_h(O,n.glyphMap,n.glyphPositions,n.imagePositions,C,Fe,h,we,Xe,fe,W,l.WritingMode.vertical,!1,$e,z,I))}}let Y=!1;if(S.icon&&S.icon.name){const ie=n.imageMap[S.icon.name];ie&&(q=nw(n.imagePositions[S.icon.name],e.get("icon-offset").evaluate(S,{},n.canonical),e.get("icon-anchor").evaluate(S,{},n.canonical)),Y=!!ie.sdf,n.bucket.sdfIcons===void 0?n.bucket.sdfIcons=Y:n.bucket.sdfIcons!==Y&&gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ie.pixelRatio!==n.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(n.bucket.iconsNeedLinear=!0))}const le=Zy(F.horizontal)||F.vertical;n.bucket.iconsInText=!!le&&le.iconsInText,(le||q)&&xw(n.bucket,S,F,q,n.imageMap,a,z,L,W,Y,n.canonical)}n.showCollisionBoxes&&n.bucket.generateCollisionDebugBuffers()},l.perspective=function(n,e,r,a,h){var m,y=1/Math.tan(e/2);return n[0]=y/r,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=y,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,h!=null&&h!==1/0?(n[10]=(h+a)*(m=1/(a-h)),n[14]=2*h*a*m):(n[10]=-1,n[14]=-2*a),n},l.pick=function(n,e){const r={};for(let a=0;a<e.length;a++){const h=e[a];h in n&&(r[h]=n[h])}return r},l.plugin=Nn,l.pointGeometry=D,l.polygonIntersectsPolygon=Sg,l.potpack=uy,l.register=He,l.registerForPluginStateChange=function(n){return n({pluginStatus:an,pluginURL:Qr}),Na.on("pluginStateChange",n),n},l.renderColorRamp=Dg,l.rotateX=function(n,e,r){var a=Math.sin(r),h=Math.cos(r),m=e[4],y=e[5],v=e[6],S=e[7],C=e[8],I=e[9],z=e[10],L=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=m*h+C*a,n[5]=y*h+I*a,n[6]=v*h+z*a,n[7]=S*h+L*a,n[8]=C*h-m*a,n[9]=I*h-y*a,n[10]=z*h-v*a,n[11]=L*h-S*a,n},l.rotateZ=function(n,e,r){var a=Math.sin(r),h=Math.cos(r),m=e[0],y=e[1],v=e[2],S=e[3],C=e[4],I=e[5],z=e[6],L=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=m*h+C*a,n[1]=y*h+I*a,n[2]=v*h+z*a,n[3]=S*h+L*a,n[4]=C*h-m*a,n[5]=I*h-y*a,n[6]=z*h-v*a,n[7]=L*h-S*a,n},l.sameOrigin=An,l.scale=function(n,e,r){var a=r[0],h=r[1],m=r[2];return n[0]=e[0]*a,n[1]=e[1]*a,n[2]=e[2]*a,n[3]=e[3]*a,n[4]=e[4]*h,n[5]=e[5]*h,n[6]=e[6]*h,n[7]=e[7]*h,n[8]=e[8]*m,n[9]=e[9]*m,n[10]=e[10]*m,n[11]=e[11]*m,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n},l.setRTLTextPlugin=function(n,e,r=!1){if(an===ou||an===Oa||an===su)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qr=dt.resolveURL(n),an=ou,Os=e,au(),r||nh()},l.sphericalToCartesian=function([n,e,r]){return e+=90,e*=Math.PI/180,r*=Math.PI/180,{x:n*Math.cos(e)*Math.sin(r),y:n*Math.sin(e)*Math.sin(r),z:n*Math.cos(r)}},l.toEvaluationFeature=Zs,l.transformMat4=hh,l.translate=function(n,e,r){var a,h,m,y,v,S,C,I,z,L,F,O,q=r[0],W=r[1],Y=r[2];return e===n?(n[12]=e[0]*q+e[4]*W+e[8]*Y+e[12],n[13]=e[1]*q+e[5]*W+e[9]*Y+e[13],n[14]=e[2]*q+e[6]*W+e[10]*Y+e[14],n[15]=e[3]*q+e[7]*W+e[11]*Y+e[15]):(h=e[1],m=e[2],y=e[3],v=e[4],S=e[5],C=e[6],I=e[7],z=e[8],L=e[9],F=e[10],O=e[11],n[0]=a=e[0],n[1]=h,n[2]=m,n[3]=y,n[4]=v,n[5]=S,n[6]=C,n[7]=I,n[8]=z,n[9]=L,n[10]=F,n[11]=O,n[12]=a*q+v*W+z*Y+e[12],n[13]=h*q+S*W+L*Y+e[13],n[14]=m*q+C*W+F*Y+e[14],n[15]=y*q+I*W+O*Y+e[15]),n},l.triggerPluginCompletionEvent=ih,l.unicodeBlockLookup=Ne,l.uniqueId=function(){return ve++},l.v8Spec=ge,l.validateCustomStyleLayer=function(n){const e=[],r=n.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},l.validateLight=ap,l.validateStyle=Jr,l.vectorTile=Jo,l.warnOnce=gt,l.wrap=K}),b(["./shared"],function(l){class N{constructor(A){this.keyCache={},A&&this.replace(A)}replace(A){this._layerConfigs={},this._layers={},this.update(A,[])}update(A,R){for(const X of A){this._layerConfigs[X.id]=X;const Q=this._layers[X.id]=l.createStyleLayer(X);Q._featureFilter=l.createFilter(Q.filter),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of R)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const U=l.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const X of U){const Q=X.map(Te=>this._layers[Te.id]),ae=Q[0];if(ae.visibility==="none")continue;const ne=ae.source||"";let ee=this.familiesBySource[ne];ee||(ee=this.familiesBySource[ne]={});const ue=ae.sourceLayer||"_geojsonTileLayer";let be=ee[ue];be||(be=ee[ue]=[]),be.push(Q)}}}class D{constructor(A){const R={},U=[];for(const ne in A){const ee=A[ne],ue=R[ne]={};for(const be in ee){const Te=ee[+be];if(!Te||Te.bitmap.width===0||Te.bitmap.height===0)continue;const Ee={x:0,y:0,w:Te.bitmap.width+2,h:Te.bitmap.height+2};U.push(Ee),ue[be]={rect:Ee,metrics:Te.metrics}}}const{w:X,h:Q}=l.potpack(U),ae=new l.AlphaImage({width:X||1,height:Q||1});for(const ne in A){const ee=A[ne];for(const ue in ee){const be=ee[+ue];if(!be||be.bitmap.width===0||be.bitmap.height===0)continue;const Te=R[ne][ue].rect;l.AlphaImage.copy(be.bitmap,ae,{x:0,y:0},{x:Te.x+1,y:Te.y+1},be.bitmap)}}this.image=ae,this.positions=R}}l.register("GlyphAtlas",D);class oe{constructor(A){this.tileID=new l.OverscaledTileID(A.tileID.overscaledZ,A.tileID.wrap,A.tileID.canonical.z,A.tileID.canonical.x,A.tileID.canonical.y),this.uid=A.uid,this.zoom=A.zoom,this.pixelRatio=A.pixelRatio,this.tileSize=A.tileSize,this.source=A.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=A.showCollisionBoxes,this.collectResourceTiming=!!A.collectResourceTiming,this.returnDependencies=!!A.returnDependencies,this.promoteId=A.promoteId}parse(A,R,U,X,Q){this.status="parsing",this.data=A,this.collisionBoxArray=new l.CollisionBoxArray;const ae=new l.DictionaryCoder(Object.keys(A.layers).sort()),ne=new l.FeatureIndex(this.tileID,this.promoteId);ne.bucketLayerIDs=[];const ee={},ue={featureIndex:ne,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:U},be=R.familiesBySource[this.source];for(const vt in be){const Nt=A.layers[vt];if(!Nt)continue;Nt.version===1&&l.warnOnce(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Gt=ae.encode(vt),ht=[];for(let Jt=0;Jt<Nt.length;Jt++){const oi=Nt.feature(Jt),Mi=ne.getId(oi,vt);ht.push({feature:oi,id:Mi,index:Jt,sourceLayerIndex:Gt})}for(const Jt of be[vt]){const oi=Jt[0];oi.source!==this.source&&l.warnOnce(`layer.source = ${oi.source} does not equal this.source = ${this.source}`),oi.minzoom&&this.zoom<Math.floor(oi.minzoom)||oi.maxzoom&&this.zoom>=oi.maxzoom||oi.visibility!=="none"&&(te(Jt,this.zoom,U),(ee[oi.id]=oi.createBucket({index:ne.bucketLayerIDs.length,layers:Jt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Gt,sourceID:this.source})).populate(ht,ue,this.tileID.canonical),ne.bucketLayerIDs.push(Jt.map(Mi=>Mi.id)))}}let Te,Ee,nt,pt;const Ye=l.mapObject(ue.glyphDependencies,vt=>Object.keys(vt).map(Number));Object.keys(Ye).length?X.send("getGlyphs",{uid:this.uid,stacks:Ye,source:this.source,tileID:this.tileID,type:"glyphs"},(vt,Nt)=>{Te||(Te=vt,Ee=Nt,It.call(this))}):Ee={};const it=Object.keys(ue.iconDependencies);it.length?X.send("getImages",{icons:it,source:this.source,tileID:this.tileID,type:"icons"},(vt,Nt)=>{Te||(Te=vt,nt=Nt,It.call(this))}):nt={};const ct=Object.keys(ue.patternDependencies);function It(){if(Te)return Q(Te);if(Ee&&nt&&pt){const vt=new D(Ee),Nt=new l.ImageAtlas(nt,pt);for(const Gt in ee){const ht=ee[Gt];ht instanceof l.SymbolBucket?(te(ht.layers,this.zoom,U),l.performSymbolLayout({bucket:ht,glyphMap:Ee,glyphPositions:vt.positions,imageMap:nt,imagePositions:Nt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ht.hasPattern&&(ht instanceof l.LineBucket||ht instanceof l.FillBucket||ht instanceof l.FillExtrusionBucket)&&(te(ht.layers,this.zoom,U),ht.addFeatures(ue,this.tileID.canonical,Nt.patternPositions))}this.status="done",Q(null,{buckets:Object.values(ee).filter(Gt=>!Gt.isEmpty()),featureIndex:ne,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vt.image,imageAtlas:Nt,glyphMap:this.returnDependencies?Ee:null,iconMap:this.returnDependencies?nt:null,glyphPositions:this.returnDependencies?vt.positions:null})}}ct.length?X.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"patterns"},(vt,Nt)=>{Te||(Te=vt,pt=Nt,It.call(this))}):pt={},It.call(this)}}function te(G,A,R){const U=new l.EvaluationParameters(A);for(const X of G)X.recalculate(U,R)}function he(G,A){const R=l.getArrayBuffer(G.request,(U,X,Q,ae)=>{U?A(U):X&&A(null,{vectorTile:new l.vectorTile.VectorTile(new l.Protobuf(X)),rawData:X,cacheControl:Q,expires:ae})});return()=>{R.cancel(),A()}}class Ie{constructor(A,R,U,X){this.actor=A,this.layerIndex=R,this.availableImages=U,this.loadVectorData=X||he,this.loading={},this.loaded={}}loadTile(A,R){const U=A.uid;this.loading||(this.loading={});const X=!!(A&&A.request&&A.request.collectResourceTiming)&&new l.RequestPerformance(A.request),Q=this.loading[U]=new oe(A);Q.abort=this.loadVectorData(A,(ae,ne)=>{if(delete this.loading[U],ae||!ne)return Q.status="done",this.loaded[U]=Q,R(ae);const ee=ne.rawData,ue={};ne.expires&&(ue.expires=ne.expires),ne.cacheControl&&(ue.cacheControl=ne.cacheControl);const be={};if(X){const Te=X.finish();Te&&(be.resourceTiming=JSON.parse(JSON.stringify(Te)))}Q.vectorTile=ne.vectorTile,Q.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,(Te,Ee)=>{if(Te||!Ee)return R(Te);R(null,l.extend({rawTileData:ee.slice(0)},Ee,ue,be))}),this.loaded=this.loaded||{},this.loaded[U]=Q})}reloadTile(A,R){const U=this.loaded,X=A.uid,Q=this;if(U&&U[X]){const ae=U[X];ae.showCollisionBoxes=A.showCollisionBoxes;const ne=(ee,ue)=>{const be=ae.reloadCallback;be&&(delete ae.reloadCallback,ae.parse(ae.vectorTile,Q.layerIndex,this.availableImages,Q.actor,be)),R(ee,ue)};ae.status==="parsing"?ae.reloadCallback=ne:ae.status==="done"&&(ae.vectorTile?ae.parse(ae.vectorTile,this.layerIndex,this.availableImages,this.actor,ne):ne())}}abortTile(A,R){const U=this.loading,X=A.uid;U&&U[X]&&U[X].abort&&(U[X].abort(),delete U[X]),R()}removeTile(A,R){const U=this.loaded,X=A.uid;U&&U[X]&&delete U[X],R()}}class Ce{constructor(){this.loaded={}}loadTile(A,R){const{uid:U,encoding:X,rawImageData:Q}=A,ae=l.isImageBitmap(Q)?this.getImageData(Q):Q,ne=new l.DEMData(U,ae,X);this.loaded=this.loaded||{},this.loaded[U]=ne,R(null,ne)}getImageData(A){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(A.width,A.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=A.width,this.offscreenCanvas.height=A.height,this.offscreenCanvasContext.drawImage(A,0,0,A.width,A.height);const R=this.offscreenCanvasContext.getImageData(-1,-1,A.width+2,A.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new l.RGBAImage({width:R.width,height:R.height},R.data)}removeTile(A){const R=this.loaded,U=A.uid;R&&R[U]&&delete R[U]}}function Pe(G,A){if(G.length!==0){ft(G[0],A);for(var R=1;R<G.length;R++)ft(G[R],!A)}}function ft(G,A){for(var R=0,U=0,X=0,Q=G.length,ae=Q-1;X<Q;ae=X++){var ne=(G[X][0]-G[ae][0])*(G[ae][1]+G[X][1]),ee=R+ne;U+=Math.abs(R)>=Math.abs(ne)?R-ee+ne:ne-ee+R,R=ee}R+U>=0!=!!A&&G.reverse()}var J=l.getDefaultExportFromCjs(function G(A,R){var U,X=A&&A.type;if(X==="FeatureCollection")for(U=0;U<A.features.length;U++)G(A.features[U],R);else if(X==="GeometryCollection")for(U=0;U<A.geometries.length;U++)G(A.geometries[U],R);else if(X==="Feature")G(A.geometry,R);else if(X==="Polygon")Pe(A.coordinates,R);else if(X==="MultiPolygon")for(U=0;U<A.coordinates.length;U++)Pe(A.coordinates[U],R);return A});const K=l.vectorTile.VectorTileFeature.prototype.toGeoJSON;var re={exports:{}},ve=l.pointGeometry,Ae=l.vectorTile.VectorTileFeature,Ue=Ge;function Ge(G,A){this.options=A||{},this.features=G,this.length=G.length}function Ve(G,A){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=A||4096}Ge.prototype.feature=function(G){return new Ve(this.features[G],this.options.extent)},Ve.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var A=0;A<G.length;A++){for(var R=G[A],U=[],X=0;X<R.length;X++)U.push(new ve(R[X][0],R[X][1]));this.geometry.push(U)}return this.geometry},Ve.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,A=1/0,R=-1/0,U=1/0,X=-1/0,Q=0;Q<G.length;Q++)for(var ae=G[Q],ne=0;ne<ae.length;ne++){var ee=ae[ne];A=Math.min(A,ee.x),R=Math.max(R,ee.x),U=Math.min(U,ee.y),X=Math.max(X,ee.y)}return[A,U,R,X]},Ve.prototype.toGeoJSON=Ae.prototype.toGeoJSON;var gt=l.pbf,Je=Ue;function qt(G){var A=new gt;return function(R,U){for(var X in R.layers)U.writeMessage(3,ni,R.layers[X])}(G,A),A.finish()}function ni(G,A){var R;A.writeVarintField(15,G.version||1),A.writeStringField(1,G.name||""),A.writeVarintField(5,G.extent||4096);var U={keys:[],values:[],keycache:{},valuecache:{}};for(R=0;R<G.length;R++)U.feature=G.feature(R),A.writeMessage(2,Fi,U);var X=U.keys;for(R=0;R<X.length;R++)A.writeStringField(3,X[R]);var Q=U.values;for(R=0;R<Q.length;R++)A.writeMessage(4,We,Q[R])}function Fi(G,A){var R=G.feature;R.id!==void 0&&A.writeVarintField(1,R.id),A.writeMessage(2,Cr,G),A.writeVarintField(3,R.type),A.writeMessage(4,ar,R)}function Cr(G,A){var R=G.feature,U=G.keys,X=G.values,Q=G.keycache,ae=G.valuecache;for(var ne in R.properties){var ee=R.properties[ne],ue=Q[ne];if(ee!==null){ue===void 0&&(U.push(ne),Q[ne]=ue=U.length-1),A.writeVarint(ue);var be=typeof ee;be!=="string"&&be!=="boolean"&&be!=="number"&&(ee=JSON.stringify(ee));var Te=be+":"+ee,Ee=ae[Te];Ee===void 0&&(X.push(ee),ae[Te]=Ee=X.length-1),A.writeVarint(Ee)}}}function sr(G,A){return(A<<3)+(7&G)}function on(G){return G<<1^G>>31}function ar(G,A){for(var R=G.loadGeometry(),U=G.type,X=0,Q=0,ae=R.length,ne=0;ne<ae;ne++){var ee=R[ne],ue=1;U===1&&(ue=ee.length),A.writeVarint(sr(1,ue));for(var be=U===3?ee.length-1:ee.length,Te=0;Te<be;Te++){Te===1&&U!==1&&A.writeVarint(sr(2,be-1));var Ee=ee[Te].x-X,nt=ee[Te].y-Q;A.writeVarint(on(Ee)),A.writeVarint(on(nt)),X+=Ee,Q+=nt}U===3&&A.writeVarint(sr(7,1))}}function We(G,A){var R=typeof G;R==="string"?A.writeStringField(1,G):R==="boolean"?A.writeBooleanField(7,G):R==="number"&&(G%1!=0?A.writeDoubleField(3,G):G<0?A.writeSVarintField(6,G):A.writeVarintField(5,G))}re.exports=qt,re.exports.fromVectorTileJs=qt,re.exports.fromGeojsonVt=function(G,A){A=A||{};var R={};for(var U in G)R[U]=new Je(G[U].features,A),R[U].name=U,R[U].version=A.version,R[U].extent=A.extent;return qt({layers:R})},re.exports.GeoJSONWrapper=Je;var dt=l.getDefaultExportFromCjs(re.exports);const xt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:G=>G},Ut=Math.fround||(Vt=new Float32Array(1),G=>(Vt[0]=+G,Vt[0]));var Vt;const Oi=3,Bt=5,Hn=6;class yn{constructor(A){this.options=Object.assign(Object.create(xt),A),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(A){const{log:R,minZoom:U,maxZoom:X}=this.options;R&&console.time("total time");const Q=`prepare ${A.length} points`;R&&console.time(Q),this.points=A;const ae=[];for(let ee=0;ee<A.length;ee++){const ue=A[ee];if(!ue.geometry)continue;const[be,Te]=ue.geometry.coordinates,Ee=Ut(kr(be)),nt=Ut(Ln(Te));ae.push(Ee,nt,1/0,ee,-1,1),this.options.reduce&&ae.push(0)}let ne=this.trees[X+1]=this._createTree(ae);R&&console.timeEnd(Q);for(let ee=X;ee>=U;ee--){const ue=+Date.now();ne=this.trees[ee]=this._createTree(this._cluster(ne,ee)),R&&console.log("z%d: %d clusters in %dms",ee,ne.numItems,+Date.now()-ue)}return R&&console.timeEnd("total time"),this}getClusters(A,R){let U=((A[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,A[1]));let Q=A[2]===180?180:((A[2]+180)%360+360)%360-180;const ae=Math.max(-90,Math.min(90,A[3]));if(A[2]-A[0]>=360)U=-180,Q=180;else if(U>Q){const Te=this.getClusters([U,X,180,ae],R),Ee=this.getClusters([-180,X,Q,ae],R);return Te.concat(Ee)}const ne=this.trees[this._limitZoom(R)],ee=ne.range(kr(U),Ln(ae),kr(Q),Ln(X)),ue=ne.data,be=[];for(const Te of ee){const Ee=this.stride*Te;be.push(ue[Ee+Bt]>1?An(ue,Ee,this.clusterProps):this.points[ue[Ee+Oi]])}return be}getChildren(A){const R=this._getOriginId(A),U=this._getOriginZoom(A),X="No cluster with the specified id.",Q=this.trees[U];if(!Q)throw new Error(X);const ae=Q.data;if(R*this.stride>=ae.length)throw new Error(X);const ne=this.options.radius/(this.options.extent*Math.pow(2,U-1)),ee=Q.within(ae[R*this.stride],ae[R*this.stride+1],ne),ue=[];for(const be of ee){const Te=be*this.stride;ae[Te+4]===A&&ue.push(ae[Te+Bt]>1?An(ae,Te,this.clusterProps):this.points[ae[Te+Oi]])}if(ue.length===0)throw new Error(X);return ue}getLeaves(A,R,U){const X=[];return this._appendLeaves(X,A,R=R||10,U=U||0,0),X}getTile(A,R,U){const X=this.trees[this._limitZoom(A)],Q=Math.pow(2,A),{extent:ae,radius:ne}=this.options,ee=ne/ae,ue=(U-ee)/Q,be=(U+1+ee)/Q,Te={features:[]};return this._addTileFeatures(X.range((R-ee)/Q,ue,(R+1+ee)/Q,be),X.data,R,U,Q,Te),R===0&&this._addTileFeatures(X.range(1-ee/Q,ue,1,be),X.data,Q,U,Q,Te),R===Q-1&&this._addTileFeatures(X.range(0,ue,ee/Q,be),X.data,-1,U,Q,Te),Te.features.length?Te:null}getClusterExpansionZoom(A){let R=this._getOriginZoom(A)-1;for(;R<=this.options.maxZoom;){const U=this.getChildren(A);if(R++,U.length!==1)break;A=U[0].properties.cluster_id}return R}_appendLeaves(A,R,U,X,Q){const ae=this.getChildren(R);for(const ne of ae){const ee=ne.properties;if(ee&&ee.cluster?Q+ee.point_count<=X?Q+=ee.point_count:Q=this._appendLeaves(A,ee.cluster_id,U,X,Q):Q<X?Q++:A.push(ne),A.length===U)break}return Q}_createTree(A){const R=new l.KDBush(A.length/this.stride|0,this.options.nodeSize,Float32Array);for(let U=0;U<A.length;U+=this.stride)R.add(A[U],A[U+1]);return R.finish(),R.data=A,R}_addTileFeatures(A,R,U,X,Q,ae){for(const ne of A){const ee=ne*this.stride,ue=R[ee+Bt]>1;let be,Te,Ee;if(ue)be=zo(R,ee,this.clusterProps),Te=R[ee],Ee=R[ee+1];else{const Ye=this.points[R[ee+Oi]];be=Ye.properties;const[it,ct]=Ye.geometry.coordinates;Te=kr(it),Ee=Ln(ct)}const nt={type:1,geometry:[[Math.round(this.options.extent*(Te*Q-U)),Math.round(this.options.extent*(Ee*Q-X))]],tags:be};let pt;pt=ue||this.options.generateId?R[ee+Oi]:this.points[R[ee+Oi]].id,pt!==void 0&&(nt.id=pt),ae.features.push(nt)}}_limitZoom(A){return Math.max(this.options.minZoom,Math.min(Math.floor(+A),this.options.maxZoom+1))}_cluster(A,R){const{radius:U,extent:X,reduce:Q,minPoints:ae}=this.options,ne=U/(X*Math.pow(2,R)),ee=A.data,ue=[],be=this.stride;for(let Te=0;Te<ee.length;Te+=be){if(ee[Te+2]<=R)continue;ee[Te+2]=R;const Ee=ee[Te],nt=ee[Te+1],pt=A.within(ee[Te],ee[Te+1],ne),Ye=ee[Te+Bt];let it=Ye;for(const ct of pt){const It=ct*be;ee[It+2]>R&&(it+=ee[It+Bt])}if(it>Ye&&it>=ae){let ct,It=Ee*Ye,vt=nt*Ye,Nt=-1;const Gt=((Te/be|0)<<5)+(R+1)+this.points.length;for(const ht of pt){const Jt=ht*be;if(ee[Jt+2]<=R)continue;ee[Jt+2]=R;const oi=ee[Jt+Bt];It+=ee[Jt]*oi,vt+=ee[Jt+1]*oi,ee[Jt+4]=Gt,Q&&(ct||(ct=this._map(ee,Te,!0),Nt=this.clusterProps.length,this.clusterProps.push(ct)),Q(ct,this._map(ee,Jt)))}ee[Te+4]=Gt,ue.push(It/it,vt/it,1/0,Gt,-1,it),Q&&ue.push(Nt)}else{for(let ct=0;ct<be;ct++)ue.push(ee[Te+ct]);if(it>1)for(const ct of pt){const It=ct*be;if(!(ee[It+2]<=R)){ee[It+2]=R;for(let vt=0;vt<be;vt++)ue.push(ee[It+vt])}}}}return ue}_getOriginId(A){return A-this.points.length>>5}_getOriginZoom(A){return(A-this.points.length)%32}_map(A,R,U){if(A[R+Bt]>1){const ae=this.clusterProps[A[R+Hn]];return U?Object.assign({},ae):ae}const X=this.points[A[R+Oi]].properties,Q=this.options.map(X);return U&&Q===X?Object.assign({},Q):Q}}function An(G,A,R){return{type:"Feature",id:G[A+Oi],properties:zo(G,A,R),geometry:{type:"Point",coordinates:[(U=G[A],360*(U-.5)),lr(G[A+1])]}};var U}function zo(G,A,R){const U=G[A+Bt],X=U>=1e4?`${Math.round(U/1e3)}k`:U>=1e3?Math.round(U/100)/10+"k":U,Q=G[A+Hn],ae=Q===-1?{}:Object.assign({},R[Q]);return Object.assign(ae,{cluster:!0,cluster_id:G[A+Oi],point_count:U,point_count_abbreviated:X})}function kr(G){return G/360+.5}function Ln(G){const A=Math.sin(G*Math.PI/180),R=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return R<0?0:R>1?1:R}function lr(G){const A=(180-360*G)*Math.PI/180;return 360*Math.atan(Math.exp(A))/Math.PI-90}function Zr(G,A,R,U){for(var X,Q=U,ae=R-A>>1,ne=R-A,ee=G[A],ue=G[A+1],be=G[R],Te=G[R+1],Ee=A+3;Ee<R;Ee+=3){var nt=ge(G[Ee],G[Ee+1],ee,ue,be,Te);if(nt>Q)X=Ee,Q=nt;else if(nt===Q){var pt=Math.abs(Ee-ae);pt<ne&&(X=Ee,ne=pt)}}Q>U&&(X-A>3&&Zr(G,A,X,U),G[X+2]=Q,R-X>3&&Zr(G,X,R,U))}function ge(G,A,R,U,X,Q){var ae=X-R,ne=Q-U;if(ae!==0||ne!==0){var ee=((G-R)*ae+(A-U)*ne)/(ae*ae+ne*ne);ee>1?(R=X,U=Q):ee>0&&(R+=ae*ee,U+=ne*ee)}return(ae=G-R)*ae+(ne=A-U)*ne}function Ir(G,A,R,U){var X={id:G===void 0?null:G,type:A,geometry:R,tags:U,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Q){var ae=Q.geometry,ne=Q.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")Ao(Q,ae);else if(ne==="Polygon"||ne==="MultiLineString")for(var ee=0;ee<ae.length;ee++)Ao(Q,ae[ee]);else if(ne==="MultiPolygon")for(ee=0;ee<ae.length;ee++)for(var ue=0;ue<ae[ee].length;ue++)Ao(Q,ae[ee][ue])}(X),X}function Ao(G,A){for(var R=0;R<A.length;R+=3)G.minX=Math.min(G.minX,A[R]),G.minY=Math.min(G.minY,A[R+1]),G.maxX=Math.max(G.maxX,A[R]),G.maxY=Math.max(G.maxY,A[R+1])}function jt(G,A,R,U){if(A.geometry){var X=A.geometry.coordinates,Q=A.geometry.type,ae=Math.pow(R.tolerance/((1<<R.maxZoom)*R.extent),2),ne=[],ee=A.id;if(R.promoteId?ee=A.properties[R.promoteId]:R.generateId&&(ee=U||0),Q==="Point")Dt(X,ne);else if(Q==="MultiPoint")for(var ue=0;ue<X.length;ue++)Dt(X[ue],ne);else if(Q==="LineString")ao(X,ne,ae,!1);else if(Q==="MultiLineString"){if(R.lineMetrics){for(ue=0;ue<X.length;ue++)ao(X[ue],ne=[],ae,!1),G.push(Ir(ee,"LineString",ne,A.properties));return}lo(X,ne,ae,!1)}else if(Q==="Polygon")lo(X,ne,ae,!0);else{if(Q!=="MultiPolygon"){if(Q==="GeometryCollection"){for(ue=0;ue<A.geometry.geometries.length;ue++)jt(G,{id:ee,geometry:A.geometry.geometries[ue],properties:A.properties},R,U);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ue=0;ue<X.length;ue++){var be=[];lo(X[ue],be,ae,!0),ne.push(be)}}G.push(Ir(ee,Q,ne,A.properties))}}function Dt(G,A){A.push(ua(G[0])),A.push(ca(G[1])),A.push(0)}function ao(G,A,R,U){for(var X,Q,ae=0,ne=0;ne<G.length;ne++){var ee=ua(G[ne][0]),ue=ca(G[ne][1]);A.push(ee),A.push(ue),A.push(0),ne>0&&(ae+=U?(X*ue-ee*Q)/2:Math.sqrt(Math.pow(ee-X,2)+Math.pow(ue-Q,2))),X=ee,Q=ue}var be=A.length-3;A[2]=1,Zr(A,0,be,R),A[be+2]=1,A.size=Math.abs(ae),A.start=0,A.end=A.size}function lo(G,A,R,U){for(var X=0;X<G.length;X++){var Q=[];ao(G[X],Q,R,U),A.push(Q)}}function ua(G){return G/360+.5}function ca(G){var A=Math.sin(G*Math.PI/180),R=.5-.25*Math.log((1+A)/(1-A))/Math.PI;return R<0?0:R>1?1:R}function ri(G,A,R,U,X,Q,ae,ne){if(U/=A,Q>=(R/=A)&&ae<U)return G;if(ae<R||Q>=U)return null;for(var ee=[],ue=0;ue<G.length;ue++){var be=G[ue],Te=be.geometry,Ee=be.type,nt=X===0?be.minX:be.minY,pt=X===0?be.maxX:be.maxY;if(nt>=R&&pt<U)ee.push(be);else if(!(pt<R||nt>=U)){var Ye=[];if(Ee==="Point"||Ee==="MultiPoint")Es(Te,Ye,R,U,X);else if(Ee==="LineString")Lo(Te,Ye,R,U,X,!1,ne.lineMetrics);else if(Ee==="MultiLineString")Yi(Te,Ye,R,U,X,!1);else if(Ee==="Polygon")Yi(Te,Ye,R,U,X,!0);else if(Ee==="MultiPolygon")for(var it=0;it<Te.length;it++){var ct=[];Yi(Te[it],ct,R,U,X,!0),ct.length&&Ye.push(ct)}if(Ye.length){if(ne.lineMetrics&&Ee==="LineString"){for(it=0;it<Ye.length;it++)ee.push(Ir(be.id,Ee,Ye[it],be.tags));continue}Ee!=="LineString"&&Ee!=="MultiLineString"||(Ye.length===1?(Ee="LineString",Ye=Ye[0]):Ee="MultiLineString"),Ee!=="Point"&&Ee!=="MultiPoint"||(Ee=Ye.length===3?"Point":"MultiPoint"),ee.push(Ir(be.id,Ee,Ye,be.tags))}}}return ee.length?ee:null}function Es(G,A,R,U,X){for(var Q=0;Q<G.length;Q+=3){var ae=G[Q+X];ae>=R&&ae<=U&&(A.push(G[Q]),A.push(G[Q+1]),A.push(G[Q+2]))}}function Lo(G,A,R,U,X,Q,ae){for(var ne,ee,ue=Be(G),be=X===0?Pr:Gr,Te=G.start,Ee=0;Ee<G.length-3;Ee+=3){var nt=G[Ee],pt=G[Ee+1],Ye=G[Ee+2],it=G[Ee+3],ct=G[Ee+4],It=X===0?nt:pt,vt=X===0?it:ct,Nt=!1;ae&&(ne=Math.sqrt(Math.pow(nt-it,2)+Math.pow(pt-ct,2))),It<R?vt>R&&(ee=be(ue,nt,pt,it,ct,R),ae&&(ue.start=Te+ne*ee)):It>U?vt<U&&(ee=be(ue,nt,pt,it,ct,U),ae&&(ue.start=Te+ne*ee)):sn(ue,nt,pt,Ye),vt<R&&It>=R&&(ee=be(ue,nt,pt,it,ct,R),Nt=!0),vt>U&&It<=U&&(ee=be(ue,nt,pt,it,ct,U),Nt=!0),!Q&&Nt&&(ae&&(ue.end=Te+ne*ee),A.push(ue),ue=Be(G)),ae&&(Te+=ne)}var Gt=G.length-3;nt=G[Gt],pt=G[Gt+1],Ye=G[Gt+2],(It=X===0?nt:pt)>=R&&It<=U&&sn(ue,nt,pt,Ye),Gt=ue.length-3,Q&&Gt>=3&&(ue[Gt]!==ue[0]||ue[Gt+1]!==ue[1])&&sn(ue,ue[0],ue[1],ue[2]),ue.length&&A.push(ue)}function Be(G){var A=[];return A.size=G.size,A.start=G.start,A.end=G.end,A}function Yi(G,A,R,U,X,Q){for(var ae=0;ae<G.length;ae++)Lo(G[ae],A,R,U,X,Q,!1)}function sn(G,A,R,U){G.push(A),G.push(R),G.push(U)}function Pr(G,A,R,U,X,Q){var ae=(Q-A)/(U-A);return G.push(Q),G.push(R+(X-R)*ae),G.push(1),ae}function Gr(G,A,R,U,X,Q){var ae=(Q-R)/(X-R);return G.push(A+(U-A)*ae),G.push(Q),G.push(1),ae}function De(G,A){for(var R=[],U=0;U<G.length;U++){var X,Q=G[U],ae=Q.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")X=yt(Q.geometry,A);else if(ae==="MultiLineString"||ae==="Polygon"){X=[];for(var ne=0;ne<Q.geometry.length;ne++)X.push(yt(Q.geometry[ne],A))}else if(ae==="MultiPolygon")for(X=[],ne=0;ne<Q.geometry.length;ne++){for(var ee=[],ue=0;ue<Q.geometry[ne].length;ue++)ee.push(yt(Q.geometry[ne][ue],A));X.push(ee)}R.push(Ir(Q.id,ae,X,Q.tags))}return R}function yt(G,A){var R=[];R.size=G.size,G.start!==void 0&&(R.start=G.start,R.end=G.end);for(var U=0;U<G.length;U+=3)R.push(G[U]+A,G[U+1],G[U+2]);return R}function _t(G,A){if(G.transformed)return G;var R,U,X,Q=1<<G.z,ae=G.x,ne=G.y;for(R=0;R<G.features.length;R++){var ee=G.features[R],ue=ee.geometry,be=ee.type;if(ee.geometry=[],be===1)for(U=0;U<ue.length;U+=2)ee.geometry.push(qi(ue[U],ue[U+1],A,Q,ae,ne));else for(U=0;U<ue.length;U++){var Te=[];for(X=0;X<ue[U].length;X+=2)Te.push(qi(ue[U][X],ue[U][X+1],A,Q,ae,ne));ee.geometry.push(Te)}}return G.transformed=!0,G}function qi(G,A,R,U,X,Q){return[Math.round(R*(G*U-X)),Math.round(R*(A*U-Q))]}function Mr(G,A,R,U,X){for(var Q=A===X.maxZoom?0:X.tolerance/((1<<A)*X.extent),ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:R,y:U,z:A,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ne=0;ne<G.length;ne++){ae.numFeatures++,lt(ae,G[ne],Q,X);var ee=G[ne].minX,ue=G[ne].minY,be=G[ne].maxX,Te=G[ne].maxY;ee<ae.minX&&(ae.minX=ee),ue<ae.minY&&(ae.minY=ue),be>ae.maxX&&(ae.maxX=be),Te>ae.maxY&&(ae.maxY=Te)}return ae}function lt(G,A,R,U){var X=A.geometry,Q=A.type,ae=[];if(Q==="Point"||Q==="MultiPoint")for(var ne=0;ne<X.length;ne+=3)ae.push(X[ne]),ae.push(X[ne+1]),G.numPoints++,G.numSimplified++;else if(Q==="LineString")ur(ae,X,G,R,!1,!1);else if(Q==="MultiLineString"||Q==="Polygon")for(ne=0;ne<X.length;ne++)ur(ae,X[ne],G,R,Q==="Polygon",ne===0);else if(Q==="MultiPolygon")for(var ee=0;ee<X.length;ee++){var ue=X[ee];for(ne=0;ne<ue.length;ne++)ur(ae,ue[ne],G,R,!0,ne===0)}if(ae.length){var be=A.tags||null;if(Q==="LineString"&&U.lineMetrics){for(var Te in be={},A.tags)be[Te]=A.tags[Te];be.mapbox_clip_start=X.start/X.size,be.mapbox_clip_end=X.end/X.size}var Ee={geometry:ae,type:Q==="Polygon"||Q==="MultiPolygon"?3:Q==="LineString"||Q==="MultiLineString"?2:1,tags:be};A.id!==null&&(Ee.id=A.id),G.features.push(Ee)}}function ur(G,A,R,U,X,Q){var ae=U*U;if(U>0&&A.size<(X?ae:U))R.numPoints+=A.length/3;else{for(var ne=[],ee=0;ee<A.length;ee+=3)(U===0||A[ee+2]>ae)&&(R.numSimplified++,ne.push(A[ee]),ne.push(A[ee+1])),R.numPoints++;X&&function(ue,be){for(var Te=0,Ee=0,nt=ue.length,pt=nt-2;Ee<nt;pt=Ee,Ee+=2)Te+=(ue[Ee]-ue[pt])*(ue[Ee+1]+ue[pt+1]);if(Te>0===be)for(Ee=0,nt=ue.length;Ee<nt/2;Ee+=2){var Ye=ue[Ee],it=ue[Ee+1];ue[Ee]=ue[nt-2-Ee],ue[Ee+1]=ue[nt-1-Ee],ue[nt-2-Ee]=Ye,ue[nt-1-Ee]=it}}(ne,Q),G.push(ne)}}function cr(G,A){var R=(A=this.options=function(X,Q){for(var ae in Q)X[ae]=Q[ae];return X}(Object.create(this.options),A)).debug;if(R&&console.time("preprocess data"),A.maxZoom<0||A.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(A.promoteId&&A.generateId)throw new Error("promoteId and generateId cannot be used together.");var U=function(X,Q){var ae=[];if(X.type==="FeatureCollection")for(var ne=0;ne<X.features.length;ne++)jt(ae,X.features[ne],Q,ne);else jt(ae,X.type==="Feature"?X:{geometry:X},Q);return ae}(G,A);this.tiles={},this.tileCoords=[],R&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",A.indexMaxZoom,A.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),U=function(X,Q){var ae=Q.buffer/Q.extent,ne=X,ee=ri(X,1,-1-ae,ae,0,-1,2,Q),ue=ri(X,1,1-ae,2+ae,0,-1,2,Q);return(ee||ue)&&(ne=ri(X,1,-ae,1+ae,0,-1,2,Q)||[],ee&&(ne=De(ee,1).concat(ne)),ue&&(ne=ne.concat(De(ue,-1)))),ne}(U,A),U.length&&this.splitTile(U,0,0,0),R&&(U.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Hr(G,A,R){return 32*((1<<G)*R+A)+G}function Dn(G,A){return A?G.properties[A]:G.id}function Ni(G,A){if(G==null)return!0;if(G.type==="Feature")return Dn(G,A)!=null;if(G.type==="FeatureCollection"){const R=new Set;for(const U of G.features){const X=Dn(U,A);if(X==null||R.has(X))return!1;R.add(X)}return!0}return!1}function Zt(G,A){const R=new Map;if(G!=null)if(G.type==="Feature")R.set(Dn(G,A),G);else for(const U of G.features)R.set(Dn(U,A),U);return R}function ha(G,A){const R=G.tileID.canonical;if(!this._geoJSONIndex)return A(null,null);const U=this._geoJSONIndex.getTile(R.z,R.x,R.y);if(!U)return A(null,null);const X=new class{constructor(ae){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=l.EXTENT,this.length=ae.length,this._features=ae}feature(ae){return new class{constructor(ne){this._feature=ne,this.extent=l.EXTENT,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ee of this._feature.geometry)ne.push([new l.Point(ee[0],ee[1])]);return ne}{const ne=[];for(const ee of this._feature.geometry){const ue=[];for(const be of ee)ue.push(new l.Point(be[0],be[1]));ne.push(ue)}return ne}}toGeoJSON(ne,ee,ue){return K.call(this,ne,ee,ue)}}(this._features[ae])}}(U.features);let Q=dt(X);Q.byteOffset===0&&Q.byteLength===Q.buffer.byteLength||(Q=new Uint8Array(Q)),A(null,{vectorTile:X,rawData:Q.buffer})}cr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},cr.prototype.splitTile=function(G,A,R,U,X,Q,ae){for(var ne=[G,A,R,U],ee=this.options,ue=ee.debug;ne.length;){U=ne.pop(),R=ne.pop(),A=ne.pop(),G=ne.pop();var be=1<<A,Te=Hr(A,R,U),Ee=this.tiles[Te];if(!Ee&&(ue>1&&console.time("creation"),Ee=this.tiles[Te]=Mr(G,A,R,U,ee),this.tileCoords.push({z:A,x:R,y:U}),ue)){ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",A,R,U,Ee.numFeatures,Ee.numPoints,Ee.numSimplified),console.timeEnd("creation"));var nt="z"+A;this.stats[nt]=(this.stats[nt]||0)+1,this.total++}if(Ee.source=G,X){if(A===ee.maxZoom||A===X)continue;var pt=1<<X-A;if(R!==Math.floor(Q/pt)||U!==Math.floor(ae/pt))continue}else if(A===ee.indexMaxZoom||Ee.numPoints<=ee.indexMaxPoints)continue;if(Ee.source=null,G.length!==0){ue>1&&console.time("clipping");var Ye,it,ct,It,vt,Nt,Gt=.5*ee.buffer/ee.extent,ht=.5-Gt,Jt=.5+Gt,oi=1+Gt;Ye=it=ct=It=null,vt=ri(G,be,R-Gt,R+Jt,0,Ee.minX,Ee.maxX,ee),Nt=ri(G,be,R+ht,R+oi,0,Ee.minX,Ee.maxX,ee),G=null,vt&&(Ye=ri(vt,be,U-Gt,U+Jt,1,Ee.minY,Ee.maxY,ee),it=ri(vt,be,U+ht,U+oi,1,Ee.minY,Ee.maxY,ee),vt=null),Nt&&(ct=ri(Nt,be,U-Gt,U+Jt,1,Ee.minY,Ee.maxY,ee),It=ri(Nt,be,U+ht,U+oi,1,Ee.minY,Ee.maxY,ee),Nt=null),ue>1&&console.timeEnd("clipping"),ne.push(Ye||[],A+1,2*R,2*U),ne.push(it||[],A+1,2*R,2*U+1),ne.push(ct||[],A+1,2*R+1,2*U),ne.push(It||[],A+1,2*R+1,2*U+1)}}},cr.prototype.getTile=function(G,A,R){var U=this.options,X=U.extent,Q=U.debug;if(G<0||G>24)return null;var ae=1<<G,ne=Hr(G,A=(A%ae+ae)%ae,R);if(this.tiles[ne])return _t(this.tiles[ne],X);Q>1&&console.log("drilling down to z%d-%d-%d",G,A,R);for(var ee,ue=G,be=A,Te=R;!ee&&ue>0;)ue--,be=Math.floor(be/2),Te=Math.floor(Te/2),ee=this.tiles[Hr(ue,be,Te)];return ee&&ee.source?(Q>1&&console.log("found parent tile z%d-%d-%d",ue,be,Te),Q>1&&console.time("drilling down"),this.splitTile(ee.source,ue,be,Te,G,A,R),Q>1&&console.timeEnd("drilling down"),this.tiles[ne]?_t(this.tiles[ne],X):null):null};class zr extends Ie{constructor(A,R,U,X){super(A,R,U,ha),this._dataUpdateable=new Map,this.loadGeoJSON=(Q,ae)=>{const{promoteId:ne}=Q;if(Q.request)return l.getJSON(Q.request,(ee,ue,be,Te)=>{this._dataUpdateable=Ni(ue,ne)?Zt(ue,ne):void 0,ae(ee,ue,be,Te)});if(typeof Q.data=="string")try{const ee=JSON.parse(Q.data);this._dataUpdateable=Ni(ee,ne)?Zt(ee,ne):void 0,ae(null,ee)}catch{ae(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`))}else Q.dataDiff?this._dataUpdateable?(function(ee,ue,be){var Te,Ee,nt,pt;if(ue.removeAll&&ee.clear(),ue.remove)for(const Ye of ue.remove)ee.delete(Ye);if(ue.add)for(const Ye of ue.add){const it=Dn(Ye,be);it!=null&&ee.set(it,Ye)}if(ue.update)for(const Ye of ue.update){let it=ee.get(Ye.id);if(it==null)continue;const ct=!Ye.removeAllProperties&&(((Te=Ye.removeProperties)===null||Te===void 0?void 0:Te.length)>0||((Ee=Ye.addOrUpdateProperties)===null||Ee===void 0?void 0:Ee.length)>0);if((Ye.newGeometry||Ye.removeAllProperties||ct)&&(it={...it},ee.set(Ye.id,it),ct&&(it.properties={...it.properties})),Ye.newGeometry&&(it.geometry=Ye.newGeometry),Ye.removeAllProperties)it.properties={};else if(((nt=Ye.removeProperties)===null||nt===void 0?void 0:nt.length)>0)for(const It of Ye.removeProperties)Object.prototype.hasOwnProperty.call(it.properties,It)&&delete it.properties[It];if(((pt=Ye.addOrUpdateProperties)===null||pt===void 0?void 0:pt.length)>0)for(const{key:It,value:vt}of Ye.addOrUpdateProperties)it.properties[It]=vt}}(this._dataUpdateable,Q.dataDiff,ne),ae(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):ae(new Error(`Cannot update existing geojson data in ${Q.source}`)):ae(new Error(`Input data given to '${Q.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},X&&(this.loadGeoJSON=X)}loadData(A,R){var U;(U=this._pendingRequest)===null||U===void 0||U.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const X=!!(A&&A.request&&A.request.collectResourceTiming)&&new l.RequestPerformance(A.request);this._pendingCallback=R,this._pendingRequest=this.loadGeoJSON(A,(Q,ae)=>{if(delete this._pendingCallback,delete this._pendingRequest,Q||!ae)return R(Q);if(typeof ae!="object")return R(new Error(`Input data given to '${A.source}' is not a valid GeoJSON object.`));{J(ae,!0);try{if(A.filter){const ee=l.createExpression(A.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ee.result==="error")throw new Error(ee.value.map(be=>`${be.key}: ${be.message}`).join(", "));ae={type:"FeatureCollection",features:ae.features.filter(be=>ee.value.evaluate({zoom:0},be))}}this._geoJSONIndex=A.cluster?new yn(function({superclusterOptions:ee,clusterProperties:ue}){if(!ue||!ee)return ee;const be={},Te={},Ee={accumulated:null,zoom:0},nt={properties:null},pt=Object.keys(ue);for(const Ye of pt){const[it,ct]=ue[Ye],It=l.createExpression(ct),vt=l.createExpression(typeof it=="string"?[it,["accumulated"],["get",Ye]]:it);be[Ye]=It.value,Te[Ye]=vt.value}return ee.map=Ye=>{nt.properties=Ye;const it={};for(const ct of pt)it[ct]=be[ct].evaluate(Ee,nt);return it},ee.reduce=(Ye,it)=>{nt.properties=it;for(const ct of pt)Ee.accumulated=Ye[ct],Ye[ct]=Te[ct].evaluate(Ee,nt)},ee}(A)).load(ae.features):function(ee,ue){return new cr(ee,ue)}(ae,A.geojsonVtOptions)}catch(ee){return R(ee)}this.loaded={};const ne={};if(X){const ee=X.finish();ee&&(ne.resourceTiming={},ne.resourceTiming[A.source]=JSON.parse(JSON.stringify(ee)))}R(null,ne)}})}reloadTile(A,R){const U=this.loaded;return U&&U[A.uid]?super.reloadTile(A,R):this.loadTile(A,R)}removeSource(A,R){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),R()}getClusterExpansionZoom(A,R){try{R(null,this._geoJSONIndex.getClusterExpansionZoom(A.clusterId))}catch(U){R(U)}}getClusterChildren(A,R){try{R(null,this._geoJSONIndex.getChildren(A.clusterId))}catch(U){R(U)}}getClusterLeaves(A,R){try{R(null,this._geoJSONIndex.getLeaves(A.clusterId,A.limit,A.offset))}catch(U){R(U)}}}class Wr{constructor(A){this.self=A,this.actor=new l.Actor(A,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ie,geojson:zr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(R,U)=>{if(this.workerSourceTypes[R])throw new Error(`Worker source with name "${R}" already registered.`);this.workerSourceTypes[R]=U},this.self.registerRTLTextPlugin=R=>{if(l.plugin.isParsed())throw new Error("RTL text plugin already registered.");l.plugin.applyArabicShaping=R.applyArabicShaping,l.plugin.processBidirectionalText=R.processBidirectionalText,l.plugin.processStyledBidirectionalText=R.processStyledBidirectionalText}}setReferrer(A,R){this.referrer=R}setImages(A,R,U){this.availableImages[A]=R;for(const X in this.workerSources[A]){const Q=this.workerSources[A][X];for(const ae in Q)Q[ae].availableImages=R}U()}setLayers(A,R,U){this.getLayerIndex(A).replace(R),U()}updateLayers(A,R,U){this.getLayerIndex(A).update(R.layers,R.removedIds),U()}loadTile(A,R,U){this.getWorkerSource(A,R.type,R.source).loadTile(R,U)}loadDEMTile(A,R,U){this.getDEMWorkerSource(A,R.source).loadTile(R,U)}reloadTile(A,R,U){this.getWorkerSource(A,R.type,R.source).reloadTile(R,U)}abortTile(A,R,U){this.getWorkerSource(A,R.type,R.source).abortTile(R,U)}removeTile(A,R,U){this.getWorkerSource(A,R.type,R.source).removeTile(R,U)}removeDEMTile(A,R){this.getDEMWorkerSource(A,R.source).removeTile(R)}removeSource(A,R,U){if(!this.workerSources[A]||!this.workerSources[A][R.type]||!this.workerSources[A][R.type][R.source])return;const X=this.workerSources[A][R.type][R.source];delete this.workerSources[A][R.type][R.source],X.removeSource!==void 0?X.removeSource(R,U):U()}loadWorkerSource(A,R,U){try{this.self.importScripts(R.url),U()}catch(X){U(X.toString())}}syncRTLPluginState(A,R,U){try{l.plugin.setState(R);const X=l.plugin.getPluginURL();if(l.plugin.isLoaded()&&!l.plugin.isParsed()&&X!=null){this.self.importScripts(X);const Q=l.plugin.isParsed();U(Q?void 0:new Error(`RTL Text Plugin failed to import scripts from ${X}`),Q)}}catch(X){U(X.toString())}}getAvailableImages(A){let R=this.availableImages[A];return R||(R=[]),R}getLayerIndex(A){let R=this.layerIndexes[A];return R||(R=this.layerIndexes[A]=new N),R}getWorkerSource(A,R,U){if(this.workerSources[A]||(this.workerSources[A]={}),this.workerSources[A][R]||(this.workerSources[A][R]={}),!this.workerSources[A][R][U]){const X={send:(Q,ae,ne)=>{this.actor.send(Q,ae,ne,A)}};this.workerSources[A][R][U]=new this.workerSourceTypes[R](X,this.getLayerIndex(A),this.getAvailableImages(A))}return this.workerSources[A][R][U]}getDEMWorkerSource(A,R){return this.demWorkerSources[A]||(this.demWorkerSources[A]={}),this.demWorkerSources[A][R]||(this.demWorkerSources[A][R]=new Ce),this.demWorkerSources[A][R]}}return l.isWorker()&&(self.worker=new Wr(self)),Wr}),b(["./shared"],function(l){var N="3.2.0";class D{static testProp(t){if(!D.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in D.docStyle)return t[s];return t[0]}static create(t,s,c){const d=window.document.createElement(t);return s!==void 0&&(d.className=s),c&&c.appendChild(d),d}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){D.docStyle&&D.selectProp&&(D.userSelect=D.docStyle[D.selectProp],D.docStyle[D.selectProp]="none")}static enableDrag(){D.docStyle&&D.selectProp&&(D.docStyle[D.selectProp]=D.userSelect)}static setTransform(t,s){t.style[D.transformProp]=s}static addEventListener(t,s,c,d={}){t.addEventListener(s,c,"passive"in d?d:d.capture)}static removeEventListener(t,s,c,d={}){t.removeEventListener(s,c,"passive"in d?d:d.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",D.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",D.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",D.suppressClickInternal,!0)},0)}static mousePos(t,s){const c=t.getBoundingClientRect();return new l.Point(s.clientX-c.left-t.clientLeft,s.clientY-c.top-t.clientTop)}static touchPos(t,s){const c=t.getBoundingClientRect(),d=[];for(let f=0;f<s.length;f++)d.push(new l.Point(s[f].clientX-c.left-t.clientLeft,s[f].clientY-c.top-t.clientTop));return d}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}D.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,D.selectProp=D.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),D.transformProp=D.testProp(["transform","WebkitTransform"]);const oe={supported:!1,testSupport:function(p){!Ie&&he&&(Ce?Pe(p):te=p)}};let te,he,Ie=!1,Ce=!1;function Pe(p){const t=p.createTexture();p.bindTexture(p.TEXTURE_2D,t);try{if(p.texImage2D(p.TEXTURE_2D,0,p.RGBA,p.RGBA,p.UNSIGNED_BYTE,he),p.isContextLost())return;oe.supported=!0}catch{}p.deleteTexture(t),Ie=!0}var ft,J;typeof document<"u"&&(he=document.createElement("img"),he.onload=function(){te&&Pe(te),te=null,Ce=!0},he.onerror=function(){Ie=!0,te=null},he.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(p){let t,s,c,d;p.resetRequestQueue=()=>{t=[],s=0,c=0,d={}},p.addThrottleControl=T=>{const k=c++;return d[k]=T,k},p.removeThrottleControl=T=>{delete d[T],w()},p.getImage=(T,k,P=!0)=>{oe.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*");const B={requestParameters:T,supportImageRefresh:P,callback:k,cancelled:!1,completed:!1,cancel:()=>{B.completed||B.cancelled||(B.cancelled=!0,B.innerRequest&&(B.innerRequest.cancel(),s--),w())}};return t.push(B),w(),B};const f=T=>{const{requestParameters:k,supportImageRefresh:P,callback:B}=T;return l.extend(k,{type:"image"}),(P!==!1||l.isWorker()||l.getProtocolAction(k.url)||k.headers&&!Object.keys(k.headers).reduce((j,V)=>j&&V==="accept",!0)?l.makeRequest:E)(k,(j,V,Z,$)=>{x(T,B,j,V,Z,$)})},x=(T,k,P,B,j,V)=>{P?k(P):B instanceof HTMLImageElement||B instanceof ImageBitmap?k(null,B):B&&((Z,$)=>{typeof createImageBitmap=="function"?l.arrayBufferToImageBitmap(Z,$):l.arrayBufferToImage(Z,$)})(B,(Z,$)=>{Z!=null?k(Z):$!=null&&k(null,$,{cacheControl:j,expires:V})}),T.cancelled||(T.completed=!0,s--,w())},w=()=>{const T=(()=>{const k=Object.keys(d);let P=!1;if(k.length>0){for(const B of k)if(P=d[B](),P)break}return P})()?l.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let k=s;k<T&&t.length>0;k++){const P=t.shift();if(P.cancelled){k--;continue}const B=f(P);s++,P.innerRequest=B}},E=(T,k)=>{const P=new Image,B=T.url;let j=!1;const V=T.credentials;return V&&V==="include"?P.crossOrigin="use-credentials":(V&&V==="same-origin"||!l.sameOrigin(B))&&(P.crossOrigin="anonymous"),P.fetchPriority="high",P.onload=()=>{k(null,P),P.onerror=P.onload=null},P.onerror=()=>{j||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),P.onerror=P.onload=null},P.src=B,{cancel:()=>{j=!0,P.src=""}}}}(ft||(ft={})),ft.resetRequestQueue(),function(p){p.Glyphs="Glyphs",p.Image="Image",p.Source="Source",p.SpriteImage="SpriteImage",p.SpriteJSON="SpriteJSON",p.Style="Style",p.Tile="Tile",p.Unknown="Unknown"}(J||(J={}));class K{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,c){const d=function(f){const x=f.match(re);if(!x)throw new Error(`Unable to parse URL "${f}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return d.path+=`${s}${c}`,function(f){const x=f.params.length?`?${f.params.join("&")}`:"";return`${f.protocol}://${f.authority}${f.path}${x}`}(d)}setTransformRequest(t){this._transformRequestFn=t}}const re=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ve(p){var t=new l.ARRAY_TYPE(3);return t[0]=p[0],t[1]=p[1],t[2]=p[2],t}var Ae,Ue=function(p,t,s){return p[0]=t[0]-s[0],p[1]=t[1]-s[1],p[2]=t[2]-s[2],p};Ae=new l.ARRAY_TYPE(3),l.ARRAY_TYPE!=Float32Array&&(Ae[0]=0,Ae[1]=0,Ae[2]=0);var Ge=function(p){var t=p[0],s=p[1];return t*t+s*s};function Ve(p){const t=[];if(typeof p=="string")t.push({id:"default",url:p});else if(p&&p.length>0){const s=[];for(const{id:c,url:d}of p){const f=`${c}${d}`;s.indexOf(f)===-1&&(s.push(f),t.push({id:c,url:d}))}}return t}function gt(p,t,s,c,d){if(c)return void p(c);if(d!==Object.values(t).length||d!==Object.values(s).length)return;const f={};for(const x in t){f[x]={};const w=l.browser.getImageCanvasContext(s[x]),E=t[x];for(const T in E){const{width:k,height:P,x:B,y:j,sdf:V,pixelRatio:Z,stretchX:$,stretchY:se,content:pe}=E[T];f[x][T]={data:null,pixelRatio:Z,sdf:V,stretchX:$,stretchY:se,content:pe,spriteData:{width:k,height:P,x:B,y:j,context:w}}}}p(null,f)}(function(){var p=new l.ARRAY_TYPE(2);l.ARRAY_TYPE!=Float32Array&&(p[0]=0,p[1]=0)})();class Je{constructor(t,s,c,d){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,d)}update(t,s,c){const{width:d,height:f}=t,x=!(this.size&&this.size[0]===d&&this.size[1]===f||c),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),x)this.size=[d,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.isImageBitmap(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,d,f,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:T,y:k}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||l.isImageBitmap(t)?E.texSubImage2D(E.TEXTURE_2D,0,T,k,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,T,k,d,f,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(t,s,c){const{context:d}=this,{gl:f}=d;f.bindTexture(f.TEXTURE_2D,this.texture),c!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,c||t),this.filter=t),s!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function qt(p){const{userImage:t}=p;return!!(t&&t.render&&t.render())&&(p.data.replace(new Uint8Array(t.data.buffer)),!0)}class ni extends l.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:c}of this.requestors)this._notify(s,c);this.requestors=[]}}getImage(t){const s=this.images[t];if(s&&!s.data&&s.spriteData){const c=s.spriteData;s.data=new l.RGBAImage({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),s.spriteData=null}return s}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let c=!0;const d=s.data||s.spriteData;return this._validateStretch(s.stretchX,d&&d.width)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(s.stretchY,d&&d.height)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(s.content,s)||(this.fire(new l.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,s){if(!t)return!0;let c=0;for(const d of t){if(d[0]<c||d[1]<d[0]||s<d[1])return!1;c=d[1]}return!0}_validateContent(t,s){if(!t)return!0;if(t.length!==4)return!1;const c=s.spriteData,d=c&&c.width||s.data.width,f=c&&c.height||s.data.height;return!(t[0]<0||d<t[0]||t[1]<0||f<t[1]||t[2]<0||d<t[2]||t[3]<0||f<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,s,c=!0){const d=this.getImage(t);if(c&&(d.data.width!==s.data.width||d.data.height!==s.data.height))throw new Error(`size mismatch between old image (${d.data.width}x${d.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=d.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let c=!0;if(!this.isLoaded())for(const d of t)this.images[d]||(c=!1);this.isLoaded()||c?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const c={};for(const d of t){let f=this.getImage(d);f||(this.fire(new l.Event("styleimagemissing",{id:d})),f=this.getImage(d)),f?c[d]={data:f.data.clone(),pixelRatio:f.pixelRatio,sdf:f.sdf,version:f.version,stretchX:f.stretchX,stretchY:f.stretchY,content:f.content,hasRenderCallback:!!(f.userImage&&f.userImage.render)}:l.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,c)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],c=this.getImage(t);if(!c)return null;if(s&&s.position.version===c.version)return s.position;if(s)s.position.version=c.version;else{const d={w:c.data.width+2,h:c.data.height+2,x:0,y:0},f=new l.ImagePosition(d,c);this.patterns[t]={bin:d,position:f}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Je(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const f in this.patterns)t.push(this.patterns[f].bin);const{w:s,h:c}=l.potpack(t),d=this.atlasImage;d.resize({width:s||1,height:c||1});for(const f in this.patterns){const{bin:x}=this.patterns[f],w=x.x+1,E=x.y+1,T=this.getImage(f).data,k=T.width,P=T.height;l.RGBAImage.copy(T,d,{x:0,y:0},{x:w,y:E},{width:k,height:P}),l.RGBAImage.copy(T,d,{x:0,y:P-1},{x:w,y:E-1},{width:k,height:1}),l.RGBAImage.copy(T,d,{x:0,y:0},{x:w,y:E+P},{width:k,height:1}),l.RGBAImage.copy(T,d,{x:k-1,y:0},{x:w-1,y:E},{width:1,height:P}),l.RGBAImage.copy(T,d,{x:0,y:0},{x:w+k,y:E},{width:1,height:P})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const c=this.getImage(s);c||l.warnOnce(`Image with ID: "${s}" was not found`),qt(c)&&this.updateImage(s,c)}}}const Fi=1e20;function Cr(p,t,s,c,d,f,x,w,E){for(let T=t;T<t+c;T++)sr(p,s*f+T,f,d,x,w,E);for(let T=s;T<s+d;T++)sr(p,T*f+t,1,c,x,w,E)}function sr(p,t,s,c,d,f,x){f[0]=0,x[0]=-Fi,x[1]=Fi,d[0]=p[t];for(let w=1,E=0,T=0;w<c;w++){d[w]=p[t+w*s];const k=w*w;do{const P=f[E];T=(d[w]-d[P]+k-P*P)/(w-P)/2}while(T<=x[E]&&--E>-1);E++,f[E]=w,x[E]=T,x[E+1]=Fi}for(let w=0,E=0;w<c;w++){for(;x[E+1]<w;)E++;const T=f[E],k=w-T;p[t+w*s]=d[T]+k*k}}class on{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const c=[];for(const d in t)for(const f of t[d])c.push({stack:d,id:f});l.asyncAll(c,({stack:d,id:f},x)=>{let w=this.entries[d];w||(w=this.entries[d]={glyphs:{},requests:{},ranges:{}});let E=w.glyphs[f];if(E!==void 0)return void x(null,{stack:d,id:f,glyph:E});if(E=this._tinySDF(w,d,f),E)return w.glyphs[f]=E,void x(null,{stack:d,id:f,glyph:E});const T=Math.floor(f/256);if(256*T>65535)return void x(new Error("glyphs > 65535 not supported"));if(w.ranges[T])return void x(null,{stack:d,id:f,glyph:E});if(!this.url)return void x(new Error("glyphsUrl is not set"));let k=w.requests[T];k||(k=w.requests[T]=[],on.loadGlyphRange(d,T,this.url,this.requestManager,(P,B)=>{if(B){for(const j in B)this._doesCharSupportLocalGlyph(+j)||(w.glyphs[+j]=B[+j]);w.ranges[T]=!0}for(const j of k)j(P,B);delete w.requests[T]})),k.push((P,B)=>{P?x(P):B&&x(null,{stack:d,id:f,glyph:B[f]||null})})},(d,f)=>{if(d)s(d);else if(f){const x={};for(const{stack:w,id:E,glyph:T}of f)(x[w]||(x[w]={}))[E]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics};s(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(l.unicodeBlockLookup["CJK Unified Ideographs"](t)||l.unicodeBlockLookup["Hangul Syllables"](t)||l.unicodeBlockLookup.Hiragana(t)||l.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,c){const d=this.localIdeographFontFamily;if(!d||!this._doesCharSupportLocalGlyph(c))return;let f=t.tinySDF;if(!f){let w="400";/bold/i.test(s)?w="900":/medium/i.test(s)?w="500":/light/i.test(s)&&(w="200"),f=t.tinySDF=new on.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:d,fontWeight:w})}const x=f.draw(String.fromCharCode(c));return{id:c,bitmap:new l.AlphaImage({width:x.width||30,height:x.height||30},x.data),metrics:{width:x.glyphWidth||24,height:x.glyphHeight||24,left:x.glyphLeft||0,top:x.glyphTop-27||-8,advance:x.glyphAdvance||24}}}}on.loadGlyphRange=function(p,t,s,c,d){const f=256*t,x=f+255,w=c.transformRequest(s.replace("{fontstack}",p).replace("{range}",`${f}-${x}`),J.Glyphs);l.getArrayBuffer(w,(E,T)=>{if(E)d(E);else if(T){const k={};for(const P of l.parseGlyphPbf(T))k[P.id]=P;d(null,k)}})},on.TinySDF=class{constructor({fontSize:p=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:d="sans-serif",fontWeight:f="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const w=this.size=p+4*t,E=this._createCanvas(w),T=this.ctx=E.getContext("2d",{willReadFrequently:!0});T.font=`${x} ${f} ${p}px ${d}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(p){const t=document.createElement("canvas");return t.width=t.height=p,t}draw(p){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:d,actualBoundingBoxRight:f}=this.ctx.measureText(p),x=Math.ceil(s),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-d))),E=Math.min(this.size-this.buffer,x+Math.ceil(c)),T=w+2*this.buffer,k=E+2*this.buffer,P=Math.max(T*k,0),B=new Uint8ClampedArray(P),j={data:B,width:T,height:k,glyphWidth:w,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(w===0||E===0)return j;const{ctx:V,buffer:Z,gridInner:$,gridOuter:se}=this;V.clearRect(Z,Z,w,E),V.fillText(p,Z,Z+x);const pe=V.getImageData(Z,Z,w,E);se.fill(Fi,0,P),$.fill(0,0,P);for(let H=0;H<E;H++)for(let ce=0;ce<w;ce++){const me=pe.data[4*(H*w+ce)+3]/255;if(me===0)continue;const ye=(H+Z)*T+ce+Z;if(me===1)se[ye]=0,$[ye]=Fi;else{const _e=.5-me;se[ye]=_e>0?_e*_e:0,$[ye]=_e<0?_e*_e:0}}Cr(se,0,0,T,k,T,this.f,this.v,this.z),Cr($,Z,Z,w,E,T,this.f,this.v,this.z);for(let H=0;H<P;H++){const ce=Math.sqrt(se[H])-Math.sqrt($[H]);B[H]=Math.round(255-255*(ce/this.radius+this.cutoff))}return j}};class ar{constructor(){this.specification=l.v8Spec.light.position}possiblyEvaluate(t,s){return l.sphericalToCartesian(t.expression.evaluate(s))}interpolate(t,s,c){return{x:l.interpolate.number(t.x,s.x,c),y:l.interpolate.number(t.y,s.y,c),z:l.interpolate.number(t.z,s.z,c)}}}let We,dt;class xt extends l.Evented{constructor(t){super(),We=We||new l.Properties({anchor:new l.DataConstantProperty(l.v8Spec.light.anchor),position:new ar,color:new l.DataConstantProperty(l.v8Spec.light.color),intensity:new l.DataConstantProperty(l.v8Spec.light.intensity)}),this._transitionable=new l.Transitionable(We),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(l.validateLight,t,s))for(const c in t){const d=t[c];c.endsWith("-transition")?this._transitionable.setTransition(c.slice(0,-11),d):this._transitionable.setValue(c,d)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&l.emitValidationErrors(this,t.call(l.validateStyle,l.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:l.v8Spec})))}}class Ut{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const c=t.join(",")+String(s);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,s)),this.dashEntry[c]}getDashRanges(t,s,c){const d=[];let f=t.length%2==1?-t[t.length-1]*c:0,x=t[0]*c,w=!0;d.push({left:f,right:x,isDash:w,zeroLength:t[0]===0});let E=t[0];for(let T=1;T<t.length;T++){w=!w;const k=t[T];f=E*c,E+=k,x=E*c,d.push({left:f,right:x,isDash:w,zeroLength:k===0})}return d}addRoundDash(t,s,c){const d=s/2;for(let f=-c;f<=c;f++){const x=this.width*(this.nextRow+c+f);let w=0,E=t[w];for(let T=0;T<this.width;T++){T/E.right>1&&(E=t[++w]);const k=Math.abs(T-E.left),P=Math.abs(T-E.right),B=Math.min(k,P);let j;const V=f/c*(d+1);if(E.isDash){const Z=d-Math.abs(V);j=Math.sqrt(B*B+Z*Z)}else j=d-Math.sqrt(B*B+V*V);this.data[x+T]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(t){for(let w=t.length-1;w>=0;--w){const E=t[w],T=t[w+1];E.zeroLength?t.splice(w,1):T&&T.isDash===E.isDash&&(T.left=E.left,t.splice(w,1))}const s=t[0],c=t[t.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,x=t[f];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++f]);const E=Math.abs(w-x.left),T=Math.abs(w-x.right),k=Math.min(E,T);this.data[d+w]=Math.max(0,Math.min(255,(x.isDash?k:-k)+128))}}addDash(t,s){const c=s?7:0,d=2*c+1;if(this.nextRow+d>this.height)return l.warnOnce("LineAtlas out of space"),null;let f=0;for(let w=0;w<t.length;w++)f+=t[w];if(f!==0){const w=this.width/f,E=this.getDashRanges(t,this.width,w);s?this.addRoundDash(E,w,c):this.addRegularDash(E)}const x={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:f};return this.nextRow+=d,this.dirty=!0,x}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class Vt{constructor(t,s,c){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=c;const d=this.workerPool.acquire(c);for(let f=0;f<d.length;f++){const x=new Vt.Actor(d[f],s,c);x.name=`Worker ${f}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,c){l.asyncAll(this.actors,(d,f)=>{d.send(t,s,f)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],t&&this.workerPool.release(this.id)}}function Oi(p,t,s){const c=function(d,f){if(d)return s(d);if(f){const x=l.pick(l.extend(f,p),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);f.vector_layers&&(x.vectorLayers=f.vector_layers,x.vectorLayerIds=x.vectorLayers.map(w=>w.id)),s(null,x)}};return p.url?l.getJSON(t.transformRequest(p.url,J.Source),c):l.browser.frame(()=>c(null,p))}Vt.Actor=l.Actor;class Bt{constructor(t,s){t&&(s?this.setSouthWest(t).setNorthEast(s):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof l.LngLat?new l.LngLat(t.lng,t.lat):l.LngLat.convert(t),this}setSouthWest(t){return this._sw=t instanceof l.LngLat?new l.LngLat(t.lng,t.lat):l.LngLat.convert(t),this}extend(t){const s=this._sw,c=this._ne;let d,f;if(t instanceof l.LngLat)d=t,f=t;else{if(!(t instanceof Bt))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Bt.convert(t)):this.extend(l.LngLat.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(l.LngLat.convert(t)):this;if(d=t._sw,f=t._ne,!d||!f)return this}return s||c?(s.lng=Math.min(d.lng,s.lng),s.lat=Math.min(d.lat,s.lat),c.lng=Math.max(f.lng,c.lng),c.lat=Math.max(f.lat,c.lat)):(this._sw=new l.LngLat(d.lng,d.lat),this._ne=new l.LngLat(f.lng,f.lat)),this}getCenter(){return new l.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new l.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:s,lat:c}=l.LngLat.convert(t);let d=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&d}static convert(t){return t instanceof Bt?t:t&&new Bt(t)}static fromLngLat(t,s=0){const c=360*s/40075017,d=c/Math.cos(Math.PI/180*t.lat);return new Bt(new l.LngLat(t.lng-d,t.lat-c),new l.LngLat(t.lng+d,t.lat+c))}}class Hn{constructor(t,s,c){this.bounds=Bt.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),c=Math.floor(l.mercatorXfromLng(this.bounds.getWest())*s),d=Math.floor(l.mercatorYfromLat(this.bounds.getNorth())*s),f=Math.ceil(l.mercatorXfromLng(this.bounds.getEast())*s),x=Math.ceil(l.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=c&&t.x<f&&t.y>=d&&t.y<x}}class yn extends l.Evented{constructor(t,s,c,d){if(super(),this.load=()=>{this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Oi(this._options,this.map._requestManager,(f,x)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),f?this.fire(new l.ErrorEvent(f)):x&&(l.extend(this,x),x.bounds&&(this.tileBounds=new Hn(x.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})},this.serialize=()=>l.extend({},this._options),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.extend(this,l.pick(s,["url","scheme","tileSize","promoteId"])),this._options=l.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d)}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(c,J.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function f(x,w){return delete t.request,t.aborted?s(null):x&&x.status!==404?s(x):(w&&w.resourceTiming&&(t.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&t.setExpiryData(w),t.loadVectorData(w,this.map.painter),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}d.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",d,f.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",d,f.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class An extends l.Evented{constructor(t,s,c,d){super(),this.id=t,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.extend({type:"raster"},s),l.extend(this,l.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Oi(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new l.ErrorEvent(t)):s&&(l.extend(this,s),s.bounds&&(this.tileBounds=new Hn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return l.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=ft.getImage(this.map._requestManager.transformRequest(c,J.Tile),(d,f,x)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(d)t.state="errored",s(d);else if(f){this.map._refreshExpiredTiles&&x&&t.setExpiryData(x);const w=this.map.painter.context,E=w.gl;t.texture=this.map.painter.getTileTexture(f.width),t.texture?t.texture.update(f,{useMipmap:!0}):(t.texture=new Je(w,f,E.RGBA,{useMipmap:!0}),t.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),w.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,w.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,w.extTextureFilterAnisotropicMax)),t.state="loaded",s(null)}},this.map._refreshExpiredTiles)}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}class zo extends An{constructor(t,s,c,d){super(t,s,c,d),this.type="raster-dem",this.maxzoom=22,this._options=l.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function d(f,x){f&&(t.state="errored",s(f)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=ft.getImage(this.map._requestManager.transformRequest(c,J.Tile),function(f,x){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(f)t.state="errored",s(f);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(x),delete x.cacheControl,delete x.expires;const w=l.isImageBitmap(x)&&(dt==null&&(dt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),dt)?x:l.browser.getImageData(x,1),E={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:w,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",E,d.bind(this)))}}.bind(this),this.map._refreshExpiredTiles),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,c=Math.pow(2,s.z),d=(s.x-1+c)%c,f=s.x===0?t.wrap-1:t.wrap,x=(s.x+1+c)%c,w=s.x+1===c?t.wrap+1:t.wrap,E={};return E[new l.OverscaledTileID(t.overscaledZ,f,s.z,d,s.y).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,w,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(E[new l.OverscaledTileID(t.overscaledZ,f,s.z,d,s.y-1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,w,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(E[new l.OverscaledTileID(t.overscaledZ,f,s.z,d,s.y+1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new l.OverscaledTileID(t.overscaledZ,w,s.z,x,s.y+1).key]={backfilled:!1}),E}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class kr extends l.Evented{constructor(t,s,c,d){super(),this.load=()=>{this._updateWorkerData()},this.serialize=()=>l.extend({},this._options,{type:this.type,data:this._data}),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(d),this._data=s.data,this._options=l.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const f=l.EXTENT/this.tileSize;this.workerOptions=l.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*f,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*f,extent:l.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:l.EXTENT,radius:(s.clusterRadius||50)*f,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData(),this}updateData(t){return this._updateWorkerData(t),this}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t&&(t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=t.clusterRadius),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=t.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,c,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:c},d),this}_updateWorkerData(t){const s=l.extend({},this.workerOptions);t?s.dataDiff=t:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(l.browser.resolveURL(this._data),J.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(c,d)=>{if(this._pendingLoads--,this._removed||d&&d.abandoned)return void this.fire(new l.Event("dataabort",{dataType:"source"}));let f=null;if(d&&d.resourceTiming&&d.resourceTiming[this.id]&&(f=d.resourceTiming[this.id].slice(0)),c)return void this.fire(new l.ErrorEvent(c));const x={dataType:"source"};this._collectResourceTiming&&f&&f.length>0&&l.extend(x,{resourceTiming:f}),this.fire(new l.Event("data",{...x,sourceDataType:"metadata"})),this.fire(new l.Event("data",{...x,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const c=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const d={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(c,d,(f,x)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):f?s(f):(t.loadVectorData(x,this.map.painter,c==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}hasTransition(){return!1}}var Ln=l.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class lr extends l.Evented{constructor(t,s,c,d){super(),this.load=(f,x)=>{this._loaded=!1,this.fire(new l.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=ft.getImage(this.map._requestManager.transformRequest(this.url,J.Image),(w,E)=>{this._request=null,this._loaded=!0,w?this.fire(new l.ErrorEvent(w)):E&&(this.image=E,f&&(this.coordinates=f),x&&x(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||!this.image)return;const f=this.map.painter.context,x=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Ln.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Je(f,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const E in this.tiles){const T=this.tiles[E];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,w=!0)}w&&this.fire(new l.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"image",url:this.options.url,coordinates:this.coordinates}),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=s}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(t){this.coordinates=t;const s=t.map(l.MercatorCoordinate.fromLngLat);this.tileID=function(d){let f=1/0,x=1/0,w=-1/0,E=-1/0;for(const B of d)f=Math.min(f,B.x),x=Math.min(x,B.y),w=Math.max(w,B.x),E=Math.max(E,B.y);const T=Math.max(w-f,E-x),k=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),P=Math.pow(2,k);return new l.CanonicalTileID(k,Math.floor((f+w)/2*P),Math.floor((x+E)/2*P))}(s),this.minzoom=this.maxzoom=this.tileID.z;const c=s.map(d=>this.tileID.getTilePoint(d)._round());return this._boundsArray=new l.RasterBoundsArray,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,l.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,l.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,l.EXTENT,l.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.Event("data",{dataType:"source",sourceDataType:"content"})),this}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}hasTransition(){return!1}}class Zr extends lr{constructor(t,s,c,d){super(t,s,c,d),this.load=()=>{this._loaded=!1;const f=this.options;this.urls=[];for(const x of f.urls)this.urls.push(this.map._requestManager.transformRequest(x,J.Source).url);l.getVideo(this.urls,(x,w)=>{this._loaded=!0,x?this.fire(new l.ErrorEvent(x)):w&&(this.video=w,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})},this.prepare=()=>{if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,x=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,Ln.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new Je(f,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let w=!1;for(const E in this.tiles){const T=this.tiles[E];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,w=!0)}w&&this.fire(new l.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"video",urls:this.urls,coordinates:this.coordinates}),this.roundZoom=!0,this.type="video",this.options=s}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}hasTransition(){return this.video&&!this.video.paused}}class ge extends lr{constructor(t,s,c,d){super(t,s,c,d),this.load=()=>{this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},this.prepare=()=>{let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,w=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,Ln.members)),this.boundsSegments||(this.boundsSegments=l.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Je(x,this.canvas,w.RGBA,{premultiply:!0});let E=!1;for(const T in this.tiles){const k=this.tiles[T];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,E=!0)}E&&this.fire(new l.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))},this.serialize=()=>({type:"canvas",coordinates:this.coordinates}),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(f=>!Array.isArray(f)||f.length!==2||f.some(x=>typeof x!="number"))||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.ErrorEvent(new l.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const Ir={},Ao=p=>{switch(p){case"geojson":return kr;case"image":return lr;case"raster":return An;case"raster-dem":return zo;case"vector":return yn;case"video":return Zr;case"canvas":return ge}return Ir[p]};function jt(p,t){const s=l.create();return l.translate(s,s,[1,1,0]),l.scale(s,s,[.5*p.width,.5*p.height,1]),l.multiply(s,s,p.calculatePosMatrix(t.toUnwrapped()))}function Dt(p,t,s,c,d,f){const x=function(P,B,j){if(P)for(const V of P){const Z=B[V];if(Z&&Z.source===j&&Z.type==="fill-extrusion")return!0}else for(const V in B){const Z=B[V];if(Z.source===j&&Z.type==="fill-extrusion")return!0}return!1}(d&&d.layers,t,p.id),w=f.maxPitchScaleFactor(),E=p.tilesIn(c,w,x);E.sort(ao);const T=[];for(const P of E)T.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(t,s,p._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,d,f,w,jt(p.transform,P.tileID))});const k=function(P){const B={},j={};for(const V of P){const Z=V.queryResults,$=V.wrappedTileID,se=j[$]=j[$]||{};for(const pe in Z){const H=Z[pe],ce=se[pe]=se[pe]||{},me=B[pe]=B[pe]||[];for(const ye of H)ce[ye.featureIndex]||(ce[ye.featureIndex]=!0,me.push(ye))}}return B}(T);for(const P in k)k[P].forEach(B=>{const j=B.feature,V=p.getFeatureState(j.layer["source-layer"],j.id);j.source=j.layer.source,j.layer["source-layer"]&&(j.sourceLayer=j.layer["source-layer"]),j.state=V});return k}function ao(p,t){const s=p.tileID,c=t.tileID;return s.overscaledZ-c.overscaledZ||s.canonical.y-c.canonical.y||s.wrap-c.wrap||s.canonical.x-c.canonical.x}class lo{constructor(t,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=t,this.uid=l.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(d,f){const x={};if(!f)return x;for(const w of d){const E=w.layerIds.map(T=>f.getLayer(T)).filter(Boolean);if(E.length!==0){w.layers=E,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(T=>E.filter(k=>k.id===T)[0]));for(const T of E)x[T.id]=w}}return x}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const f=this.buckets[d];if(f instanceof l.SymbolBucket){if(this.hasSymbolBuckets=!0,!c)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const f=this.buckets[d];if(f instanceof l.SymbolBucket&&f.hasRTLText){this.hasRTLText=!0,l.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const d in this.buckets){const f=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(d).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new l.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const d=this.buckets[c];d.uploadPending()&&d.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Je(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Je(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,d,f,x,w,E,T,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:d,cameraQueryGeometry:f,scale:x,tileSize:this.tileSize,pixelPosMatrix:k,transform:E,params:w,queryPadding:this.queryPadding*T},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),f=s&&s.sourceLayer?s.sourceLayer:"",x=d._geojsonTileLayer||d[f];if(!x)return;const w=l.createFilter(s&&s.filter),{z:E,x:T,y:k}=this.tileID.canonical,P={z:E,x:T,y:k};for(let B=0;B<x.length;B++){const j=x.feature(B);if(w.needGeometry){const $=l.toEvaluationFeature(j,!0);if(!w.filter(new l.EvaluationParameters(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!w.filter(new l.EvaluationParameters(this.tileID.overscaledZ),j))continue;const V=c.getId(j,f),Z=new l.GeoJSONFeature(j,E,T,k,V);Z.tile=P,t.push(Z)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=l.parseCacheControl(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(s)if(this.expirationTime<s)d=!0;else{const f=this.expirationTime-s;f?this.expirationTime=c+Math.max(f,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!s.style.hasLayer(d))continue;const f=this.buckets[d],x=f.layers[0].sourceLayer||"_geojsonTileLayer",w=c[x],E=t[x];if(!w||!E||Object.keys(E).length===0)continue;f.update(E,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});const T=s&&s.style&&s.style.getLayer(d);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(f)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<l.browser.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=l.browser.now()+t}setDependencies(t,s){const c={};for(const d of s)c[d]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const d=this.dependencies[c];if(d){for(const f of s)if(d[f])return!0}}return!1}}class ua{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const d=t.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const f={value:s,timeout:void 0};if(c!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},c)),this.data[d].push(f),this.order.push(d),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,d=s===void 0?0:this.data[c].indexOf(s),f=this.data[c][d];return this.data[c].splice(d,1),f.timeout&&clearTimeout(f.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(f.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const d of this.data[c])t(d.value)||s.push(d);for(const c of s)this.remove(c.value.tileID,c)}}class ca{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const d=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},l.extend(this.stateChanges[t][d],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==d&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const f in this.state[t][d])c[f]||(this.deletedStates[t][d][f]=null)}else for(const f in c)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][f]===null&&delete this.deletedStates[t][d][f]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const d=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(c in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][c]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),d=l.extend({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][s];if(f===null)return{};for(const x in f)delete d[x]}return d}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const f={};for(const x in this.stateChanges[d])this.state[d][x]||(this.state[d][x]={}),l.extend(this.state[d][x],this.stateChanges[d][x]),f[x]=this.state[d][x];c[d]=f}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const f={};if(this.deletedStates[d]===null)for(const x in this.state[d])f[x]={},this.state[d][x]={};else for(const x in this.deletedStates[d]){if(this.deletedStates[d][x]===null)this.state[d][x]={};else for(const w of Object.keys(this.deletedStates[d][x]))delete this.state[d][x][w];f[x]=this.state[d][x]}c[d]=c[d]||{},l.extend(c[d],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in t)t[d].setFeatureState(c,s)}}class ri extends l.Evented{constructor(t,s,c){super(),this.id=t,this.dispatcher=c,this.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((d,f,x,w)=>{const E=new(Ao(f.type))(d,f,x,w);if(E.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${E.id}`);return E})(t,s,c,this),this._tiles={},this._cache=new ua(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ca,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new l.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Es).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&s.push(this._tiles[c]);return t?s.sort((c,d)=>{const f=c.tileID,x=d.tileID,w=new l.Point(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),E=new l.Point(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-x.overscaledZ||E.y-w.y||E.x-w.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Es).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,d){if(d)return t.state="errored",void(d.status!==404?this._source.fire(new l.ErrorEvent(d,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=l.browser.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new l.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let d=0;d<s.length;d++){const f=s[d];if(t.neighboringTiles&&t.neighboringTiles[f]){const x=this.getTileByID(f);c(t,x),c(x,t)}}function c(d,f){d.needsHillshadePrepare=!0,d.needsTerrainPrepare=!0;let x=f.tileID.canonical.x-d.tileID.canonical.x;const w=f.tileID.canonical.y-d.tileID.canonical.y,E=Math.pow(2,d.tileID.canonical.z),T=f.tileID.key;x===0&&w===0||Math.abs(w)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),f.dem&&d.dem&&(d.dem.backfillBorder(f.dem,x,w),d.neighboringTiles&&d.neighboringTiles[T]&&(d.neighboringTiles[T].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,d){for(const f in this._tiles){let x=this._tiles[f];if(d[f]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>c)continue;let w=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const T=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[T.key],x&&x.hasData()&&(w=T)}let E=w;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){d[w.key]=w;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const d=t.scaledTo(c),f=this._getLoadedTile(d);if(f)return f}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,d=Math.floor(s*c*(this._maxTileCacheZoomLevels===null?l.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),f=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(f)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const d in this._tiles){const f=this._tiles[d];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+s),c[f.tileID.key]=f}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(d,this._tiles[d])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new l.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(c=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(c=c.filter(k=>this._source.hasTile(k)))):c=[];const d=t.coveringZoomLevel(this._source),f=Math.max(d-ri.maxOverzooming,this._source.minzoom),x=Math.max(d+ri.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const P of c)if(P.canonical.z>this._source.minzoom){const B=P.scaledTo(P.canonical.z-1);k[B.key]=B;const j=P.scaledTo(Math.max(this._source.minzoom,Math.min(P.canonical.z,5)));k[j.key]=j}c=c.concat(Object.values(k))}const w=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,w&&this.fire(new l.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const E=this._updateRetainedTiles(c,d);if(Lo(this._source.type)){const k={},P={},B=Object.keys(E),j=l.browser.now();for(const V of B){const Z=E[V],$=this._tiles[V];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=j)continue;const se=this.findLoadedParent(Z,f);se&&(this._addTile(se.tileID),k[se.tileID.key]=se.tileID),P[V]=Z}this._retainLoadedChildren(P,d,x,E);for(const V in k)E[V]||(this._coveredTiles[V]=!0,E[V]=k[V]);if(s){const V={},Z={};for(const $ of c)this._tiles[$.key].hasData()?V[$.key]=$:Z[$.key]=$;for(const $ in Z){const se=Z[$].children(this._source.maxzoom);this._tiles[se[0].key]&&this._tiles[se[1].key]&&this._tiles[se[2].key]&&this._tiles[se[3].key]&&(V[se[0].key]=E[se[0].key]=se[0],V[se[1].key]=E[se[1].key]=se[1],V[se[2].key]=E[se[2].key]=se[2],V[se[3].key]=E[se[3].key]=se[3],delete Z[$])}for(const $ in Z){const se=this.findLoadedParent(Z[$],this._source.minzoom);if(se){V[se.tileID.key]=E[se.tileID.key]=se.tileID;for(const pe in V)V[pe].isChildOf(se.tileID)&&delete V[pe]}}for(const $ in this._tiles)V[$]||(this._coveredTiles[$]=!0)}}for(const k in E)this._tiles[k].clearFadeHold();const T=l.keysDifference(this._tiles,E);for(const k of T){const P=this._tiles[k];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const c={},d={},f=Math.max(s-ri.maxOverzooming,this._source.minzoom),x=Math.max(s+ri.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const T=this._addTile(E);c[E.key]=E,T.hasData()||s<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,s,x,c);for(const E of t){let T=this._tiles[E.key];if(T.hasData())continue;if(s+1>this._source.maxzoom){const P=E.children(this._source.maxzoom)[0],B=this.getTile(P);if(B&&B.hasData()){c[P.key]=P;continue}}else{const P=E.children(this._source.maxzoom);if(c[P[0].key]&&c[P[1].key]&&c[P[2].key]&&c[P[3].key])continue}let k=T.wasRequested();for(let P=E.overscaledZ-1;P>=f;--P){const B=E.scaledTo(P);if(d[B.key])break;if(d[B.key]=!0,T=this.getTile(B),!T&&k&&(T=this._addTile(B)),T){const j=T.hasData();if((k||j)&&(c[B.key]=B),k=T.wasRequested(),j)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,d=this._tiles[t].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}s.push(d.key);const f=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(f),c)break;d=f}for(const f of s)this._loadedParentTiles[f]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=s;return s||(s=new lo(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,c||this._source.fire(new l.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,c){const d=[],f=this.transform;if(!f)return d;const x=c?f.getCameraQueryGeometry(t):t,w=t.map(V=>f.pointCoordinate(V,this.terrain)),E=x.map(V=>f.pointCoordinate(V,this.terrain)),T=this.getIds();let k=1/0,P=1/0,B=-1/0,j=-1/0;for(const V of E)k=Math.min(k,V.x),P=Math.min(P,V.y),B=Math.max(B,V.x),j=Math.max(j,V.y);for(let V=0;V<T.length;V++){const Z=this._tiles[T[V]];if(Z.holdingForFade())continue;const $=Z.tileID,se=Math.pow(2,f.zoom-Z.tileID.overscaledZ),pe=s*Z.queryPadding*l.EXTENT/Z.tileSize/se,H=[$.getTilePoint(new l.MercatorCoordinate(k,P)),$.getTilePoint(new l.MercatorCoordinate(B,j))];if(H[0].x-pe<l.EXTENT&&H[0].y-pe<l.EXTENT&&H[1].x+pe>=0&&H[1].y+pe>=0){const ce=w.map(ye=>$.getTilePoint(ye)),me=E.map(ye=>$.getTilePoint(ye));d.push({tile:Z,tileID:$,queryGeometry:ce,cameraQueryGeometry:me,scale:se})}}return d}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Lo(this._source.type)){const t=l.browser.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=t)return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const d=this._tiles[t];d&&d.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}}function Es(p,t){const s=Math.abs(2*p.wrap)-+(p.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return p.overscaledZ-t.overscaledZ||c-s||t.canonical.y-p.canonical.y||t.canonical.x-p.canonical.x}function Lo(p){return p==="raster"||p==="image"||p==="video"}ri.maxOverzooming=10,ri.maxUnderzooming=3;const Be="mapboxgl_preloaded_worker_pool";class Yi{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Yi.workerCount;)this.workers.push(new Worker(l.config.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Be]}numActive(){return Object.keys(this.active).length}}const sn=Math.floor(l.browser.hardwareConcurrency/2);let Pr;function Gr(){return Pr||(Pr=new Yi),Pr}Yi.workerCount=l.isSafari(globalThis)?Math.max(Math.min(sn,3),1):1;class De{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=l.clamp(t,0,1);let s=1,c=this._distances[s];const d=t*this.paddedLength+this.padding;for(;c<d&&s<this._distances.length;)c=this._distances[++s];const f=s-1,x=this._distances[f],w=c-x,E=w>0?(d-x)/w:0;return this.points[f].mult(1-E).add(this.points[s].mult(E))}}function yt(p,t){let s=!0;return p==="always"||p!=="never"&&t!=="never"||(s=!1),s}class _t{constructor(t,s,c){const d=this.boxCells=[],f=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(s/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)d.push([]),f.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,c,d,f){this._forEachCell(s,c,d,f,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(f)}insertCircle(t,s,c,d){this._forEachCell(s-d,c-d,s+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(c),this.circles.push(d)}_insertBoxCell(t,s,c,d,f,x){this.boxCells[f].push(x)}_insertCircleCell(t,s,c,d,f,x){this.circleCells[f].push(x)}_query(t,s,c,d,f,x,w){if(c<0||t>this.width||d<0||s>this.height)return[];const E=[];if(t<=0&&s<=0&&this.width<=c&&this.height<=d){if(f)return[{key:null,x1:t,y1:s,x2:c,y2:d}];for(let T=0;T<this.boxKeys.length;T++)E.push({key:this.boxKeys[T],x1:this.bboxes[4*T],y1:this.bboxes[4*T+1],x2:this.bboxes[4*T+2],y2:this.bboxes[4*T+3]});for(let T=0;T<this.circleKeys.length;T++){const k=this.circles[3*T],P=this.circles[3*T+1],B=this.circles[3*T+2];E.push({key:this.circleKeys[T],x1:k-B,y1:P-B,x2:k+B,y2:P+B})}}else this._forEachCell(t,s,c,d,this._queryCell,E,{hitTest:f,overlapMode:x,seenUids:{box:{},circle:{}}},w);return E}query(t,s,c,d){return this._query(t,s,c,d,!1,null)}hitTest(t,s,c,d,f,x){return this._query(t,s,c,d,!0,f,x).length>0}hitTestCircle(t,s,c,d,f){const x=t-c,w=t+c,E=s-c,T=s+c;if(w<0||x>this.width||T<0||E>this.height)return!1;const k=[];return this._forEachCell(x,E,w,T,this._queryCellCircle,k,{hitTest:!0,overlapMode:d,circle:{x:t,y:s,radius:c},seenUids:{box:{},circle:{}}},f),k.length>0}_queryCell(t,s,c,d,f,x,w,E){const{seenUids:T,hitTest:k,overlapMode:P}=w,B=this.boxCells[f];if(B!==null){const V=this.bboxes;for(const Z of B)if(!T.box[Z]){T.box[Z]=!0;const $=4*Z,se=this.boxKeys[Z];if(t<=V[$+2]&&s<=V[$+3]&&c>=V[$+0]&&d>=V[$+1]&&(!E||E(se))&&(!k||!yt(P,se.overlapMode))&&(x.push({key:se,x1:V[$],y1:V[$+1],x2:V[$+2],y2:V[$+3]}),k))return!0}}const j=this.circleCells[f];if(j!==null){const V=this.circles;for(const Z of j)if(!T.circle[Z]){T.circle[Z]=!0;const $=3*Z,se=this.circleKeys[Z];if(this._circleAndRectCollide(V[$],V[$+1],V[$+2],t,s,c,d)&&(!E||E(se))&&(!k||!yt(P,se.overlapMode))){const pe=V[$],H=V[$+1],ce=V[$+2];if(x.push({key:se,x1:pe-ce,y1:H-ce,x2:pe+ce,y2:H+ce}),k)return!0}}}return!1}_queryCellCircle(t,s,c,d,f,x,w,E){const{circle:T,seenUids:k,overlapMode:P}=w,B=this.boxCells[f];if(B!==null){const V=this.bboxes;for(const Z of B)if(!k.box[Z]){k.box[Z]=!0;const $=4*Z,se=this.boxKeys[Z];if(this._circleAndRectCollide(T.x,T.y,T.radius,V[$+0],V[$+1],V[$+2],V[$+3])&&(!E||E(se))&&!yt(P,se.overlapMode))return x.push(!0),!0}}const j=this.circleCells[f];if(j!==null){const V=this.circles;for(const Z of j)if(!k.circle[Z]){k.circle[Z]=!0;const $=3*Z,se=this.circleKeys[Z];if(this._circlesCollide(V[$],V[$+1],V[$+2],T.x,T.y,T.radius)&&(!E||E(se))&&!yt(P,se.overlapMode))return x.push(!0),!0}}}_forEachCell(t,s,c,d,f,x,w,E){const T=this._convertToXCellCoord(t),k=this._convertToYCellCoord(s),P=this._convertToXCellCoord(c),B=this._convertToYCellCoord(d);for(let j=T;j<=P;j++)for(let V=k;V<=B;V++)if(f.call(this,t,s,c,d,this.xCellCount*V+j,x,w,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,c,d,f,x){const w=d-t,E=f-s,T=c+x;return T*T>w*w+E*E}_circleAndRectCollide(t,s,c,d,f,x,w){const E=(x-d)/2,T=Math.abs(t-(d+E));if(T>E+c)return!1;const k=(w-f)/2,P=Math.abs(s-(f+k));if(P>k+c)return!1;if(T<=E||P<=k)return!0;const B=T-E,j=P-k;return B*B+j*j<=c*c}}function qi(p,t,s,c,d){const f=l.create();return t?(l.scale(f,f,[1/d,1/d,1]),s||l.rotateZ(f,f,c.angle)):l.multiply(f,c.labelPlaneMatrix,p),f}function Mr(p,t,s,c,d){if(t){const f=l.clone(p);return l.scale(f,f,[d,d,1]),s||l.rotateZ(f,f,-c.angle),f}return c.glCoordMatrix}function lt(p,t,s){let c;s?(c=[p.x,p.y,s(p.x,p.y),1],l.transformMat4(c,c,t)):(c=[p.x,p.y,0,1],X(c,c,t));const d=c[3];return{point:new l.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function ur(p,t){return .5+p/t*.5}function cr(p,t){const s=p[0]/p[3],c=p[1]/p[3];return s>=-t[0]&&s<=t[0]&&c>=-t[1]&&c<=t[1]}function Hr(p,t,s,c,d,f,x,w,E,T){const k=c?p.textSizeData:p.iconSizeData,P=l.evaluateSizeForZoom(k,s.transform.zoom),B=[256/s.width*2+1,256/s.height*2+1],j=c?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;j.clear();const V=p.lineVertexArray,Z=c?p.text.placedSymbolArray:p.icon.placedSymbolArray,$=s.transform.width/s.transform.height;let se=!1;for(let pe=0;pe<Z.length;pe++){const H=Z.get(pe);if(H.hidden||H.writingMode===l.WritingMode.vertical&&!se){U(H.numGlyphs,j);continue}let ce;if(se=!1,T?(ce=[H.anchorX,H.anchorY,T(H.anchorX,H.anchorY),1],l.transformMat4(ce,ce,t)):(ce=[H.anchorX,H.anchorY,0,1],X(ce,ce,t)),!cr(ce,B)){U(H.numGlyphs,j);continue}const me=ur(s.transform.cameraToCenterDistance,ce[3]),ye=l.evaluateSizeForFeature(k,P,H),_e=x?ye/me:ye*me,Se=new l.Point(H.anchorX,H.anchorY),xe=lt(Se,d,T).point,Re={projections:{},offsets:{}},Ke=Zt(H,_e,!1,w,t,d,f,p.glyphOffsetArray,V,j,xe,Se,Re,$,E,T);se=Ke.useVertical,(Ke.notEnoughRoom||se||Ke.needsFlipping&&Zt(H,_e,!0,w,t,d,f,p.glyphOffsetArray,V,j,xe,Se,Re,$,E,T).notEnoughRoom)&&U(H.numGlyphs,j)}c?p.text.dynamicLayoutVertexBuffer.updateData(j):p.icon.dynamicLayoutVertexBuffer.updateData(j)}function Dn(p,t,s,c,d,f,x,w,E,T,k,P,B){const j=w.glyphStartIndex+w.numGlyphs,V=w.lineStartIndex,Z=w.lineStartIndex+w.lineLength,$=t.getoffsetX(w.glyphStartIndex),se=t.getoffsetX(j-1),pe=A(p*$,s,c,d,f,x,w.segment,V,Z,E,T,k,P,B);if(!pe)return null;const H=A(p*se,s,c,d,f,x,w.segment,V,Z,E,T,k,P,B);return H?{first:pe,last:H}:null}function Ni(p,t,s,c){return p===l.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*c?{useVertical:!0}:(p===l.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function Zt(p,t,s,c,d,f,x,w,E,T,k,P,B,j,V,Z){const $=t/24,se=p.lineOffsetX*$,pe=p.lineOffsetY*$;let H;if(p.numGlyphs>1){const ce=p.glyphStartIndex+p.numGlyphs,me=p.lineStartIndex,ye=p.lineStartIndex+p.lineLength,_e=Dn($,w,se,pe,s,k,P,p,E,f,B,V,Z);if(!_e)return{notEnoughRoom:!0};const Se=lt(_e.first.point,x,Z).point,xe=lt(_e.last.point,x,Z).point;if(c&&!s){const Re=Ni(p.writingMode,Se,xe,j);if(Re)return Re}H=[_e.first];for(let Re=p.glyphStartIndex+1;Re<ce-1;Re++)H.push(A($*w.getoffsetX(Re),se,pe,s,k,P,p.segment,me,ye,E,f,B,V,Z));H.push(_e.last)}else{if(c&&!s){const me=lt(P,d,Z).point,ye=p.lineStartIndex+p.segment+1,_e=new l.Point(E.getx(ye),E.gety(ye)),Se=lt(_e,d,Z),xe=Se.signedDistanceFromCamera>0?Se.point:ha(P,_e,me,1,d,Z),Re=Ni(p.writingMode,me,xe,j);if(Re)return Re}const ce=A($*w.getoffsetX(p.glyphStartIndex),se,pe,s,k,P,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,E,f,B,V,Z);if(!ce)return{notEnoughRoom:!0};H=[ce]}for(const ce of H)l.addDynamicAttributes(T,ce.point,ce.angle);return{}}function ha(p,t,s,c,d,f){const x=lt(p.add(p.sub(t)._unit()),d,f).point,w=s.sub(x);return s.add(w._mult(c/w.mag()))}function zr(p,t){const{projectionCache:s,lineVertexArray:c,labelPlaneMatrix:d,tileAnchorPoint:f,distanceFromAnchor:x,getElevation:w,previousVertex:E,direction:T,absOffsetX:k}=t;if(s.projections[p])return s.projections[p];const P=new l.Point(c.getx(p),c.gety(p)),B=lt(P,d,w);if(B.signedDistanceFromCamera>0)return s.projections[p]=B.point,B.point;const j=p-T;return ha(x===0?f:new l.Point(c.getx(j),c.gety(j)),P,E,k-x+1,d,w)}function Wr(p,t,s){return p._unit()._perp()._mult(t*s)}function G(p,t,s,c,d,f,x,w){const{projectionCache:E,direction:T}=w;if(E.offsets[p])return E.offsets[p];const k=s.add(t);if(p+T<c||p+T>=d)return E.offsets[p]=k,k;const P=zr(p+T,w),B=Wr(P.sub(s),x,T),j=s.add(B),V=P.add(B);return E.offsets[p]=l.findLineIntersection(f,k,j,V)||k,E.offsets[p]}function A(p,t,s,c,d,f,x,w,E,T,k,P,B,j){const V=c?p-t:p+t;let Z=V>0?1:-1,$=0;c&&(Z*=-1,$=Math.PI),Z<0&&($+=Math.PI);let se,pe,H=Z>0?w+x:w+x+1,ce=d,me=d,ye=0,_e=0;const Se=Math.abs(V),xe=[];let Re;for(;ye+_e<=Se;){if(H+=Z,H<w||H>=E)return null;ye+=_e,me=ce,pe=se;const Me={projectionCache:P,lineVertexArray:T,labelPlaneMatrix:k,tileAnchorPoint:f,distanceFromAnchor:ye,getElevation:j,previousVertex:me,direction:Z,absOffsetX:Se};if(ce=zr(H,Me),s===0)xe.push(me),Re=ce.sub(me);else{let ot;const je=ce.sub(me);ot=je.mag()===0?Wr(zr(H+Z,Me).sub(ce),s,Z):Wr(je,s,Z),pe||(pe=me.add(ot)),se=G(H,ot,ce,w,E,pe,s,Me),xe.push(pe),Re=se.sub(pe)}_e=Re.mag()}const Ke=Re._mult((Se-ye)/_e)._add(pe||me),wt=$+Math.atan2(ce.y-me.y,ce.x-me.x);return xe.push(Ke),{point:Ke,angle:B?wt:0,path:xe}}const R=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function U(p,t){for(let s=0;s<p;s++){const c=t.length;t.resize(c+4),t.float32.set(R,3*c)}}function X(p,t,s){const c=t[0],d=t[1];return p[0]=s[0]*c+s[4]*d+s[12],p[1]=s[1]*c+s[5]*d+s[13],p[3]=s[3]*c+s[7]*d+s[15],p}const Q=100;class ae{constructor(t,s=new _t(t.width+200,t.height+200,25),c=new _t(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Q,this.screenBottomBoundary=t.height+Q,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,c,d,f,x){const w=this.projectAndGetPerspectiveRatio(d,t.anchorPointX,t.anchorPointY,x),E=c*w.perspectiveRatio,T=t.x1*E+w.point.x,k=t.y1*E+w.point.y,P=t.x2*E+w.point.x,B=t.y2*E+w.point.y;return!this.isInsideGrid(T,k,P,B)||s!=="always"&&this.grid.hitTest(T,k,P,B,s,f)||w.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[T,k,P,B],offscreen:this.isOffscreen(T,k,P,B)}}placeCollisionCircles(t,s,c,d,f,x,w,E,T,k,P,B,j,V){const Z=[],$=new l.Point(s.anchorX,s.anchorY),se=lt($,x,V),pe=ur(this.transform.cameraToCenterDistance,se.signedDistanceFromCamera),H=(k?f/pe:f*pe)/l.ONE_EM,ce=lt($,w,V).point,me=Dn(H,d,s.lineOffsetX*H,s.lineOffsetY*H,!1,ce,$,s,c,w,{projections:{},offsets:{}},!1,V);let ye=!1,_e=!1,Se=!0;if(me){const xe=.5*B*pe+j,Re=new l.Point(-100,-100),Ke=new l.Point(this.screenRightBoundary,this.screenBottomBoundary),wt=new De,Me=me.first,ot=me.last;let je=[];for(let St=Me.path.length-1;St>=1;St--)je.push(Me.path[St]);for(let St=1;St<ot.path.length;St++)je.push(ot.path[St]);const Mt=2.5*xe;if(E){const St=je.map(ut=>lt(ut,E,V));je=St.some(ut=>ut.signedDistanceFromCamera<=0)?[]:St.map(ut=>ut.point)}let kt=[];if(je.length>0){const St=je[0].clone(),ut=je[0].clone();for(let ti=1;ti<je.length;ti++)St.x=Math.min(St.x,je[ti].x),St.y=Math.min(St.y,je[ti].y),ut.x=Math.max(ut.x,je[ti].x),ut.y=Math.max(ut.y,je[ti].y);kt=St.x>=Re.x&&ut.x<=Ke.x&&St.y>=Re.y&&ut.y<=Ke.y?[je]:ut.x<Re.x||St.x>Ke.x||ut.y<Re.y||St.y>Ke.y?[]:l.clipLine([je],Re.x,Re.y,Ke.x,Ke.y)}for(const St of kt){wt.reset(St,.25*xe);let ut=0;ut=wt.length<=.5*xe?1:Math.ceil(wt.paddedLength/Mt)+1;for(let ti=0;ti<ut;ti++){const Vi=ti/Math.max(ut-1,1),fi=wt.lerp(Vi),zi=fi.x+Q,xn=fi.y+Q;Z.push(zi,xn,xe,0);const Xn=zi-xe,Kn=xn-xe,Ji=zi+xe,yr=xn+xe;if(Se=Se&&this.isOffscreen(Xn,Kn,Ji,yr),_e=_e||this.isInsideGrid(Xn,Kn,Ji,yr),t!=="always"&&this.grid.hitTestCircle(zi,xn,xe,t,P)&&(ye=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ye}}}}return{circles:!T&&ye||!_e||pe<this.perspectiveRatioCutoff?[]:Z,offscreen:Se,collisionDetected:ye}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let c=1/0,d=1/0,f=-1/0,x=-1/0;for(const k of t){const P=new l.Point(k.x+Q,k.y+Q);c=Math.min(c,P.x),d=Math.min(d,P.y),f=Math.max(f,P.x),x=Math.max(x,P.y),s.push(P)}const w=this.grid.query(c,d,f,x).concat(this.ignoredGrid.query(c,d,f,x)),E={},T={};for(const k of w){const P=k.key;if(E[P.bucketInstanceId]===void 0&&(E[P.bucketInstanceId]={}),E[P.bucketInstanceId][P.featureIndex])continue;const B=[new l.Point(k.x1,k.y1),new l.Point(k.x2,k.y1),new l.Point(k.x2,k.y2),new l.Point(k.x1,k.y2)];l.polygonIntersectsPolygon(s,B)&&(E[P.bucketInstanceId][P.featureIndex]=!0,T[P.bucketInstanceId]===void 0&&(T[P.bucketInstanceId]=[]),T[P.bucketInstanceId].push(P.featureIndex))}return T}insertCollisionBox(t,s,c,d,f,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:f,collisionGroupID:x,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,c,d,f,x){const w=c?this.ignoredGrid:this.grid,E={bucketInstanceId:d,featureIndex:f,collisionGroupID:x,overlapMode:s};for(let T=0;T<t.length;T+=4)w.insertCircle(E,t[T],t[T+1],t[T+2])}projectAndGetPerspectiveRatio(t,s,c,d){let f;return d?(f=[s,c,d(s,c),1],l.transformMat4(f,f,t)):(f=[s,c,0,1],X(f,f,t)),{point:new l.Point((f[0]/f[3]+1)/2*this.transform.width+Q,(-f[1]/f[3]+1)/2*this.transform.height+Q),perspectiveRatio:.5+this.transform.cameraToCenterDistance/f[3]*.5}}isOffscreen(t,s,c,d){return c<Q||t>=this.screenRightBoundary||d<Q||s>this.screenBottomBoundary}isInsideGrid(t,s,c,d){return c>=0&&t<this.gridRightBoundary&&d>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=l.identity([]);return l.translate(t,t,[-100,-100,0]),t}}function ne(p,t,s){return t*(l.EXTENT/(p.tileSize*Math.pow(2,s-p.tileID.overscaledZ)))}class ee{constructor(t,s,c,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class ue{constructor(t,s,c,d,f){this.text=new ee(t?t.text:null,s,c,f),this.icon=new ee(t?t.icon:null,s,d,f)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class be{constructor(t,s,c){this.text=t,this.icon=s,this.skipFade=c}}class Te{constructor(){this.invProjMatrix=l.create(),this.viewportMatrix=l.create(),this.circles=[]}}class Ee{constructor(t,s,c,d,f){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=f}}class nt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:c=>c.collisionGroupID===s}}return this.collisionGroups[t]}}function pt(p,t,s,c,d){const{horizontalAlign:f,verticalAlign:x}=l.getAnchorAlignment(p),w=-(f-.5)*t,E=-(x-.5)*s,T=l.evaluateVariableOffset(p,c);return new l.Point(w+T[0]*d,E+T[1]*d)}function Ye(p,t,s,c,d,f){const{x1:x,x2:w,y1:E,y2:T,anchorPointX:k,anchorPointY:P}=p,B=new l.Point(t,s);return c&&B._rotate(d?f:-f),{x1:x+B.x,y1:E+B.y,x2:w+B.x,y2:T+B.y,anchorPointX:k,anchorPointY:P}}class it{constructor(t,s,c,d,f){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new ae(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new nt(d),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,c,d){const f=c.getBucket(s),x=c.latestFeatureIndex;if(!f||!x||s.id!==f.layerIds[0])return;const w=c.collisionBoxArray,E=f.layers[0].layout,T=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),k=c.tileSize/l.EXTENT,P=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),B=E.get("text-pitch-alignment")==="map",j=E.get("text-rotation-alignment")==="map",V=ne(c,1,this.transform.zoom),Z=qi(P,B,j,this.transform,V);let $=null;if(B){const pe=Mr(P,B,j,this.transform,V);$=l.multiply([],this.transform.labelPlaneMatrix,pe)}this.retainedQueryData[f.bucketInstanceId]=new Ee(f.bucketInstanceId,x,f.sourceLayerIndex,f.index,c.tileID);const se={bucket:f,layout:E,posMatrix:P,textLabelPlaneMatrix:Z,labelToScreenMatrix:$,scale:T,textPixelRatio:k,holdingForFade:c.holdingForFade(),collisionBoxArray:w,partiallyEvaluatedTextSize:l.evaluateSizeForZoom(f.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(f.sourceID)};if(d)for(const pe of f.sortKeyRanges){const{sortKey:H,symbolInstanceStart:ce,symbolInstanceEnd:me}=pe;t.push({sortKey:H,symbolInstanceStart:ce,symbolInstanceEnd:me,parameters:se})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:f.symbolInstances.length,parameters:se})}attemptAnchorPlacement(t,s,c,d,f,x,w,E,T,k,P,B,j,V,Z,$){const se=[B.textOffset0,B.textOffset1],pe=pt(t,c,d,se,f),H=this.collisionIndex.placeCollisionBox(Ye(s,pe.x,pe.y,x,w,this.transform.angle),P,E,T,k.predicate,$);if((!Z||this.collisionIndex.placeCollisionBox(Ye(Z,pe.x,pe.y,x,w,this.transform.angle),P,E,T,k.predicate,$).box.length!==0)&&H.box.length>0){let ce;if(this.prevPlacement&&this.prevPlacement.variableOffsets[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID]&&this.prevPlacement.placements[B.crossTileID].text&&(ce=this.prevPlacement.variableOffsets[B.crossTileID].anchor),B.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[B.crossTileID]={textOffset:se,width:c,height:d,anchor:t,textBoxScale:f,prevAnchor:ce},this.markUsedJustification(j,t,B,V),j.allowVerticalPlacement&&(this.markUsedOrientation(j,V,B),this.placedOrientations[B.crossTileID]=V),{shift:pe,placedGlyphBoxes:H}}}placeLayerBucketPart(t,s,c){const{bucket:d,layout:f,posMatrix:x,textLabelPlaneMatrix:w,labelToScreenMatrix:E,textPixelRatio:T,holdingForFade:k,collisionBoxArray:P,partiallyEvaluatedTextSize:B,collisionGroup:j}=t.parameters,V=f.get("text-optional"),Z=f.get("icon-optional"),$=l.getOverlapMode(f,"text-overlap","text-allow-overlap"),se=$==="always",pe=l.getOverlapMode(f,"icon-overlap","icon-allow-overlap"),H=pe==="always",ce=f.get("text-rotation-alignment")==="map",me=f.get("text-pitch-alignment")==="map",ye=f.get("icon-text-fit")!=="none",_e=f.get("symbol-z-order")==="viewport-y",Se=se&&(H||!d.hasIconData()||Z),xe=H&&(se||!d.hasTextData()||V);!d.collisionArrays&&P&&d.deserializeCollisionBoxes(P);const Re=this.retainedQueryData[d.bucketInstanceId].tileID,Ke=this.terrain?(Me,ot)=>this.terrain.getElevation(Re,Me,ot):null,wt=(Me,ot)=>{if(s[Me.crossTileID])return;if(k)return void(this.placements[Me.crossTileID]=new be(!1,!1,!1));let je=!1,Mt=!1,kt=!0,St=null,ut={box:null,offscreen:null},ti={box:null,offscreen:null},Vi=null,fi=null,zi=null,xn=0,Xn=0,Kn=0;ot.textFeatureIndex?xn=ot.textFeatureIndex:Me.useRuntimeCollisionCircles&&(xn=Me.featureIndex),ot.verticalTextFeatureIndex&&(Xn=ot.verticalTextFeatureIndex);const Ji=ot.textBox;if(Ji){const Zi=Lt=>{let Ti=l.WritingMode.horizontal;if(d.allowVerticalPlacement&&!Lt&&this.prevPlacement){const Li=this.prevPlacement.placedOrientations[Me.crossTileID];Li&&(this.placedOrientations[Me.crossTileID]=Li,Ti=Li,this.markUsedOrientation(d,Ti,Me))}return Ti},Ai=(Lt,Ti)=>{if(d.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&ot.verticalTextBox){for(const Li of d.writingModes)if(Li===l.WritingMode.vertical?(ut=Ti(),ti=ut):ut=Lt(),ut&&ut.box&&ut.box.length)break}else ut=Lt()};if(f.get("text-variable-anchor")){let Lt=f.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Me.crossTileID]){const Rt=this.prevPlacement.variableOffsets[Me.crossTileID];Lt.indexOf(Rt.anchor)>0&&(Lt=Lt.filter(Ci=>Ci!==Rt.anchor),Lt.unshift(Rt.anchor))}const Ti=(Rt,Ci,wn)=>{const Ka=Rt.x2-Rt.x1,Lr=Rt.y2-Rt.y1,cp=Me.textBoxScale,ah=ye&&pe==="never"?Ci:null;let Kt={box:[],offscreen:!1};const _u=$!=="never"?2*Lt.length:Lt.length;for(let qs=0;qs<_u;++qs){const Dr=this.attemptAnchorPlacement(Lt[qs%Lt.length],Rt,Ka,Lr,cp,ce,me,T,x,j,qs>=Lt.length?$:"never",Me,d,wn,ah,Ke);if(Dr&&(Kt=Dr.placedGlyphBoxes,Kt&&Kt.box&&Kt.box.length)){je=!0,St=Dr.shift;break}}return Kt};Ai(()=>Ti(Ji,ot.iconBox,l.WritingMode.horizontal),()=>{const Rt=ot.verticalTextBox;return d.allowVerticalPlacement&&!(ut&&ut.box&&ut.box.length)&&Me.numVerticalGlyphVertices>0&&Rt?Ti(Rt,ot.verticalIconBox,l.WritingMode.vertical):{box:null,offscreen:null}}),ut&&(je=ut.box,kt=ut.offscreen);const Li=Zi(ut&&ut.box);if(!je&&this.prevPlacement){const Rt=this.prevPlacement.variableOffsets[Me.crossTileID];Rt&&(this.variableOffsets[Me.crossTileID]=Rt,this.markUsedJustification(d,Rt.anchor,Me,Li))}}else{const Lt=(Ti,Li)=>{const Rt=this.collisionIndex.placeCollisionBox(Ti,$,T,x,j.predicate,Ke);return Rt&&Rt.box&&Rt.box.length&&(this.markUsedOrientation(d,Li,Me),this.placedOrientations[Me.crossTileID]=Li),Rt};Ai(()=>Lt(Ji,l.WritingMode.horizontal),()=>{const Ti=ot.verticalTextBox;return d.allowVerticalPlacement&&Me.numVerticalGlyphVertices>0&&Ti?Lt(Ti,l.WritingMode.vertical):{box:null,offscreen:null}}),Zi(ut&&ut.box&&ut.box.length)}}if(Vi=ut,je=Vi&&Vi.box&&Vi.box.length>0,kt=Vi&&Vi.offscreen,Me.useRuntimeCollisionCircles){const Zi=d.text.placedSymbolArray.get(Me.centerJustifiedTextSymbolIndex),Ai=l.evaluateSizeForFeature(d.textSizeData,B,Zi),Lt=f.get("text-padding");fi=this.collisionIndex.placeCollisionCircles($,Zi,d.lineVertexArray,d.glyphOffsetArray,Ai,x,w,E,c,me,j.predicate,Me.collisionCircleDiameter,Lt,Ke),fi.circles.length&&fi.collisionDetected&&!c&&l.warnOnce("Collisions detected, but collision boxes are not shown"),je=se||fi.circles.length>0&&!fi.collisionDetected,kt=kt&&fi.offscreen}if(ot.iconFeatureIndex&&(Kn=ot.iconFeatureIndex),ot.iconBox){const Zi=Ai=>{const Lt=ye&&St?Ye(Ai,St.x,St.y,ce,me,this.transform.angle):Ai;return this.collisionIndex.placeCollisionBox(Lt,pe,T,x,j.predicate,Ke)};ti&&ti.box&&ti.box.length&&ot.verticalIconBox?(zi=Zi(ot.verticalIconBox),Mt=zi.box.length>0):(zi=Zi(ot.iconBox),Mt=zi.box.length>0),kt=kt&&zi.offscreen}const yr=V||Me.numHorizontalGlyphVertices===0&&Me.numVerticalGlyphVertices===0,$s=Z||Me.numIconVertices===0;if(yr||$s?$s?yr||(Mt=Mt&&je):je=Mt&&je:Mt=je=Mt&&je,je&&Vi&&Vi.box&&this.collisionIndex.insertCollisionBox(Vi.box,$,f.get("text-ignore-placement"),d.bucketInstanceId,ti&&ti.box&&Xn?Xn:xn,j.ID),Mt&&zi&&this.collisionIndex.insertCollisionBox(zi.box,pe,f.get("icon-ignore-placement"),d.bucketInstanceId,Kn,j.ID),fi&&(je&&this.collisionIndex.insertCollisionCircles(fi.circles,$,f.get("text-ignore-placement"),d.bucketInstanceId,xn,j.ID),c)){const Zi=d.bucketInstanceId;let Ai=this.collisionCircleArrays[Zi];Ai===void 0&&(Ai=this.collisionCircleArrays[Zi]=new Te);for(let Lt=0;Lt<fi.circles.length;Lt+=4)Ai.circles.push(fi.circles[Lt+0]),Ai.circles.push(fi.circles[Lt+1]),Ai.circles.push(fi.circles[Lt+2]),Ai.circles.push(fi.collisionDetected?1:0)}if(Me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(d.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Me.crossTileID]=new be(je||Se,Mt||xe,kt||d.justReloaded),s[Me.crossTileID]=!0};if(_e){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Me=d.getSortedSymbolIndexes(this.transform.angle);for(let ot=Me.length-1;ot>=0;--ot){const je=Me[ot];wt(d.symbolInstances.get(je),d.collisionArrays[je])}}else for(let Me=t.symbolInstanceStart;Me<t.symbolInstanceEnd;Me++)wt(d.symbolInstances.get(Me),d.collisionArrays[Me]);if(c&&d.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[d.bucketInstanceId];l.invert(Me.invProjMatrix,x),Me.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(t,s,c,d){let f;f=d===l.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[l.getAnchorJustification(s)];const x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const w of x)w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=f>=0&&w!==f?0:c.crossTileID)}markUsedOrientation(t,s,c){const d=s===l.WritingMode.horizontal||s===l.WritingMode.horizontalOnly?s:0,f=s===l.WritingMode.vertical?s:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const w of x)t.text.placedSymbolArray.get(w).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=f)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let c=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const d=s?s.symbolFadeChange(t):1,f=s?s.opacities:{},x=s?s.variableOffsets:{},w=s?s.placedOrientations:{};for(const E in this.placements){const T=this.placements[E],k=f[E];k?(this.opacities[E]=new ue(k,d,T.text,T.icon),c=c||T.text!==k.text.placed||T.icon!==k.icon.placed):(this.opacities[E]=new ue(null,d,T.text,T.icon,T.skipFade),c=c||T.text||T.icon)}for(const E in f){const T=f[E];if(!this.opacities[E]){const k=new ue(T,d,!1,!1);k.isHidden()||(this.opacities[E]=k,c=c||T.text.placed||T.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in w)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=w[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const c={};for(const d of s){const f=d.getBucket(t);f&&d.latestFeatureIndex&&t.id===f.layerIds[0]&&this.updateBucketOpacities(f,c,d.collisionBoxArray)}}updateBucketOpacities(t,s,c){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const d=t.layers[0].layout,f=new ue(null,0,!1,!1,!0),x=d.get("text-allow-overlap"),w=d.get("icon-allow-overlap"),E=d.get("text-variable-anchor"),T=d.get("text-rotation-alignment")==="map",k=d.get("text-pitch-alignment")==="map",P=d.get("icon-text-fit")!=="none",B=new ue(null,0,x&&(w||!t.hasIconData()||d.get("icon-optional")),w&&(x||!t.hasTextData()||d.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const j=(V,Z,$)=>{for(let se=0;se<Z/4;se++)V.opacityVertexArray.emplaceBack($);V.hasVisibleVertices=V.hasVisibleVertices||$!==Ui};for(let V=0;V<t.symbolInstances.length;V++){const Z=t.symbolInstances.get(V),{numHorizontalGlyphVertices:$,numVerticalGlyphVertices:se,crossTileID:pe}=Z;let H=this.opacities[pe];s[pe]?H=f:H||(H=B,this.opacities[pe]=H),s[pe]=!0;const ce=Z.numIconVertices>0,me=this.placedOrientations[Z.crossTileID],ye=me===l.WritingMode.vertical,_e=me===l.WritingMode.horizontal||me===l.WritingMode.horizontalOnly;if($>0||se>0){const Se=Mi(H.text);j(t.text,$,ye?Ui:Se),j(t.text,se,_e?Ui:Se);const xe=H.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(wt=>{wt>=0&&(t.text.placedSymbolArray.get(wt).hidden=xe||ye?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=xe||_e?1:0);const Re=this.variableOffsets[Z.crossTileID];Re&&this.markUsedJustification(t,Re.anchor,Z,me);const Ke=this.placedOrientations[Z.crossTileID];Ke&&(this.markUsedJustification(t,"left",Z,Ke),this.markUsedOrientation(t,Ke,Z))}if(ce){const Se=Mi(H.icon),xe=!(P&&Z.verticalPlacedIconSymbolIndex&&ye);Z.placedIconSymbolIndex>=0&&(j(t.icon,Z.numIconVertices,xe?Se:Ui),t.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=H.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(j(t.icon,Z.numVerticalIconVertices,xe?Ui:Se),t.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=H.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Se=t.collisionArrays[V];if(Se){let xe=new l.Point(0,0);if(Se.textBox||Se.verticalTextBox){let Ke=!0;if(E){const wt=this.variableOffsets[pe];wt?(xe=pt(wt.anchor,wt.width,wt.height,wt.textOffset,wt.textBoxScale),T&&xe._rotate(k?this.transform.angle:-this.transform.angle)):Ke=!1}Se.textBox&&ct(t.textCollisionBox.collisionVertexArray,H.text.placed,!Ke||ye,xe.x,xe.y),Se.verticalTextBox&&ct(t.textCollisionBox.collisionVertexArray,H.text.placed,!Ke||_e,xe.x,xe.y)}const Re=!!(!_e&&Se.verticalIconBox);Se.iconBox&&ct(t.iconCollisionBox.collisionVertexArray,H.icon.placed,Re,P?xe.x:0,P?xe.y:0),Se.verticalIconBox&&ct(t.iconCollisionBox.collisionVertexArray,H.icon.placed,!Re,P?xe.x:0,P?xe.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const V=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=V.invProjMatrix,t.placementViewportMatrix=V.viewportMatrix,t.collisionCircleArray=V.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const c=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function ct(p,t,s,c,d){p.emplaceBack(t?1:0,s?1:0,c||0,d||0),p.emplaceBack(t?1:0,s?1:0,c||0,d||0),p.emplaceBack(t?1:0,s?1:0,c||0,d||0),p.emplaceBack(t?1:0,s?1:0,c||0,d||0)}const It=Math.pow(2,25),vt=Math.pow(2,24),Nt=Math.pow(2,17),Gt=Math.pow(2,16),ht=Math.pow(2,9),Jt=Math.pow(2,8),oi=Math.pow(2,1);function Mi(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const t=p.placed?1:0,s=Math.floor(127*p.opacity);return s*It+t*vt+s*Nt+t*Gt+s*ht+t*Jt+s*oi+t}const Ui=0;class Rn{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,c,d,f){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,d,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,f())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((w,E)=>w.sortKey-E.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,f())return!0;return!1}}class Ic{constructor(t,s,c,d,f,x,w,E){this.placement=new it(t,s,x,w,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(t,s,c){const d=l.browser.now(),f=()=>!this._forceFullPlacement&&l.browser.now()-d>2;for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],w=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=w)&&(!x.maxzoom||x.maxzoom>w)){if(this._inProgressLayer||(this._inProgressLayer=new Rn(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,f))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Xr=512/l.EXTENT/2;class vi{constructor(t,s,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const d=new Map;for(let f=0;f<s.length;f++){const x=s.get(f),w=x.key,E=d.get(w);E?E.push(x):d.set(w,[x])}for(const[f,x]of d){const w={positions:x.map(E=>({x:Math.floor(E.anchorX*Xr),y:Math.floor(E.anchorY*Xr)})),crossTileIDs:x.map(E=>E.crossTileID)};if(w.positions.length>128){const E=new l.KDBush(w.positions.length,16,Uint16Array);for(const{x:T,y:k}of w.positions)E.add(T,k);E.finish(),delete w.positions,w.index=E}this._symbolsByKey[f]=w}}getScaledCoordinates(t,s){const{x:c,y:d,z:f}=this.tileID.canonical,{x,y:w,z:E}=s.canonical,T=Xr/Math.pow(2,E-f),k=(w*l.EXTENT+t.anchorY)*T,P=d*l.EXTENT*Xr;return{x:Math.floor((x*l.EXTENT+t.anchorX)*T-c*l.EXTENT*Xr),y:Math.floor(k-P)}}findMatches(t,s,c){const d=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let f=0;f<t.length;f++){const x=t.get(f);if(x.crossTileID)continue;const w=this._symbolsByKey[x.key];if(!w)continue;const E=this.getScaledCoordinates(x,s);if(w.index){const T=w.index.range(E.x-d,E.y-d,E.x+d,E.y+d).sort();for(const k of T){const P=w.crossTileIDs[k];if(!c[P]){c[P]=!0,x.crossTileID=P;break}}}else if(w.positions)for(let T=0;T<w.positions.length;T++){const k=w.positions[T],P=w.crossTileIDs[T];if(Math.abs(k.x-E.x)<=d&&Math.abs(k.y-E.y)<=d&&!c[P]){c[P]=!0,x.crossTileID=P;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:t})=>t)}}class Ts{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class uo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const c in this.indexes){const d=this.indexes[c],f={};for(const x in d){const w=d[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+s),f[w.tileID.key]=w}this.indexes[c]=f}this.lng=t}addBucket(t,s,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let f=0;f<s.symbolInstances.length;f++)s.symbolInstances.get(f).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const d=this.usedCrossTileIDs[t.overscaledZ];for(const f in this.indexes){const x=this.indexes[f];if(Number(f)>t.overscaledZ)for(const w in x){const E=x[w];E.tileID.isChildOf(t)&&E.findMatches(s.symbolInstances,t,d)}else{const w=x[t.scaledTo(Number(f)).key];w&&w.findMatches(s.symbolInstances,t,d)}}for(let f=0;f<s.symbolInstances.length;f++){const x=s.symbolInstances.get(f);x.crossTileID||(x.crossTileID=c.generate(),d[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new vi(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const c of s.getCrossTileIDsLists())for(const d of c)delete this.usedCrossTileIDs[t][d]}removeStaleBuckets(t){let s=!1;for(const c in this.indexes){const d=this.indexes[c];for(const f in d)t[d[f].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[f]),delete d[f],s=!0)}return s}}class Ei{constructor(){this.layerIndexes={},this.crossTileIDs=new Ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,c){let d=this.layerIndexes[t.id];d===void 0&&(d=this.layerIndexes[t.id]=new uo);let f=!1;const x={};d.handleWrapJump(c);for(const w of s){const E=w.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(w.tileID,E,this.crossTileIDs)&&(f=!0),x[E.bucketInstanceId]=!0)}return d.removeStaleBuckets(x)&&(f=!0),f}pruneUnusedLayers(t){const s={};t.forEach(c=>{s[c]=!0});for(const c in this.layerIndexes)s[c]||delete this.layerIndexes[c]}}const co=(p,t)=>l.emitValidationErrors(p,t&&t.filter(s=>s.identifier!=="source.canvas")),Wn=l.pick(l.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),Pc=l.pick(l.operations,["setCenter","setZoom","setBearing","setPitch"]),Kr=l.emptyStyle();class Do extends l.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new Vt(Gr(),this,t._getMapId()),this.imageManager=new ni,this.imageManager.setEventedParent(this),this.glyphManager=new on(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Ut(256,512),this.crossTileSymbolIndex=new Ei,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.getReferrer());const c=this;this._rtlTextPluginCallback=Do.registerForPluginStateChange(d=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(f,x)=>{if(l.triggerPluginCompletionEvent(f),x&&x.every(w=>w))for(const w in c.sourceCaches){const E=c.sourceCaches[w].getSource().type;E!=="vector"&&E!=="geojson"||c.sourceCaches[w].reload()}})}),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const f=this.sourceCaches[d.sourceId];if(!f)return;const x=f.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const E=this._layers[w];E.source===x.id&&this._validateLayer(E)}})}loadURL(t,s={},c){this.fire(new l.Event("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const d=this.map._requestManager.transformRequest(t,J.Style);this._request=l.getJSON(d,(f,x)=>{this._request=null,f?this.fire(new l.ErrorEvent(f)):x&&this._load(x,s,c)})}loadJSON(t,s={},c){this.fire(new l.Event("dataloading",{dataType:"style"})),this._request=l.browser.frame(()=>{this._request=null,s.validate=s.validate!==!1,this._load(t,s,c)})}loadEmpty(){this.fire(new l.Event("dataloading",{dataType:"style"})),this._load(Kr,{validate:!1})}_load(t,s,c){const d=s.transformStyle?s.transformStyle(c,t):t;if(!s.validate||!co(this,l.validateStyle(d))){this._loaded=!0,this.stylesheet=d;for(const f in d.sources)this.addSource(f,d.sources[f],{validate:!1});d.sprite?this._loadSprite(d.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(d.glyphs),this._createLayers(),this.light=new xt(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new l.Event("data",{dataType:"style"})),this.fire(new l.Event("style.load"))}}_createLayers(){const t=l.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",t),this._order=t.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of t){const c=l.createStyleLayer(s);c.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=c}}_loadSprite(t,s=!1,c=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(d,f,x,w){const E=Ve(d),T=E.length,k=x>1?"@2x":"",P={},B={},j={};for(const{id:V,url:Z}of E){const $=f.transformRequest(f.normalizeSpriteURL(Z,k,".json"),J.SpriteJSON),se=`${V}_${$.url}`;P[se]=l.getJSON($,(ce,me)=>{delete P[se],B[V]=me,gt(w,B,j,ce,T)});const pe=f.transformRequest(f.normalizeSpriteURL(Z,k,".png"),J.SpriteImage),H=`${V}_${pe.url}`;P[H]=ft.getImage(pe,(ce,me)=>{delete P[H],j[V]=me,gt(w,B,j,ce,T)})}return{cancel(){for(const V of Object.values(P))V.cancel()}}}(t,this.map._requestManager,this.map.getPixelRatio(),(d,f)=>{if(this._spriteRequest=null,d)this.fire(new l.ErrorEvent(d));else if(f)for(const x in f){this._spritesImagesIds[x]=[];const w=this._spritesImagesIds[x]?this._spritesImagesIds[x].filter(E=>!(E in f)):[];for(const E of w)this.imageManager.removeImage(E),this._changedImages[E]=!0;for(const E in f[x]){const T=x==="default"?E:`${x}:${E}`;this._spritesImagesIds[x].push(T),T in this.imageManager.images?this.imageManager.updateImage(T,f[x][E],!1):this.imageManager.addImage(T,f[x][E]),s&&(this._changedImages[T]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"})),c&&c(d)})}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const c=t.sourceLayer;if(!c)return;const d=s.getSource();(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(c)===-1)&&this.fire(new l.ErrorEvent(new Error(`Source layer "${c}" does not exist on source "${d.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t){const s=this._serializedAllLayers();if(!t||t.length===0)return Object.values(s);const c=[];for(const d of t)s[d]&&c.push(s[d]);return c}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const s=Object.keys(this._layers);for(const c of s){const d=this._layers[c];d.type!=="custom"&&(t[c]=d.serialize())}return t}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),f=Object.keys(this._removedLayers);(d.length||f.length)&&this._updateWorkerLayers(d,f);for(const x in this._updatedSources){const w=this._updatedSources[x];if(w==="reload")this._reloadSource(x);else{if(w!=="clear")throw new Error(`Invalid action ${w}`);this._clearSource(x)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const c={};for(const d in this.sourceCaches){const f=this.sourceCaches[d];c[d]=f.used,f.used=!1}for(const d of this._order){const f=this._layers[d];f.recalculate(t,this._availableImages),!f.isHidden(t.zoom)&&f.source&&(this.sourceCaches[f.source].used=!0)}for(const d in c){const f=this.sourceCaches[d];c[d]!==f.used&&f.fire(new l.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new l.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.sourceCaches)this.sourceCaches[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,s={}){this._checkLoaded();const c=this.serialize();if(t=s.transformStyle?s.transformStyle(c,t):t,co(this,l.validateStyle(t)))return!1;(t=l.clone$1(t)).layers=l.derefLayers(t.layers);const d=l.diffStyles(c,t).filter(x=>!(x.command in Pc));if(d.length===0)return!1;const f=d.filter(x=>!(x.command in Wn));if(f.length>0)throw new Error(`Unimplemented: ${f.map(x=>x.command).join(", ")}.`);for(const x of d)x.command!=="setTransition"&&this[x.command].apply(this,x.args);return this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new l.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new l.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(l.validateStyle.source,`sources.${t}`,s,null,c))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const d=this.sourceCaches[t]=new ri(t,s,this.dispatcher);d.style=this,d.setEventedParent(this,()=>({isSourceLoaded:d.loaded(),source:d.serialize(),sourceId:t})),d.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new l.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new l.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,c={}){this._checkLoaded();const d=t.id;if(this.getLayer(d))return void this.fire(new l.ErrorEvent(new Error(`Layer "${d}" already exists on this map.`)));let f;if(t.type==="custom"){if(co(this,l.validateCustomStyleLayer(t)))return;f=l.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(d,t.source),t=l.clone$1(t),t=l.extend(t,{source:d})),this._validate(l.validateStyle.layer,`layers.${d}`,t,{arrayIndex:-1},c))return;f=l.createStyleLayer(t),this._validateLayer(f),f.setEventedParent(this,{layer:{id:d}})}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new l.ErrorEvent(new Error(`Cannot add layer "${d}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,d),this._layerOrderChanged=!0,this._layers[d]=f,this._removedLayers[d]&&f.source&&f.type!=="custom"){const w=this._removedLayers[d];delete this._removedLayers[d],w.type!==f.type?this._updatedSources[f.source]="clear":(this._updatedSources[f.source]="reload",this.sourceCaches[f.source].pause())}this._updateLayer(f),f.onAdd&&f.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new l.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const c=this._order.indexOf(t);this._order.splice(c,1);const d=s?this._order.indexOf(s):this._order.length;s&&d===-1?this.fire(new l.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(d,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new l.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,c){this._checkLoaded();const d=this.getLayer(t);d?d.minzoom===s&&d.maxzoom===c||(s!=null&&(d.minzoom=s),c!=null&&(d.maxzoom=c),this._updateLayer(d)):this.fire(new l.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,c={}){this._checkLoaded();const d=this.getLayer(t);if(d){if(!l.deepEqual(d.filter,s))return s==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(l.validateStyle.filter,`layers.${d.id}.filter`,s,null,c)||(d.filter=l.clone$1(s),this._updateLayer(d)))}else this.fire(new l.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return l.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,c,d={}){this._checkLoaded();const f=this.getLayer(t);f?l.deepEqual(f.getLayoutProperty(s),c)||(f.setLayoutProperty(s,c,d),this._updateLayer(f)):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const c=this.getLayer(t);if(c)return c.getLayoutProperty(s);this.fire(new l.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,c,d={}){this._checkLoaded();const f=this.getLayer(t);f?l.deepEqual(f.getPaintProperty(s),c)||(f.setPaintProperty(s,c,d)&&this._updateLayer(f),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new l.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const c=t.source,d=t.sourceLayer,f=this.sourceCaches[c];if(f===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const x=f.getSource().type;x==="geojson"&&d?this.fire(new l.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||d?(t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),f.setFeatureState(d,t.id,s)):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const c=t.source,d=this.sourceCaches[c];if(d===void 0)return void this.fire(new l.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const f=d.getSource().type,x=f==="vector"?t.sourceLayer:void 0;f!=="vector"||x?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new l.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):d.removeFeatureState(x,t.id,s):this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,c=t.sourceLayer,d=this.sourceCaches[s];if(d!==void 0)return d.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new l.ErrorEvent(new Error("The feature id parameter must be provided."))),d.getFeatureState(c,t.id)):void this.fire(new l.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return l.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=l.mapObject(this.sourceCaches,d=>d.serialize()),s=this._serializeByIds(this._order),c=this.stylesheet;return l.filterObject({version:c.version,name:c.name,metadata:c.metadata,light:c.light,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:t,layers:s},d=>d!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",c={},d=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(s(w)){c[w]=x;for(const E of t){const T=E[w];if(T)for(const k of T)d.push(k)}}}d.sort((x,w)=>w.intersectionZ-x.intersectionZ);const f=[];for(let x=this._order.length-1;x>=0;x--){const w=this._order[x];if(s(w))for(let E=d.length-1;E>=0;E--){const T=d[E].feature;if(c[T.layer.id]<x)break;f.push(T),d.pop()}else for(const E of t){const T=E[w];if(T)for(const k of T)f.push(k.feature)}}return f}queryRenderedFeatures(t,s,c){s&&s.filter&&this._validate(l.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const d={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new l.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const w of s.layers){const E=this._layers[w];if(!E)return this.fire(new l.ErrorEvent(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];d[E.source]=!0}}const f=[];s.availableImages=this._availableImages;const x=this._serializedAllLayers();for(const w in this.sourceCaches)s.layers&&!d[w]||f.push(Dt(this.sourceCaches[w],this._layers,x,t,s,c));return this.placement&&f.push(function(w,E,T,k,P,B,j){const V={},Z=B.queryRenderedSymbols(k),$=[];for(const se of Object.keys(Z).map(Number))$.push(j[se]);$.sort(ao);for(const se of $){const pe=se.featureIndex.lookupSymbolFeatures(Z[se.bucketInstanceId],E,se.bucketIndex,se.sourceLayerIndex,P.filter,P.layers,P.availableImages,w);for(const H in pe){const ce=V[H]=V[H]||[],me=pe[H];me.sort((ye,_e)=>{const Se=se.featureSortOrder;if(Se){const xe=Se.indexOf(ye.featureIndex);return Se.indexOf(_e.featureIndex)-xe}return _e.featureIndex-ye.featureIndex});for(const ye of me)ce.push(ye)}}for(const se in V)V[se].forEach(pe=>{const H=pe.feature,ce=T[w[se].source].getFeatureState(H.layer["source-layer"],H.id);H.source=H.layer.source,H.layer["source-layer"]&&(H.sourceLayer=H.layer["source-layer"]),H.state=ce});return V}(this._layers,x,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(f)}querySourceFeatures(t,s){s&&s.filter&&this._validate(l.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const c=this.sourceCaches[t];return c?function(d,f){const x=d.getRenderableIds().map(T=>d.getTileByID(T)),w=[],E={};for(let T=0;T<x.length;T++){const k=x[T],P=k.tileID.canonical.key;E[P]||(E[P]=!0,k.querySourceFeatures(w,f))}return w}(c,s):[]}addSourceType(t,s,c){return Ao(t)?c(new Error(`A source type called "${t}" already exists.`)):(((d,f)=>{Ir[d]=f})(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const c=this.light.getLight();let d=!1;for(const x in t)if(!l.deepEqual(t[x],c[x])){d=!0;break}if(!d)return;const f={now:l.browser.now(),transition:l.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(f)}_validate(t,s,c,d,f={}){return(!f||f.validate!==!1)&&co(this,t.call(l.validateStyle,l.extend({key:s,style:this.serialize(),value:c,styleSpec:l.v8Spec},d)))}_remove(t=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),l.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const c=this.sourceCaches[s];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(t)}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,c,d,f=!1){let x=!1,w=!1;const E={};for(const T of this._order){const k=this._layers[T];if(k.type!=="symbol")continue;if(!E[k.source]){const B=this.sourceCaches[k.source];E[k.source]=B.getRenderableIds(!0).map(j=>B.getTileByID(j)).sort((j,V)=>V.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(V.tileID)?-1:1))}const P=this.crossTileSymbolIndex.addLayer(k,E[k.source],t.center.lng);x=x||P}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((f=f||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(l.browser.now(),t.zoom))&&(this.pauseablePlacement=new Ic(t,this.map.terrain,this._order,f,s,c,d,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(l.browser.now()),w=!0),x&&this.pauseablePlacement.placement.setStale()),w||x)for(const T of this._order){const k=this._layers[T];k.type==="symbol"&&this.placement.updateLayerOpacities(k,E[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(l.browser.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,c){this.imageManager.getImages(s.icons,c),this._updateTilesForChangedImages();const d=this.sourceCaches[s.source];d&&d.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,c){this.glyphManager.getGlyphs(s.stacks,c);const d=this.sourceCaches[s.source];d&&d.setDependencies(s.tileID.key,s.type,[""])}getResource(t,s,c){return l.makeRequest(s,c)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,s={}){this._checkLoaded(),t&&this._validate(l.validateStyle.glyphs,"glyphs",t,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}addSprite(t,s,c={},d){this._checkLoaded();const f=[{id:t,url:s}],x=[...Ve(this.stylesheet.sprite),...f];this._validate(l.validateStyle.sprite,"sprite",x,null,c)||(this.stylesheet.sprite=x,this._loadSprite(f,!0,d))}removeSprite(t){this._checkLoaded();const s=Ve(this.stylesheet.sprite);if(s.find(c=>c.id===t)){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;s.splice(s.findIndex(c=>c.id===t),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.Event("data",{dataType:"style"}))}else this.fire(new l.ErrorEvent(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ve(this.stylesheet.sprite)}setSprite(t,s={},c){this._checkLoaded(),t&&this._validate(l.validateStyle.sprite,"sprite",t,null,s)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}}Do.registerForPluginStateChange=l.registerForPluginStateChange;var da=l.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ro="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Yr={prelude:Ct(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ct(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ct(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ct(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ct(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ct(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ct("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ct(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ct(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ct(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ct(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ct(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ct(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ct(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ct(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ct(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ct(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ct(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ct(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ct(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ct("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ro),terrainDepth:Ct("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ro),terrainCoords:Ct("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ro)};function Ct(p,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/attribute ([\w]+) ([\w]+)/g),d=p.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),f=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=f?f.concat(d):d,w={};return{fragmentSource:p=p.replace(s,(E,T,k,P,B)=>(w[B]=!0,T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${k} ${P} ${B};
#else
uniform ${k} ${P} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${k} ${P} ${B} = u_${B};
#endif
`)),vertexSource:t=t.replace(s,(E,T,k,P,B)=>{const j=P==="float"?"vec2":"vec4",V=B.match(/color/)?"color":j;return w[B]?T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${k} ${j} a_${B};
varying ${k} ${P} ${B};
#else
uniform ${k} ${P} u_${B};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${k} ${P} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${V}(a_${B}, u_${B}_t);
#else
    ${k} ${P} ${B} = u_${B};
#endif
`:T==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${k} ${j} a_${B};
#else
uniform ${k} ${P} u_${B};
#endif
`:V==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${k} ${P} ${B} = a_${B};
#else
    ${k} ${P} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${k} ${P} ${B} = unpack_mix_${V}(a_${B}, u_${B}_t);
#else
    ${k} ${P} ${B} = u_${B};
#endif
`}),staticAttributes:c,staticUniforms:x}}class Fl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,c,d,f,x,w,E,T){this.context=t;let k=this.boundPaintVertexBuffers.length!==d.length;for(let P=0;!k&&P<d.length;P++)this.boundPaintVertexBuffers[P]!==d[P]&&(k=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==c||k||this.boundIndexBuffer!==f||this.boundVertexOffset!==x||this.boundDynamicVertexBuffer!==w||this.boundDynamicVertexBuffer2!==E||this.boundDynamicVertexBuffer3!==T?this.freshBind(s,c,d,f,x,w,E,T):(t.bindVertexArray.set(this.vao),w&&w.bind(),f&&f.dynamicDraw&&f.bind(),E&&E.bind(),T&&T.bind())}freshBind(t,s,c,d,f,x,w,E){const T=t.numAttributes,k=this.context,P=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=f,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=w,this.boundDynamicVertexBuffer3=E,s.enableAttributes(P,t);for(const B of c)B.enableAttributes(P,t);x&&x.enableAttributes(P,t),w&&w.enableAttributes(P,t),E&&E.enableAttributes(P,t),s.bind(),s.setVertexAttribPointers(P,t,f);for(const B of c)B.bind(),B.setVertexAttribPointers(P,t,f);x&&(x.bind(),x.setVertexAttribPointers(P,t,f)),d&&d.bind(),w&&(w.bind(),w.setVertexAttribPointers(P,t,f)),E&&(E.bind(),E.setVertexAttribPointers(P,t,f)),k.currentNumAttributes=T}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Bo(p){const t=[];for(let s=0;s<p.length;s++){if(p[s]===null)continue;const c=p[s].split(" ");t.push(c.pop())}return t}class Hd{constructor(t,s,c,d,f,x,w){const E=t.gl;this.program=E.createProgram();const T=Bo(c.staticAttributes),k=d?d.getBinderAttributes():[],P=T.concat(k),B=Yr.prelude.staticUniforms?Bo(Yr.prelude.staticUniforms):[],j=c.staticUniforms?Bo(c.staticUniforms):[],V=d?d.getBinderUniforms():[],Z=B.concat(j).concat(V),$=[];for(const _e of Z)$.indexOf(_e)<0&&$.push(_e);const se=d?d.defines():[];x&&se.push("#define OVERDRAW_INSPECTOR;"),w&&se.push("#define TERRAIN3D;");const pe=se.concat(Yr.prelude.fragmentSource,c.fragmentSource).join(`
`),H=se.concat(Yr.prelude.vertexSource,c.vertexSource).join(`
`),ce=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(ce,pe),E.compileShader(ce),E.attachShader(this.program,ce);const me=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(me,H),E.compileShader(me),E.attachShader(this.program,me),this.attributes={};const ye={};this.numAttributes=P.length;for(let _e=0;_e<this.numAttributes;_e++)P[_e]&&(E.bindAttribLocation(this.program,_e,P[_e]),this.attributes[P[_e]]=_e);E.linkProgram(this.program),E.deleteShader(me),E.deleteShader(ce);for(let _e=0;_e<$.length;_e++){const Se=$[_e];if(Se&&!ye[Se]){const xe=E.getUniformLocation(this.program,Se);xe&&(ye[Se]=xe)}}this.fixedUniforms=f(t,ye),this.terrainUniforms=((_e,Se)=>({u_depth:new l.Uniform1i(_e,Se.u_depth),u_terrain:new l.Uniform1i(_e,Se.u_terrain),u_terrain_dim:new l.Uniform1f(_e,Se.u_terrain_dim),u_terrain_matrix:new l.UniformMatrix4f(_e,Se.u_terrain_matrix),u_terrain_unpack:new l.Uniform4f(_e,Se.u_terrain_unpack),u_terrain_exaggeration:new l.Uniform1f(_e,Se.u_terrain_exaggeration)}))(t,ye),this.binderUniforms=d?d.getUniforms(t,ye):[]}draw(t,s,c,d,f,x,w,E,T,k,P,B,j,V,Z,$,se,pe){const H=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(d),t.setColorMode(f),t.setCullFace(x),E){t.activeTexture.set(H.TEXTURE2),H.bindTexture(H.TEXTURE_2D,E.depthTexture),t.activeTexture.set(H.TEXTURE3),H.bindTexture(H.TEXTURE_2D,E.texture);for(const me in this.terrainUniforms)this.terrainUniforms[me].set(E[me])}for(const me in this.fixedUniforms)this.fixedUniforms[me].set(w[me]);Z&&Z.setUniforms(t,this.binderUniforms,j,{zoom:V});let ce=0;switch(s){case H.LINES:ce=2;break;case H.TRIANGLES:ce=3;break;case H.LINE_STRIP:ce=1}for(const me of B.get()){const ye=me.vaos||(me.vaos={});(ye[T]||(ye[T]=new Fl)).bind(t,this,k,Z?Z.getPaintVertexBuffers():[],P,me.vertexOffset,$,se,pe),H.drawElements(s,me.primitiveLength*ce,H.UNSIGNED_SHORT,me.primitiveOffset*ce*2)}}}function Mc(p,t,s){const c=1/ne(s,1,t.transform.tileZoom),d=Math.pow(2,s.tileID.overscaledZ),f=s.tileSize*Math.pow(2,t.transform.tileZoom)/d,x=f*(s.tileID.canonical.x+s.tileID.wrap*d),w=f*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[c,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[x>>16,w>>16],u_pixel_coord_lower:[65535&x,65535&w]}}const pa=(p,t,s,c)=>{const d=t.style.light,f=d.properties.get("position"),x=[f.x,f.y,f.z],w=function(){var T=new l.ARRAY_TYPE(9);return l.ARRAY_TYPE!=Float32Array&&(T[1]=0,T[2]=0,T[3]=0,T[5]=0,T[6]=0,T[7]=0),T[0]=1,T[4]=1,T[8]=1,T}();d.properties.get("anchor")==="viewport"&&function(T,k){var P=Math.sin(k),B=Math.cos(k);T[0]=B,T[1]=P,T[2]=0,T[3]=-P,T[4]=B,T[5]=0,T[6]=0,T[7]=0,T[8]=1}(w,-t.transform.angle),function(T,k,P){var B=k[0],j=k[1],V=k[2];T[0]=B*P[0]+j*P[3]+V*P[6],T[1]=B*P[1]+j*P[4]+V*P[7],T[2]=B*P[2]+j*P[5]+V*P[8]}(x,x,w);const E=d.properties.get("color");return{u_matrix:p,u_lightpos:x,u_lightintensity:d.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+s,u_opacity:c}},Wd=(p,t,s,c,d,f,x)=>l.extend(pa(p,t,s,c),Mc(f,t,x),{u_height_factor:-Math.pow(2,d.overscaledZ)/x.tileSize/8}),Ol=p=>({u_matrix:p}),zc=(p,t,s,c)=>l.extend(Ol(p),Mc(s,t,c)),Ac=(p,t)=>({u_matrix:p,u_world:t}),Xd=(p,t,s,c,d)=>l.extend(zc(p,t,s,c),{u_world:d}),Nl=(p,t,s,c)=>{const d=p.transform;let f,x;if(c.paint.get("circle-pitch-alignment")==="map"){const w=ne(s,1,d.zoom);f=!0,x=[w,w]}else f=!1,x=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:p.translatePosMatrix(t.posMatrix,s,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+f,u_device_pixel_ratio:p.pixelRatio,u_extrude_scale:x}},Lc=(p,t,s)=>{const c=ne(s,1,t.zoom),d=Math.pow(2,t.zoom-s.tileID.overscaledZ),f=s.tileID.overscaleFactor();return{u_matrix:p,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[t.pixelsToGLUnits[0]/(c*d),t.pixelsToGLUnits[1]/(c*d)],u_overscale_factor:f}},Ul=(p,t,s=1)=>({u_matrix:p,u_color:t,u_overlay:0,u_overlay_scale:s}),Vl=p=>({u_matrix:p}),Dc=(p,t,s,c)=>({u_matrix:p,u_extrude_scale:ne(t,1,s),u_intensity:c});function ho(p,t){const s=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new l.MercatorCoordinate(0,c/s).toLngLat().lat,new l.MercatorCoordinate(0,(c+1)/s).toLngLat().lat]}const Fo=(p,t,s,c)=>{const d=p.transform;return{u_matrix:Cs(p,t,s,c),u_ratio:1/ne(t,1,d.zoom),u_device_pixel_ratio:p.pixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Bn=(p,t,s,c,d)=>l.extend(Fo(p,t,s,d),{u_image:0,u_image_height:c}),fa=(p,t,s,c,d)=>{const f=p.transform,x=Oo(t,f);return{u_matrix:Cs(p,t,s,d),u_texsize:t.imageAtlasTexture.size,u_ratio:1/ne(t,1,f.zoom),u_device_pixel_ratio:p.pixelRatio,u_image:0,u_scale:[x,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/f.pixelsToGLUnits[0],1/f.pixelsToGLUnits[1]]}},ma=(p,t,s,c,d,f)=>{const x=p.lineAtlas,w=Oo(t,p.transform),E=s.layout.get("line-cap")==="round",T=x.getDash(c.from,E),k=x.getDash(c.to,E),P=T.width*d.fromScale,B=k.width*d.toScale;return l.extend(Fo(p,t,s,f),{u_patternscale_a:[w/P,-T.height/2],u_patternscale_b:[w/B,-k.height/2],u_sdfgamma:x.width/(256*Math.min(P,B)*p.pixelRatio)/2,u_image:0,u_tex_y_a:T.y,u_tex_y_b:k.y,u_mix:d.t})};function Oo(p,t){return 1/ne(p,1,t.tileZoom)}function Cs(p,t,s,c){return p.translatePosMatrix(c?c.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const ga=(p,t,s,c,d)=>{return{u_matrix:p,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(x=d.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(f=d.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:ks(d.paint.get("raster-hue-rotate"))};var f,x};function ks(p){p*=Math.PI/180;const t=Math.sin(p),s=Math.cos(p);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const No=(p,t,s,c,d,f,x,w,E,T)=>{const k=d.transform;return{u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:k.cameraToCenterDistance,u_pitch:k.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:k.width/k.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:f,u_label_plane_matrix:x,u_coord_matrix:w,u_is_text:+E,u_pitch_with_map:+c,u_texsize:T,u_texture:0}},Is=(p,t,s,c,d,f,x,w,E,T,k)=>{const P=d.transform;return l.extend(No(p,t,s,c,d,f,x,w,E,T),{u_gamma_scale:c?Math.cos(P._pitch)*P.cameraToCenterDistance:1,u_device_pixel_ratio:d.pixelRatio,u_is_halo:+k})},_n=(p,t,s,c,d,f,x,w,E,T)=>l.extend(Is(p,t,s,c,d,f,x,w,!0,E,!0),{u_texsize_icon:T,u_texture_icon:1}),vn=(p,t,s)=>({u_matrix:p,u_opacity:t,u_color:s}),jl=(p,t,s,c,d,f)=>l.extend(function(x,w,E,T){const k=E.imageManager.getPattern(x.from.toString()),P=E.imageManager.getPattern(x.to.toString()),{width:B,height:j}=E.imageManager.getPixelSize(),V=Math.pow(2,T.tileID.overscaledZ),Z=T.tileSize*Math.pow(2,E.transform.tileZoom)/V,$=Z*(T.tileID.canonical.x+T.tileID.wrap*V),se=Z*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:P.tl,u_pattern_br_b:P.br,u_texsize:[B,j],u_mix:w.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:P.displaySize,u_scale_a:w.fromScale,u_scale_b:w.toScale,u_tile_units_to_pixels:1/ne(T,1,E.transform.tileZoom),u_pixel_coord_upper:[$>>16,se>>16],u_pixel_coord_lower:[65535&$,65535&se]}}(c,f,s,d),{u_matrix:p,u_opacity:t}),ya={fillExtrusion:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_lightpos:new l.Uniform3f(p,t.u_lightpos),u_lightintensity:new l.Uniform1f(p,t.u_lightintensity),u_lightcolor:new l.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(p,t.u_vertical_gradient),u_opacity:new l.Uniform1f(p,t.u_opacity)}),fillExtrusionPattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_lightpos:new l.Uniform3f(p,t.u_lightpos),u_lightintensity:new l.Uniform1f(p,t.u_lightintensity),u_lightcolor:new l.Uniform3f(p,t.u_lightcolor),u_vertical_gradient:new l.Uniform1f(p,t.u_vertical_gradient),u_height_factor:new l.Uniform1f(p,t.u_height_factor),u_image:new l.Uniform1i(p,t.u_image),u_texsize:new l.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade),u_opacity:new l.Uniform1f(p,t.u_opacity)}),fill:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix)}),fillPattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_image:new l.Uniform1i(p,t.u_image),u_texsize:new l.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade)}),fillOutline:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_world:new l.Uniform2f(p,t.u_world)}),fillOutlinePattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_world:new l.Uniform2f(p,t.u_world),u_image:new l.Uniform1i(p,t.u_image),u_texsize:new l.Uniform2f(p,t.u_texsize),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade)}),circle:(p,t)=>({u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_scale_with_map:new l.Uniform1i(p,t.u_scale_with_map),u_pitch_with_map:new l.Uniform1i(p,t.u_pitch_with_map),u_extrude_scale:new l.Uniform2f(p,t.u_extrude_scale),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_matrix:new l.UniformMatrix4f(p,t.u_matrix)}),collisionBox:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_pixels_to_tile_units:new l.Uniform1f(p,t.u_pixels_to_tile_units),u_extrude_scale:new l.Uniform2f(p,t.u_extrude_scale),u_overscale_factor:new l.Uniform1f(p,t.u_overscale_factor)}),collisionCircle:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_inv_matrix:new l.UniformMatrix4f(p,t.u_inv_matrix),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_viewport_size:new l.Uniform2f(p,t.u_viewport_size)}),debug:(p,t)=>({u_color:new l.UniformColor(p,t.u_color),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_overlay:new l.Uniform1i(p,t.u_overlay),u_overlay_scale:new l.Uniform1f(p,t.u_overlay_scale)}),clippingMask:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix)}),heatmap:(p,t)=>({u_extrude_scale:new l.Uniform1f(p,t.u_extrude_scale),u_intensity:new l.Uniform1f(p,t.u_intensity),u_matrix:new l.UniformMatrix4f(p,t.u_matrix)}),heatmapTexture:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_world:new l.Uniform2f(p,t.u_world),u_image:new l.Uniform1i(p,t.u_image),u_color_ramp:new l.Uniform1i(p,t.u_color_ramp),u_opacity:new l.Uniform1f(p,t.u_opacity)}),hillshade:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_image:new l.Uniform1i(p,t.u_image),u_latrange:new l.Uniform2f(p,t.u_latrange),u_light:new l.Uniform2f(p,t.u_light),u_shadow:new l.UniformColor(p,t.u_shadow),u_highlight:new l.UniformColor(p,t.u_highlight),u_accent:new l.UniformColor(p,t.u_accent)}),hillshadePrepare:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_image:new l.Uniform1i(p,t.u_image),u_dimension:new l.Uniform2f(p,t.u_dimension),u_zoom:new l.Uniform1f(p,t.u_zoom),u_unpack:new l.Uniform4f(p,t.u_unpack)}),line:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_ratio:new l.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(p,t.u_units_to_pixels)}),lineGradient:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_ratio:new l.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(p,t.u_units_to_pixels),u_image:new l.Uniform1i(p,t.u_image),u_image_height:new l.Uniform1f(p,t.u_image_height)}),linePattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_texsize:new l.Uniform2f(p,t.u_texsize),u_ratio:new l.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_image:new l.Uniform1i(p,t.u_image),u_units_to_pixels:new l.Uniform2f(p,t.u_units_to_pixels),u_scale:new l.Uniform3f(p,t.u_scale),u_fade:new l.Uniform1f(p,t.u_fade)}),lineSDF:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_ratio:new l.Uniform1f(p,t.u_ratio),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_units_to_pixels:new l.Uniform2f(p,t.u_units_to_pixels),u_patternscale_a:new l.Uniform2f(p,t.u_patternscale_a),u_patternscale_b:new l.Uniform2f(p,t.u_patternscale_b),u_sdfgamma:new l.Uniform1f(p,t.u_sdfgamma),u_image:new l.Uniform1i(p,t.u_image),u_tex_y_a:new l.Uniform1f(p,t.u_tex_y_a),u_tex_y_b:new l.Uniform1f(p,t.u_tex_y_b),u_mix:new l.Uniform1f(p,t.u_mix)}),raster:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_tl_parent:new l.Uniform2f(p,t.u_tl_parent),u_scale_parent:new l.Uniform1f(p,t.u_scale_parent),u_buffer_scale:new l.Uniform1f(p,t.u_buffer_scale),u_fade_t:new l.Uniform1f(p,t.u_fade_t),u_opacity:new l.Uniform1f(p,t.u_opacity),u_image0:new l.Uniform1i(p,t.u_image0),u_image1:new l.Uniform1i(p,t.u_image1),u_brightness_low:new l.Uniform1f(p,t.u_brightness_low),u_brightness_high:new l.Uniform1f(p,t.u_brightness_high),u_saturation_factor:new l.Uniform1f(p,t.u_saturation_factor),u_contrast_factor:new l.Uniform1f(p,t.u_contrast_factor),u_spin_weights:new l.Uniform3f(p,t.u_spin_weights)}),symbolIcon:(p,t)=>({u_is_size_zoom_constant:new l.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,t.u_size_t),u_size:new l.Uniform1f(p,t.u_size),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(p,t.u_pitch),u_rotate_symbol:new l.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,t.u_fade_change),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new l.Uniform1i(p,t.u_is_text),u_pitch_with_map:new l.Uniform1i(p,t.u_pitch_with_map),u_texsize:new l.Uniform2f(p,t.u_texsize),u_texture:new l.Uniform1i(p,t.u_texture)}),symbolSDF:(p,t)=>({u_is_size_zoom_constant:new l.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,t.u_size_t),u_size:new l.Uniform1f(p,t.u_size),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(p,t.u_pitch),u_rotate_symbol:new l.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,t.u_fade_change),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new l.Uniform1i(p,t.u_is_text),u_pitch_with_map:new l.Uniform1i(p,t.u_pitch_with_map),u_texsize:new l.Uniform2f(p,t.u_texsize),u_texture:new l.Uniform1i(p,t.u_texture),u_gamma_scale:new l.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(p,t.u_is_halo)}),symbolTextAndIcon:(p,t)=>({u_is_size_zoom_constant:new l.Uniform1i(p,t.u_is_size_zoom_constant),u_is_size_feature_constant:new l.Uniform1i(p,t.u_is_size_feature_constant),u_size_t:new l.Uniform1f(p,t.u_size_t),u_size:new l.Uniform1f(p,t.u_size),u_camera_to_center_distance:new l.Uniform1f(p,t.u_camera_to_center_distance),u_pitch:new l.Uniform1f(p,t.u_pitch),u_rotate_symbol:new l.Uniform1i(p,t.u_rotate_symbol),u_aspect_ratio:new l.Uniform1f(p,t.u_aspect_ratio),u_fade_change:new l.Uniform1f(p,t.u_fade_change),u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_label_plane_matrix:new l.UniformMatrix4f(p,t.u_label_plane_matrix),u_coord_matrix:new l.UniformMatrix4f(p,t.u_coord_matrix),u_is_text:new l.Uniform1i(p,t.u_is_text),u_pitch_with_map:new l.Uniform1i(p,t.u_pitch_with_map),u_texsize:new l.Uniform2f(p,t.u_texsize),u_texsize_icon:new l.Uniform2f(p,t.u_texsize_icon),u_texture:new l.Uniform1i(p,t.u_texture),u_texture_icon:new l.Uniform1i(p,t.u_texture_icon),u_gamma_scale:new l.Uniform1f(p,t.u_gamma_scale),u_device_pixel_ratio:new l.Uniform1f(p,t.u_device_pixel_ratio),u_is_halo:new l.Uniform1i(p,t.u_is_halo)}),background:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_opacity:new l.Uniform1f(p,t.u_opacity),u_color:new l.UniformColor(p,t.u_color)}),backgroundPattern:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_opacity:new l.Uniform1f(p,t.u_opacity),u_image:new l.Uniform1i(p,t.u_image),u_pattern_tl_a:new l.Uniform2f(p,t.u_pattern_tl_a),u_pattern_br_a:new l.Uniform2f(p,t.u_pattern_br_a),u_pattern_tl_b:new l.Uniform2f(p,t.u_pattern_tl_b),u_pattern_br_b:new l.Uniform2f(p,t.u_pattern_br_b),u_texsize:new l.Uniform2f(p,t.u_texsize),u_mix:new l.Uniform1f(p,t.u_mix),u_pattern_size_a:new l.Uniform2f(p,t.u_pattern_size_a),u_pattern_size_b:new l.Uniform2f(p,t.u_pattern_size_b),u_scale_a:new l.Uniform1f(p,t.u_scale_a),u_scale_b:new l.Uniform1f(p,t.u_scale_b),u_pixel_coord_upper:new l.Uniform2f(p,t.u_pixel_coord_upper),u_pixel_coord_lower:new l.Uniform2f(p,t.u_pixel_coord_lower),u_tile_units_to_pixels:new l.Uniform1f(p,t.u_tile_units_to_pixels)}),terrain:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_texture:new l.Uniform1i(p,t.u_texture),u_ele_delta:new l.Uniform1f(p,t.u_ele_delta)}),terrainDepth:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_ele_delta:new l.Uniform1f(p,t.u_ele_delta)}),terrainCoords:(p,t)=>({u_matrix:new l.UniformMatrix4f(p,t.u_matrix),u_texture:new l.Uniform1i(p,t.u_texture),u_terrain_coords_id:new l.Uniform1f(p,t.u_terrain_coords_id),u_ele_delta:new l.Uniform1f(p,t.u_ele_delta)})};class _a{constructor(t,s,c){this.context=t;const d=t.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $l={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ql{constructor(t,s,c,d){this.length=s.length,this.attributes=c,this.itemSize=s.bytesPerElement,this.dynamicDraw=d,this.context=t;const f=t.gl;this.buffer=f.createBuffer(),t.bindVertexBuffer.set(this.buffer),f.bufferData(f.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let c=0;c<this.attributes.length;c++){const d=s.attributes[this.attributes[c].name];d!==void 0&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,s,c){for(let d=0;d<this.attributes.length;d++){const f=this.attributes[d],x=s.attributes[f.name];x!==void 0&&t.vertexAttribPointer(x,f.components,t[$l[f.type]],!1,this.itemSize,f.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Uo=new WeakMap;function Vo(p){if(Uo.has(p))return Uo.get(p);{const t=p.getParameter(p.VERSION).startsWith("WebGL 2.0");return Uo.set(p,t),t}}class Pt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class va extends Pt{getDefault(){return l.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Rc extends Pt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Bc extends Pt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class jo extends Pt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Kd extends Pt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Yd extends Pt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Jd extends Pt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Qd extends Pt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ep extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class tp extends Pt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Zl extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class xa extends Pt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Gl extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class Hl extends Pt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class $o extends Pt{getDefault(){return l.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fc extends Pt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Oc extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Wl extends Pt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class po extends Pt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Nc extends Pt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class qo extends Pt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Zo extends Pt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Uc extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Xl extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ft extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class wa extends Pt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ip extends Pt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Vc extends Pt{getDefault(){return null}set(t){var s;if(t===this.current&&!this.dirty)return;const c=this.gl;Vo(c)?c.bindVertexArray(t):(s=c.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class Ps extends Pt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class np extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class rp extends Pt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ba extends Pt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class op extends ba{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Kl extends ba{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Sa extends ba{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ea{constructor(t,s,c,d,f){this.context=t,this.width=s,this.height=c;const x=t.gl,w=this.framebuffer=x.createFramebuffer();if(this.colorAttachment=new op(t,w),d)this.depthAttachment=f?new Sa(t,w):new Kl(t,w);else if(f)throw new Error("Stencil cannot be setted without depth");if(x.checkFramebufferStatus(x.FRAMEBUFFER)!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class si{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}si.Replace=[1,0],si.disabled=new si(si.Replace,l.Color.transparent,[!1,!1,!1,!1]),si.unblended=new si(si.Replace,l.Color.transparent,[!0,!0,!0,!0]),si.alphaBlended=new si([1,771],l.Color.transparent,[!0,!0,!0,!0]);class Yl{constructor(t){var s,c;if(this.gl=t,this.clearColor=new va(this),this.clearDepth=new Rc(this),this.clearStencil=new Bc(this),this.colorMask=new jo(this),this.depthMask=new Kd(this),this.stencilMask=new Yd(this),this.stencilFunc=new Jd(this),this.stencilOp=new Qd(this),this.stencilTest=new ep(this),this.depthRange=new tp(this),this.depthTest=new Zl(this),this.depthFunc=new xa(this),this.blend=new Gl(this),this.blendFunc=new Hl(this),this.blendColor=new $o(this),this.blendEquation=new Fc(this),this.cullFace=new Oc(this),this.cullFaceSide=new Wl(this),this.frontFace=new po(this),this.program=new Nc(this),this.activeTexture=new qo(this),this.viewport=new Zo(this),this.bindFramebuffer=new Uc(this),this.bindRenderbuffer=new Xl(this),this.bindTexture=new Ft(this),this.bindVertexBuffer=new wa(this),this.bindElementBuffer=new ip(this),this.bindVertexArray=new Vc(this),this.pixelStoreUnpack=new Ps(this),this.pixelStoreUnpackPremultiplyAlpha=new np(this),this.pixelStoreUnpackFlipY=new rp(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Vo(t)){this.HALF_FLOAT=t.HALF_FLOAT;const d=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=t.RGBA16F)!==null&&s!==void 0?s:d==null?void 0:d.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:d==null?void 0:d.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const d=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=d==null?void 0:d.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new _a(this,t,s)}createVertexBuffer(t,s,c){return new ql(this,t,s,c)}createRenderbuffer(t,s,c){const d=this.gl,f=d.createRenderbuffer();return this.bindRenderbuffer.set(f),d.renderbufferStorage(d.RENDERBUFFER,t,s,c),this.bindRenderbuffer.set(null),f}createFramebuffer(t,s,c,d){return new Ea(this,t,s,c,d)}clear({color:t,depth:s,stencil:c}){const d=this.gl;let f=0;t&&(f|=d.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(f|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),c!==void 0&&(f|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),d.clear(f)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){l.deepEqual(t.blendFunction,si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Vo(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var s;return Vo(this.gl)?this.gl.deleteVertexArray(t):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}class Tt{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);const Go=7680;class Ht{constructor(t,s,c,d,f,x){this.test=t,this.ref=s,this.mask=c,this.fail=d,this.depthFail=f,this.pass=x}}Ht.disabled=new Ht({func:519,mask:0},0,0,Go,Go,Go);class Wt{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}let Ta;function Ca(p,t,s,c,d,f,x){const w=p.context,E=w.gl,T=p.useProgram("collisionBox"),k=[];let P=0,B=0;for(let H=0;H<c.length;H++){const ce=c[H],me=t.getTile(ce),ye=me.getBucket(s);if(!ye)continue;let _e=ce.posMatrix;d[0]===0&&d[1]===0||(_e=p.translatePosMatrix(ce.posMatrix,me,d,f));const Se=x?ye.textCollisionBox:ye.iconCollisionBox,xe=ye.collisionCircleArray;if(xe.length>0){const Re=l.create(),Ke=_e;l.mul(Re,ye.placementInvProjMatrix,p.transform.glCoordMatrix),l.mul(Re,Re,ye.placementViewportMatrix),k.push({circleArray:xe,circleOffset:B,transform:Ke,invTransform:Re,coord:ce}),P+=xe.length/4,B=P}Se&&T.draw(w,E.LINES,Tt.disabled,Ht.disabled,p.colorModeForRenderPass(),Wt.disabled,Lc(_e,p.transform,me),p.style.map.terrain&&p.style.map.terrain.getTerrainData(ce),s.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,null,p.transform.zoom,null,null,Se.collisionVertexBuffer)}if(!x||!k.length)return;const j=p.useProgram("collisionCircle"),V=new l.CollisionCircleLayoutArray;V.resize(4*P),V._trim();let Z=0;for(const H of k)for(let ce=0;ce<H.circleArray.length/4;ce++){const me=4*ce,ye=H.circleArray[me+0],_e=H.circleArray[me+1],Se=H.circleArray[me+2],xe=H.circleArray[me+3];V.emplace(Z++,ye,_e,Se,xe,0),V.emplace(Z++,ye,_e,Se,xe,1),V.emplace(Z++,ye,_e,Se,xe,2),V.emplace(Z++,ye,_e,Se,xe,3)}(!Ta||Ta.length<2*P)&&(Ta=function(H){const ce=2*H,me=new l.QuadTriangleArray;me.resize(ce),me._trim();for(let ye=0;ye<ce;ye++){const _e=6*ye;me.uint16[_e+0]=4*ye+0,me.uint16[_e+1]=4*ye+1,me.uint16[_e+2]=4*ye+2,me.uint16[_e+3]=4*ye+2,me.uint16[_e+4]=4*ye+3,me.uint16[_e+5]=4*ye+0}return me}(P));const $=w.createIndexBuffer(Ta,!0),se=w.createVertexBuffer(V,l.collisionCircleLayout.members,!0);for(const H of k){const ce={u_matrix:H.transform,u_inv_matrix:H.invTransform,u_camera_to_center_distance:(pe=p.transform).cameraToCenterDistance,u_viewport_size:[pe.width,pe.height]};j.draw(w,E.TRIANGLES,Tt.disabled,Ht.disabled,p.colorModeForRenderPass(),Wt.disabled,ce,p.style.map.terrain&&p.style.map.terrain.getTerrainData(H.coord),s.id,se,$,l.SegmentVector.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,p.transform.zoom,null,null,null)}var pe;se.destroy(),$.destroy()}Wt.disabled=new Wt(!1,1029,2305),Wt.backCCW=new Wt(!0,1029,2305);const sp=l.identity(new Float32Array(16));function jc(p,t,s,c,d,f){const{horizontalAlign:x,verticalAlign:w}=l.getAnchorAlignment(p),E=-(x-.5)*t,T=-(w-.5)*s,k=l.evaluateVariableOffset(p,c);return new l.Point((E/d+k[0])*f,(T/d+k[1])*f)}function ka(p,t,s,c,d,f,x,w,E,T,k){const P=p.text.placedSymbolArray,B=p.text.dynamicLayoutVertexArray,j=p.icon.dynamicLayoutVertexArray,V={};B.clear();for(let Z=0;Z<P.length;Z++){const $=P.get(Z),se=$.hidden||!$.crossTileID||p.allowVerticalPlacement&&!$.placedOrientation?null:c[$.crossTileID];if(se){const pe=new l.Point($.anchorX,$.anchorY),H=lt(pe,s?x:f,k),ce=ur(d.cameraToCenterDistance,H.signedDistanceFromCamera);let me=l.evaluateSizeForFeature(p.textSizeData,E,$)*ce/l.ONE_EM;s&&(me*=p.tilePixelRatio/w);const{width:ye,height:_e,anchor:Se,textOffset:xe,textBoxScale:Re}=se,Ke=jc(Se,ye,_e,xe,Re,me),wt=s?lt(pe.add(Ke),f,k).point:H.point.add(t?Ke.rotate(-d.angle):Ke),Me=p.allowVerticalPlacement&&$.placedOrientation===l.WritingMode.vertical?Math.PI/2:0;for(let ot=0;ot<$.numGlyphs;ot++)l.addDynamicAttributes(B,wt,Me);T&&$.associatedIconIndex>=0&&(V[$.associatedIconIndex]={shiftedAnchor:wt,angle:Me})}else U($.numGlyphs,B)}if(T){j.clear();const Z=p.icon.placedSymbolArray;for(let $=0;$<Z.length;$++){const se=Z.get($);if(se.hidden)U(se.numGlyphs,j);else{const pe=V[$];if(pe)for(let H=0;H<se.numGlyphs;H++)l.addDynamicAttributes(j,pe.shiftedAnchor,pe.angle);else U(se.numGlyphs,j)}}p.icon.dynamicLayoutVertexBuffer.updateData(j)}p.text.dynamicLayoutVertexBuffer.updateData(B)}function Jl(p,t,s){return s.iconsInText&&t?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Ql(p,t,s,c,d,f,x,w,E,T,k,P){const B=p.context,j=B.gl,V=p.transform,Z=w==="map",$=E==="map",se=w!=="viewport"&&s.layout.get("symbol-placement")!=="point",pe=Z&&!$&&!se,H=!s.layout.get("symbol-sort-key").isConstant();let ce=!1;const me=p.depthModeForSublayer(0,Tt.ReadOnly),ye=s.layout.get("text-variable-anchor"),_e=[];for(const Se of c){const xe=t.getTile(Se),Re=xe.getBucket(s);if(!Re)continue;const Ke=d?Re.text:Re.icon;if(!Ke||!Ke.segments.get().length||!Ke.hasVisibleVertices)continue;const wt=Ke.programConfigurations.get(s.id),Me=d||Re.sdfIcons,ot=d?Re.textSizeData:Re.iconSizeData,je=$||V.pitch!==0,Mt=p.useProgram(Jl(Me,d,Re),wt),kt=l.evaluateSizeForZoom(ot,V.zoom),St=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Se);let ut,ti,Vi,fi,zi=[0,0],xn=null;if(d)ti=xe.glyphAtlasTexture,Vi=j.LINEAR,ut=xe.glyphAtlasTexture.size,Re.iconsInText&&(zi=xe.imageAtlasTexture.size,xn=xe.imageAtlasTexture,fi=je||p.options.rotating||p.options.zooming||ot.kind==="composite"||ot.kind==="camera"?j.LINEAR:j.NEAREST);else{const Ci=s.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;ti=xe.imageAtlasTexture,Vi=Me||p.options.rotating||p.options.zooming||Ci||je?j.LINEAR:j.NEAREST,ut=xe.imageAtlasTexture.size}const Xn=ne(xe,1,p.transform.zoom),Kn=qi(Se.posMatrix,$,Z,p.transform,Xn),Ji=Mr(Se.posMatrix,$,Z,p.transform,Xn),yr=ye&&Re.hasTextData(),$s=s.layout.get("icon-text-fit")!=="none"&&yr&&Re.hasIconData();if(se){const Ci=p.style.map.terrain?(Ka,Lr)=>p.style.map.terrain.getElevation(Se,Ka,Lr):null,wn=s.layout.get("text-rotation-alignment")==="map";Hr(Re,Se.posMatrix,p,d,Kn,Ji,$,T,wn,Ci)}const Zi=p.translatePosMatrix(Se.posMatrix,xe,f,x),Ai=se||d&&ye||$s?sp:Kn,Lt=p.translatePosMatrix(Ji,xe,f,x,!0),Ti=Me&&s.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Li;Li=Me?Re.iconsInText?_n(ot.kind,kt,pe,$,p,Zi,Ai,Lt,ut,zi):Is(ot.kind,kt,pe,$,p,Zi,Ai,Lt,d,ut,!0):No(ot.kind,kt,pe,$,p,Zi,Ai,Lt,d,ut);const Rt={program:Mt,buffers:Ke,uniformValues:Li,atlasTexture:ti,atlasTextureIcon:xn,atlasInterpolation:Vi,atlasInterpolationIcon:fi,isSDF:Me,hasHalo:Ti};if(H&&Re.canOverlap){ce=!0;const Ci=Ke.segments.get();for(const wn of Ci)_e.push({segments:new l.SegmentVector([wn]),sortKey:wn.sortKey,state:Rt,terrainData:St})}else _e.push({segments:Ke.segments,sortKey:0,state:Rt,terrainData:St})}ce&&_e.sort((Se,xe)=>Se.sortKey-xe.sortKey);for(const Se of _e){const xe=Se.state;if(B.activeTexture.set(j.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,j.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(B.activeTexture.set(j.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),xe.isSDF){const Re=xe.uniformValues;xe.hasHalo&&(Re.u_is_halo=1,eu(xe.buffers,Se.segments,s,p,xe.program,me,k,P,Re,Se.terrainData)),Re.u_is_halo=0}eu(xe.buffers,Se.segments,s,p,xe.program,me,k,P,xe.uniformValues,Se.terrainData)}}function eu(p,t,s,c,d,f,x,w,E,T){const k=c.context;d.draw(k,k.gl.TRIANGLES,f,x,w,Wt.disabled,E,T,s.id,p.layoutVertexBuffer,p.indexBuffer,t,s.paint,c.transform.zoom,p.programConfigurations.get(s.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer)}function Ms(p,t,s,c,d){if(!s||!c||!c.imageAtlas)return;const f=c.imageAtlas.patternPositions;let x=f[s.to.toString()],w=f[s.from.toString()];if(!x||!w){const E=d.getPaintProperty(t);x=f[E],w=f[E]}x&&w&&p.setConstantPatternPositions(x,w)}function Ia(p,t,s,c,d,f,x){const w=p.context.gl,E="fill-pattern",T=s.paint.get(E),k=T&&T.constantOr(1),P=s.getCrossfadeParameters();let B,j,V,Z,$;x?(j=k&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=w.LINES):(j=k?"fillPattern":"fill",B=w.TRIANGLES);const se=T.constantOr(null);for(const pe of c){const H=t.getTile(pe);if(k&&!H.patternsLoaded())continue;const ce=H.getBucket(s);if(!ce)continue;const me=ce.programConfigurations.get(s.id),ye=p.useProgram(j,me),_e=p.style.map.terrain&&p.style.map.terrain.getTerrainData(pe);k&&(p.context.activeTexture.set(w.TEXTURE0),H.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),me.updatePaintBuffers(P)),Ms(me,E,se,H,s);const Se=_e?pe:null,xe=p.translatePosMatrix(Se?Se.posMatrix:pe.posMatrix,H,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){Z=ce.indexBuffer2,$=ce.segments2;const Re=[w.drawingBufferWidth,w.drawingBufferHeight];V=j==="fillOutlinePattern"&&k?Xd(xe,p,P,H,Re):Ac(xe,Re)}else Z=ce.indexBuffer,$=ce.segments,V=k?zc(xe,p,P,H):Ol(xe);ye.draw(p.context,B,d,p.stencilModeForClipping(pe),f,Wt.disabled,V,_e,s.id,ce.layoutVertexBuffer,Z,$,s.paint,p.transform.zoom,me)}}function tu(p,t,s,c,d,f,x){const w=p.context,E=w.gl,T="fill-extrusion-pattern",k=s.paint.get(T),P=k.constantOr(1),B=s.getCrossfadeParameters(),j=s.paint.get("fill-extrusion-opacity"),V=k.constantOr(null);for(const Z of c){const $=t.getTile(Z),se=$.getBucket(s);if(!se)continue;const pe=p.style.map.terrain&&p.style.map.terrain.getTerrainData(Z),H=se.programConfigurations.get(s.id),ce=p.useProgram(P?"fillExtrusionPattern":"fillExtrusion",H);P&&(p.context.activeTexture.set(E.TEXTURE0),$.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),H.updatePaintBuffers(B)),Ms(H,T,V,$,s);const me=p.translatePosMatrix(Z.posMatrix,$,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ye=s.paint.get("fill-extrusion-vertical-gradient"),_e=P?Wd(me,p,ye,j,Z,B,$):pa(me,p,ye,j);ce.draw(w,w.gl.TRIANGLES,d,f,x,Wt.backCCW,_e,pe,s.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,s.paint,p.transform.zoom,H,p.style.map.terrain&&se.centroidVertexBuffer)}}function $c(p,t,s,c,d,f,x){const w=p.context,E=w.gl,T=s.fbo;if(!T)return;const k=p.useProgram("hillshade"),P=p.style.map.terrain&&p.style.map.terrain.getTerrainData(t);w.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,T.colorAttachment.get()),k.draw(w,E.TRIANGLES,d,f,x,Wt.disabled,((B,j,V,Z)=>{const $=V.paint.get("hillshade-shadow-color"),se=V.paint.get("hillshade-highlight-color"),pe=V.paint.get("hillshade-accent-color");let H=V.paint.get("hillshade-illumination-direction")*(Math.PI/180);V.paint.get("hillshade-illumination-anchor")==="viewport"&&(H-=B.transform.angle);const ce=!B.options.moving;return{u_matrix:Z?Z.posMatrix:B.transform.calculatePosMatrix(j.tileID.toUnwrapped(),ce),u_image:0,u_latrange:ho(0,j.tileID),u_light:[V.paint.get("hillshade-exaggeration"),H],u_shadow:$,u_highlight:se,u_accent:pe}})(p,s,c,P?t:null),P,c.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments)}function pi(p,t,s,c,d,f){const x=p.context,w=x.gl,E=t.dem;if(E&&E.data){const T=E.dim,k=E.stride,P=E.getPixels();if(x.activeTexture.set(w.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||p.getTileTexture(k),t.demTexture){const j=t.demTexture;j.update(P,{premultiply:!1}),j.bind(w.NEAREST,w.CLAMP_TO_EDGE)}else t.demTexture=new Je(x,P,w.RGBA,{premultiply:!1}),t.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);x.activeTexture.set(w.TEXTURE0);let B=t.fbo;if(!B){const j=new Je(x,{width:T,height:T,data:null},w.RGBA);j.bind(w.LINEAR,w.CLAMP_TO_EDGE),B=t.fbo=x.createFramebuffer(T,T,!0,!1),B.colorAttachment.set(j.texture)}x.bindFramebuffer.set(B.framebuffer),x.viewport.set([0,0,T,T]),p.useProgram("hillshadePrepare").draw(x,w.TRIANGLES,c,d,f,Wt.disabled,((j,V)=>{const Z=V.stride,$=l.create();return l.ortho($,0,l.EXTENT,-l.EXTENT,0,0,1),l.translate($,$,[0,-l.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[Z,Z],u_zoom:j.overscaledZ,u_unpack:V.getUnpackVector()}})(t.tileID,E),null,s.id,p.rasterBoundsBuffer,p.quadTriangleIndexBuffer,p.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function fo(p,t,s,c,d,f){const x=c.paint.get("raster-fade-duration");if(!f&&x>0){const w=l.browser.now(),E=(w-p.timeAdded)/x,T=t?(w-t.timeAdded)/x:-1,k=s.getSource(),P=d.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),B=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(p.tileID.overscaledZ-P),j=B&&p.refreshedUponExpiration?1:l.clamp(B?E:1-T,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),t?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const Fn=new l.Color(1,0,0,1),qc=new l.Color(0,1,0,1),iu=new l.Color(0,0,1,1),Zc=new l.Color(1,0,1,1),Ho=new l.Color(0,1,1,1);function zs(p,t,s,c){As(p,0,t+s/2,p.transform.width,s,c)}function Pa(p,t,s,c){As(p,t-s/2,0,s,p.transform.height,c)}function As(p,t,s,c,d,f){const x=p.context,w=x.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*p.pixelRatio,s*p.pixelRatio,c*p.pixelRatio,d*p.pixelRatio),x.clear({color:f}),w.disable(w.SCISSOR_TEST)}function Gc(p,t,s){const c=p.context,d=c.gl,f=s.posMatrix,x=p.useProgram("debug"),w=Tt.disabled,E=Ht.disabled,T=p.colorModeForRenderPass(),k="$debug",P=p.style.map.terrain&&p.style.map.terrain.getTerrainData(s);c.activeTexture.set(d.TEXTURE0);const B=t.getTileByID(s.key).latestRawTileData,j=Math.floor((B&&B.byteLength||0)/1024),V=t.getTile(s).tileSize,Z=512/Math.min(V,512)*(s.overscaledZ/p.transform.zoom)*.5;let $=s.canonical.toString();s.overscaledZ!==s.canonical.z&&($+=` => ${s.overscaledZ}`),function(se,pe){se.initDebugOverlayCanvas();const H=se.debugOverlayCanvas,ce=se.context.gl,me=se.debugOverlayCanvas.getContext("2d");me.clearRect(0,0,H.width,H.height),me.shadowColor="white",me.shadowBlur=2,me.lineWidth=1.5,me.strokeStyle="white",me.textBaseline="top",me.font="bold 36px Open Sans, sans-serif",me.fillText(pe,5,5),me.strokeText(pe,5,5),se.debugOverlayTexture.update(H),se.debugOverlayTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)}(p,`${$} ${j}kB`),x.draw(c,d.TRIANGLES,w,E,si.alphaBlended,Wt.disabled,Ul(f,l.Color.transparent,Z),null,k,p.debugBuffer,p.quadTriangleIndexBuffer,p.debugSegments),x.draw(c,d.LINE_STRIP,w,E,T,Wt.disabled,Ul(f,l.Color.red),P,k,p.debugBuffer,p.tileBorderIndexBuffer,p.debugSegments)}function nu(p,t,s){const c=p.context,d=c.gl,f=p.colorModeForRenderPass(),x=new Tt(d.LEQUAL,Tt.ReadWrite,p.depthRangeFor3D),w=p.useProgram("terrain"),E=t.getTerrainMesh();c.bindFramebuffer.set(null),c.viewport.set([0,0,p.width,p.height]);for(const T of s){const k=p.renderToTexture.getTexture(T),P=t.getTerrainData(T.tileID);c.activeTexture.set(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,k.texture);const B={u_matrix:p.transform.calculatePosMatrix(T.tileID.toUnwrapped()),u_texture:0,u_ele_delta:t.getMeshFrameDelta(p.transform.zoom)};w.draw(c,d.TRIANGLES,x,Ht.disabled,f,Wt.backCCW,B,P,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}}class Hc{constructor(t,s){this.context=new Yl(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.create(),renderTime:0},this.setup(),this.numSublayers=ri.maxUnderzooming+ri.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ei}resize(t,s,c){if(this.width=Math.floor(t*c),this.height=Math.floor(s*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style._order)this.style._layers[d].resize()}setup(){const t=this.context,s=new l.PosArray;s.emplaceBack(0,0),s.emplaceBack(l.EXTENT,0),s.emplaceBack(0,l.EXTENT),s.emplaceBack(l.EXTENT,l.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,da.members),this.tileExtentSegments=l.SegmentVector.simpleSegment(0,0,4,2);const c=new l.PosArray;c.emplaceBack(0,0),c.emplaceBack(l.EXTENT,0),c.emplaceBack(0,l.EXTENT),c.emplaceBack(l.EXTENT,l.EXTENT),this.debugBuffer=t.createVertexBuffer(c,da.members),this.debugSegments=l.SegmentVector.simpleSegment(0,0,4,5);const d=new l.RasterBoundsArray;d.emplaceBack(0,0,0,0),d.emplaceBack(l.EXTENT,0,l.EXTENT,0),d.emplaceBack(0,l.EXTENT,0,l.EXTENT),d.emplaceBack(l.EXTENT,l.EXTENT,l.EXTENT,l.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(d,Ln.members),this.rasterBoundsSegments=l.SegmentVector.simpleSegment(0,0,4,2);const f=new l.PosArray;f.emplaceBack(0,0),f.emplaceBack(1,0),f.emplaceBack(0,1),f.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(f,da.members),this.viewportSegments=l.SegmentVector.simpleSegment(0,0,4,2);const x=new l.LineStripIndexArray;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const w=new l.TriangleIndexArray;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(w);const E=this.context.gl;this.stencilClearMode=new Ht({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=l.create();l.ortho(c,0,this.width,this.height,0,0,1),l.scale(c,c,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,Tt.disabled,this.stencilClearMode,si.disabled,Wt.disabled,Vl(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const c=this.context,d=c.gl;this.nextStencilID+s.length>256&&this.clearStencil(),c.setColorMode(si.disabled),c.setDepthMode(Tt.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of s){const w=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,E=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x);f.draw(c,d.TRIANGLES,Tt.disabled,new Ht({func:d.ALWAYS,mask:0},w,255,d.KEEP,d.KEEP,d.REPLACE),si.disabled,Wt.disabled,Vl(x.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Ht({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Ht({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,c=t.sort((x,w)=>w.overscaledZ-x.overscaledZ),d=c[c.length-1].overscaledZ,f=c[0].overscaledZ-d+1;if(f>1){this.currentStencilSource=void 0,this.nextStencilID+f>256&&this.clearStencil();const x={};for(let w=0;w<f;w++)x[w+d]=new Ht({func:s.GEQUAL,mask:255},w+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=f,[x,c]}return[{[d]:Ht.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new si([t.CONSTANT_COLOR,t.ONE],new l.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?si.unblended:si.alphaBlended}depthModeForSublayer(t,s,c){if(!this.opaquePassEnabledForLayer())return Tt.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Tt(c||this.context.gl.LEQUAL,s,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(l.browser.now()),this.imageManager.beginFrame();const c=this.style._order,d=this.style.sourceCaches,f={},x={},w={};for(const E in d){const T=d[E];T.used&&T.prepare(this.context),f[E]=T.getVisibleCoordinates(),x[E]=f[E].slice().reverse(),w[E]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<c.length;E++)if(this.style._layers[c[E]].is3D()){this.opaquePassCutoff=E;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const E=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!l.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||E.length)&&(l.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(T,k){const P=T.context,B=P.gl,j=si.unblended,V=new Tt(B.LEQUAL,Tt.ReadWrite,[0,1]),Z=k.getTerrainMesh(),$=k.sourceCache.getRenderableTiles(),se=T.useProgram("terrainDepth");P.bindFramebuffer.set(k.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),P.clear({color:l.Color.transparent,depth:1});for(const pe of $){const H=k.getTerrainData(pe.tileID),ce={u_matrix:T.transform.calculatePosMatrix(pe.tileID.toUnwrapped()),u_ele_delta:k.getMeshFrameDelta(T.transform.zoom)};se.draw(P,B.TRIANGLES,V,Ht.disabled,j,Wt.backCCW,ce,H,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain),function(T,k){const P=T.context,B=P.gl,j=si.unblended,V=new Tt(B.LEQUAL,Tt.ReadWrite,[0,1]),Z=k.getTerrainMesh(),$=k.getCoordsTexture(),se=k.sourceCache.getRenderableTiles(),pe=T.useProgram("terrainCoords");P.bindFramebuffer.set(k.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,T.width/devicePixelRatio,T.height/devicePixelRatio]),P.clear({color:l.Color.transparent,depth:1}),k.coordsIndex=[];for(const H of se){const ce=k.getTerrainData(H.tileID);P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,$.texture);const me={u_matrix:T.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_terrain_coords_id:(255-k.coordsIndex.length)/255,u_texture:0,u_ele_delta:k.getMeshFrameDelta(T.transform.zoom)};pe.draw(P,B.TRIANGLES,V,Ht.disabled,j,Wt.backCCW,me,ce,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),k.coordsIndex.push(H.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,T.width,T.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const E of c){const T=this.style._layers[E];if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const k=x[T.source];(T.type==="custom"||k.length)&&this.renderLayer(this,d[T.source],T,k)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?l.Color.black:l.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[c[this.currentLayer]],T=d[E.source],k=f[E.source];this._renderTileClippingMasks(E,k),this.renderLayer(this,T,E,k)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const E=this.style._layers[c[this.currentLayer]],T=d[E.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(E))continue;const k=(E.type==="symbol"?w:x)[E.source];this._renderTileClippingMasks(E,f[E.source]),this.renderLayer(this,T,E,k)}if(this.options.showTileBoundaries){const E=function(T,k){let P=null;const B=Object.values(T._layers).flatMap($=>$.source&&!$.isHidden(k)?[T.sourceCaches[$.source]]:[]),j=B.filter($=>$.getSource().type==="vector"),V=B.filter($=>$.getSource().type!=="vector"),Z=$=>{(!P||P.getSource().maxzoom<$.getSource().maxzoom)&&(P=$)};return j.forEach($=>Z($)),P||V.forEach($=>Z($)),P}(this.style,this.transform.zoom);E&&function(T,k,P){for(let B=0;B<P.length;B++)Gc(T,k,P[B])}(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const T=E.transform.padding;zs(E,E.transform.height-(T.top||0),3,Fn),zs(E,T.bottom||0,3,qc),Pa(E,T.left||0,3,iu),Pa(E,E.transform.width-(T.right||0),3,Zc);const k=E.transform.centerPoint;(function(P,B,j,V){As(P,B-1,j-10,2,20,V),As(P,B-10,j-1,20,2,V)})(E,k.x,E.transform.height-k.y,Ho)}(this),this.context.setDefault()}renderLayer(t,s,c,d){if(!c.isHidden(this.transform.zoom)&&(c.type==="background"||c.type==="custom"||(d||[]).length))switch(this.id=c.id,c.type){case"symbol":(function(f,x,w,E,T){if(f.renderPass!=="translucent")return;const k=Ht.disabled,P=f.colorModeForRenderPass();w.layout.get("text-variable-anchor")&&function(B,j,V,Z,$,se,pe){const H=j.transform,ce=$==="map",me=se==="map";for(const ye of B){const _e=Z.getTile(ye),Se=_e.getBucket(V);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const xe=l.evaluateSizeForZoom(Se.textSizeData,H.zoom),Re=ne(_e,1,j.transform.zoom),Ke=qi(ye.posMatrix,me,ce,j.transform,Re),wt=V.layout.get("icon-text-fit")!=="none"&&Se.hasIconData();if(xe){const Me=Math.pow(2,H.zoom-_e.tileID.overscaledZ);ka(Se,ce,me,pe,H,Ke,ye.posMatrix,Me,xe,wt,j.style.map.terrain?(ot,je)=>j.style.map.terrain.getElevation(ye,ot,je):null)}}}(E,f,w,x,w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),T),w.paint.get("icon-opacity").constantOr(1)!==0&&Ql(f,x,w,E,!1,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),w.layout.get("icon-rotation-alignment"),w.layout.get("icon-pitch-alignment"),w.layout.get("icon-keep-upright"),k,P),w.paint.get("text-opacity").constantOr(1)!==0&&Ql(f,x,w,E,!0,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),w.layout.get("text-rotation-alignment"),w.layout.get("text-pitch-alignment"),w.layout.get("text-keep-upright"),k,P),x.map.showCollisionBoxes&&(Ca(f,x,w,E,w.paint.get("text-translate"),w.paint.get("text-translate-anchor"),!0),Ca(f,x,w,E,w.paint.get("icon-translate"),w.paint.get("icon-translate-anchor"),!1))})(t,s,c,d,this.style.placement.variableOffsets);break;case"circle":(function(f,x,w,E){if(f.renderPass!=="translucent")return;const T=w.paint.get("circle-opacity"),k=w.paint.get("circle-stroke-width"),P=w.paint.get("circle-stroke-opacity"),B=!w.layout.get("circle-sort-key").isConstant();if(T.constantOr(1)===0&&(k.constantOr(1)===0||P.constantOr(1)===0))return;const j=f.context,V=j.gl,Z=f.depthModeForSublayer(0,Tt.ReadOnly),$=Ht.disabled,se=f.colorModeForRenderPass(),pe=[];for(let H=0;H<E.length;H++){const ce=E[H],me=x.getTile(ce),ye=me.getBucket(w);if(!ye)continue;const _e=ye.programConfigurations.get(w.id),Se=f.useProgram("circle",_e),xe=ye.layoutVertexBuffer,Re=ye.indexBuffer,Ke=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ce),wt={programConfiguration:_e,program:Se,layoutVertexBuffer:xe,indexBuffer:Re,uniformValues:Nl(f,ce,me,w),terrainData:Ke};if(B){const Me=ye.segments.get();for(const ot of Me)pe.push({segments:new l.SegmentVector([ot]),sortKey:ot.sortKey,state:wt})}else pe.push({segments:ye.segments,sortKey:0,state:wt})}B&&pe.sort((H,ce)=>H.sortKey-ce.sortKey);for(const H of pe){const{programConfiguration:ce,program:me,layoutVertexBuffer:ye,indexBuffer:_e,uniformValues:Se,terrainData:xe}=H.state;me.draw(j,V.TRIANGLES,Z,$,se,Wt.disabled,Se,xe,w.id,ye,_e,H.segments,w.paint,f.transform.zoom,ce)}})(t,s,c,d);break;case"heatmap":(function(f,x,w,E){if(w.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const T=f.context,k=T.gl,P=Ht.disabled,B=new si([k.ONE,k.ONE],l.Color.transparent,[!0,!0,!0,!0]);(function(j,V,Z){const $=j.gl;j.activeTexture.set($.TEXTURE1),j.viewport.set([0,0,V.width/4,V.height/4]);let se=Z.heatmapFbo;if(se)$.bindTexture($.TEXTURE_2D,se.colorAttachment.get()),j.bindFramebuffer.set(se.framebuffer);else{const pe=$.createTexture();$.bindTexture($.TEXTURE_2D,pe),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),se=Z.heatmapFbo=j.createFramebuffer(V.width/4,V.height/4,!1,!1),function(H,ce,me,ye){var _e,Se;const xe=H.gl,Re=(_e=H.HALF_FLOAT)!==null&&_e!==void 0?_e:xe.UNSIGNED_BYTE,Ke=(Se=H.RGBA16F)!==null&&Se!==void 0?Se:xe.RGBA;xe.texImage2D(xe.TEXTURE_2D,0,Ke,ce.width/4,ce.height/4,0,xe.RGBA,Re,null),ye.colorAttachment.set(me)}(j,V,pe,se)}})(T,f,w),T.clear({color:l.Color.transparent});for(let j=0;j<E.length;j++){const V=E[j];if(x.hasRenderableParent(V))continue;const Z=x.getTile(V),$=Z.getBucket(w);if(!$)continue;const se=$.programConfigurations.get(w.id),pe=f.useProgram("heatmap",se),{zoom:H}=f.transform;pe.draw(T,k.TRIANGLES,Tt.disabled,P,B,Wt.disabled,Dc(V.posMatrix,Z,H,w.paint.get("heatmap-intensity")),null,w.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,w.paint,f.transform.zoom,se)}T.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(T,k){const P=T.context,B=P.gl,j=k.heatmapFbo;if(!j)return;P.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,j.colorAttachment.get()),P.activeTexture.set(B.TEXTURE1);let V=k.colorRampTexture;V||(V=k.colorRampTexture=new Je(P,k.colorRamp,B.RGBA)),V.bind(B.LINEAR,B.CLAMP_TO_EDGE),T.useProgram("heatmapTexture").draw(P,B.TRIANGLES,Tt.disabled,Ht.disabled,T.colorModeForRenderPass(),Wt.disabled,((Z,$,se,pe)=>{const H=l.create();l.ortho(H,0,Z.width,Z.height,0,0,1);const ce=Z.context.gl;return{u_matrix:H,u_world:[ce.drawingBufferWidth,ce.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:$.paint.get("heatmap-opacity")}})(T,k),null,k.id,T.viewportBuffer,T.quadTriangleIndexBuffer,T.viewportSegments,k.paint,T.transform.zoom)}(f,w))})(t,s,c,d);break;case"line":(function(f,x,w,E){if(f.renderPass!=="translucent")return;const T=w.paint.get("line-opacity"),k=w.paint.get("line-width");if(T.constantOr(1)===0||k.constantOr(1)===0)return;const P=f.depthModeForSublayer(0,Tt.ReadOnly),B=f.colorModeForRenderPass(),j=w.paint.get("line-dasharray"),V=w.paint.get("line-pattern"),Z=V.constantOr(1),$=w.paint.get("line-gradient"),se=w.getCrossfadeParameters(),pe=Z?"linePattern":j?"lineSDF":$?"lineGradient":"line",H=f.context,ce=H.gl;let me=!0;for(const ye of E){const _e=x.getTile(ye);if(Z&&!_e.patternsLoaded())continue;const Se=_e.getBucket(w);if(!Se)continue;const xe=Se.programConfigurations.get(w.id),Re=f.context.program.get(),Ke=f.useProgram(pe,xe),wt=me||Ke.program!==Re,Me=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ye),ot=V.constantOr(null);if(ot&&_e.imageAtlas){const kt=_e.imageAtlas,St=kt.patternPositions[ot.to.toString()],ut=kt.patternPositions[ot.from.toString()];St&&ut&&xe.setConstantPatternPositions(St,ut)}const je=Me?ye:null,Mt=Z?fa(f,_e,w,se,je):j?ma(f,_e,w,j,se,je):$?Bn(f,_e,w,Se.lineClipsArray.length,je):Fo(f,_e,w,je);if(Z)H.activeTexture.set(ce.TEXTURE0),_e.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),xe.updatePaintBuffers(se);else if(j&&(wt||f.lineAtlas.dirty))H.activeTexture.set(ce.TEXTURE0),f.lineAtlas.bind(H);else if($){const kt=Se.gradients[w.id];let St=kt.texture;if(w.gradientVersion!==kt.version){let ut=256;if(w.stepInterpolant){const ti=x.getSource().maxzoom,Vi=ye.canonical.z===ti?Math.ceil(1<<f.transform.maxZoom-ye.canonical.z):1;ut=l.clamp(l.nextPowerOfTwo(Se.maxLineLength/l.EXTENT*1024*Vi),256,H.maxTextureSize)}kt.gradient=l.renderColorRamp({expression:w.gradientExpression(),evaluationKey:"lineProgress",resolution:ut,image:kt.gradient||void 0,clips:Se.lineClipsArray}),kt.texture?kt.texture.update(kt.gradient):kt.texture=new Je(H,kt.gradient,ce.RGBA),kt.version=w.gradientVersion,St=kt.texture}H.activeTexture.set(ce.TEXTURE0),St.bind(w.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}Ke.draw(H,ce.TRIANGLES,P,f.stencilModeForClipping(ye),B,Wt.disabled,Mt,Me,w.id,Se.layoutVertexBuffer,Se.indexBuffer,Se.segments,w.paint,f.transform.zoom,xe,Se.layoutVertexBuffer2),me=!1}})(t,s,c,d);break;case"fill":(function(f,x,w,E){const T=w.paint.get("fill-color"),k=w.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const P=f.colorModeForRenderPass(),B=w.paint.get("fill-pattern"),j=f.opaquePassEnabledForLayer()&&!B.constantOr(1)&&T.constantOr(l.Color.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===j){const V=f.depthModeForSublayer(1,f.renderPass==="opaque"?Tt.ReadWrite:Tt.ReadOnly);Ia(f,x,w,E,V,P,!1)}if(f.renderPass==="translucent"&&w.paint.get("fill-antialias")){const V=f.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);Ia(f,x,w,E,V,P,!0)}})(t,s,c,d);break;case"fill-extrusion":(function(f,x,w,E){const T=w.paint.get("fill-extrusion-opacity");if(T!==0&&f.renderPass==="translucent"){const k=new Tt(f.context.gl.LEQUAL,Tt.ReadWrite,f.depthRangeFor3D);if(T!==1||w.paint.get("fill-extrusion-pattern").constantOr(1))tu(f,x,w,E,k,Ht.disabled,si.disabled),tu(f,x,w,E,k,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const P=f.colorModeForRenderPass();tu(f,x,w,E,k,Ht.disabled,P)}}})(t,s,c,d);break;case"hillshade":(function(f,x,w,E){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const T=f.context,k=f.depthModeForSublayer(0,Tt.ReadOnly),P=f.colorModeForRenderPass(),[B,j]=f.renderPass==="translucent"?f.stencilConfigForOverlap(E):[{},E];for(const V of j){const Z=x.getTile(V);Z.needsHillshadePrepare!==void 0&&Z.needsHillshadePrepare&&f.renderPass==="offscreen"?pi(f,Z,w,k,Ht.disabled,P):f.renderPass==="translucent"&&$c(f,V,Z,w,k,B[V.overscaledZ],P)}T.viewport.set([0,0,f.width,f.height])})(t,s,c,d);break;case"raster":(function(f,x,w,E){if(f.renderPass!=="translucent"||w.paint.get("raster-opacity")===0||!E.length)return;const T=f.context,k=T.gl,P=x.getSource(),B=f.useProgram("raster"),j=f.colorModeForRenderPass(),[V,Z]=P instanceof lr?[{},E]:f.stencilConfigForOverlap(E),$=Z[Z.length-1].overscaledZ,se=!f.options.moving;for(const pe of Z){const H=f.depthModeForSublayer(pe.overscaledZ-$,w.paint.get("raster-opacity")===1?Tt.ReadWrite:Tt.ReadOnly,k.LESS),ce=x.getTile(pe);ce.registerFadeDuration(w.paint.get("raster-fade-duration"));const me=x.findLoadedParent(pe,0),ye=fo(ce,me,x,w,f.transform,f.style.map.terrain);let _e,Se;const xe=w.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;T.activeTexture.set(k.TEXTURE0),ce.texture.bind(xe,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),T.activeTexture.set(k.TEXTURE1),me?(me.texture.bind(xe,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),_e=Math.pow(2,me.tileID.overscaledZ-ce.tileID.overscaledZ),Se=[ce.tileID.canonical.x*_e%1,ce.tileID.canonical.y*_e%1]):ce.texture.bind(xe,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const Re=f.style.map.terrain&&f.style.map.terrain.getTerrainData(pe),Ke=Re?pe:null,wt=Ke?Ke.posMatrix:f.transform.calculatePosMatrix(pe.toUnwrapped(),se),Me=ga(wt,Se||[0,0],_e||1,ye,w);P instanceof lr?B.draw(T,k.TRIANGLES,H,Ht.disabled,j,Wt.disabled,Me,Re,w.id,P.boundsBuffer,f.quadTriangleIndexBuffer,P.boundsSegments):B.draw(T,k.TRIANGLES,H,V[pe.overscaledZ],j,Wt.disabled,Me,Re,w.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}})(t,s,c,d);break;case"background":(function(f,x,w,E){const T=w.paint.get("background-color"),k=w.paint.get("background-opacity");if(k===0)return;const P=f.context,B=P.gl,j=f.transform,V=j.tileSize,Z=w.paint.get("background-pattern");if(f.isPatternMissing(Z))return;const $=!Z&&T.a===1&&k===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==$)return;const se=Ht.disabled,pe=f.depthModeForSublayer(0,$==="opaque"?Tt.ReadWrite:Tt.ReadOnly),H=f.colorModeForRenderPass(),ce=f.useProgram(Z?"backgroundPattern":"background"),me=E||j.coveringTiles({tileSize:V,terrain:f.style.map.terrain});Z&&(P.activeTexture.set(B.TEXTURE0),f.imageManager.bind(f.context));const ye=w.getCrossfadeParameters();for(const _e of me){const Se=E?_e.posMatrix:f.transform.calculatePosMatrix(_e.toUnwrapped()),xe=Z?jl(Se,k,f,Z,{tileID:_e,tileSize:V},ye):vn(Se,k,T),Re=f.style.map.terrain&&f.style.map.terrain.getTerrainData(_e);ce.draw(P,B.TRIANGLES,pe,se,H,Wt.disabled,xe,Re,w.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}})(t,0,c,d);break;case"custom":(function(f,x,w){const E=f.context,T=w.implementation;if(f.renderPass==="offscreen"){const k=T.prerender;k&&(f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),k.call(T,E.gl,f.transform.customLayerMatrix()),E.setDirty(),f.setBaseState())}else if(f.renderPass==="translucent"){f.setCustomLayerDefaults(),E.setColorMode(f.colorModeForRenderPass()),E.setStencilMode(Ht.disabled);const k=T.renderingMode==="3d"?new Tt(f.context.gl.LEQUAL,Tt.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Tt.ReadOnly);E.setDepthMode(k),T.render(E.gl,f.transform.customLayerMatrix()),E.setDirty(),f.setBaseState(),E.bindFramebuffer.set(null)}})(t,0,c)}}translatePosMatrix(t,s,c,d,f){if(!c[0]&&!c[1])return t;const x=f?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(x){const T=Math.sin(x),k=Math.cos(x);c=[c[0]*k-c[1]*T,c[0]*T+c[1]*k]}const w=[f?c[0]:ne(s,c[0],this.transform.zoom),f?c[1]:ne(s,c[1],this.transform.zoom),0],E=new Float32Array(16);return l.translate(E,t,w),E}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!s||!c}useProgram(t,s){this.cache=this.cache||{};const c=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new Hd(this.context,t,Yr[t],s,ya[t],this._showOverdrawInspector,this.style.map.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Je(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:s}=this.context.gl;return this.width!==t||this.height!==s}}class Ma{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c){const d=Math.pow(2,c),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=1/(w=l.transformMat4([],w,t))[3]/s*d;return l.mul$1(w,w,[E,E,1/w[3],E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=function(B,j){var V=j[0],Z=j[1],$=j[2],se=V*V+Z*Z+$*$;return se>0&&(se=1/Math.sqrt(se)),B[0]=j[0]*se,B[1]=j[1]*se,B[2]=j[2]*se,B}([],function(B,j,V){var Z=j[0],$=j[1],se=j[2],pe=V[0],H=V[1],ce=V[2];return B[0]=$*ce-se*H,B[1]=se*pe-Z*ce,B[2]=Z*H-$*pe,B}([],Ue([],f[w[0]],f[w[1]]),Ue([],f[w[2]],f[w[1]]))),T=-((k=E)[0]*(P=f[w[1]])[0]+k[1]*P[1]+k[2]*P[2]);var k,P;return E.concat(T)});return new Ma(f,x)}}class hr{constructor(t,s){this.min=t,this.max=s,this.center=function(c,d,f){return c[0]=.5*d[0],c[1]=.5*d[1],c[2]=.5*d[2],c}([],function(c,d,f){return c[0]=d[0]+f[0],c[1]=d[1]+f[1],c[2]=d[2]+f[2],c}([],this.min,this.max))}quadrant(t){const s=[t%2==0,t<2],c=ve(this.min),d=ve(this.max);for(let f=0;f<s.length;f++)c[f]=s[f]?this.min[f]:this.center[f],d[f]=s[f]?this.center[f]:this.max[f];return d[2]=this.max[2],new hr(c,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let d=0;d<t.planes.length;d++){const f=t.planes[d];let x=0;for(let w=0;w<s.length;w++)l.dot(f,s[w])>=0&&x++;if(x===0)return 0;x!==s.length&&(c=!1)}if(c)return 2;for(let d=0;d<3;d++){let f=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let w=0;w<t.points.length;w++){const E=t.points[w][d]-this.min[d];f=Math.min(f,E),x=Math.max(x,E)}if(x<0||f>this.max[d]-this.min[d])return 0}return 1}}class za{constructor(t=0,s=0,c=0,d=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=c,this.right=d}interpolate(t,s,c){return s.top!=null&&t.top!=null&&(this.top=l.interpolate.number(t.top,s.top,c)),s.bottom!=null&&t.bottom!=null&&(this.bottom=l.interpolate.number(t.bottom,s.bottom,c)),s.left!=null&&t.left!=null&&(this.left=l.interpolate.number(t.left,s.left,c)),s.right!=null&&t.right!=null&&(this.right=l.interpolate.number(t.right,s.right,c)),this}getCenter(t,s){const c=l.clamp((this.left+t-this.right)/2,0,t),d=l.clamp((this.top+s-this.bottom)/2,0,s);return new l.Point(c,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new za(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Aa{constructor(t,s,c,d,f){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=f===void 0||!!f,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=d??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new za,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Aa(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}apply(t){this.tileSize=t.tileSize,this.latRange=t.latRange,this.width=t.width,this.height=t.height,this._center=t._center,this._elevation=t._elevation,this.zoom=t.zoom,this.angle=t.angle,this._fov=t._fov,this._pitch=t._pitch,this._unmodified=t._unmodified,this._edgeInsets=t._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-l.wrap(t,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var c=new l.ARRAY_TYPE(4);return l.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c}(),function(c,d,f){var x=d[0],w=d[1],E=d[2],T=d[3],k=Math.sin(f),P=Math.cos(f);c[0]=x*P+E*k,c[1]=w*P+T*k,c[2]=x*-k+E*P,c[3]=w*-k+T*P}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=l.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,c){this._unmodified=!1,this._edgeInsets.interpolate(t,s,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new l.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new l.Point(0,0)),d=this.pointCoordinate(new l.Point(this.width,0)),f=this.pointCoordinate(new l.Point(this.width,this.height)),x=this.pointCoordinate(new l.Point(0,this.height)),w=Math.floor(Math.min(c.x,d.x,f.x,x.x)),E=Math.floor(Math.max(c.x,d.x,f.x,x.x)),T=1;for(let k=w-T;k<=E+T;k++)k!==0&&s.push(new l.UnwrappedTileID(k,t))}return s}coveringTiles(t){var s,c;let d=this.coveringZoomLevel(t);const f=d;if(t.minzoom!==void 0&&d<t.minzoom)return[];t.maxzoom!==void 0&&d>t.maxzoom&&(d=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),w=l.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,d),T=[E*x.x,E*x.y,0],k=[E*w.x,E*w.y,0],P=Ma.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d);let B=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=d);const j=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,V=H=>({aabb:new hr([H*E,0,0],[(H+1)*E,E,0]),zoom:0,x:0,y:0,wrap:H,fullyVisible:!1}),Z=[],$=[],se=d,pe=t.reparseOverscaled?f:d;if(this._renderWorldCopies)for(let H=1;H<=3;H++)Z.push(V(-H)),Z.push(V(H));for(Z.push(V(0));Z.length>0;){const H=Z.pop(),ce=H.x,me=H.y;let ye=H.fullyVisible;if(!ye){const Ke=H.aabb.intersects(P);if(Ke===0)continue;ye=Ke===2}const _e=t.terrain?T:k,Se=H.aabb.distanceX(_e),xe=H.aabb.distanceY(_e),Re=Math.max(Math.abs(Se),Math.abs(xe));if(H.zoom===se||Re>j+(1<<se-H.zoom)-2&&H.zoom>=B){const Ke=se-H.zoom,wt=T[0]-.5-(ce<<Ke),Me=T[1]-.5-(me<<Ke);$.push({tileID:new l.OverscaledTileID(H.zoom===se?pe:H.zoom,H.wrap,H.zoom,ce,me),distanceSq:Ge([k[0]-.5-ce,k[1]-.5-me]),tileDistanceToCamera:Math.sqrt(wt*wt+Me*Me)})}else for(let Ke=0;Ke<4;Ke++){const wt=(ce<<1)+Ke%2,Me=(me<<1)+(Ke>>1),ot=H.zoom+1;let je=H.aabb.quadrant(Ke);if(t.terrain){const Mt=new l.OverscaledTileID(ot,H.wrap,ot,wt,Me),kt=t.terrain.getMinMaxElevation(Mt),St=(s=kt.minElevation)!==null&&s!==void 0?s:this.elevation,ut=(c=kt.maxElevation)!==null&&c!==void 0?c:this.elevation;je=new hr([je.min[0],je.min[1],St],[je.max[0],je.max[1],ut])}Z.push({aabb:je,zoom:ot,x:wt,y:Me,wrap:H.wrap,fullyVisible:ye})}}return $.sort((H,ce)=>H.distanceSq-ce.distanceSq).map(H=>H.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=l.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new l.Point(l.mercatorXfromLng(t.lng)*this.worldSize,l.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new l.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const c=l.MercatorCoordinate.fromLngLat(t.wrap()),d=(1<<this.tileZoom)*l.EXTENT,f=c.x*d,x=c.y*d,w=Math.floor(f/l.EXTENT),E=Math.floor(x/l.EXTENT),T=new l.OverscaledTileID(this.tileZoom,0,this.tileZoom,w,E);return s.getElevation(T,f%l.EXTENT,x%l.EXTENT,l.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),c=this.getElevation(s,t);if(!(this.elevation-c))return;const d=this.getCameraPosition(),f=l.MercatorCoordinate.fromLngLat(d.lngLat,d.altitude),x=l.MercatorCoordinate.fromLngLat(s,c),w=f.x-x.x,E=f.y-x.y,T=f.z-x.z,k=Math.sqrt(w*w+E*E+T*T),P=this.scaleZoom(this.cameraToCenterDistance/k/this.tileSize);this._elevation=c,this._center=s,this.zoom=P}setLocationAtPoint(t,s){const c=this.pointCoordinate(s),d=this.pointCoordinate(this.centerPoint),f=this.locationCoordinate(t),x=new l.MercatorCoordinate(f.x-(c.x-d.x),f.y-(c.y-d.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return l.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const B=s.pointCoordinate(t);if(B!=null)return B}const c=[t.x,t.y,0,1],d=[t.x,t.y,1,1];l.transformMat4(c,c,this.pixelMatrixInverse),l.transformMat4(d,d,this.pixelMatrixInverse);const f=c[3],x=d[3],w=c[1]/f,E=d[1]/x,T=c[2]/f,k=d[2]/x,P=T===k?0:(0-T)/(k-T);return new l.MercatorCoordinate(l.interpolate.number(c[0]/f,d[0]/x,P)/this.worldSize,l.interpolate.number(w,E,P)/this.worldSize)}coordinatePoint(t,s=0,c=this.pixelMatrix){const d=[t.x*this.worldSize,t.y*this.worldSize,s,1];return l.transformMat4(d,d,c),new l.Point(d[0]/d[3],d[1]/d[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new Bt().extend(this.pointLocation(new l.Point(0,t))).extend(this.pointLocation(new l.Point(this.width,t))).extend(this.pointLocation(new l.Point(this.width,this.height))).extend(this.pointLocation(new l.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Bt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const c=t.key,d=s?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];const f=t.canonical,x=this.worldSize/this.zoomScale(f.z),w=f.x+Math.pow(2,f.z)*t.wrap,E=l.identity(new Float64Array(16));return l.translate(E,E,[w*x,f.y*x,0]),l.scale(E,E,[x/l.EXTENT,x/l.EXTENT,1]),l.multiply(E,s?this.alignedProjMatrix:this.projMatrix,E),d[c]=new Float32Array(E),d[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,c,d,f=-90,x=90,w=-180,E=180;const T=this.size,k=this._unmodified;if(this.latRange){const j=this.latRange;f=l.mercatorYfromLat(j[1])*this.worldSize,x=l.mercatorYfromLat(j[0])*this.worldSize,t=x-f<T.y?T.y/(x-f):0}if(this.lngRange){const j=this.lngRange;w=l.wrap(l.mercatorXfromLng(j[0])*this.worldSize,0,this.worldSize),E=l.wrap(l.mercatorXfromLng(j[1])*this.worldSize,0,this.worldSize),E<w&&(E+=this.worldSize),s=E-w<T.x?T.x/(E-w):0}const P=this.point,B=Math.max(s||0,t||0);if(B)return this.center=this.unproject(new l.Point(s?(E+w)/2:P.x,t?(x+f)/2:P.y)),this.zoom+=this.scaleZoom(B),this._unmodified=k,void(this._constraining=!1);if(this.latRange){const j=P.y,V=T.y/2;j-V<f&&(d=f+V),j+V>x&&(d=x-V)}if(this.lngRange){const j=(w+E)/2,V=l.wrap(P.x,j-this.worldSize/2,j+this.worldSize/2),Z=T.x/2;V-Z<w&&(c=w+Z),V+Z>E&&(c=E-Z)}c===void 0&&d===void 0||(this.center=this.unproject(new l.Point(c!==void 0?c:P.x,d!==void 0?d:P.y)).wrap()),this._unmodified=k,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let d=l.identity(new Float64Array(16));l.scale(d,d,[this.width/2,-this.height/2,1]),l.translate(d,d,[1,-1,0]),this.labelPlaneMatrix=d,d=l.identity(new Float64Array(16)),l.scale(d,d,[1,-1,1]),l.translate(d,d,[-1,-1,0]),l.scale(d,d,[2/this.width,2/this.height,1]),this.glCoordMatrix=d,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const f=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,x=Math.PI/2+this._pitch,w=this._fov*(.5+t.y/this.height),E=Math.sin(w)*f/Math.sin(l.clamp(Math.PI-x-w,.01,Math.PI-.01)),T=this.getHorizon(),k=2*Math.atan(T/this.cameraToCenterDistance)*(.5+t.y/(2*T)),P=Math.sin(k)*f/Math.sin(l.clamp(Math.PI-x-k,.01,Math.PI-.01)),B=Math.min(E,P),j=1.01*(Math.cos(Math.PI/2-this._pitch)*B+f),V=this.height/50;d=new Float64Array(16),l.perspective(d,this._fov,this.width/this.height,V,j),d[8]=2*-t.x/this.width,d[9]=2*t.y/this.height,l.scale(d,d,[1,-1,1]),l.translate(d,d,[0,0,-this.cameraToCenterDistance]),l.rotateX(d,d,this._pitch),l.rotateZ(d,d,this.angle),l.translate(d,d,[-s,-c,0]),this.mercatorMatrix=l.scale([],d,[this.worldSize,this.worldSize,this.worldSize]),l.scale(d,d,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.multiply(new Float64Array(16),this.labelPlaneMatrix,d),l.translate(d,d,[0,0,-this.elevation]),this.projMatrix=d,this.invProjMatrix=l.invert([],d),this.pixelMatrix3D=l.multiply(new Float64Array(16),this.labelPlaneMatrix,d);const Z=this.width%2/2,$=this.height%2/2,se=Math.cos(this.angle),pe=Math.sin(this.angle),H=s-Math.round(s)+se*Z+pe*$,ce=c-Math.round(c)+se*$+pe*Z,me=new Float64Array(d);if(l.translate(me,me,[H>.5?H-1:H,ce>.5?ce-1:ce,0]),this.alignedProjMatrix=me,d=l.invert(new Float64Array(16),this.pixelMatrix),!d)throw new Error("failed to invert matrix");this.pixelMatrixInverse=d,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new l.Point(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return l.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.Point(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let c=s.x,d=s.y,f=s.x,x=s.y;for(const w of t)c=Math.min(c,w.x),d=Math.min(d,w.y),f=Math.max(f,w.x),x=Math.max(x,w.y);return[new l.Point(c,d),new l.Point(f,d),new l.Point(f,x),new l.Point(c,x),new l.Point(c,d)]}}}class Wc{constructor(t){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(c=d)}),(c&&c[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:c,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,s)}catch{}},this._updateHash=function(s,c){let d=!1,f=null;const x=()=>{f=null,d&&(s(),f=setTimeout(x,300),d=!1)};return()=>(d=!0,f||x(),f)}(this._updateHashUnthrottled),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),f=Math.pow(10,d),x=Math.round(s.lng*f)/f,w=Math.round(s.lat*f)/f,E=this._map.getBearing(),T=this._map.getPitch();let k="";if(k+=t?`/${x}/${w}/${c}`:`${c}/${w}/${x}`,(E||T)&&(k+="/"+Math.round(10*E)/10),T&&(k+=`/${Math.round(T)}`),this._hashName){const P=this._hashName;let B=!1;const j=window.location.hash.slice(1).split("&").map(V=>{const Z=V.split("=")[0];return Z===P?(B=!0,`${Z}=${k}`):V}).filter(V=>V);return B||j.push(`${P}=${k}`),`#${j.join("&")}`}return`#${k}`}}const Ls={linearity:.3,easing:l.bezier(0,0,.3,1)},Xc=l.extend({deceleration:2500,maxSpeed:1400},Ls),Kc=l.extend({deceleration:20,maxSpeed:1400},Ls),Ds=l.extend({deceleration:1e3,maxSpeed:360},Ls),Yc=l.extend({deceleration:1e3,maxSpeed:90},Ls);class dr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:l.browser.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=l.browser.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new l.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:f}of this._inertiaBuffer)s.zoom+=f.zoomDelta||0,s.bearing+=f.bearingDelta||0,s.pitch+=f.pitchDelta||0,f.panDelta&&s.pan._add(f.panDelta),f.around&&(s.around=f.around),f.pinchAround&&(s.pinchAround=f.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(s.pan.mag()){const f=Rs(s.pan.mag(),c,l.extend({},Xc,t||{}));d.offset=s.pan.mult(f.amount/s.pan.mag()),d.center=this._map.transform.center,On(d,f)}if(s.zoom){const f=Rs(s.zoom,c,Kc);d.zoom=this._map.transform.zoom+f.amount,On(d,f)}if(s.bearing){const f=Rs(s.bearing,c,Ds);d.bearing=this._map.transform.bearing+l.clamp(f.amount,-179,179),On(d,f)}if(s.pitch){const f=Rs(s.pitch,c,Yc);d.pitch=this._map.transform.pitch+f.amount,On(d,f)}if(d.zoom||d.bearing){const f=s.pinchAround===void 0?s.around:s.pinchAround;d.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),l.extend(d,{noMoveStart:!0})}}function On(p,t){(!p.duration||p.duration<t.duration)&&(p.duration=t.duration,p.easing=t.easing)}function Rs(p,t,s){const{maxSpeed:c,linearity:d,deceleration:f}=s,x=l.clamp(p*d/(t/1e3),-c,c),w=Math.abs(x)/(f*d);return{easing:s.easing,duration:1e3*w,amount:x*(w/2)}}class xi extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c,d={}){const f=D.mousePos(s.getCanvasContainer(),c),x=s.unproject(f);super(t,l.extend({point:f,lngLat:x,originalEvent:c},d)),this._defaultPrevented=!1,this.target=s}}class Jr extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c){const d=t==="touchend"?c.changedTouches:c.touches,f=D.touchPos(s.getCanvasContainer(),d),x=f.map(E=>s.unproject(E)),w=f.reduce((E,T,k,P)=>E.add(T.div(P.length)),new l.Point(0,0));super(t,{points:f,point:w,lngLats:x,lngLat:s.unproject(w),originalEvent:c}),this._defaultPrevented=!1}}class ap extends l.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class lp{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new ap(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new xi(t.type,this._map,t))}mouseup(t){this._map.fire(new xi(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new xi(t.type,this._map,t))}dblclick(t){return this._firePreventable(new xi(t.type,this._map,t))}mouseover(t){this._map.fire(new xi(t.type,this._map,t))}mouseout(t){this._map.fire(new xi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Jr(t.type,this._map,t))}touchmove(t){this._map.fire(new Jr(t.type,this._map,t))}touchend(t){this._map.fire(new Jr(t.type,this._map,t))}touchcancel(t){this._map.fire(new Jr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class up{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new xi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new xi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wo{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.pointLocation(l.Point.convert(t),this._map.terrain)}}class Bs{constructor(t,s){this._map=t,this._tr=new Wo(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(D.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const c=s;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const d=this._startPos;this._lastPos=c,this._box||(this._box=D.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const f=Math.min(d.x,c.x),x=Math.max(d.x,c.x),w=Math.min(d.y,c.y),E=Math.max(d.y,c.y);D.setTransform(this._box,`translate(${f}px,${w}px)`),this._box.style.width=x-f+"px",this._box.style.height=E-w+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const c=this._startPos,d=s;if(this.reset(),D.suppressClick(),c.x!==d.x||c.y!==d.y)return this._map.fire(new l.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:f=>f.fitScreenCoordinates(c,d,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(D.remove(this._box),this._box=null),D.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new l.Event(t,{originalEvent:s}))}}function pr(p,t){if(p.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${p.length}, points ${t.length}`);const s={};for(let c=0;c<p.length;c++)s[p[c].identifier]=t[c];return s}class He{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){const f=new l.Point(0,0);for(const x of d)f._add(x);return f.div(d.length)}(s),this.touches=pr(c,s)))}touchmove(t,s,c){if(this.aborted||!this.centroid)return;const d=pr(c,s);for(const f in this.touches){const x=d[f];(!x||x.dist(this.touches[f])>30)&&(this.aborted=!0)}}touchend(t,s,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class La{constructor(t){this.singleTap=new He(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,c){this.singleTap.touchstart(t,s,c)}touchmove(t,s,c){this.singleTap.touchmove(t,s,c)}touchend(t,s,c){const d=this.singleTap.touchend(t,s,c);if(d){const f=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(d)<30;if(f&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Fs{constructor(t){this._tr=new Wo(t),this._zoomIn=new La({numTouches:1,numTaps:2}),this._zoomOut=new La({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,c){this._zoomIn.touchstart(t,s,c),this._zoomOut.touchstart(t,s,c)}touchmove(t,s,c){this._zoomIn.touchmove(t,s,c),this._zoomOut.touchmove(t,s,c)}touchend(t,s,c){const d=this._zoomIn.touchend(t,s,c),f=this._zoomOut.touchend(t,s,c),x=this._tr;return d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom+1,around:x.unproject(d)},{originalEvent:t})}):f?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:x.zoom-1,around:x.unproject(f)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ar{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const s=this._moveFunction(...t);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(t,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,s){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const d=s.length?s[0]:s;return!this._moved&&d.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=d,this._move(c,d))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&D.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Jc={0:1,2:2};class Ne{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const s=D.mouseButton(t);this._eventButton=s}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!function(s,c){const d=Jc[c];return s.buttons===void 0||(s.buttons&d)!==d}(t,this._eventButton)}isValidEndEvent(t){return D.mouseButton(t)===this._eventButton}}class Da{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}const ru=p=>{p.mousedown=p.dragStart,p.mousemoveWindow=p.dragMove,p.mouseup=p.dragEnd,p.contextmenu=function(t){t.preventDefault()}},Qc=({enable:p,clickTolerance:t,bearingDegreesPerPixelMoved:s=.8})=>{const c=new Ne({checkCorrectEvent:d=>D.mouseButton(d)===0&&d.ctrlKey||D.mouseButton(d)===2});return new Ar({clickTolerance:t,move:(d,f)=>({bearingDelta:(f.x-d.x)*s}),moveStateManager:c,enable:p,assignEvents:ru})},Ra=({enable:p,clickTolerance:t,pitchDegreesPerPixelMoved:s=-.5})=>{const c=new Ne({checkCorrectEvent:d=>D.mouseButton(d)===0&&d.ctrlKey||D.mouseButton(d)===2});return new Ar({clickTolerance:t,move:(d,f)=>({pitchDelta:(f.y-d.y)*s}),moveStateManager:c,enable:p,assignEvents:ru})};class eh{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,c){return this._calculateTransform(t,s,c)}touchmove(t,s,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,c)}touchend(t,s,c){this._calculateTransform(t,s,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,c){c.length>0&&(this._active=!0);const d=pr(c,s),f=new l.Point(0,0),x=new l.Point(0,0);let w=0;for(const T in d){const k=d[T],P=this._touches[T];P&&(f._add(k),x._add(k.sub(P)),w++,d[T]=k)}if(this._touches=d,w<this._minTouches||!x.mag())return;const E=x.div(w);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:f.div(w),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,s,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,c){if(!this._firstTwoTouches)return;t.preventDefault();const[d,f]=this._firstTwoTouches,x=Fa(c,s,d),w=Fa(c,s,f);if(!x||!w)return;const E=this._aroundCenter?null:x.add(w).div(2);return this._move([x,w],E,t)}touchend(t,s,c){if(!this._firstTwoTouches)return;const[d,f]=this._firstTwoTouches,x=Fa(c,s,d),w=Fa(c,s,f);x&&w||(this._active&&D.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Fa(p,t,s){for(let c=0;c<p.length;c++)if(p[c].identifier===s)return t[c]}function th(p,t){return Math.log(p/t)/Math.LN2}class ou extends Ba{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(th(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:th(this._distance,c),pinchAround:s}}}function Oa(p,t){return 180*p.angleWith(t)/Math.PI}class su extends Ba{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oa(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,c=Oa(t,this._startVector);return Math.abs(c)<s}}function Os(p){return Math.abs(p.y)>Math.abs(p.x)}class an extends Ba{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,c){super.touchstart(t,s,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Os(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const d=t[0].sub(this._lastPoints[0]),f=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(d,f,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(d.y+f.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,c){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,f=s.mag()>=2;if(!d&&!f)return;if(!d||!f)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Os(t)&&Os(s)&&x}}const Qr={panStep:100,bearingStep:15,pitchStep:10};class ih{constructor(t){this._tr=new Wo(t);const s=Qr;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,c=0,d=0,f=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),f=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),f=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:w=>{const E=this._tr;w.easeTo({duration:300,easeId:"keyboardHandler",easing:au,zoom:s?Math.round(E.zoom)+s*(t.shiftKey?2:1):E.zoom,bearing:E.bearing+c*this._bearingStep,pitch:E.pitch+d*this._pitchStep,offset:[-f*this._panStep,-x*this._panStep],center:E.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function au(p){return p*(2-p)}const Na=4.000244140625;class lu{constructor(t,s){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new Wo(t),this._el=t.getCanvasContainer(),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!t[this._map._metaKey])return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=l.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,s!==0&&s%Na==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=D.mousePos(this._el,t),c=this._tr;this._around=l.LngLat.convert(this._aroundCenter?c.center:c.unproject(s)),this._aroundPoint=c.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(this._delta!==0){const w=this._type==="wheel"&&Math.abs(this._delta)>Na?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*w)));this._delta<0&&E!==0&&(E=1/E);const T=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(T*E))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,c=this._startZoom,d=this._easing;let f,x=!1;if(this._type==="wheel"&&c&&d){const w=Math.min((l.browser.now()-this._lastWheelEventTime)/200,1),E=d(w);f=l.interpolate.number(c,s,E),w<1?this._frameId||(this._frameId=!0):x=!0}else f=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:f-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=l.defaultEasing;if(this._prevEase){const c=this._prevEase,d=(l.browser.now()-c.start)/c.duration,f=c.easing(d+.01)-c.easing(d),x=.27/Math.sqrt(f*f+1e-4)*.01,w=Math.sqrt(.0729-x*x);s=l.bezier(x,w,.25,1)}return this._prevEase={start:l.browser.now(),duration:t,easing:s},s}reset(){this._active=!1}}class nh{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nn{constructor(t){this._tr=new Wo(t),this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qt{constructor(){this._tap=new La({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,s,c){if(!this._swipePoint)if(this._tapTime){const d=s[0],f=t.timeStamp-this._tapTime<500,x=this._tapPoint.dist(d)<30;f&&x?c.length>0&&(this._swipePoint=d,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,s,c)}touchmove(t,s,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=s[0],f=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:f/128}}}else this._tap.touchmove(t,s,c)}touchend(t,s,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const d=this._tap.touchend(t,s,c);d&&(this._tapTime=t.timeStamp,this._tapPoint=d)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ua{constructor(t,s,c){this._el=t,this._mousePan=s,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class uu{constructor(t,s,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class rh{constructor(t,s,c,d){this._el=t,this._touchZoom=s,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ns=p=>p.zoom||p.drag||p.pitch||p.rotate;class oh extends l.Event{}function cu(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class fr{constructor(t,s){this.handleWindowEvent=d=>{this.handleEvent(d,`${d.type}Window`)},this.handleEvent=(d,f)=>{if(d.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const x=d.type==="renderFrame"?void 0:d,w={needsRenderFrame:!1},E={},T={},k=d.touches,P=k?this._getMapTouches(k):void 0,B=P?D.touchPos(this._el,P):D.mousePos(this._el,d);for(const{handlerName:Z,handler:$,allowed:se}of this._handlers){if(!$.isEnabled())continue;let pe;this._blockedByActive(T,se,Z)?$.reset():$[f||d.type]&&(pe=$[f||d.type](d,B,P),this.mergeHandlerResult(w,E,pe,Z,x),pe&&pe.needsRenderFrame&&this._triggerRenderFrame()),(pe||$.isActive())&&(T[Z]=$)}const j={};for(const Z in this._previousActiveHandlers)T[Z]||(j[Z]=x);this._previousActiveHandlers=T,(Object.keys(j).length||cu(w))&&(this._changes.push([w,E,j]),this._triggerRenderFrame()),(Object.keys(T).length||cu(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:V}=w;V&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],V(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dr(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,f,x]of this._listeners)D.addEventListener(d,f,d===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,c]of this._listeners)D.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const s=this._map,c=s.getCanvasContainer();this._add("mapEvent",new lp(s,t));const d=s.boxZoom=new Bs(s,t);this._add("boxZoom",d),t.interactive&&t.boxZoom&&d.enable();const f=new Fs(s),x=new Nn(s);s.doubleClickZoom=new nh(x,f),this._add("tapZoom",f),this._add("clickZoom",x),t.interactive&&t.doubleClickZoom&&s.doubleClickZoom.enable();const w=new Qt;this._add("tapDragZoom",w);const E=s.touchPitch=new an(s);this._add("touchPitch",E),t.interactive&&t.touchPitch&&s.touchPitch.enable(t.touchPitch);const T=Qc(t),k=Ra(t);s.dragRotate=new uu(t,T,k),this._add("mouseRotate",T,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]),t.interactive&&t.dragRotate&&s.dragRotate.enable();const P=(({enable:se,clickTolerance:pe})=>{const H=new Ne({checkCorrectEvent:ce=>D.mouseButton(ce)===0&&!ce.ctrlKey});return new Ar({clickTolerance:pe,move:(ce,me)=>({around:me,panDelta:me.sub(ce)}),activateOnStart:!0,moveStateManager:H,enable:se,assignEvents:ru})})(t),B=new eh(t,s);s.dragPan=new Ua(c,P,B),this._add("mousePan",P),this._add("touchPan",B,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&s.dragPan.enable(t.dragPan);const j=new su,V=new ou;s.touchZoomRotate=new rh(c,V,j,w),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&s.touchZoomRotate.enable(t.touchZoomRotate);const Z=s.scrollZoom=new lu(s,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),t.interactive&&t.scrollZoom&&s.scrollZoom.enable(t.scrollZoom);const $=s.keyboard=new ih(s);this._add("keyboard",$),t.interactive&&t.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new up(s))}_add(t,s,c){this._handlers.push({handlerName:t,handler:s,allowed:c}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ns(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,s,c){for(const d in t)if(d!==c&&(!s||s.indexOf(d)<0))return!0;return!1}_getMapTouches(t){const s=[];for(const c of t)this._el.contains(c.target)&&s.push(c);return s}mergeHandlerResult(t,s,c,d,f){if(!c)return;l.extend(t,c);const x={handlerName:d,originalEvent:c.originalEvent||f};c.zoomDelta!==void 0&&(s.zoom=x),c.panDelta!==void 0&&(s.drag=x),c.pitchDelta!==void 0&&(s.pitch=x),c.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},c={};for(const[d,f,x]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new l.Point(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(t.around=d.around),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),l.extend(s,f),l.extend(c,x);this._updateMapTransform(t,s,c),this._changes=[]}_updateMapTransform(t,s,c){const d=this._map,f=d._getTransformForUpdate(),x=d.terrain;if(!(cu(t)||x&&this._terrainMovement))return this._fireEvents(s,c,!0);let{panDelta:w,zoomDelta:E,bearingDelta:T,pitchDelta:k,around:P,pinchAround:B}=t;B!==void 0&&(P=B),d._stop(!0),P=P||d.transform.centerPoint;const j=f.pointLocation(w?P.sub(w):P);T&&(f.bearing+=T),k&&(f.pitch+=k),E&&(f.zoom+=E),x?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?f.center=f.pointLocation(f.centerPoint.sub(w)):f.setLocationAtPoint(j,P):(this._terrainMovement=!0,f.freezeElevation=!0,f.setLocationAtPoint(j,P),this._map.once("moveend",()=>{f.freezeElevation=!1,this._terrainMovement=!1,f.recalculateZoom(d.terrain)})):f.setLocationAtPoint(j,P),d._applyUpdatedTransform(f),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,c,!0)}_fireEvents(t,s,c){const d=Ns(this._eventsInProgress),f=Ns(t),x={};for(const k in t){const{originalEvent:P}=t[k];this._eventsInProgress[k]||(x[`${k}start`]=P),this._eventsInProgress[k]=t[k]}!d&&f&&this._fireEvent("movestart",f.originalEvent);for(const k in x)this._fireEvent(k,x[k]);f&&this._fireEvent("move",f.originalEvent);for(const k in t){const{originalEvent:P}=t[k];this._fireEvent(k,P)}const w={};let E;for(const k in this._eventsInProgress){const{handlerName:P,originalEvent:B}=this._eventsInProgress[k];this._handlersById[P].isActive()||(delete this._eventsInProgress[k],E=s[P]||B,w[`${k}end`]=E)}for(const k in w)this._fireEvent(k,w[k]);const T=Ns(this._eventsInProgress);if(c&&(d||f)&&!T){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;k?(P(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:E})):(this._map.fire(new l.Event("moveend",{originalEvent:E})),P(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new l.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new oh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Va extends l.Evented{constructor(t,s){super(),this._renderFrameCallback=()=>{const c=Math.min((l.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,c){return t=l.Point.convert(t).mult(-1),this.panTo(this.transform.center,l.extend({offset:t},s),c)}panTo(t,s,c){return this.easeTo(l.extend({center:t},s),c)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,c){return this.easeTo(l.extend({zoom:t},s),c)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,c){return this.easeTo(l.extend({bearing:t},s),c)}resetNorth(t,s){return this.rotateTo(0,l.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(l.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=Bt.convert(t);const c=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,s)}_cameraForBoxAndBearing(t,s,c,d){const f={top:0,bottom:0,right:0,left:0};if(typeof(d=l.extend({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},d)).padding=="number"){const me=d.padding;d.padding={top:me,bottom:me,right:me,left:me}}d.padding=l.extend(f,d.padding);const x=this.transform,w=x.padding,E=x.project(l.LngLat.convert(t)),T=x.project(l.LngLat.convert(s)),k=E.rotate(-c*Math.PI/180),P=T.rotate(-c*Math.PI/180),B=new l.Point(Math.max(k.x,P.x),Math.max(k.y,P.y)),j=new l.Point(Math.min(k.x,P.x),Math.min(k.y,P.y)),V=B.sub(j),Z=(x.width-(w.left+w.right+d.padding.left+d.padding.right))/V.x,$=(x.height-(w.top+w.bottom+d.padding.top+d.padding.bottom))/V.y;if($<0||Z<0)return void l.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const se=Math.min(x.scaleZoom(x.scale*Math.min(Z,$)),d.maxZoom),pe=l.Point.convert(d.offset),H=new l.Point((d.padding.left-d.padding.right)/2,(d.padding.top-d.padding.bottom)/2).rotate(c*Math.PI/180),ce=pe.add(H).mult(x.scale/x.zoomScale(se));return{center:x.unproject(E.add(T).div(2).sub(ce)),zoom:se,bearing:c}}fitBounds(t,s,c){return this._fitInternal(this.cameraForBounds(t,s),s,c)}fitScreenCoordinates(t,s,c,d,f){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.Point.convert(t)),this.transform.pointLocation(l.Point.convert(s)),c,d),d,f)}_fitInternal(t,s,c){return t?(delete(s=l.extend(t,s)).padding,s.linear?this.easeTo(s,c):this.flyTo(s,c)):this}jumpTo(t,s){this.stop();const c=this._getTransformForUpdate();let d=!1,f=!1,x=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(d=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=l.LngLat.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(f=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(x=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this._applyUpdatedTransform(c),this.fire(new l.Event("movestart",s)).fire(new l.Event("move",s)),d&&this.fire(new l.Event("zoomstart",s)).fire(new l.Event("zoom",s)).fire(new l.Event("zoomend",s)),f&&this.fire(new l.Event("rotatestart",s)).fire(new l.Event("rotate",s)).fire(new l.Event("rotateend",s)),x&&this.fire(new l.Event("pitchstart",s)).fire(new l.Event("pitch",s)).fire(new l.Event("pitchend",s)),this.fire(new l.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,c,d=0){const f=l.MercatorCoordinate.fromLngLat(t,s),x=l.MercatorCoordinate.fromLngLat(c,d),w=x.x-f.x,E=x.y-f.y,T=x.z-f.z,k=Math.hypot(w,E,T);if(k===0)throw new Error("Can't calculate camera options with same From and To");const P=Math.hypot(w,E),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/k/this.transform.tileSize),j=180*Math.atan2(w,-E)/Math.PI;let V=180*Math.acos(P/k)/Math.PI;return V=T<0?90-V:90+V,{center:x.toLngLat(),zoom:B,pitch:V,bearing:j}}easeTo(t,s){this._stop(!1,t.easeId),((t=l.extend({offset:[0,0],duration:500,easing:l.defaultEasing},t)).animate===!1||!t.essential&&l.browser.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),d=this.getZoom(),f=this.getBearing(),x=this.getPitch(),w=this.getPadding(),E="zoom"in t?+t.zoom:d,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,k="pitch"in t?+t.pitch:x,P="padding"in t?t.padding:c.padding,B=l.Point.convert(t.offset);let j=c.centerPoint.add(B);const V=c.pointLocation(j),Z=l.LngLat.convert(t.center||V);this._normalizeCenter(Z);const $=c.project(V),se=c.project(Z).sub($),pe=c.zoomScale(E-d);let H,ce;t.around&&(H=l.LngLat.convert(t.around),ce=c.locationPoint(H));const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==d,this._rotating=this._rotating||f!==T,this._pitching=this._pitching||k!==x,this._padding=!c.isPaddingEqual(P),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,me),this.terrain&&this._prepareElevation(Z),this._ease(ye=>{if(this._zooming&&(c.zoom=l.interpolate.number(d,E,ye)),this._rotating&&(c.bearing=l.interpolate.number(f,T,ye)),this._pitching&&(c.pitch=l.interpolate.number(x,k,ye)),this._padding&&(c.interpolatePadding(w,P,ye),j=c.centerPoint.add(B)),this.terrain&&!t.freezeElevation&&this._updateElevation(ye),H)c.setLocationAtPoint(H,ce);else{const _e=c.zoomScale(c.zoom-d),Se=E>d?Math.min(2,pe):Math.max(.5,pe),xe=Math.pow(Se,1-ye),Re=c.unproject($.add(se.mult(ye*xe)).mult(_e));c.setLocationAtPoint(c.renderWorldCopies?Re.wrap():Re,j)}this._applyUpdatedTransform(c),this._fireMoveEvents(s)},ye=>{this.terrain&&this._finalizeElevation(),this._afterEase(s,ye)},t),this}_prepareEase(t,s,c={}){this._moving=!0,s||c.moving||this.fire(new l.Event("movestart",t)),this._zooming&&!c.zooming&&this.fire(new l.Event("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new l.Event("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new l.Event("pitchstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(t,this.terrain),this.transform.freezeElevation=!0}_updateElevation(t){const s=this.transform.getElevation(this._elevationCenter,this.terrain);if(t<1&&s!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(s-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=s}this.transform.elevation=l.interpolate.number(this._elevationStart,this._elevationTarget,t)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(t){if(!this.transformCameraUpdate)return;const s=t.clone(),{center:c,zoom:d,pitch:f,bearing:x,elevation:w}=this.transformCameraUpdate(s);c&&(s.center=c),d!==void 0&&(s.zoom=d),f!==void 0&&(s.pitch=f),x!==void 0&&(s.bearing=x),w!==void 0&&(s.elevation=w),this.transform.apply(s)}_fireMoveEvents(t){this.fire(new l.Event("move",t)),this._zooming&&this.fire(new l.Event("zoom",t)),this._rotating&&this.fire(new l.Event("rotate",t)),this._pitching&&this.fire(new l.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const c=this._zooming,d=this._rotating,f=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new l.Event("zoomend",t)),d&&this.fire(new l.Event("rotateend",t)),f&&this.fire(new l.Event("pitchend",t)),this.fire(new l.Event("moveend",t))}flyTo(t,s){if(!t.essential&&l.browser.prefersReducedMotion){const je=l.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(je,s)}this.stop(),t=l.extend({offset:[0,0],speed:1.2,curve:1.42,easing:l.defaultEasing},t);const c=this._getTransformForUpdate(),d=this.getZoom(),f=this.getBearing(),x=this.getPitch(),w=this.getPadding(),E="zoom"in t?l.clamp(+t.zoom,c.minZoom,c.maxZoom):d,T="bearing"in t?this._normalizeBearing(t.bearing,f):f,k="pitch"in t?+t.pitch:x,P="padding"in t?t.padding:c.padding,B=c.zoomScale(E-d),j=l.Point.convert(t.offset);let V=c.centerPoint.add(j);const Z=c.pointLocation(V),$=l.LngLat.convert(t.center||Z);this._normalizeCenter($);const se=c.project(Z),pe=c.project($).sub(se);let H=t.curve;const ce=Math.max(c.width,c.height),me=ce/B,ye=pe.mag();if("minZoom"in t){const je=l.clamp(Math.min(t.minZoom,d,E),c.minZoom,c.maxZoom),Mt=ce/c.zoomScale(je-d);H=Math.sqrt(Mt/ye*2)}const _e=H*H;function Se(je){const Mt=(me*me-ce*ce+(je?-1:1)*_e*_e*ye*ye)/(2*(je?me:ce)*_e*ye);return Math.log(Math.sqrt(Mt*Mt+1)-Mt)}function xe(je){return(Math.exp(je)-Math.exp(-je))/2}function Re(je){return(Math.exp(je)+Math.exp(-je))/2}const Ke=Se(!1);let wt=function(je){return Re(Ke)/Re(Ke+H*je)},Me=function(je){return ce*((Re(Ke)*(xe(Mt=Ke+H*je)/Re(Mt))-xe(Ke))/_e)/ye;var Mt},ot=(Se(!0)-Ke)/H;if(Math.abs(ye)<1e-6||!isFinite(ot)){if(Math.abs(ce-me)<1e-6)return this.easeTo(t,s);const je=me<ce?-1:1;ot=Math.abs(Math.log(me/ce))/H,Me=function(){return 0},wt=function(Mt){return Math.exp(je*H*Mt)}}return t.duration="duration"in t?+t.duration:1e3*ot/("screenSpeed"in t?+t.screenSpeed/H:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=f!==T,this._pitching=k!==x,this._padding=!c.isPaddingEqual(P),this._prepareEase(s,!1),this.terrain&&this._prepareElevation($),this._ease(je=>{const Mt=je*ot,kt=1/wt(Mt);c.zoom=je===1?E:d+c.scaleZoom(kt),this._rotating&&(c.bearing=l.interpolate.number(f,T,je)),this._pitching&&(c.pitch=l.interpolate.number(x,k,je)),this._padding&&(c.interpolatePadding(w,P,je),V=c.centerPoint.add(j)),this.terrain&&!t.freezeElevation&&this._updateElevation(je);const St=je===1?$:c.unproject(se.add(pe.mult(Me(Mt))).mult(kt));c.setLocationAtPoint(c.renderWorldCopies?St.wrap():St,V),this._applyUpdatedTransform(c),this._fireMoveEvents(s)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(s)},t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,s)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,s,c){c.animate===!1||c.duration===0?(t(1),s()):(this._easeStart=l.browser.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,s){t=l.wrap(t,-180,180);const c=Math.abs(t-s);return Math.abs(t-360-s)<c&&(t-=360),Math.abs(t+360-s)<c&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const c=t.lng-s.center.lng;t.lng+=c>180?-360:c<-180?360:0}queryTerrainElevation(t){return this.terrain?this.transform.getElevation(l.LngLat.convert(t),this.terrain)-this.transform.elevation:null}}class Qe{constructor(t={}){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=D.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=D.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=D.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){D.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const c=this._map._getUIString(`AttributionControl.${s}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(d=>typeof d!="string"?"":d)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const s=this._map.style.sourceCaches;for(const d in s){const f=s[d];if(f.used||f.usedForTerrain){const x=f.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(d=>String(d).trim()),t.sort((d,f)=>d.length-f.length),t=t.filter((d,f)=>{for(let x=f+1;x<t.length;x++)if(t[x].indexOf(d)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class at{constructor(t={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=D.create("div","maplibregl-ctrl");const s=D.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){D.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ja{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,c=s?this._queue.concat(s):this._queue;for(const d of c)if(d.id===t)return void(d.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const c of s)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const hu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var du=l.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class ln extends l.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];const c={};for(const d of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))c[d.key]=!0,this._renderableTilesKeys.push(d.key),this._tiles[d.key]||(d.posMatrix=new Float64Array(16),l.ortho(d.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),this._tiles[d.key]=new lo(d,this.tileSize));for(const d in this._tiles)c[d]||delete this._tiles[d]}freeRtt(t){for(const s in this._tiles){const c=this._tiles[s];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID;if(d.canonical.equals(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16),l.ortho(f.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),s[c]=f}else if(d.canonical.isChildOf(t.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const x=d.canonical.z-t.canonical.z,w=d.canonical.x-(d.canonical.x>>x<<x),E=d.canonical.y-(d.canonical.y>>x<<x),T=l.EXTENT>>x;l.ortho(f.posMatrix,0,T,0,T,0,1),l.translate(f.posMatrix,f.posMatrix,[-w*T,-E*T,0]),s[c]=f}else if(t.canonical.isChildOf(d.canonical)){const f=t.clone();f.posMatrix=new Float64Array(16);const x=t.canonical.z-d.canonical.z,w=t.canonical.x-(t.canonical.x>>x<<x),E=t.canonical.y-(t.canonical.y>>x<<x),T=l.EXTENT>>x;l.ortho(f.posMatrix,0,l.EXTENT,0,l.EXTENT,0,1),l.translate(f.posMatrix,f.posMatrix,[w*T,E*T,0]),l.scale(f.posMatrix,f.posMatrix,[1/2**x,1/2**x,0]),s[c]=f}}return s}getSourceTile(t,s){const c=this.sourceCache._source;let d=t.overscaledZ-this.deltaZoom;if(d>c.maxzoom&&(d=c.maxzoom),d<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(d).key);let f=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!f||!f.dem)&&s)for(;d>=c.minzoom&&(!f||!f.dem);)f=this.sourceCache.getTileByID(t.scaledTo(d--).key);return f}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=t)}}class sh{constructor(t,s,c){this.painter=t,this.sourceCache=new ln(s),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,s,c,d=l.EXTENT){var f;if(!(s>=0&&s<d&&c>=0&&c<d))return 0;const x=this.getTerrainData(t),w=(f=x.tile)===null||f===void 0?void 0:f.dem;if(!w)return 0;const E=function(V,Z,$){var se=Z[0],pe=Z[1];return V[0]=$[0]*se+$[4]*pe+$[12],V[1]=$[1]*se+$[5]*pe+$[13],V}([],[s/d*l.EXTENT,c/d*l.EXTENT],x.u_terrain_matrix),T=[E[0]*w.dim,E[1]*w.dim],k=Math.floor(T[0]),P=Math.floor(T[1]),B=T[0]-k,j=T[1]-P;return w.get(k,P)*(1-B)*(1-j)+w.get(k+1,P)*B*(1-j)+w.get(k,P+1)*(1-B)*j+w.get(k+1,P+1)*B*j}getElevation(t,s,c,d=l.EXTENT){return this.getDEMElevation(t,s,c,d)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const d=this.painter.context,f=new l.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Je(d,f,d.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Je(d,new l.RGBAImage({width:1,height:1}),d.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const d=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new Je(d,s.dem.getPixels(),d.gl.RGBA,{premultiply:!1}),s.demTexture.bind(d.gl.NEAREST,d.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const c=s&&s+s.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const d=this.sourceCache.sourceCache._source.maxzoom;let f=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=d?f=t.canonical.z-d:l.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>f<<f),w=t.canonical.y-(t.canonical.y>>f<<f),E=l.fromScaling(new Float64Array(16),[1/(l.EXTENT<<f),1/(l.EXTENT<<f),0]);l.translate(E,E,[x*l.EXTENT,w*l.EXTENT,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(t){const s=this.painter,c=s.width/devicePixelRatio,d=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===d||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Je(s.context,{width:c,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Je(s.context,{width:c,height:d,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(c,d,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,c,d))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let f=0,x=0;f<this._coordsTextureSize;f++)for(let w=0;w<this._coordsTextureSize;w++,x+=4)s[x+0]=255&w,s[x+1]=255&f,s[x+2]=w>>8<<4|f>>8,s[x+3]=0;const c=new l.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),d=new Je(t,c,t.gl.RGBA,{premultiply:!1});return d.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=d,d}pointCoordinate(t){const s=new Uint8Array(4),c=this.painter.context,d=c.gl;c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),d.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,d.RGBA,d.UNSIGNED_BYTE,s),c.bindFramebuffer.set(null);const f=s[0]+(s[2]>>4<<8),x=s[1]+((15&s[2])<<8),w=this.coordsIndex[255-s[3]],E=w&&this.sourceCache.getTileByID(w);if(!E)return null;const T=this._coordsTextureSize,k=(1<<E.tileID.canonical.z)*T;return new l.MercatorCoordinate((E.tileID.canonical.x*T+f)/k,(E.tileID.canonical.y*T+x)/k,this.getElevation(E.tileID,f,x,T))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.painter.context,s=new l.Pos3dArray,c=new l.TriangleIndexArray,d=this.meshSize,f=l.EXTENT/d,x=d*d;for(let P=0;P<=d;P++)for(let B=0;B<=d;B++)s.emplaceBack(B*f,P*f,0);for(let P=0;P<x;P+=d+1)for(let B=0;B<d;B++)c.emplaceBack(B+P,d+B+P+1,d+B+P+2),c.emplaceBack(B+P,d+B+P+2,B+P+1);const w=s.length,E=w+2*(d+1);for(const P of[0,1])for(let B=0;B<=d;B++)for(const j of[0,1])s.emplaceBack(B*f,P*l.EXTENT,j);for(let P=0;P<2*d;P+=2)c.emplaceBack(E+P,E+P+1,E+P+3),c.emplaceBack(E+P,E+P+3,E+P+2),c.emplaceBack(w+P,w+P+3,w+P+1),c.emplaceBack(w+P,w+P+2,w+P+3);const T=s.length,k=T+2*(d+1);for(const P of[0,1])for(let B=0;B<=d;B++)for(const j of[0,1])s.emplaceBack(P*l.EXTENT,B*f,j);for(let P=0;P<2*d;P+=2)c.emplaceBack(T+P,T+P+1,T+P+3),c.emplaceBack(T+P,T+P+3,T+P+2),c.emplaceBack(k+P,k+P+3,k+P+1),c.emplaceBack(k+P,k+P+2,k+P+3);return this._mesh={indexBuffer:t.createIndexBuffer(c),vertexBuffer:t.createVertexBuffer(s,du.members),segments:l.SegmentVector.simpleSegment(0,0,s.length,c.length)},this._mesh}getMeshFrameDelta(t){return 2*Math.PI*l.earthRadius/Math.pow(2,t)/5}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return s&&s.dem&&(c.minElevation=s.dem.min*this.exaggeration,c.maxElevation=s.dem.max*this.exaggeration),c}}class mr{constructor(t,s,c){this._context=t,this._size=s,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new Je(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(c.texture),{id:t,fbo:s,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>t.id!==s),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(t=>!t.inUse)===!1}}const Xo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class $a{constructor(t,s){this.painter=t,this.terrain=s,this.pool=new mr(t.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=t._order.filter(c=>!t._layers[c].isHidden(s)),this._coordsDescendingInv={};for(const c in t.sourceCaches){this._coordsDescendingInv[c]={};const d=t.sourceCaches[c].getVisibleCoordinates();for(const f of d){const x=this.terrain.sourceCache.getTerrainCoords(f);for(const w in x)this._coordsDescendingInv[c][w]||(this._coordsDescendingInv[c][w]=[]),this._coordsDescendingInv[c][w].push(x[w])}}this._coordsDescendingInvStr={};for(const c of t._order){const d=t._layers[c],f=d.source;if(Xo[d.type]&&!this._coordsDescendingInvStr[f]){this._coordsDescendingInvStr[f]={};for(const x in this._coordsDescendingInv[f])this._coordsDescendingInvStr[f][x]=this._coordsDescendingInv[f][x].map(w=>w.key).sort().join()}}for(const c of this._renderableTiles)for(const d in this._coordsDescendingInvStr){const f=this._coordsDescendingInvStr[d][c.tileID.key];f&&f!==c.rttCoords[d]&&(c.rtt=[])}}renderLayer(t){if(t.isHidden(this.painter.transform.zoom))return!1;const s=t.type,c=this.painter,d=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(Xo[s]&&(this._prevType&&Xo[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(t.id),!d))return!0;if(Xo[this._prevType]||Xo[s]&&d){this._prevType=s;const f=this._stacks.length-1,x=this._stacks[f]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(nu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[f]){const T=this.pool.getObjectForId(w.rtt[f].id);if(T.stamp===w.rtt[f].stamp){this.pool.useObject(T);continue}}const E=this.pool.getOrCreateFreeObject();this.pool.useObject(E),this.pool.stampObject(E),w.rtt[f]={id:E.id,stamp:E.stamp},c.context.bindFramebuffer.set(E.fbo.framebuffer),c.context.clear({color:l.Color.transparent,stencil:0}),c.currentStencilSource=void 0;for(let T=0;T<x.length;T++){const k=c.style._layers[x[T]],P=k.source?this._coordsDescendingInv[k.source][w.tileID.key]:[w.tileID];c.context.viewport.set([0,0,E.fbo.width,E.fbo.height]),c._renderTileClippingMasks(k,P),c.renderLayer(c,c.style.sourceCaches[k.source],k,P),k.source&&(w.rttCoords[k.source]=this._coordsDescendingInvStr[k.source][w.tileID.key])}}return nu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Xo[s]}return!1}}const ui=N,wi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},pu=p=>{p.touchstart=p.dragStart,p.touchmoveWindow=p.dragMove,p.touchend=p.dragEnd},Us={showCompass:!0,showZoom:!0,visualizePitch:!1};class qa{constructor(t,s,c=!1){this.mousedown=x=>{this.startMouse(l.extend({},x,{ctrlKey:!0,preventDefault:()=>x.preventDefault()}),D.mousePos(this.element,x)),D.addEventListener(window,"mousemove",this.mousemove),D.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=x=>{this.moveMouse(x,D.mousePos(this.element,x))},this.mouseup=x=>{this.mouseRotate.dragEnd(x),this.mousePitch&&this.mousePitch.dragEnd(x),this.offTemp()},this.touchstart=x=>{x.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=D.touchPos(this.element,x.targetTouches)[0],this.startTouch(x,this._startPos),D.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.addEventListener(window,"touchend",this.touchend))},this.touchmove=x=>{x.targetTouches.length!==1?this.reset():(this._lastPos=D.touchPos(this.element,x.targetTouches)[0],this.moveTouch(x,this._lastPos))},this.touchend=x=>{x.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const d=t.dragRotate._mouseRotate.getClickTolerance(),f=t.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Qc({clickTolerance:d,enable:!0}),this.touchRotate=(({enable:x,clickTolerance:w,bearingDegreesPerPixelMoved:E=.8})=>{const T=new Da;return new Ar({clickTolerance:w,move:(k,P)=>({bearingDelta:(P.x-k.x)*E}),moveStateManager:T,enable:x,assignEvents:pu})})({clickTolerance:d,enable:!0}),this.map=t,c&&(this.mousePitch=Ra({clickTolerance:f,enable:!0}),this.touchPitch=(({enable:x,clickTolerance:w,pitchDegreesPerPixelMoved:E=-.5})=>{const T=new Da;return new Ar({clickTolerance:w,move:(k,P)=>({pitchDelta:(P.y-k.y)*E}),moveStateManager:T,enable:x,assignEvents:pu})})({clickTolerance:f,enable:!0})),D.addEventListener(s,"mousedown",this.mousedown),D.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),D.addEventListener(s,"touchcancel",this.reset)}startMouse(t,s){this.mouseRotate.dragStart(t,s),this.mousePitch&&this.mousePitch.dragStart(t,s),D.disableDrag()}startTouch(t,s){this.touchRotate.dragStart(t,s),this.touchPitch&&this.touchPitch.dragStart(t,s),D.disableDrag()}moveMouse(t,s){const c=this.map,{bearingDelta:d}=this.mouseRotate.dragMove(t,s)||{};if(d&&c.setBearing(c.getBearing()+d),this.mousePitch){const{pitchDelta:f}=this.mousePitch.dragMove(t,s)||{};f&&c.setPitch(c.getPitch()+f)}}moveTouch(t,s){const c=this.map,{bearingDelta:d}=this.touchRotate.dragMove(t,s)||{};if(d&&c.setBearing(c.getBearing()+d),this.touchPitch){const{pitchDelta:f}=this.touchPitch.dragMove(t,s)||{};f&&c.setPitch(c.getPitch()+f)}}off(){const t=this.element;D.removeEventListener(t,"mousedown",this.mousedown),D.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend),D.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){D.enableDrag(),D.removeEventListener(window,"mousemove",this.mousemove),D.removeEventListener(window,"mouseup",this.mouseup),D.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),D.removeEventListener(window,"touchend",this.touchend)}}let gr;function Za(p,t,s){if(p=new l.LngLat(p.lng,p.lat),t){const c=new l.LngLat(p.lng-360,p.lat),d=new l.LngLat(p.lng+360,p.lat),f=s.locationPoint(p).distSqr(t);s.locationPoint(c).distSqr(t)<f?p=c:s.locationPoint(d).distSqr(t)<f&&(p=d)}for(;Math.abs(p.lng-s.center.lng)>180;){const c=s.locationPoint(p);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;p.lng>s.center.lng?p.lng-=360:p.lng+=360}return p}const Vs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ko(p,t,s){const c=p.classList;for(const d in Vs)c.remove(`maplibregl-${s}-anchor-${d}`);c.add(`maplibregl-${s}-anchor-${t}`)}class js extends l.Evented{constructor(t){if(super(),this._onKeyPress=s=>{const c=s.code,d=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&d!==32&&d!==13||this.togglePopup()},this._onMapClick=s=>{const c=s.originalEvent.target,d=this._element;this._popup&&(c===d||d.contains(c))&&this.togglePopup()},this._update=s=>{if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Za(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),s&&s.type!=="moveend"||(this._pos=this._pos.round()),D.setTransform(this._element,`${Vs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const f=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=f.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))},this._onMove=s=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.Event("dragstart"))),this.fire(new l.Event("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.Event("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=l.Point.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=D.create("div"),this._element.setAttribute("aria-label","Map marker");const s=D.createNS("http://www.w3.org/2000/svg","svg"),c=41,d=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${c}px`),s.setAttributeNS(null,"width",`${d}px`),s.setAttributeNS(null,"viewBox",`0 0 ${d} ${c}`);const f=D.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"stroke","none"),f.setAttributeNS(null,"stroke-width","1"),f.setAttributeNS(null,"fill","none"),f.setAttributeNS(null,"fill-rule","evenodd");const x=D.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"fill-rule","nonzero");const w=D.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"transform","translate(3.0, 29.0)"),w.setAttributeNS(null,"fill","#000000");const E=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const se of E){const pe=D.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",se.rx),pe.setAttributeNS(null,"ry",se.ry),w.appendChild(pe)}const T=D.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill",this._color);const k=D.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),T.appendChild(k);const P=D.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"opacity","0.25"),P.setAttributeNS(null,"fill","#000000");const B=D.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),P.appendChild(B);const j=D.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(6.0, 7.0)"),j.setAttributeNS(null,"fill","#FFFFFF");const V=D.createNS("http://www.w3.org/2000/svg","g");V.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Z=D.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#000000"),Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962");const $=D.createNS("http://www.w3.org/2000/svg","circle");$.setAttributeNS(null,"fill","#FFFFFF"),$.setAttributeNS(null,"cx","5.5"),$.setAttributeNS(null,"cy","5.5"),$.setAttributeNS(null,"r","5.4999962"),V.appendChild(Z),V.appendChild($),x.appendChild(w),x.appendChild(T),x.appendChild(P),x.appendChild(j),x.appendChild(V),s.appendChild(x),s.setAttributeNS(null,"height",c*this._scale+"px"),s.setAttributeNS(null,"width",d*this._scale+"px"),this._element.appendChild(s),this._offset=l.Point.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Ko(this._element,this._anchor,"marker"),t&&t.className)for(const s of t.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),D.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=l.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}getOffset(){return this._offset}setOffset(t){return this._offset=l.Point.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const fu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Yo=0,mo=!1;const mu={maxWidth:100,unit:"metric"};function Ga(p,t,s){const c=s&&s.maxWidth||100,d=p._container.clientHeight/2,f=p.unproject([0,d]),x=p.unproject([c,d]),w=f.distanceTo(x);if(s&&s.unit==="imperial"){const E=3.2808*w;E>5280?go(t,c,E/5280,p._getUIString("ScaleControl.Miles")):go(t,c,E,p._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?go(t,c,w/1852,p._getUIString("ScaleControl.NauticalMiles")):w>=1e3?go(t,c,w/1e3,p._getUIString("ScaleControl.Kilometers")):go(t,c,w,p._getUIString("ScaleControl.Meters"))}function go(p,t,s,c){const d=function(f){const x=Math.pow(10,`${Math.floor(f)}`.length-1);let w=f/x;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(E){const T=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*T)/T}(w),x*w}(s);p.style.width=t*(d/s)+"px",p.innerHTML=`${d}&nbsp;${c}`}const gu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Ha=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wa(p){if(p){if(typeof p=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(p,2)));return{center:new l.Point(0,0),top:new l.Point(0,p),"top-left":new l.Point(t,t),"top-right":new l.Point(-t,t),bottom:new l.Point(0,-p),"bottom-left":new l.Point(t,-t),"bottom-right":new l.Point(-t,-t),left:new l.Point(p,0),right:new l.Point(-p,0)}}if(p instanceof l.Point||Array.isArray(p)){const t=l.Point.convert(p);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:l.Point.convert(p.center||[0,0]),top:l.Point.convert(p.top||[0,0]),"top-left":l.Point.convert(p["top-left"]||[0,0]),"top-right":l.Point.convert(p["top-right"]||[0,0]),bottom:l.Point.convert(p.bottom||[0,0]),"bottom-left":l.Point.convert(p["bottom-left"]||[0,0]),"bottom-right":l.Point.convert(p["bottom-right"]||[0,0]),left:l.Point.convert(p.left||[0,0]),right:l.Point.convert(p.right||[0,0])}}return Wa(new l.Point(0,0))}const yu={extend:(p,...t)=>l.extend(p,...t),run(p){p()},logToElement(p,t=!1,s="log"){const c=window.document.getElementById(s);c&&(t&&(c.innerHTML=""),c.innerHTML+=`<br>${p}`)}},Xa=N;class At{static get version(){return Xa}static get workerCount(){return Yi.workerCount}static set workerCount(t){Yi.workerCount=t}static get maxParallelImageRequests(){return l.config.MAX_PARALLEL_IMAGE_REQUESTS}static set maxParallelImageRequests(t){l.config.MAX_PARALLEL_IMAGE_REQUESTS=t}static get workerUrl(){return l.config.WORKER_URL}static set workerUrl(t){l.config.WORKER_URL=t}static addProtocol(t,s){l.config.REGISTERED_PROTOCOLS[t]=s}static removeProtocol(t){delete l.config.REGISTERED_PROTOCOLS[t]}}return At.Map=class extends Va{constructor(p){if(l.PerformanceUtils.mark(l.PerformanceMarkers.create),(p=l.extend({},wi,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Aa(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),{bearingSnap:p.bearingSnap}),this._cooperativeGesturesOnWheel=t=>{this._onCooperativeGesture(t,t[this._metaKey],1)},this._contextLost=t=>{t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new l.Event("webglcontextlost",{originalEvent:t}))},this._contextRestored=t=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.Event("webglcontextrestored",{originalEvent:t}))},this._onMapScroll=t=>{if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=p.interactive,this._cooperativeGestures=p.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=p.maxTileCacheSize,this._maxTileCacheZoomLevels=p.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._renderTaskQueue=new ja,this._controls=[],this._mapId=l.uniqueId(),this._locale=l.extend({},hu,p.locale),this._clickTolerance=p.clickTolerance,this._overridePixelRatio=p.pixelRatio,this._maxCanvasSize=p.maxCanvasSize,this.transformCameraUpdate=p.transformCameraUpdate,this._imageQueueHandle=ft.addThrottleControl(()=>this.isMoving()),this._requestManager=new K(p.transformRequest),typeof p.container=="string"){if(this._container=document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(p.maxBounds&&this.setMaxBounds(p.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let t=!1;this._resizeObserver=new ResizeObserver(s=>{t?this._trackResize&&this.resize(s)._update():t=!0}),this._resizeObserver.observe(this._container)}this.handlers=new fr(this,p),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=p.hash&&new Wc(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,l.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=p.localIdeographFontFamily,this._validateStyle=p.validateStyle,p.style&&this.setStyle(p.style,{localIdeographFontFamily:p.localIdeographFontFamily}),p.attributionControl&&this.addControl(new Qe({customAttribution:p.customAttribution})),p.maplibreLogo&&this.addControl(new at,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new l.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new l.Event(`${t.dataType}dataloading`,t))}),this.on("dataabort",t=>{this.fire(new l.Event("sourcedataabort",t))})}_getMapId(){return this._mapId}addControl(p,t){if(t===void 0&&(t=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=p.onAdd(this);this._controls.push(p);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(s,c.firstChild):c.appendChild(s),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new l.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(p);return t>-1&&this._controls.splice(t,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}calculateCameraOptionsFromTo(p,t,s,c){return c==null&&this.terrain&&(c=this.transform.getElevation(s,this.terrain)),super.calculateCameraOptionsFromTo(p,t,s,c)}resize(p){var t;const s=this._containerDimensions(),c=s[0],d=s[1],f=this._getClampedPixelRatio(c,d);if(this._resizeCanvas(c,d,f),this.painter.resize(c,d,f),this.painter.overLimit()){const w=this.painter.context.gl;this._maxCanvasSize=[w.drawingBufferWidth,w.drawingBufferHeight];const E=this._getClampedPixelRatio(c,d);this._resizeCanvas(c,d,E),this.painter.resize(c,d,E)}this.transform.resize(c,d),(t=this._requestedCameraState)===null||t===void 0||t.resize(c,d);const x=!this._moving;return x&&(this.stop(),this.fire(new l.Event("movestart",p)).fire(new l.Event("move",p))),this.fire(new l.Event("resize",p)),x&&this.fire(new l.Event("moveend",p)),this}_getClampedPixelRatio(p,t){const{0:s,1:c}=this._maxCanvasSize,d=this.getPixelRatio(),f=p*d,x=t*d;return Math.min(f>s?s/f:1,x>c?c/x:1)*d}getPixelRatio(){var p;return(p=this._overridePixelRatio)!==null&&p!==void 0?p:devicePixelRatio}setPixelRatio(p){this._overridePixelRatio=p,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(p){return this.transform.setMaxBounds(Bt.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p&&this.setZoom(p),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p&&this.setZoom(p),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p&&this.setPitch(p),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p&&this.setPitch(p),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(p){return this.transform.locationPoint(l.LngLat.convert(p),this.style&&this.terrain)}unproject(p){return this.transform.pointLocation(l.Point.convert(p),this.terrain)}isMoving(){var p;return this._moving||((p=this.handlers)===null||p===void 0?void 0:p.isMoving())}isZooming(){var p;return this._zooming||((p=this.handlers)===null||p===void 0?void 0:p.isZooming())}isRotating(){var p;return this._rotating||((p=this.handlers)===null||p===void 0?void 0:p.isRotating())}_createDelegatedListener(p,t,s){if(p==="mouseenter"||p==="mouseover"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:f=>{const x=this.getLayer(t)?this.queryRenderedFeatures(f.point,{layers:[t]}):[];x.length?c||(c=!0,s.call(this,new xi(p,this,f.originalEvent,{features:x}))):c=!1},mouseout:()=>{c=!1}}}}if(p==="mouseleave"||p==="mouseout"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?c=!0:c&&(c=!1,s.call(this,new xi(p,this,x.originalEvent)))},mouseout:x=>{c&&(c=!1,s.call(this,new xi(p,this,x.originalEvent)))}}}}{const c=d=>{const f=this.getLayer(t)?this.queryRenderedFeatures(d.point,{layers:[t]}):[];f.length&&(d.features=f,s.call(this,d),delete d.features)};return{layer:t,listener:s,delegates:{[p]:c}}}}on(p,t,s){if(s===void 0)return super.on(p,t);const c=this._createDelegatedListener(p,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(c);for(const d in c.delegates)this.on(d,c.delegates[d]);return this}once(p,t,s){if(s===void 0)return super.once(p,t);const c=this._createDelegatedListener(p,t,s);for(const d in c.delegates)this.once(d,c.delegates[d]);return this}off(p,t,s){return s===void 0?super.off(p,t):(this._delegatedListeners&&this._delegatedListeners[p]&&(c=>{const d=this._delegatedListeners[p];for(let f=0;f<d.length;f++){const x=d[f];if(x.layer===t&&x.listener===s){for(const w in x.delegates)this.off(w,x.delegates[w]);return d.splice(f,1),this}}})(),this)}queryRenderedFeatures(p,t){if(!this.style)return[];let s;const c=p instanceof l.Point||Array.isArray(p),d=c?p:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:p)||{},d instanceof l.Point||typeof d[0]=="number")s=[l.Point.convert(d)];else{const f=l.Point.convert(d[0]),x=l.Point.convert(d[1]);s=[f,new l.Point(x.x,f.y),x,new l.Point(f.x,x.y),f]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(p,t){return this.style.querySourceFeatures(p,t)}setStyle(p,t){return(t=l.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&p?(this._diffStyle(p,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(p,t))}setTransformRequest(p){return this._requestManager.setTransformRequest(p),this}_getUIString(p){const t=this._locale[p];if(t==null)throw new Error(`Missing UI string '${p}'`);return t}_updateStyle(p,t){if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(p,t));const s=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!p)),p?(this.style=new Do(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p,t,s):this.style.loadJSON(p,t,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Do(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,t){if(typeof p=="string"){const s=this._requestManager.transformRequest(p,J.Style);l.getJSON(s,(c,d)=>{c?this.fire(new l.ErrorEvent(c)):d&&this._updateDiff(d,t)})}else typeof p=="object"&&this._updateDiff(p,t)}_updateDiff(p,t){try{this.style.setState(p,t)&&this._update(!0)}catch(s){l.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(p,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.warnOnce("There is no style added to the map.")}addSource(p,t){return this._lazyInitEmptyStyle(),this.style.addSource(p,t),this._update(!0)}isSourceLoaded(p){const t=this.style&&this.style.sourceCaches[p];if(t!==void 0)return t.loaded();this.fire(new l.ErrorEvent(new Error(`There is no source with ID '${p}'`)))}setTerrain(p){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),p){const t=this.style.sourceCaches[p.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${p.source}`);for(const s in this.style._layers){const c=this.style._layers[s];c.type==="hillshade"&&c.source===p.source&&l.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new sh(this.painter,t,p),this.painter.renderToTexture=new $a(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId===p.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new l.Event("terrain",{terrain:p})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const p=this.style&&this.style.sourceCaches;for(const t in p){const s=p[t]._tiles;for(const c in s){const d=s[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}}return!0}addSourceType(p,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(p,t,s)}removeSource(p){return this.style.removeSource(p),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,t,s={}){const{pixelRatio:c=1,sdf:d=!1,stretchX:f,stretchY:x,content:w}=s;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||l.isImageBitmap(t))){if(t.width===void 0||t.height===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:E,height:T,data:k}=t,P=t;return this.style.addImage(p,{data:new l.RGBAImage({width:E,height:T},new Uint8Array(k)),pixelRatio:c,stretchX:f,stretchY:x,content:w,sdf:d,version:0,userImage:P}),P.onAdd&&P.onAdd(this,p),this}}{const{width:E,height:T,data:k}=l.browser.getImageData(t);this.style.addImage(p,{data:new l.RGBAImage({width:E,height:T},k),pixelRatio:c,stretchX:f,stretchY:x,content:w,sdf:d,version:0})}}updateImage(p,t){const s=this.style.getImage(p);if(!s)return this.fire(new l.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||l.isImageBitmap(t)?l.browser.getImageData(t):t,{width:d,height:f,data:x}=c;if(d===void 0||f===void 0)return this.fire(new l.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(d!==s.data.width||f!==s.data.height)return this.fire(new l.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const w=!(t instanceof HTMLImageElement||l.isImageBitmap(t));return s.data.replace(x,w),this.style.updateImage(p,s),this}getImage(p){return this.style.getImage(p)}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new l.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,t){ft.getImage(this._requestManager.transformRequest(p,J.Image),t)}listImages(){return this.style.listImages()}addLayer(p,t){return this._lazyInitEmptyStyle(),this.style.addLayer(p,t),this._update(!0)}moveLayer(p,t){return this.style.moveLayer(p,t),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,t,s){return this.style.setLayerZoomRange(p,t,s),this._update(!0)}setFilter(p,t,s={}){return this.style.setFilter(p,t,s),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,t,s,c={}){return this.style.setPaintProperty(p,t,s,c),this._update(!0)}getPaintProperty(p,t){return this.style.getPaintProperty(p,t)}setLayoutProperty(p,t,s,c={}){return this.style.setLayoutProperty(p,t,s,c),this._update(!0)}getLayoutProperty(p,t){return this.style.getLayoutProperty(p,t)}setGlyphs(p,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(p,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(p,t,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(p,t,s,c=>{c||this._update(!0)}),this}removeSprite(p){return this._lazyInitEmptyStyle(),this.style.removeSprite(p),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(p,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(p,t,s=>{s||this._update(!0)}),this}setLight(p,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(p,t){return this.style.setFeatureState(p,t),this._update()}removeFeatureState(p,t){return this.style.removeFeatureState(p,t),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let p=0,t=0;return this._container&&(p=this._container.clientWidth||400,t=this._container.clientHeight||300),[p,t]}_setupContainer(){const p=this._container;p.classList.add("maplibregl-map");const t=this._canvasContainer=D.create("div","maplibregl-canvas-container",p);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=D.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),c=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],c);const d=this._controlContainer=D.create("div","maplibregl-control-container",p),f=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{f[x]=D.create("div",`maplibregl-ctrl-${x} `,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=D.create("div","maplibregl-cooperative-gesture-screen",this._container);let p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(p=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use  + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${p}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){D.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(p,t,s){this._canvas.width=Math.floor(s*p),this._canvas.height=Math.floor(s*t),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const p={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let t=null;this._canvas.addEventListener("webglcontextcreationerror",c=>{t={requestedAttributes:p},c&&(t.statusMessage=c.statusMessage,t.type=c.type)},{once:!0});const s=this._canvas.getContext("webgl2",p)||this._canvas.getContext("webgl",p);if(!s){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new Hc(s,this.transform),oe.testSupport(s)}_onCooperativeGesture(p,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_render(p){const t=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const d=this.transform.zoom,f=l.browser.now();this.style.zoomHistory.update(d,f);const x=new l.EvaluationParameters(d,{now:f,fadeDuration:t,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),w=x.crossFadingFactor();w===1&&w===this._crossFadingFactor||(s=!0,this._crossFadingFactor=w),this.style.update(x)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,t,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:t,showPadding:this.showPadding}),this.fire(new l.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.load),this.fire(new l.Event("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const c=this._sourcesDirty||this._styleDirty||this._placementDirty;return c||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.Event("idle")),!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,l.PerformanceUtils.mark(l.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var p;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ft.removeThrottleControl(this._imageQueueHandle),(p=this._resizeObserver)===null||p===void 0||p.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),D.remove(this._canvasContainer),D.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),l.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new l.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=l.browser.frame(p=>{l.PerformanceUtils.frame(p),this._frame=null,this._render(p)}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get version(){return ui}getCameraTargetElevation(){return this.transform.elevation}},At.NavigationControl=class{constructor(p){this._updateZoomButtons=()=>{const t=this._map.getZoom(),s=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=t},this._setButtonTitle=(t,s)=>{const c=this._map._getUIString(`NavigationControl.${s}`);t.title=c,t.setAttribute("aria-label",c)},this.options=l.extend({},Us,p),this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),D.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),D.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=D.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new qa(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){D.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(p,t){const s=D.create("button",p,this._container);return s.type="button",s.addEventListener("click",t),s}},At.GeolocateControl=class extends l.Evented{constructor(p){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new l.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.Event("geolocate",t)),this._finish()}},this._updateCamera=t=>{const s=new l.LngLat(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,d=this._map.getBearing(),f=l.extend({bearing:d},this.options.fitBoundsOptions),x=Bt.fromLngLat(s,c);this._map.fitBounds(x,f,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const s=new l.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=t=>{if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&mo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.Event("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=t=>{if(this._map){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=D.create("button","maplibregl-ctrl-geolocate",this._container),D.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){l.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=D.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new js({element:this._dotElement}),this._circleElement=D.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new js({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.Event("trackuserlocationend")))})}},this.options=l.extend({},fu,p)}onAdd(p){return this._map=p,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(t,s=!1){gr===void 0||s?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(c=>{gr=c.state!=="denied",t(gr)}).catch(()=>{gr=!!window.navigator.geolocation,t(gr)}):(gr=!!window.navigator.geolocation,t(gr)):t(gr)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),D.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Yo=0,mo=!1}_isOutOfMapMaxBounds(p){const t=this._map.getMaxBounds(),s=p.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const p=this._map.getBounds(),t=p.getSouthEast(),s=p.getNorthEast(),c=t.distanceTo(s),d=Math.ceil(this._accuracy/(c/this._map._container.clientHeight)*2);this._circleElement.style.width=`${d}px`,this._circleElement.style.height=`${d}px`}trigger(){if(!this._setup)return l.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Yo--,mo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Yo++,Yo>1?(p={maximumAge:6e5,timeout:0},mo=!0):(p=this.options.positionOptions,mo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},At.AttributionControl=Qe,At.LogoControl=at,At.ScaleControl=class{constructor(p){this._onMove=()=>{Ga(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Ga(this._map,this._container,this.options)},this.options=l.extend({},mu,p)}getDefaultPosition(){return"bottom-left"}onAdd(p){return this._map=p,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-scale",p.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){D.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},At.FullscreenControl=class extends l.Evented{constructor(p={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:l.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){D.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const p=this._fullscreenButton=D.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);D.create("span","maplibregl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.title=p}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new l.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},At.TerrainControl=class{constructor(p){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))},this.options=p}onAdd(p){return this._map=p,this._container=D.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=D.create("button","maplibregl-ctrl-terrain",this._container),D.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){D.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},At.Popup=class extends l.Evented{constructor(p){super(),this.remove=()=>(this._content&&D.remove(this._content),this._container&&(D.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new l.Event("close")),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=D.create("div","maplibregl-popup",this._map.getContainer()),this._tip=D.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const x of this.options.className.split(" "))this._container.classList.add(x);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Za(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!t)return;const s=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);let c=this.options.anchor;const d=Wa(this.options.offset);if(!c){const x=this._container.offsetWidth,w=this._container.offsetHeight;let E;E=s.y+d.bottom.y<w?["top"]:s.y>this._map.transform.height-w?["bottom"]:[],s.x<x/2?E.push("left"):s.x>this._map.transform.width-x/2&&E.push("right"),c=E.length===0?"bottom":E.join("-")}const f=s.add(d[c]).round();D.setTransform(this._container,`${Vs[c]} translate(${f.x}px,${f.y}px)`),Ko(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=l.extend(Object.create(gu),p)}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.Event("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(p){return this._lngLat=l.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const t=document.createDocumentFragment(),s=document.createElement("body");let c;for(s.innerHTML=p;c=s.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var p;return(p=this._container)===null||p===void 0?void 0:p.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=D.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(p){this._container&&this._container.classList.add(p)}removeClassName(p){this._container&&this._container.classList.remove(p)}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){if(this._container)return this._container.classList.toggle(p)}_createCloseButton(){this.options.closeButton&&(this._closeButton=D.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Ha);p&&p.focus()}},At.Marker=js,At.Style=Do,At.LngLat=l.LngLat,At.LngLatBounds=Bt,At.Point=l.Point,At.MercatorCoordinate=l.MercatorCoordinate,At.Evented=l.Evented,At.AJAXError=l.AJAXError,At.config=l.config,At.CanvasSource=ge,At.GeoJSONSource=kr,At.ImageSource=lr,At.RasterDEMTileSource=zo,At.RasterTileSource=An,At.VectorTileSource=yn,At.VideoSource=Zr,At.setRTLTextPlugin=l.setRTLTextPlugin,At.getRTLTextPluginStatus=l.getRTLTextPluginStatus,At.prewarm=function(){Gr().acquire(Be)},At.clearPrewarmedResources=function(){const p=Pr;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(Be),Pr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},yu.extend(At,{isSafari:l.isSafari,getPerformanceMetrics:l.PerformanceUtils.getPerformanceMetrics}),At});var M=_;return M})})(Nx);var DS=Nx.exports;const RS=Pd(DS);const Df=({longitude:i,latitude:o,zoom:u,style:g="https://tile.openstreetmap.jp/styles/osm-bright/style.json"})=>st.jsx(bg,{mapLib:RS,initialViewState:{longitude:i,latitude:o,zoom:u},cursor:"default",doubleClickZoom:!1,dragRotate:!1,dragPan:!1,keyboard:!1,scrollZoom:!1,touchPitch:!1,touchZoomRotate:!1,style:{position:"absolute",top:0,display:"block",width:"100%",height:"100%"},mapStyle:g,children:st.jsx(AS,{position:"bottom-right"})}),BS=({src:i})=>st.jsxs("div",{className:"section-background",children:[st.jsx("div",{className:"section-background-overlay"}),st.jsx("img",{src:i})]}),FS="OpenStoryMaps",OS="Open source story telling with Maps by Markdown",NS="2022-12-31",US="yuiseki",VS="./unopengis-dwg7.jpg";function wv(i){const o=Object.assign({section:"section",h2:"h2",p:"p",code:"code",blockquote:"blockquote",a:"a"},i.components);return st.jsxs(st.Fragment,{children:[st.jsxs(o.section,{children:[st.jsx(o.h2,{id:"what-is-this",children:"What is this?"}),st.jsx(o.p,{children:"OpenStoryMaps is a software designed to tell a story along with Maps."}),st.jsx(o.p,{children:`Really many people want to tell their story, with Maps.
They also need to tell their story with Data visualization.`}),st.jsx(o.p,{children:"OpenStoryMaps allows you to tell a story with Maps and Data by simply writing Markdown."}),st.jsx(o.p,{children:`This web page demonstrates what is possible with OpenStoryMaps.
Let's scroll down.`})]}),`
`,st.jsxs(o.section,{children:[st.jsx(o.h2,{id:"usage",children:"Usage"}),st.jsx(BS,{src:"./UNHQ_NYC.jpg"}),st.jsxs(o.p,{children:["OpenStoryMaps create sections by the ",st.jsx(o.code,{children:"h2"})," level heading in markdown."]}),st.jsx(o.p,{children:"You can use background image like this section."}),st.jsx(o.p,{children:"You can use blockquote syntax like below:"}),st.jsxs(o.blockquote,{children:[`
`,st.jsx(o.p,{children:`The United Nations is headquartered in Midtown Manhattan, New York City, United
States, and the complex has served as the official headquarters of the United Nations
since its completion in 1951. It is in the Turtle Bay neighborhood of Manhattan,
on 17 to 18 acres (6.9 to 7.3 ha) of grounds overlooking the East River. Its borders
are First Avenue on the west, East 42nd Street to the south, East 48th Street on
the north, and the East River to the east.`}),`
`]}),st.jsx(o.p,{children:st.jsx(o.a,{href:"https://en.wikipedia.org/wiki/Headquarters_of_the_United_Nations",children:"https://en.wikipedia.org/wiki/Headquarters_of_the_United_Nations"})}),st.jsx(o.p,{children:"OpenStoryMaps is GitHub Flavored Markdown, so URL is automatically linked like the above."})]}),`
`,st.jsxs(o.section,{children:[st.jsx(o.h2,{id:"unhq-ny-usa",children:"UNHQ, NY, USA"}),st.jsx(o.p,{children:"Of course, you can set the Maps to the background of the section."}),st.jsx(Df,{longitude:-73.968056,latitude:40.749444,zoom:15})]}),`
`,st.jsxs(o.section,{children:[st.jsx(o.h2,{id:"ungsc-brindisi-italy",children:"UNGSC, Brindisi, Italy"}),st.jsx(Df,{longitude:17.9466719,latitude:40.6494882,zoom:17}),st.jsxs(o.blockquote,{children:[`
`,st.jsx(o.p,{children:`The United Nations Global Service Centre (UNGSC) is United Nations Peacekeeping office
based in Brindisi, Italy, as well as Valencia, Spain that provides logistics, geospatial
intelligence, IT services and training to peacekeeping and special political missions
around the world.`}),`
`]}),st.jsx(o.p,{children:st.jsx(o.a,{href:"https://en.wikipedia.org/wiki/United_Nations_Global_Service_Centre",children:"https://en.wikipedia.org/wiki/United_Nations_Global_Service_Centre"})})]}),`
`,st.jsxs(o.section,{children:[st.jsx(o.h2,{id:"geospatial-information-authority-of-japan",children:"Geospatial Information Authority of Japan"}),st.jsx(Df,{style:"./gsi_ort.json",longitude:140.084583,latitude:36.104583,zoom:16}),st.jsxs(o.blockquote,{children:[`
`,st.jsx(o.p,{children:`The Geospatial Information Authority of Japan (, Kokudo Chiri-in), or GSI, is
the national institution responsible for surveying and mapping the national land of Japan.
The former name of the organization from 1949 until March 2010 was Geographical Survey Institute;
despite the rename, it retains the same initials.`}),`
`]}),st.jsx(o.p,{children:st.jsx(o.a,{href:"https://en.wikipedia.org/wiki/Geospatial_Information_Authority_of_Japan",children:"https://en.wikipedia.org/wiki/Geospatial_Information_Authority_of_Japan"})})]})]})}function jS(i={}){const{wrapper:o}=i.components||{};return o?st.jsx(o,Object.assign({},i,{children:st.jsx(wv,i)})):wv(i)}const $S=()=>(mt.useEffect(()=>(pv.init({tocSelector:"#toc",contentSelector:"#root",headingSelector:"h2"}),()=>pv.destroy()),[]),st.jsxs(st.Fragment,{children:[st.jsxs("section",{id:"hero",children:[st.jsx("div",{id:"hero-background",children:st.jsx("img",{src:VS})}),st.jsx("div",{id:"hero-overlay"}),st.jsxs("div",{id:"hero-content",children:[st.jsx("h1",{children:FS}),st.jsx("div",{children:OS}),st.jsx("div",{children:US}),st.jsx("div",{children:NS})]})]}),st.jsx("div",{id:"toc"}),st.jsx(jS,{})]}));iS.render(st.jsx(Gw.StrictMode,{children:st.jsx($S,{})}),document.getElementById("root"));
